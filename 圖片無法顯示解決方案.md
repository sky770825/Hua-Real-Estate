# ğŸ” åœ–ç‰‡ç„¡æ³•é¡¯ç¤º - è§£æ±ºæ–¹æ¡ˆ

## å•é¡Œè¨ºæ–·

å¦‚æœåˆ¥äººçœ‹ä¸åˆ°åœ–ç‰‡ï¼Œé€šå¸¸æ˜¯ä»¥ä¸‹åŸå› ï¼š

### 1. å­˜å„²æ¡¶æœªè¨­ç½®ç‚ºå…¬é–‹ âš ï¸ **æœ€å¸¸è¦‹**

### 2. RLS ç­–ç•¥æœªæ­£ç¢ºé…ç½®

### 3. åœ–ç‰‡ URL æ ¼å¼ä¸æ­£ç¢º

---

## âœ… è§£æ±ºæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šæª¢æŸ¥å­˜å„²æ¡¶æ˜¯å¦ç‚ºå…¬é–‹

1. è¨ªå• Supabase Dashboardï¼š
   - https://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/storage/buckets

2. æ‰¾åˆ° `hua-real-estate` å­˜å„²æ¡¶

3. é»æ“Šå­˜å„²æ¡¶åç¨±é€²å…¥è¨­ç½®

4. **æª¢æŸ¥ "Public bucket" é¸é …**ï¼š
   - âœ… å¿…é ˆå‹¾é¸ "Public bucket"
   - å¦‚æœæ²’æœ‰å‹¾é¸ï¼Œé»æ“Šåˆ‡æ›é–‹é—œå•Ÿç”¨

5. ä¿å­˜è¨­ç½®

### æ­¥é©Ÿ 2ï¼šæª¢æŸ¥ RLS ç­–ç•¥

1. è¨ªå• Supabase Dashboardï¼š
   - https://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/storage/policies

2. æ‰¾åˆ° `hua-real-estate` å­˜å„²æ¡¶çš„ç­–ç•¥

3. **ç¢ºèªæœ‰ä»¥ä¸‹ç­–ç•¥**ï¼š
   - âœ… `Allow public read from hua-real-estate` (SELECT)
   - âœ… `Allow public uploads to hua-real-estate project` (INSERT)

4. **å¦‚æœæ²’æœ‰ç­–ç•¥ï¼ŒåŸ·è¡Œ SQL**ï¼š
   - æ‰“é–‹ SQL Editorï¼šhttps://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/sql/new
   - è¤‡è£½ä¸¦åŸ·è¡Œ `supabase-storage-policies.sql` æ–‡ä»¶ä¸­çš„ SQL

### æ­¥é©Ÿ 3ï¼šé©—è­‰åœ–ç‰‡ URL

1. æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰

2. æŸ¥çœ‹ Console æ¨™ç±¤ï¼Œæ‰¾åˆ°åœ–ç‰‡ URL

3. **æ¸¬è©¦åœ–ç‰‡ URL**ï¼š
   - è¤‡è£½åœ–ç‰‡ URL
   - åœ¨æ–°æ¨™ç±¤é ä¸­æ‰“é–‹
   - å¦‚æœé¡¯ç¤ºåœ–ç‰‡ â†’ URL æ­£ç¢º
   - å¦‚æœé¡¯ç¤ºéŒ¯èª¤ â†’ æª¢æŸ¥å­˜å„²æ¡¶è¨­ç½®

### æ­¥é©Ÿ 4ï¼šæª¢æŸ¥åœ–ç‰‡è·¯å¾‘

åœ–ç‰‡ URL æ ¼å¼æ‡‰è©²æ˜¯ï¼š
```
https://sqgrnowrcvspxhuudrqc.supabase.co/storage/v1/object/public/hua-real-estate/hua-real-estate/invite-photo/image1_xxx.jpg
```

**è·¯å¾‘çµæ§‹**ï¼š
- `hua-real-estate` = å­˜å„²æ¡¶åç¨±
- `hua-real-estate/invite-photo/` = æ–‡ä»¶è·¯å¾‘
- `image1_xxx.jpg` = æ–‡ä»¶å

---

## ğŸ”§ å¿«é€Ÿä¿®å¾©

### æ–¹æ³• 1ï¼šä½¿ç”¨ SQL å¿«é€Ÿé…ç½®ï¼ˆæ¨è–¦ï¼‰

1. è¨ªå• SQL Editorï¼š
   - https://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/sql/new

2. åŸ·è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- ç¢ºä¿å­˜å„²æ¡¶å­˜åœ¨ä¸”ç‚ºå…¬é–‹
-- æ³¨æ„ï¼šé€™éœ€è¦åœ¨ Supabase Dashboard ä¸­æ‰‹å‹•è¨­ç½®å­˜å„²æ¡¶ç‚ºå…¬é–‹

-- åˆªé™¤èˆŠç­–ç•¥
DROP POLICY IF EXISTS "Allow public read from hua-real-estate" ON storage.objects;
DROP POLICY IF EXISTS "Allow public uploads to hua-real-estate project" ON storage.objects;

-- å‰µå»ºè®€å–ç­–ç•¥ï¼ˆå…è¨±æ‰€æœ‰äººè®€å–ï¼‰
CREATE POLICY "Allow public read from hua-real-estate"
ON storage.objects
FOR SELECT
TO public
USING (
  bucket_id = 'hua-real-estate' 
  AND (storage.foldername(name))[1] = 'hua-real-estate'
);

-- å‰µå»ºä¸Šå‚³ç­–ç•¥ï¼ˆå…è¨±åŒ¿åä¸Šå‚³ï¼‰
CREATE POLICY "Allow public uploads to hua-real-estate project"
ON storage.objects
FOR INSERT
TO public
WITH CHECK (
  bucket_id = 'hua-real-estate' 
  AND (storage.foldername(name))[1] = 'hua-real-estate'
);
```

3. é»æ“Š "Run" åŸ·è¡Œ

### æ–¹æ³• 2ï¼šé€šé Dashboard è¨­ç½®

1. **è¨­ç½®å­˜å„²æ¡¶ç‚ºå…¬é–‹**ï¼š
   - Storage â†’ Buckets â†’ `hua-real-estate`
   - é–‹å•Ÿ "Public bucket" é–‹é—œ
   - ä¿å­˜

2. **æª¢æŸ¥ç­–ç•¥**ï¼š
   - Storage â†’ Policies
   - ç¢ºèªæœ‰è®€å–ç­–ç•¥

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1ï¼šç›´æ¥è¨ªå•åœ–ç‰‡ URL

1. å¾æ•¸æ“šåº«ç²å–åœ–ç‰‡ URL
2. åœ¨æ–°æ¨™ç±¤é æ‰“é–‹
3. æ‡‰è©²èƒ½çœ‹åˆ°åœ–ç‰‡

### æ¸¬è©¦ 2ï¼šæª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°

1. æ‰“é–‹ç¶²é 
2. æŒ‰ F12 æ‰“é–‹é–‹ç™¼è€…å·¥å…·
3. æŸ¥çœ‹ Console æ¨™ç±¤
4. æŸ¥çœ‹ Network æ¨™ç±¤
5. æª¢æŸ¥åœ–ç‰‡è«‹æ±‚æ˜¯å¦æˆåŠŸï¼ˆç‹€æ…‹ç¢¼ 200ï¼‰

### æ¸¬è©¦ 3ï¼šæª¢æŸ¥åœ–ç‰‡å…ƒç´ 

1. å³éµé»æ“Šåœ–ç‰‡
2. é¸æ“‡ "æª¢æŸ¥å…ƒç´ "
3. æŸ¥çœ‹ `src` å±¬æ€§
4. è¤‡è£½ URL åœ¨æ–°æ¨™ç±¤é æ‰“é–‹æ¸¬è©¦

---

## âš ï¸ å¸¸è¦‹éŒ¯èª¤

### éŒ¯èª¤ 1ï¼š403 Forbidden
**åŸå› **ï¼šå­˜å„²æ¡¶æœªè¨­ç½®ç‚ºå…¬é–‹æˆ– RLS ç­–ç•¥ä¸æ­£ç¢º
**è§£æ±º**ï¼šåŸ·è¡Œæ­¥é©Ÿ 1 å’Œ 2

### éŒ¯èª¤ 2ï¼š404 Not Found
**åŸå› **ï¼šåœ–ç‰‡è·¯å¾‘ä¸æ­£ç¢ºæˆ–æ–‡ä»¶ä¸å­˜åœ¨
**è§£æ±º**ï¼šæª¢æŸ¥æ–‡ä»¶è·¯å¾‘å’Œæ•¸æ“šåº«è¨˜éŒ„

### éŒ¯èª¤ 3ï¼šCORS éŒ¯èª¤
**åŸå› **ï¼šè·¨åŸŸå•é¡Œï¼ˆé€šå¸¸ä¸æœƒç™¼ç”Ÿï¼Œå› ç‚ºä½¿ç”¨ Supabaseï¼‰
**è§£æ±º**ï¼šæª¢æŸ¥ Supabase é…ç½®

---

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

å®Œæˆä»¥ä¸‹æª¢æŸ¥ï¼š

- [ ] å­˜å„²æ¡¶ `hua-real-estate` å·²è¨­ç½®ç‚ºå…¬é–‹ï¼ˆPublic bucketï¼‰
- [ ] RLS ç­–ç•¥å·²æ­£ç¢ºé…ç½®ï¼ˆSELECT ç­–ç•¥å­˜åœ¨ï¼‰
- [ ] åœ–ç‰‡ URL æ ¼å¼æ­£ç¢º
- [ ] åœ–ç‰‡æ–‡ä»¶ç¢ºå¯¦å­˜åœ¨æ–¼å­˜å„²æ¡¶ä¸­
- [ ] ç€è¦½å™¨æ§åˆ¶å°æ²’æœ‰éŒ¯èª¤
- [ ] å¯ä»¥ç›´æ¥è¨ªå•åœ–ç‰‡ URL

---

## ğŸ†˜ å¦‚æœé‚„æ˜¯ç„¡æ³•é¡¯ç¤º

1. **æª¢æŸ¥ Supabase é …ç›®ç‹€æ…‹**ï¼š
   - ç¢ºèªé …ç›®æ²’æœ‰æš«åœ
   - ç¢ºèªæ²’æœ‰é”åˆ°é…é¡é™åˆ¶

2. **æª¢æŸ¥ç¶²çµ¡é€£æ¥**ï¼š
   - ç¢ºèªå¯ä»¥è¨ªå• Supabase
   - æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®

3. **æ¸…é™¤ç€è¦½å™¨ç·©å­˜**ï¼š
   - æ¸…é™¤ç·©å­˜å’Œ Cookie
   - ä½¿ç”¨ç„¡ç—•æ¨¡å¼æ¸¬è©¦

4. **æª¢æŸ¥åœ–ç‰‡æ–‡ä»¶**ï¼š
   - ç¢ºèªåœ–ç‰‡æ–‡ä»¶ç¢ºå¯¦ä¸Šå‚³æˆåŠŸ
   - æª¢æŸ¥æ–‡ä»¶å¤§å°å’Œæ ¼å¼

---

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœä»¥ä¸Šæ­¥é©Ÿéƒ½ç„¡æ³•è§£æ±ºï¼Œè«‹æä¾›ï¼š
1. ç€è¦½å™¨æ§åˆ¶å°çš„éŒ¯èª¤ä¿¡æ¯
2. Network æ¨™ç±¤ä¸­åœ–ç‰‡è«‹æ±‚çš„ç‹€æ…‹ç¢¼
3. åœ–ç‰‡ URLï¼ˆå¯ä»¥æ¸¬è©¦çš„ï¼‰
4. Supabase Dashboard ä¸­å­˜å„²æ¡¶çš„è¨­ç½®æˆªåœ–
