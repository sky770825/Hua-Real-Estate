# 圖片上傳功能配置說明

## 功能概述

在 `invite.html` 中已添加圖片上傳功能，包含：
- 密碼保護（密碼：888）
- 兩個圖片上傳區域
- 拖放上傳支持
- 上傳進度顯示
- 上傳到 Cloudflare R2 存儲

## 配置方法

### 方法 1：使用 Cloudflare Workers（推薦）

這是最安全的方法，不會在前端暴露訪問憑證。

#### 步驟 1：創建 Cloudflare Worker

1. 登錄 Cloudflare Dashboard
2. 進入 Workers & Pages
3. 創建一個新的 Worker
4. 將 `r2-upload-worker.js` 中的代碼複製到 Worker 編輯器

#### 步驟 2：配置 R2 綁定

1. 在 Worker 設置中，點擊「Variables」
2. 在「R2 Bucket Bindings」中添加綁定：
   - Variable name: `R2_BUCKET`
   - R2 Bucket: 選擇您的 `hua-real-estate` 存儲桶

#### 步驟 3：部署 Worker

1. 點擊「Save and Deploy」
2. 記下 Worker 的 URL（例如：`https://your-worker.your-subdomain.workers.dev`）

#### 步驟 4：配置前端

在 `invite.html` 中，找到 `R2_CONFIG` 配置，設置 `apiEndpoint`：

```javascript
const R2_CONFIG = {
    endpoint: 'https://82ebeb1d91888e83e8e1b30eeb33d3c3.r2.cloudflarestorage.com',
    bucketName: 'hua-real-estate',
    apiEndpoint: 'https://your-worker.your-subdomain.workers.dev', // 設置為您的 Worker URL
    accessKeyId: '',
    secretAccessKey: ''
};
```

### 方法 2：直接使用 R2 API（僅測試用，不推薦）

⚠️ **警告**：此方法會在前端暴露訪問憑證，不適合生產環境使用。

1. 在 Cloudflare Dashboard 獲取 R2 的 Access Key ID 和 Secret Access Key
2. 在 `invite.html` 中配置：

```javascript
const R2_CONFIG = {
    endpoint: 'https://82ebeb1d91888e83e8e1b30eeb33d3c3.r2.cloudflarestorage.com',
    bucketName: 'hua-real-estate',
    apiEndpoint: '', // 留空
    accessKeyId: 'your-access-key-id', // 您的 Access Key ID
    secretAccessKey: 'your-secret-access-key' // 您的 Secret Access Key
};
```

## 使用說明

1. 打開 `invite.html` 頁面
2. 滾動到「圖片上傳管理」區域
3. 輸入密碼：`888`
4. 點擊「確認」按鈕
5. 選擇或拖放兩張圖片
6. 點擊「上傳圖片」按鈕
7. 等待上傳完成，系統會顯示上傳成功的 URL

## 上傳的圖片位置

圖片會上傳到 `hua-real-estate/invite-photo/` 目錄：
```
https://82ebeb1d91888e83e8e1b30eeb33d3c3.r2.cloudflarestorage.com/hua-real-estate/invite-photo/image1_[timestamp].[ext]
https://82ebeb1d91888e83e8e1b30eeb33d3c3.r2.cloudflarestorage.com/hua-real-estate/invite-photo/image2_[timestamp].[ext]
```

## 注意事項

1. **安全性**：強烈建議使用方法 1（Cloudflare Workers），避免在前端暴露訪問憑證
2. **文件大小**：單個圖片最大 10MB
3. **文件類型**：只支持圖片格式（jpg, png, gif, webp 等）
4. **密碼保護**：上傳功能需要密碼 888 才能使用
5. **CORS**：如果遇到 CORS 錯誤，請在 R2 存儲桶設置中配置允許的來源

## 故障排除

### 上傳失敗

1. 檢查網絡連接
2. 確認 R2 配置正確
3. 檢查瀏覽器控制台的錯誤信息
4. 確認文件大小不超過 10MB
5. 確認文件是圖片格式

### CORS 錯誤

如果使用直接上傳方法，需要在 R2 存儲桶設置中：
1. 進入 Cloudflare Dashboard
2. 選擇 R2 存儲桶
3. 在設置中配置 CORS 規則，允許您的域名

### Worker 部署問題

1. 確認 Worker 代碼沒有語法錯誤
2. 確認 R2 綁定配置正確
3. 檢查 Worker 日誌獲取詳細錯誤信息

## 技術支持

如有問題，請檢查：
- 瀏覽器控制台的錯誤信息
- Cloudflare Workers 的日誌
- R2 存儲桶的設置
