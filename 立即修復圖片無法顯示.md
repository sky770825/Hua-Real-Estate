# ğŸš€ ç«‹å³ä¿®å¾©åœ–ç‰‡ç„¡æ³•é¡¯ç¤º

## âš¡ å¿«é€Ÿä¿®å¾©ï¼ˆ2 æ­¥ï¼‰

### æ­¥é©Ÿ 1ï¼šåŸ·è¡Œ RLS ç­–ç•¥ SQLï¼ˆæœ€é‡è¦ï¼ï¼‰

1. **è¨ªå• SQL Editor**ï¼š
   - https://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/sql/new

2. **è¤‡è£½ä¸¦åŸ·è¡Œä»¥ä¸‹ SQL**ï¼š
   - æ‰“é–‹ `å¿«é€Ÿä¿®å¾©RLSç­–ç•¥.sql` æ–‡ä»¶
   - è¤‡è£½å…¨éƒ¨å…§å®¹
   - è²¼åˆ° SQL Editor
   - é»æ“Š "Run" åŸ·è¡Œ

3. **ç¢ºèªåŸ·è¡ŒæˆåŠŸ**ï¼š
   - æ‡‰è©²çœ‹åˆ° "Success. No rows returned" æˆ–é¡ä¼¼çš„æˆåŠŸæ¶ˆæ¯

### æ­¥é©Ÿ 2ï¼šè¨­ç½®å­˜å„²æ¡¶ç‚ºå…¬é–‹ï¼ˆå¿…é ˆï¼ï¼‰

1. **è¨ªå•å­˜å„²æ¡¶è¨­ç½®**ï¼š
   - https://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/storage/buckets

2. **æ‰¾åˆ°å­˜å„²æ¡¶**ï¼š
   - é»æ“Š `hua-real-estate` å­˜å„²æ¡¶åç¨±

3. **é–‹å•Ÿå…¬é–‹è¨­ç½®**ï¼š
   - æ‰¾åˆ° "Public bucket" é¸é …
   - **é–‹å•Ÿé–‹é—œ**ï¼ˆå¿…é ˆé–‹å•Ÿï¼ï¼‰
   - é»æ“Š "Save" ä¿å­˜

4. **ç¢ºèªè¨­ç½®**ï¼š
   - å­˜å„²æ¡¶æ‡‰è©²é¡¯ç¤ºç‚º "Public"

---

## âœ… å®Œæˆå¾Œæ¸¬è©¦

1. **åˆ·æ–°ç¶²é **
2. **æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·**ï¼ˆF12ï¼‰
3. **æŸ¥çœ‹ Console æ¨™ç±¤**ï¼š
   - æ‡‰è©²çœ‹åˆ° `âœ… åœ–ç‰‡å¯è¨ªå•` çš„æ¶ˆæ¯
   - å¦‚æœçœ‹åˆ° `âŒ åœ–ç‰‡ç„¡æ³•è¨ªå•`ï¼Œè«‹æª¢æŸ¥æ­¥é©Ÿ 2

---

## ğŸ” å¦‚æœé‚„æ˜¯ç„¡æ³•é¡¯ç¤º

### æª¢æŸ¥æ¸…å–®ï¼š

- [ ] SQL å·²æˆåŠŸåŸ·è¡Œï¼ˆæ²’æœ‰éŒ¯èª¤ï¼‰
- [ ] å­˜å„²æ¡¶å·²è¨­ç½®ç‚ºå…¬é–‹ï¼ˆPublic bucket å·²é–‹å•Ÿï¼‰
- [ ] ç€è¦½å™¨æ§åˆ¶å°æ²’æœ‰ 403 éŒ¯èª¤
- [ ] åœ–ç‰‡ URL æ ¼å¼æ­£ç¢ºï¼ˆåŒ…å« `/storage/v1/object/public/`ï¼‰

### é©—è­‰ RLS ç­–ç•¥ï¼š

1. è¨ªå•ï¼šhttps://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/storage/policies
2. æ‰¾åˆ° `hua-real-estate` å­˜å„²æ¡¶
3. ç¢ºèªæœ‰ä»¥ä¸‹ç­–ç•¥ï¼š
   - âœ… `Allow public read all from hua-real-estate bucket` (SELECT)
   - âœ… `Allow public uploads to hua-real-estate project` (INSERT)

---

## ğŸ“‹ SQL å…§å®¹ï¼ˆå¦‚æœæ–‡ä»¶æ‰“ä¸é–‹ï¼‰

å¦‚æœç„¡æ³•æ‰“é–‹ `å¿«é€Ÿä¿®å¾©RLSç­–ç•¥.sql` æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥è¤‡è£½ä»¥ä¸‹ SQLï¼š

```sql
-- åˆªé™¤æ‰€æœ‰ç¾æœ‰ç­–ç•¥
DROP POLICY IF EXISTS "Allow public read from hua-real-estate" ON storage.objects;
DROP POLICY IF EXISTS "Allow public read all from hua-real-estate bucket" ON storage.objects;
DROP POLICY IF EXISTS "Allow public uploads to hua-real-estate project" ON storage.objects;
DROP POLICY IF EXISTS "Allow public update in hua-real-estate" ON storage.objects;
DROP POLICY IF EXISTS "Allow public delete in hua-real-estate" ON storage.objects;

-- å‰µå»ºæœ€å¯¬é¬†çš„è®€å–ç­–ç•¥ï¼ˆå…è¨±è®€å–æ•´å€‹å­˜å„²æ¡¶çš„æ‰€æœ‰æ–‡ä»¶ï¼‰
CREATE POLICY "Allow public read all from hua-real-estate bucket"
ON storage.objects
FOR SELECT
TO public
USING (bucket_id = 'hua-real-estate');

-- å‰µå»ºä¸Šå‚³ç­–ç•¥
CREATE POLICY "Allow public uploads to hua-real-estate project"
ON storage.objects
FOR INSERT
TO public
WITH CHECK (
  bucket_id = 'hua-real-estate' 
  AND (storage.foldername(name))[1] = 'hua-real-estate'
);

-- å‰µå»ºåˆªé™¤ç­–ç•¥
CREATE POLICY "Allow public delete in hua-real-estate"
ON storage.objects
FOR DELETE
TO public
USING (
  bucket_id = 'hua-real-estate' 
  AND (storage.foldername(name))[1] = 'hua-real-estate'
);
```

---

## ğŸ¯ é—œéµé»

1. **RLS ç­–ç•¥å¿…é ˆé…ç½®** - åŸ·è¡Œ SQL
2. **å­˜å„²æ¡¶å¿…é ˆå…¬é–‹** - é–‹å•Ÿ Public bucket é–‹é—œ
3. **å…©è€…ç¼ºä¸€ä¸å¯** - å¿…é ˆåŒæ™‚å®Œæˆ

å®Œæˆé€™å…©æ­¥å¾Œï¼Œåœ–ç‰‡æ‡‰è©²å¯ä»¥æ­£å¸¸é¡¯ç¤ºäº†ï¼
