# 🖼️ 自動圖片壓縮功能

## ✅ 功能說明

系統已實現**自動圖片壓縮功能**，當您上傳獎品圖片時，系統會自動壓縮圖片以：
- ✅ 減少儲存空間
- ✅ 加快上傳速度
- ✅ 提高網頁載入速度
- ✅ 節省頻寬使用

## 📋 功能特點

### 1. 自動壓縮
- **觸發時機**：選擇圖片檔案後自動開始壓縮
- **壓縮目標**：將圖片壓縮到 **2MB 以下**
- **最大尺寸**：限制圖片最大寬度/高度為 **1920px**
- **品質設定**：使用 **80% 品質**（平衡檔案大小和圖片品質）

### 2. 檔案大小限制
- **前端限制**：最大 **50MB**（Supabase 免費方案限制）
- **自動處理**：超過限制的檔案會自動壓縮
- **支援格式**：JPG、PNG、GIF、WebP

### 3. 用戶體驗
- **即時反饋**：顯示壓縮進度指示器
- **壓縮資訊**：顯示原始大小、壓縮後大小、壓縮比例
- **錯誤處理**：壓縮失敗時自動使用原始檔案

## 🎯 使用方式

### 新增獎品時
1. 點擊「新增獎品」
2. 選擇圖片檔案（最大 50MB）
3. 系統自動開始壓縮（顯示「正在壓縮圖片...」）
4. 壓縮完成後顯示：
   - ✓ 壓縮完成
   - 原始大小：X MB
   - 壓縮後：Y MB
   - 減少：Z%
5. 點擊「儲存」上傳

### 編輯獎品時
- 如果選擇新圖片，會自動壓縮
- 如果不選擇新圖片，保持原有圖片

## 📊 壓縮效果

### 典型壓縮比例
- **高解析度照片**（5-10MB）：通常可壓縮到 **1-2MB**（減少 60-80%）
- **中等解析度照片**（2-5MB）：通常可壓縮到 **0.5-1.5MB**（減少 50-70%）
- **小檔案**（< 2MB）：可能不需要壓縮或輕微壓縮

### 品質保證
- **80% 品質**：在檔案大小和視覺品質之間取得良好平衡
- **1920px 限制**：適合網頁顯示，不會過度縮小
- **自動調整**：系統會自動調整壓縮參數以達到目標大小

## 🔧 技術細節

### 使用的庫
- **browser-image-compression**：瀏覽器端圖片壓縮庫
- **支援格式**：JPEG、PNG、GIF、WebP
- **壓縮方式**：使用 Canvas API 進行壓縮

### 壓縮參數
```typescript
{
  maxSizeMB: 2,              // 目標檔案大小：2MB
  maxWidthOrHeight: 1920,     // 最大寬度/高度：1920px
  initialQuality: 0.8,       // 初始品質：80%
  useWebWorker: true,         // 使用 Web Worker（提升效能）
  preserveExif: false         // 不保留 EXIF 資料（減少檔案大小）
}
```

### 檔案位置
- **壓縮工具**：`lib/image-compression.ts`
- **前端整合**：`app/admin/attendance_management/page.tsx`
- **API 驗證**：`app/api/prizes/route.ts`、`app/api/prizes/[id]/route.ts`

## ⚙️ 自訂設定

如果需要調整壓縮設定，可以修改 `app/admin/attendance_management/page.tsx` 中的壓縮參數：

```typescript
const compressedFile = await compressImage(file, {
  maxSizeMB: 2,              // 調整目標大小（MB）
  maxWidthOrHeight: 1920,   // 調整最大尺寸（像素）
  initialQuality: 0.8,     // 調整品質（0-1）
})
```

### 建議設定
- **高品質需求**：`initialQuality: 0.9`，`maxSizeMB: 3`
- **平衡設定**：`initialQuality: 0.8`，`maxSizeMB: 2`（預設）
- **最小檔案**：`initialQuality: 0.6`，`maxSizeMB: 1`

## 🚨 注意事項

1. **壓縮時間**：大檔案（> 10MB）可能需要幾秒鐘壓縮
2. **瀏覽器支援**：需要支援 Canvas API 的現代瀏覽器
3. **記憶體使用**：超大檔案可能會消耗較多記憶體
4. **失敗處理**：如果壓縮失敗，系統會使用原始檔案上傳

## 📈 效益

### 儲存空間節省
- 假設平均壓縮 60%，100 張圖片可節省約 **300MB** 儲存空間

### 上傳速度提升
- 2MB 檔案比 10MB 檔案上傳速度快 **5 倍**

### 網頁載入速度
- 較小的圖片檔案可以顯著提升網頁載入速度
- 特別是在行動裝置上效果更明顯

## ✅ 測試建議

1. **測試不同大小的圖片**：
   - 小檔案（< 1MB）
   - 中等檔案（1-5MB）
   - 大檔案（5-20MB）
   - 超大檔案（20-50MB）

2. **測試不同格式**：
   - JPEG
   - PNG
   - GIF
   - WebP

3. **檢查壓縮效果**：
   - 確認壓縮後檔案大小
   - 確認圖片品質是否可接受
   - 確認上傳速度

---

**功能完成時間**：2026-01-13  
**版本**：v1.1.0
