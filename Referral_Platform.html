<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å° - å°ˆæ¥­çš„ä¸å‹•ç”¢æœå‹™å¼•è–¦ç³»çµ±ï¼Œæä¾›å®Œæ•´çš„ä¸Šä¸‹æ¸¸ç”¢æ¥­éˆæœå‹™è³‡æºæ•´åˆ">
    <meta name="keywords" content="ä¸å‹•ç”¢,å¼•è–¦,æœå‹™,è¯åœ°ç”¢,æˆ¿åœ°ç”¢,å»ºç¯‰,å®¤å…§è¨­è¨ˆ,å·¥ç¨‹,ç‰©æ¥­ç®¡ç†">
    <meta name="author" content="è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒ">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°">
    <meta property="og:description" content="å°ˆæ¥­çš„ä¸å‹•ç”¢æœå‹™å¼•è–¦ç³»çµ±ï¼Œæä¾›å®Œæ•´çš„ä¸Šä¸‹æ¸¸ç”¢æ¥­éˆæœå‹™è³‡æºæ•´åˆ">
    <meta property="og:locale" content="zh_TW">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°">
    <meta name="twitter:description" content="å°ˆæ¥­çš„ä¸å‹•ç”¢æœå‹™å¼•è–¦ç³»çµ±">
    
    <!-- Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°",
        "description": "å°ˆæ¥­çš„ä¸å‹•ç”¢æœå‹™å¼•è–¦ç³»çµ±ï¼Œæä¾›å®Œæ•´çš„ä¸Šä¸‹æ¸¸ç”¢æ¥­éˆæœå‹™è³‡æºæ•´åˆ",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "TWD"
        }
    }
    </script>
    
    <!-- DOMPurify for XSS Protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* æ‰‹æ©Ÿç‰ˆå…è¨±æ»¾å‹• */
        @media (max-width: 768px) {
            body {
                overflow: auto;
                overflow-x: hidden;
            }
            
            .app-container {
                min-height: 100vh;
                height: auto;
            }
        }

        .app-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(255,255,255,0.05) 0%, transparent 50%);
        }

        /* é ‚éƒ¨æ§åˆ¶æ¬„ */
        .top-controls {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 18px 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-container {
            flex: 1;
            max-width: 650px;
            position: relative;
            margin: 0 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 16px;
        }

        .search-clear-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 16px;
            color: #999;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-clear-btn:hover {
            background: #f1f3f4;
            color: #667eea;
        }

        .search-input:not(:placeholder-shown) + .search-clear-btn {
            opacity: 1;
        }

        /* æœç´¢çµæœå¢å¼·æ¨£å¼ */
        .search-result-item {
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: #e3e8ff !important;
            transform: translateX(5px);
        }

        .search-result-item.highlight {
            background: #fff3cd !important;
            border-left-color: #ffc107 !important;
        }

        .search-highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
            color: #856404;
        }

        /* æœç´¢æ­·å²æ¨£å¼ */
        .search-history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
        }

        .search-history-item:hover {
            background: #f8f9fa;
        }

        .search-history-icon {
            font-size: 14px;
            color: #999;
        }

        .search-history-delete {
            margin-left: auto;
            opacity: 0;
            transition: opacity 0.2s ease;
            cursor: pointer;
            color: #dc3545;
            font-size: 12px;
        }

        .search-history-item:hover .search-history-delete {
            opacity: 1;
        }

        /* ä½¿ç”¨èªªæ˜æ¡† */
        .usage-notice {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #fff3cd, #ffe69c);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 15px 25px;
            box-shadow: 0 4px 20px rgba(255, 193, 7, 0.3);
            z-index: 999;
            max-width: 90%;
            width: 600px;
            transition: all 0.3s ease;
            animation: slideDown 0.5s ease-out;
        }

        .usage-notice.collapsed {
            height: 0;
            padding: 0;
            opacity: 0;
            overflow: hidden;
            margin: 0;
            border: none;
        }

        .usage-notice-content {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            color: #856404;
            line-height: 1.6;
        }

        .usage-notice-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .usage-notice-text {
            flex: 1;
            font-weight: 500;
        }

        .usage-notice-text strong {
            color: #856404;
            font-weight: 700;
        }

        .usage-notice-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #856404;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            flex-shrink: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .usage-notice-close:hover {
            background: rgba(133, 100, 4, 0.1);
            color: #5c3f00;
        }

        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ç†±é–€æœç´¢æ¨™ç±¤ */
        .popular-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .popular-tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .popular-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* æ‘ºç–Š/å±•é–‹æ§åˆ¶ */
        .collapse-control {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            font-size: 12px;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .collapse-control:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .control-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.8);
            color: #666;
            border: 1px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: white;
            transform: translateY(-1px);
        }

        /* å¿ƒæ™ºåœ–å®¹å™¨ */
        .mindmap-container {
            width: 100%;
            height: calc(100vh - 80px);
            margin-top: 80px;
            position: relative;
            overflow: auto;
            cursor: grab;
            transition: margin-top 0.3s ease;
        }

        /* æ‰‹æ©Ÿç‰ˆå¿ƒæ™ºåœ–å®¹å™¨èª¿æ•´ */
        @media (max-width: 768px) {
            .mindmap-container {
                height: auto;
                min-height: calc(100vh - 80px);
                overflow: visible;
                padding-bottom: 40px;
            }
        }

        /* ç•¶ä½¿ç”¨èªªæ˜æ¡†æ”¶åˆæ™‚ï¼Œèª¿æ•´å¿ƒæ™ºåœ–å®¹å™¨ */
        .mindmap-container.with-notice {
            margin-top: 150px;
        }

        .mindmap-container:active {
            cursor: grabbing;
        }

        .mindmap-container.dragging {
            cursor: grabbing;
        }

        .mindmap-content {
            position: relative;
            width: 100%;
            min-height: 100%;
            transition: all 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        /* ä¸­å¿ƒç¯€é» */
        .center-node {
            display: none;
        }

        .center-node:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 50px rgba(255, 107, 107, 0.4);
        }

        .center-node.pulse {
            animation: pulse 2s infinite;
        }

        /* åˆ†æ”¯ç¯€é» */
        .branch {
            position: absolute;
            transform-origin: center;
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .branch.active {
            opacity: 1;
        }

        .branch-node {
            background: white;
            color: #333;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            white-space: nowrap;
            max-width: 200px;
            min-width: 160px;
            text-align: center;
            line-height: 1.3;
            position: relative;
            width: fit-content;
            word-wrap: break-word;
            hyphens: auto;
        }

        .branch-node:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .branch-node.has-children::after {
            content: "â–¶";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #667eea;
            transition: transform 0.3s ease;
        }

        .branch-node.expanded::after {
            transform: translateY(-50%) rotate(90deg);
        }

        /* å­åˆ†æ”¯ */
        .sub-branch {
            position: absolute;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* æ‰‹æ©Ÿç‰ˆå…©æ¬„ä½ˆå±€ - é‡å°çµ•å°å®šä½çš„ç‰¹æ®Šè™•ç† */
        @media (max-width: 768px) {
            .sub-branch {
                width: auto !important;
                max-width: 90vw !important;
            }
            
            /* ä½¿ç”¨ flex-wrap å¯¦ç¾å…©æ¬„æ•ˆæœ */
            .sub-branch .sub-node {
                display: inline-block !important;
                width: calc(50% - 6px) !important;
                max-width: calc(50% - 6px) !important;
                min-width: 0 !important;
                margin: 2px !important;
                vertical-align: top !important;
            }
        }

        .sub-branch.active {
            opacity: 1;
        }

        .sub-node {
            background: #f8f9fa;
            color: #666;
            padding: 6px 12px;
            border-radius: 18px;
            font-size: 11px;
            font-weight: 500;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            white-space: nowrap;
            margin: 2px 0;
            line-height: 1.2;
            position: relative;
            width: fit-content;
            min-width: 100px;
            max-width: 150px;
            text-align: center;
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sub-node:hover {
            background: #e9ecef;
            transform: scale(1.02);
            border-color: #667eea;
        }

        .sub-node.has-details::after {
            content: "â„¹";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é€£æ¥ç·š */
        .connection-line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,255,255,0.5));
            transform-origin: left center;
            opacity: 0;
            transition: all 0.6s ease;
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .connection-line.active {
            opacity: 1;
        }

        /* è©³ç´°è³‡è¨Šé¢æ¿ */
        .details-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 350px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .details-panel.active {
            transform: translateX(0);
        }

        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .details-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f1f3f4;
            color: #333;
        }

        .referral-section {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 4px solid #667eea;
        }

        .referral-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .referral-info {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .add-referral-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .add-referral-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* ç¸®æ”¾æ§åˆ¶ */
        .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 18px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .zoom-level {
            text-align: center;
            font-size: 12px;
            color: #666;
            font-weight: 600;
        }

        /* æœå°‹çµæœé«˜äº® */
        .highlight {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .top-controls {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }

            .search-container {
                order: 3;
                width: 100%;
                max-width: none;
                margin: 0;
            }

            .control-buttons {
                gap: 12px;
            }

            .btn {
                padding: 10px 18px;
                font-size: 13px;
                margin: 0 3px;
            }

            .details-panel {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
                top: 80px;
                max-height: calc(100vh - 120px);
                overflow-y: auto;
            }
            
            .details-panel:not(.active) {
                display: none !important;
            }
            
            /* éš±è—ç¸®æ”¾æ§åˆ¶ */
            .zoom-controls {
                display: none !important;
            }

            .center-node {
                font-size: 18px;
                padding: 20px 30px;
            }

            .branch-node {
                font-size: 13px;
                padding: 12px 20px;
            }

            .sub-node {
                font-size: 12px;
                padding: 8px 15px;
                width: 100% !important;
                max-width: none !important;
                min-width: 80px !important;
                margin: 0 !important;
            }

            /* ä½¿ç”¨èªªæ˜æ¡†éŸ¿æ‡‰å¼ */
            .usage-notice {
                top: 120px;
                width: calc(100% - 40px);
                padding: 12px 18px;
            }

            .usage-notice-content {
                font-size: 12px;
                gap: 10px;
            }

            .usage-notice-icon {
                font-size: 20px;
            }

            .usage-notice-text {
                line-height: 1.4;
            }

            /* æ‰‹æ©Ÿç‰ˆå¿ƒæ™ºåœ–å®¹å™¨èª¿æ•´ */
            .mindmap-container {
                margin-top: 130px;
            }
            
            .mindmap-container.with-notice {
                margin-top: 220px;
            }
        }

        /* å‹•ç•« */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å›åˆ°é ‚éƒ¨æŒ‰éˆ• */
        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .scroll-to-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .scroll-to-top.active {
            display: flex;
        }

        @media (max-width: 768px) {
            .scroll-to-top {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }

        /* å±å¹•é–±è®€å™¨å°ˆç”¨æ¨£å¼ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* ç„¦é»æŒ‡ç¤ºå™¨æ”¹é€² */
        *:focus-visible {
            outline: 3px solid #667eea;
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* æ”¹é€²çš„éŒ¯èª¤è™•ç†æ¨£å¼ */
        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #c33;
            margin: 10px 0;
        }

        .success-message {
            background: #efe;
            color: #3c3;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3c3;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- è¼‰å…¥å‹•ç•« -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div style="text-align: center; color: #666; font-size: 14px;">è¼‰å…¥å¿ƒæ™ºåœ–ä¸­...</div>
    </div>

    <div class="app-container" role="main" aria-label="å¼•è–¦å¹³å°ä¸»å…§å®¹å€">
        <!-- é ‚éƒ¨æ§åˆ¶æ¬„ -->
        <nav class="top-controls" role="navigation" aria-label="ä¸»è¦å°èˆª">
            <div class="logo" role="banner">ğŸ’ 2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°</div>
            <div class="search-container" role="search">
                <span class="search-icon" aria-hidden="true">ğŸ”</span>
                <input type="text" class="search-input" id="searchInput" placeholder="æœå°‹åˆ†é¡æˆ–æœå‹™..." autocomplete="off" aria-label="æœå°‹æœå‹™é …ç›®" aria-describedby="searchDescription">
                <span id="searchDescription" class="sr-only">è¼¸å…¥é—œéµå­—æœå°‹æœå‹™é …ç›®æˆ–åˆ†é¡</span>
                <button class="search-clear-btn" id="searchClearBtn" onclick="clearSearch()" title="æ¸…é™¤æœç´¢" aria-label="æ¸…é™¤æœå°‹å…§å®¹">âœ•</button>
            </div>
            <div class="control-buttons" role="group" aria-label="æ“ä½œæŒ‰éˆ•">
                <button class="btn btn-secondary" onclick="showReferralForm()" aria-label="é–‹å•Ÿå¼•è–¦ç™»è¨˜è¡¨å–®">
                    ğŸ‘¥ å¼•è–¦ç™»è¨˜
                </button>
                <button class="btn btn-secondary" onclick="showDataView()" aria-label="æŸ¥çœ‹è³‡æ–™çµ±è¨ˆ">
                    ğŸ“Š è³‡æ–™æŸ¥çœ‹
                </button>
            </div>
        </nav>

        <!-- ä½¿ç”¨èªªæ˜æ¡† -->
        <div class="usage-notice" id="usageNotice" role="alert" aria-live="polite" aria-label="ä½¿ç”¨èªªæ˜">
            <div class="usage-notice-content">
                <div class="usage-notice-icon" aria-hidden="true">âš ï¸</div>
                <div class="usage-notice-text">
                    <strong>ä½¿ç”¨æç¤ºï¼š</strong>æ­¤å¼•è–¦å¹³å°åƒ…ä¾›å¼•è–¦<strong>æœƒå“¡æ²’æœ‰çš„å€åŸŸåŠè³‡æº</strong>ï¼Œä»¥ç¢ºä¿ä¸æœƒæå¤±æœƒå“¡æ¬Šç›Šã€‚
                </div>
                <button class="usage-notice-close" onclick="closeUsageNotice()" title="é—œé–‰æç¤º" aria-label="é—œé–‰ä½¿ç”¨èªªæ˜">Ã—</button>
            </div>
        </div>

        <!-- å¿ƒæ™ºåœ–å®¹å™¨ -->
        <div class="mindmap-container" id="mindmapContainer" role="region" aria-label="æœå‹™åˆ†é¡å¿ƒæ™ºåœ–">
            <div class="mindmap-content" id="mindmapContent" role="list" aria-label="æœå‹™é …ç›®åˆ—è¡¨">
                <div class="center-node" id="centerNode" role="heading" aria-level="1">2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°</div>
            </div>
        </div>

        <!-- å›åˆ°é ‚éƒ¨æŒ‰éˆ• -->
        <button class="scroll-to-top" id="scrollToTop" onclick="scrollToTop()" title="å›åˆ°é ‚éƒ¨" aria-label="å›åˆ°é é¢é ‚éƒ¨">â†‘</button>

        <!-- è©³ç´°è³‡è¨Šé¢æ¿ -->
        <div class="details-panel" id="detailsPanel" role="dialog" aria-labelledby="detailsTitle" aria-modal="true" aria-hidden="true">
            <div class="details-header">
                <div class="details-title" id="detailsTitle" role="heading" aria-level="2">è©³ç´°è³‡è¨Š</div>
                <button class="close-btn" onclick="closeDetails()" aria-label="é—œé–‰è©³ç´°è³‡è¨Šé¢æ¿">Ã—</button>
            </div>
            <div id="detailsContent" role="region" aria-live="polite">
                <p>é»æ“Šä»»ä½•é …ç›®æŸ¥çœ‹è©³ç´°è³‡è¨Šå’Œå¼•è–¦äººè³‡æ–™</p>
            </div>
            <div class="referral-section" role="region" aria-labelledby="referralTitle">
                <div class="referral-title" id="referralTitle">ğŸ“ å¼•è–¦äººè³‡è¨Š</div>
                <div class="referral-info" id="referralInfo" role="region" aria-live="polite">
                    é»æ“Šä¸Šæ–¹é …ç›®æŸ¥çœ‹ç›¸é—œå¼•è–¦äººè³‡è¨Š
                </div>
                <button class="add-referral-btn" onclick="addReferral()" aria-label="æ·»åŠ æ–°çš„å¼•è–¦äºº">æ·»åŠ å¼•è–¦äºº</button>
            </div>
        </div>

        <!-- ç¸®æ”¾æ§åˆ¶ -->
        <div class="zoom-controls" role="group" aria-label="ç¸®æ”¾æ§åˆ¶">
            <button class="zoom-btn" onclick="zoomIn()" aria-label="æ”¾å¤§">+</button>
            <div class="zoom-level" id="zoomLevel" aria-live="polite">100%</div>
            <button class="zoom-btn" onclick="zoomOut()" aria-label="ç¸®å°">-</button>
        </div>
    </div>

    <script>
        /**
         * å®‰å…¨è¨­ç½® HTML å…§å®¹ï¼Œé˜²æ­¢ XSS æ”»æ“Š
         * @param {HTMLElement} element - ç›®æ¨™å…ƒç´ 
         * @param {string} html - HTML å­—ç¬¦ä¸²
         */
        function safeSetHTML(element, html) {
            if (!element) return;
            try {
                // ä½¿ç”¨ DOMPurify æ¸…ç† HTML
                if (typeof DOMPurify !== 'undefined') {
                    element.innerHTML = DOMPurify.sanitize(html, {
                        ALLOWED_TAGS: ['div', 'span', 'p', 'strong', 'em', 'br', 'button', 'input', 'select', 'option', 'optgroup', 'label', 'textarea', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol', 'li', 'a', 'img', 'table', 'tr', 'td', 'th', 'thead', 'tbody'],
                        ALLOWED_ATTR: ['class', 'id', 'style', 'onclick', 'type', 'value', 'placeholder', 'required', 'readonly', 'disabled', 'selected', 'checked', 'href', 'target', 'src', 'alt', 'title', 'role', 'aria-label', 'aria-expanded', 'aria-live', 'tabindex', 'data-*']
                    });
                } else {
                    // å¦‚æœ DOMPurify æœªè¼‰å…¥ï¼Œä½¿ç”¨ textContent ä½œç‚ºå¾Œå‚™
                    element.textContent = html.replace(/<[^>]*>/g, '');
                }
            } catch (error) {
                console.error('å®‰å…¨è¨­ç½® HTML æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                element.textContent = html.replace(/<[^>]*>/g, '');
            }
        }

        /**
         * å®‰å…¨å‰µå»ºå…ƒç´ ä¸¦è¨­ç½® HTML
         * @param {string} tag - HTML æ¨™ç±¤å
         * @param {string} html - HTML å…§å®¹
         * @param {Object} attributes - å±¬æ€§å°è±¡
         * @returns {HTMLElement} å‰µå»ºçš„å…ƒç´ 
         */
        function safeCreateElement(tag, html = '', attributes = {}) {
            const element = document.createElement(tag);
            if (html) {
                safeSetHTML(element, html);
            }
            Object.keys(attributes).forEach(key => {
                if (key === 'style' && typeof attributes[key] === 'object') {
                    Object.assign(element.style, attributes[key]);
                } else {
                    element.setAttribute(key, attributes[key]);
                }
            });
            return element;
        }

        /**
         * ç’°å¢ƒæª¢æ¸¬ï¼šæ˜¯å¦ç‚ºé–‹ç™¼ç’°å¢ƒ
         */
        const IS_DEVELOPMENT = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

        /**
         * å®‰å…¨çš„æ—¥èªŒå‡½æ•¸ï¼ˆç”Ÿç”¢ç’°å¢ƒä¸è¼¸å‡ºï¼‰
         */
        const safeLog = {
            log: (...args) => {
                if (IS_DEVELOPMENT) console.log(...args);
            },
            warn: (...args) => {
                if (IS_DEVELOPMENT) console.warn(...args);
            },
            error: (...args) => {
                // éŒ¯èª¤å§‹çµ‚è¨˜éŒ„
                console.error(...args);
            },
            info: (...args) => {
                if (IS_DEVELOPMENT) console.info(...args);
            }
        };

        /**
         * æ”¹é€²çš„éŒ¯èª¤è™•ç†å‡½æ•¸
         * @param {Error|string} error - éŒ¯èª¤å°è±¡æˆ–éŒ¯èª¤è¨Šæ¯
         * @param {string} context - éŒ¯èª¤ä¸Šä¸‹æ–‡
         * @param {boolean} showToUser - æ˜¯å¦å‘ç”¨æˆ¶é¡¯ç¤ºéŒ¯èª¤
         */
        function handleError(error, context = '', showToUser = true) {
            const errorMessage = error instanceof Error ? error.message : String(error);
            const fullMessage = context ? `${context}: ${errorMessage}` : errorMessage;
            
            safeLog.error(fullMessage, error);
            
            if (showToUser) {
                showErrorToast(fullMessage);
            }
            
            return errorMessage;
        }

        /**
         * å®‰å…¨çš„ç•°æ­¥å‡½æ•¸åŒ…è£å™¨
         * @param {Function} asyncFn - ç•°æ­¥å‡½æ•¸
         * @param {string} context - ä¸Šä¸‹æ–‡æè¿°
         * @returns {Promise} åŒ…è£å¾Œçš„ Promise
         */
        async function safeAsync(asyncFn, context = '') {
            try {
                return await asyncFn();
            } catch (error) {
                handleError(error, context, true);
                throw error;
            }
        }

        // å¿ƒæ™ºåœ–æ•¸æ“šçµæ§‹
        const mindmapData = {
            "2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°": {
                // ç°¡åŒ–ç‰ˆåˆ†é¡ - æ›´ç›´è§€æ˜“ç”¨
                "ğŸ¨ è¨­è¨ˆèˆ‡è¦åŠƒ": {
                    "å»ºç¯‰èˆ‡å®¤å…§è¨­è¨ˆ": ["å»ºç¯‰å¸«", "å®¤å…§è¨­è¨ˆ", "æ™¯è§€è¨­è¨ˆ", "ç©ºé–“è¦åŠƒ", "ä½å®…è¨­è¨ˆ", "å•†ç©ºè¨­è¨ˆ"],
                    "è£æ½¢èˆ‡è»Ÿè£": ["è£æ½¢è¨­è¨ˆ", "è»Ÿè£è¨­è¨ˆ", "å‚¢ä¿±è¨­è¨ˆ", "ç‡ˆå…‰è¨­è¨ˆ", "å®¤å…§è£æ½¢", "è‰²å½©è¦åŠƒ"],
                    "å·¥ç¨‹è¨­è¨ˆ": ["æ©Ÿé›»è¨­è¨ˆ", "çµæ§‹è¨­è¨ˆ", "æ¶ˆé˜²é¡§å•", "ç©ºèª¿è¨­è¨ˆ", "çµ¦æ’æ°´è¨­è¨ˆ"],
                    "ç’°å¢ƒèˆ‡ç‰¹æ®Šè¨­è¨ˆ": ["ç¶ å»ºç¯‰è¨­è¨ˆ", "ç¯€èƒ½è¨­è¨ˆ", "ç’°ä¿è¨­è¨ˆ", "åˆæ³•éš”å¥—è¨­è¨ˆ", "æ¨¡çµ„åŒ–è¼•è£ä¿®"],
                    "BIMèˆ‡ç®¡ç†": ["BIMæœå‹™", "3Då¯è¦–åŒ–", "å°ˆæ¡ˆç®¡ç†", "æ™‚ç¨‹æ§ç®¡", "æˆæœ¬æ§ç®¡"]
                },
                "ğŸ”¨ å·¥ç¨‹è¦åŠƒèˆ‡ä¿®ç¹•": {
                    "çµ±åŒ…å·¥ç¨‹": ["çµ±åŒ…å·¥ç¨‹", "ç¸½åŒ…", "åˆ†åŒ…ç®¡ç†", "ç‡Ÿé€ å•†"],
                    "åŸºç¤å·¥ç¨‹": ["æ°´é›»å·¥ç¨‹", "æ³¥ä½œå·¥ç¨‹", "éµå·¥å·¥ç¨‹", "é‹é–€çª—å·¥ç¨‹", "çµæ§‹è£œå¼·"],
                    "è£ä¿®å·¥ç¨‹": ["æœ¨ä½œå·¥ç¨‹", "ç£ç£šå·¥ç¨‹", "çŸ³æå·¥ç¨‹", "ç»ç’ƒå·¥ç¨‹", "å¡—æ–™å·¥ç¨‹", "å¤©èŠ±æ¿å·¥ç¨‹", "åœ°æ¿å·¥ç¨‹"],
                    "æ©Ÿé›»ç³»çµ±": ["æ©Ÿé›»å·¥ç¨‹", "å¼±é›»å·¥ç¨‹", "æ¶ˆé˜²å·¥ç¨‹", "é€šè¨Šæœå‹™", "é›»æ¢¯", "ç©ºèª¿ç³»çµ±"],
                    "æ™ºæ…§åŒ–ç³»çµ±": ["æ™ºæ…§å·¥ç¨‹", "æ™ºèƒ½å®¶å±…", "IoTç‰©è¯ç¶²", "è‡ªå‹•åŒ–æ§åˆ¶", "èƒ½æºç®¡ç†ç³»çµ±"],
                    "èƒ½æºå·¥ç¨‹": ["å¤ªé™½èƒ½å®‰è£", "å„²èƒ½ç³»çµ±", "å……é›»æ¨å®‰è£"],
                    "ç‰¹æ®Šå·¥ç¨‹": ["å¸·å¹•ç‰†å·¥ç¨‹", "é˜²æ°´éš”ç†±", "è€éœ‡è£œå¼·", "ä¿®ç¹•æœå‹™", "æˆ¿å±‹ä¿®ç¹•", "è€å±‹ç¿»æ–°"],
                    "äº¤ä»˜èˆ‡æœå‹™": ["é©—æ”¶æµç¨‹", "é»äº¤æœå‹™", "ä½¿ç”¨èªªæ˜", "æ–½å·¥æ¸…æ½”", "å»¢æ£„ç‰©è™•ç†"],
                    "å»ºæèˆ‡è¨­å‚™": ["å»ºæä¾›æ‡‰", "æ–½å·¥è¨­å‚™", "åŠè»Š", "é«˜ç©ºä½œæ¥­", "æ¸¬é‡å„€å™¨"]
                },
                "ğŸ’° æˆ¿å±‹è²·è³£èˆ‡äº¤æ˜“": {
                    "ä»²ä»‹æœå‹™": ["ä½å®…ä»²ä»‹", "å•†æ¥­ä¸å‹•ç”¢", "æµ·å¤–ä¸å‹•ç”¢", "ä¸å‹•ç”¢ç¶“ç´€"],
                    "äº¤æ˜“æœå‹™": ["å±¥ç´„ä¿è­‰", "ç”¢æ¬Šèª¿æŸ¥", "éæˆ¶æœå‹™", "é»äº¤éæˆ¶"],
                    "ç‰¹æ®Šç‰©ä»¶": ["åœŸåœ°è²·è³£", "é å”®å±‹", "æˆå±‹", "ä¸­å¤å±‹", "æ–°æˆå±‹"],
                    "ç‰¹æ®Šæ¸ é“": ["ä»£éŠ·", "æ³•æ‹", "éƒ½æ›´æ•´åˆ", "é‡åŠƒå€é–‹ç™¼"],
                    "åœ°æ”¿æœå‹™": ["åœŸåœ°é–‹ç™¼", "å±è€éƒ½æ›´æ•´åˆ", "åœ°æ”¿å£«æœå‹™", "ä¸å‹•ç”¢ç™»è¨˜"]
                },
                "ğŸ’° ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘": {
                    "è²¸æ¬¾æœå‹™": ["è³¼å±‹è²¸æ¬¾", "æˆ¿è²¸", "æˆ¿è²¸è½‰å¢è²¸", "æˆ¿è²¸ä»£å„Ÿ", "è²¸æ¬¾è¦åŠƒ", "ä¿¡ç”¨è²¸æ¬¾", "ä¼æ¥­è²¸æ¬¾", "å€‹äººä¿¡è²¸"],
                    "å»ºç¯‰èè³‡": ["é–‹ç™¼èè³‡", "å·¥ç¨‹æ¬¾èè³‡", "åœŸåœ°èè³‡", "å»ºç¯‰èè³‡è¦åŠƒ"],
                    "ç†è²¡è¦åŠƒ": ["ç†è²¡é¡§å•", "æŠ•è³‡ç†è²¡", "è³‡ç”¢é…ç½®", "è²¡å‹™è¦åŠƒ", "é€€ä¼‘è¦åŠƒ"],
                    "ä¸å‹•ç”¢æŠ•è³‡": ["REITs", "ä¸å‹•ç”¢åŸºé‡‘", "ç§å‹Ÿè‚¡æ¬Š", "ä¸å‹•ç”¢è­‰åˆ¸åŒ–"],
                    "ä¿éšªæœå‹™": ["å¯Œé‚¦äººå£½", "åœ‹æ³°äººå£½", "æ–°å…‰äººå£½", "å—å±±äººå£½", "ä¿éšªè¦åŠƒ", "å£½éšª", "ç”¢éšª"],
                    "é¢¨éšªä¿éšœ": ["å·¥ç¨‹éšª", "è²¬ä»»éšª", "å·¥ç¨‹å±¥ç´„ä¿è­‰", "ç«éšª", "åœ°éœ‡éšª", "ç”¢ç‰©ä¿éšª"],
                    "ç¨…å‹™è¦åŠƒ": ["ä¸å‹•ç”¢ç¨…å‹™è¦åŠƒ", "éºç”¢è¦åŠƒ", "ç¯€ç¨…è¦åŠƒ", "è²¡ç”¢ç§»è½‰è¦åŠƒ"]
                },
                "âš–ï¸ å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“": {
                    "æ³•å¾‹èˆ‡ç¨…å‹™": ["å¾‹å¸«", "æœƒè¨ˆå¸«", "ä¸å‹•ç”¢ä¼°åƒ¹å¸«", "åœ°æ”¿å£«ï¼ˆä»£æ›¸ï¼‰", "æ³•è¦è«®è©¢"],
                    "æª¢æ¸¬èˆ‡é©—å±‹": ["é©—å±‹æœå‹™", "æˆ¿å±‹æª¢æ¸¬", "çµæ§‹æª¢æ¸¬", "æ¼æ°´æª¢æ¸¬", "ç”²é†›æª¢æ¸¬"],
                    "ç’°å¢ƒèˆ‡å¸‚å ´": ["ç’°å¢ƒæ²»ç†", "åœŸå£¤æ±¡æŸ“æª¢æ¸¬", "å¸‚å ´ç ”ç©¶", "å¯è¡Œæ€§è©•ä¼°", "æŠ•è³‡è©•ä¼°"],
                    "åŸ¹è¨“èˆ‡é¡§å•": ["äººæ‰åŸ¹è¨“", "è·æ¥­è¨“ç·´", "æŠ€èƒ½åŸ¹è¨“", "è­‰ç…§ä»£è¾¦", "é¡§å•æœå‹™", "è²·æˆ¿é™ªè·‘æœå‹™", "è²·æˆ¿é™ªè·‘æ•™ç·´", "è²·æˆ¿èª²ç¨‹"]
                },
                "ğŸ“¢ è¡ŒéŠ·æ›å…‰èˆ‡æ¨å»£": {
                    "å»ºæ¡ˆè¡ŒéŠ·": ["é å”®å±‹ä»£éŠ·", "æˆå±‹ä»£éŠ·", "å»ºæ¡ˆä»£éŠ·"],
                    "æ•¸ä½è¡ŒéŠ·": ["ç¶²ç«™å»ºç½®", "SEOå„ªåŒ–", "Googleå»£å‘Š", "Facebookå»£å‘Š"],
                    "è³‡è¨Šå¹³å°": ["å¯¦åƒ¹ç™»éŒ„æŸ¥è©¢", "591ç§Ÿå±‹ç¶²", "ä¿¡ç¾©æˆ¿å±‹ç¶²"],
                    "å…§å®¹è¡ŒéŠ·": ["å»ºæ¡ˆæ–‡å®£", "å»ºæ¡ˆå½±ç‰‡æ‹æ”", "å»ºæ¡ˆæ”å½±"],
                    "å‚³çµ±è¡ŒéŠ·": ["å“ç‰Œä¼åŠƒ", "åª’é«”æŠ•æ”¾", "æ´»å‹•ä¼åŠƒ"],
                    "å»£å‘Šæ¨™è­˜": ["LED å»£å‘Šç‰Œ", "å»£å‘Šè¨­è¨ˆ", "æ‹›ç‰Œè£½ä½œ"]
                },
                "ğŸ¢ å•†æ¥­ç‡Ÿé‹èˆ‡ç¶­è­·": {
                    "ç‰©æ¥­èˆ‡ç§Ÿè³ƒ": ["ç‰©æ¥­ç®¡ç†", "ç§Ÿè³ƒæœå‹™", "åŒ…ç§Ÿä»£ç®¡", "çŸ­ç§Ÿç‡Ÿé‹", "Airbnbä»£ç‡Ÿé‹"],
                    "ç¶­è­·æœå‹™": ["æ©Ÿé›»ç¶­è­·", "æ¸…æ½”æœå‹™", "åœ’è—ç¶­è­·", "è£ä¿®è¼”åŠ©", "é›»æ¢¯ä¿é¤Š", "ç©ºèª¿ä¿é¤Š"],
                    "å®‰å…¨èˆ‡åœè»Š": ["å®‰å…¨ç¶­è­·", "ä¿å…¨", "é–€ç¦ç®¡ç†", "åœè»Šç®¡ç†", "åœè»Šå ´ç®¡ç†"],
                    "ç”Ÿæ´»æœå‹™": ["æ¬å®¶æœå‹™", "å®¶æ”¿æœå‹™", "å»¢æ£„ç‰©æ¸…é‹", "å»¢æ£„ç‰©å›æ”¶"],
                    "æ•¸ä½å¹³å°": ["ç‰©æ¥­ç®¡ç†ç³»çµ±", "ç¤¾å€APP", "æ•¸ä½å¹³å°"]
                },
                "ğŸ›ï¸ å‚¢ä¿±å‚¢é›»èˆ‡å»ºæ": {
                    "å‚¢ä¿±æ¡è³¼": ["å®¢å»³å‚¢ä¿±", "è‡¥å®¤å‚¢ä¿±", "é¤å»³å‚¢ä¿±", "æ›¸æˆ¿å‚¢ä¿±", "è¨‚è£½å‚¢ä¿±", "ç³»çµ±å‚¢ä¿±", "æˆ¶å¤–å‚¢ä¿±", "è¾¦å…¬å‚¢ä¿±"],
                    "å®¶é›»æ¡è³¼": ["å»šæˆ¿å®¶é›»", "å®¢å»³å®¶é›»", "è‡¥å®¤å®¶é›»", "è¡›æµ´å®¶é›»", "æ™ºæ…§å®¶é›»", "ç¯€èƒ½å®¶é›»", "ç©ºæ°£æ¸…æ·¨æ©Ÿ", "é™¤æ¿•æ©Ÿ", "æ¸…æ½”å®¶é›»"],
                    "å¯¢å…·æ¡è³¼": ["åºŠå¢Š", "åºŠçµ„", "å¯¢å…·å¥—çµ„", "æ•é ­", "è¢«å­", "åºŠå–®", "åºŠç½©", "ç¾Šæ¯›è¢«", "ç¾½çµ¨è¢«"],
                    "çª—ç°¾èˆ‡å®¶é£¾": ["çª—ç°¾", "çª—é£¾", "å®¶é£¾æ“ºè¨­", "åœ°æ¯¯", "æ›ç•«", "èŠ±ç“¶", "æ“ºé£¾"],
                    "ç‡ˆå…·ç…§æ˜": ["åŠç‡ˆ", "å¸é ‚ç‡ˆ", "å£ç‡ˆ", "è½åœ°ç‡ˆ", "æ¡Œç‡ˆ", "LEDç‡ˆ", "æ™ºèƒ½ç‡ˆå…·"],
                    "è¡›æµ´ç”¨å“": ["é¦¬æ¡¶", "æ´—æ‰‹å°", "æµ´ç¼¸", "æ·‹æµ´è¨­å‚™", "é¡å­", "è¡›æµ´äº”é‡‘", "è¡›æµ´é…ä»¶"],
                    "äº”é‡‘é…ä»¶": ["é–€é–", "æŠŠæ‰‹", "é‰¸éˆ", "æ»‘è»Œ", "èºçµ²", "é‡˜å­", "äº”é‡‘é…ä»¶"],
                    "å»ºææ¡è³¼": ["é‹¼ç­‹æ°´æ³¥", "ç£ç£šçŸ³æ", "æœ¨ææ¿æ", "æ²¹æ¼†å¡—æ–™", "ç»ç’ƒææ–™", "é‡‘å±¬ææ–™", "é˜²æ°´ææ–™", "éš”ç†±ææ–™", "åœ°æ¿ææ–™", "å¤©èŠ±æ¿ææ–™", "é–€çª—ææ–™"],
                    "å®‰é˜²è¨­å‚™": ["ç›£æ§ç³»çµ±", "é–€ç¦ç³»çµ±", "è­¦å ±å™¨", "é˜²ç›œè¨­å‚™", "æ™ºèƒ½é–€é–"]
                }
            }
        };

        // Google Sheets è¨­å®š
        const SHEET_CONFIG = {
            // Apps Script Web App URL
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxv0z-WYpd4Q20aj8A0j8uLuG7xXSK4yntRmbEp2bFwqapzOU4K1XSnGW8AYn4dBKm2/exec',
            // å‚³çµ± Google Sheets API è¨­å®šï¼ˆå‚™ç”¨ï¼‰
            REFERRAL_SHEET_ID: '1rzFA6bqsz_Au1wiMEGj2nxrlG3uOdDMPddBZBT7sqEY', // å¼•è–¦ç™»è¨˜å·¥ä½œè¡¨ID
            ACCESS_LOG_SHEET_ID: '1rzFA6bqsz_Au1wiMEGj2nxrlG3uOdDMPddBZBT7sqEY', // ä½¿ç”¨è¨˜éŒ„å·¥ä½œè¡¨IDï¼ˆåŒä¸€å€‹Sheetçš„ä¸åŒå·¥ä½œè¡¨ï¼‰
            MEMBER_SHEET_ID: '1rzFA6bqsz_Au1wiMEGj2nxrlG3uOdDMPddBZBT7sqEY', // æœƒå“¡è³‡æ–™å·¥ä½œè¡¨IDï¼ˆç”¨æ–¼å¿«æœæœƒå“¡ç·¨è™Ÿï¼‰
            API_KEY: 'YOUR_GOOGLE_SHEETS_API_KEY' // è«‹æ›¿æ›ç‚ºæ‚¨çš„Google Sheets APIé‡‘é‘°
        };
        
        // æœƒå“¡è³‡æ–™å¿«å–ï¼ˆæœ¬åœ°ç·©å­˜ï¼‰
        let memberDataCache = null;
        let memberDataCacheTime = null;
        const MEMBER_CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é˜ç·©å­˜

        // å¼•è–¦äººè³‡æ–™åº«ï¼ˆæœƒè¢« Google Sheets çš„è³‡æ–™è¦†è“‹ï¼‰
        let referralData = {
            "å®¤å…§æ³¥ä½œ": {
                name: "å¼µå¸«å‚…",
                company: "å°ˆæ¥­æ³¥ä½œå·¥ç¨‹",
                phone: "0912-345-678",
                email: "zhang@example.com",
                experience: "15å¹´ç¶“é©—ï¼Œå°ˆç²¾å®¤å…§å¤–æ³¥ä½œå·¥ç¨‹"
            },
            "é‹¼æ§‹å·¥ç¨‹": {
                name: "æå¸«å‚…",
                company: "ç²¾å·¥éµè—",
                phone: "0934-567-890",
                email: "li@example.com",
                experience: "20å¹´ç¶“é©—ï¼Œé‹¼æ§‹å·¥ç¨‹å°ˆå®¶"
            },
            "å»ºç¯‰å¸«": {
                name: "ç‹å»ºç¯‰å¸«",
                company: "ç‹å»ºç¯‰å¸«äº‹å‹™æ‰€",
                phone: "0922-123-456",
                email: "wang@example.com",
                experience: "è¨»å†Šå»ºç¯‰å¸«ï¼Œ15å¹´è¨­è¨ˆç¶“é©—"
            }
        };

        // ç´°åˆ†è³‡æ–™åº« - æ”¯æ´ç„¡é™å±¤ç´šç´°åˆ†
        const subdivisionData = {
            "å®¤å…§æ³¥ä½œ": {
                "æŠ€è¡“å·¥é …": ["ç‰†é¢ç²‰åˆ·", "åœ°é¢æ‰¾å¹³", "å¤©èŠ±æ¿è™•ç†", "ç‰†é¢ä¿®è£œ"],
                "ç‰¹æ®Šè™•ç†": ["é˜²æ°´å·¥ç¨‹", "é˜²æ½®è™•ç†", "éš”éŸ³è™•ç†", "å¹³æ•´åº¦è™•ç†"]
            },
            "å®¤å¤–æ³¥ä½œ": {
                "å¤–ç‰†å·¥ç¨‹": ["å¤–ç‰†ç²‰åˆ·", "å¤–ç‰†ä¿®è£œ", "å¤–ç‰†é˜²æ°´", "å¤–ç‰†ç¾åŒ–"],
                "å±‹é ‚å·¥ç¨‹": ["å±‹é ‚é˜²æ°´", "å±‹é ‚ä¿®ç¹•", "é˜²æ°´éš”ç†±", "æ’æ°´ç³»çµ±"]
            },
            "é‹¼æ§‹å·¥ç¨‹": {
                "å¤§å‹é‹¼æ§‹": ["é‹¼æ¨‘è£½ä½œ", "é‹¼æŸ±å®‰è£", "é‹¼æ¿ç„Šæ¥", "é‹¼æ§‹åŠè£"],
                "ç¶­è­·æœå‹™": ["é‹¼æ§‹æª¢æŸ¥", "é˜²é½è™•ç†", "çµæ§‹è£œå¼·", "å®šæœŸä¿é¤Š"]
            },
            "æ°´é›»å®‰è£": {
                "çµ¦æ°´ç³»çµ±": ["é€²æ°´ç®¡ç·š", "é…æ°´ç®¡ç·š", "æ°´éŒ¶å®‰è£", "æ°´æ³µè¨­ç½®"],
                "æ’æ°´ç³»çµ±": ["æ±¡æ°´ç®¡ç·š", "å»¢æ°´ç®¡ç·š", "é›¨æ°´ç®¡ç·š", "åŒ–ç³æ± "],
                "é›»æ°£ç³»çµ±": ["é…é›»ç›¤", "æ’åº§é–‹é—œ", "ç…§æ˜ç·šè·¯", "æ¥åœ°ç³»çµ±"]
            },
            "æ©Ÿé›»è¨­å‚™": {
                "å‹•åŠ›è¨­å‚™": ["ç™¼é›»æ©Ÿ", "é¦¬é”", "è®Šé »å™¨", "æ§åˆ¶ç®±"],
                "ç©ºèª¿è¨­å‚™": ["åˆ†é›¢å¼å†·æ°£", "ä¸­å¤®ç©ºèª¿", "é€šé¢¨è¨­å‚™", "é™¤æ¿•æ©Ÿ"],
                "å…¶ä»–è¨­å‚™": ["ç†±æ°´å™¨", "é›»æ¢¯", "é›»æ‰¶æ¢¯", "é›»å‹•é–€"]
            },
            "æ¶ˆé˜²è¨­å‚™": {
                "æ»…ç«ç³»çµ±": ["è‡ªå‹•ç‘æ°´", "æ³¡æ²«ç³»çµ±", "ä¹¾ç²‰ç³»çµ±", "æ¶ˆé˜²æ “"],
                "è­¦å ±ç³»çµ±": ["ç…™æ„Ÿè­¦å ±", "ç†±æ„Ÿè­¦å ±", "è²å…‰è­¦å ±", "å»£æ’­ç³»çµ±"],
                "é€ƒç”Ÿè¨­å‚™": ["ç·Šæ€¥ç…§æ˜", "å‡ºå£æ¨™ç¤º", "é˜²ç«é–€", "é¿é›£å™¨å…·"]
            },
            "ç›£æ§ç³»çµ±": {
                "æ”å½±è¨­å‚™": ["ç›£è¦–å™¨", "éŒ„å½±ä¸»æ©Ÿ", "é›²ç«¯å„²å­˜", "è¡Œå‹•ç›£æ§"],
                "æ•´åˆæœå‹™": ["é ç«¯ç›£æ§", "æ™ºèƒ½è¾¨è­˜", "è­¦å ±é€£å‹•", "ç³»çµ±ç¶­è­·"]
            },
            "æ™ºæ…§å®¶é›»": {
                "æ§åˆ¶ç³»çµ±": ["æ™ºèƒ½é–‹é—œ", "å ´æ™¯æ§åˆ¶", "èªéŸ³æ§åˆ¶", "æ‰‹æ©ŸAPP"],
                "å®¶é›»è¨­å‚™": ["æ™ºèƒ½ç‡ˆå…·", "æ™ºèƒ½å†·æ°£", "æ™ºèƒ½é–", "æ™ºèƒ½æ’åº§"],
                "æ•´åˆæœå‹™": ["å±…å®¶è‡ªå‹•åŒ–", "èƒ½æºç®¡ç†", "é ç«¯æ§åˆ¶", "ç³»çµ±ç¶­è­·"]
            }
        };

        let isExpanded = false;
        let branches = [];
        let currentZoom = 1;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let currentDetails = null;
        let isCollapsedAll = false; // å…¨å±€æ‘ºç–Šç‹€æ…‹
        let displayMode = localStorage.getItem('displayMode') || 'compact'; // 'compact' æˆ– 'full'
        let mergeRegions = localStorage.getItem('mergeRegions') !== 'false'; // åˆä½µå€åŸŸé …ç›®ï¼Œé»˜èªé–‹å•Ÿ
        let showResourcesOnly = localStorage.getItem('showResourcesOnly') === 'true'; // åªé¡¯ç¤ºæœ‰å¼•è–¦äººçš„è³‡æº

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            // ç«‹å³éš±è—è¼‰å…¥å‹•ç•«ä¸¦é¡¯ç¤ºå¿ƒæ™ºåœ–
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            createMindmap();
            setupEventListeners();
            
            // åˆå§‹åŒ–æŒ‰éˆ•ç‹€æ…‹
            updateButtonsState();
            
            // æª¢æŸ¥ä½¿ç”¨èªªæ˜æ¡†ç‹€æ…‹
            checkUsageNotice();
            
            // å¾Œå°ç•°æ­¥è¼‰å…¥è³‡æ–™ï¼ˆä¸é˜»å¡UIï¼‰
            Promise.all([
                loadReferralData(),
                loadMemberData()
            ]).then(() => {
                safeLog.log('âœ… æ‰€æœ‰è³‡æ–™è¼‰å…¥å®Œæˆ');
            }).catch(err => {
                safeLog.warn('âš ï¸ è³‡æ–™è¼‰å…¥å¤±æ•—:', err);
            });
            
            // å¾Œå°é‹è¡Œæ¸¬è©¦ï¼ˆä¸é˜»å¡UIï¼‰
            setTimeout(() => {
                loadUnlockedContacts();
                testAppsScriptConnection();
                testGoogleSheetsConnection();
            }, 100);
        });
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        function updateButtonsState() {
            // æ›´æ–°åªçœ‹è³‡æºæŒ‰éˆ•
            const resourcesBtn = document.getElementById('resourcesOnlyBtn');
            if (resourcesBtn) {
                if (showResourcesOnly) {
                    resourcesBtn.textContent = 'ğŸ‘¥ åªçœ‹è³‡æº';
                    resourcesBtn.classList.add('btn-primary');
                    resourcesBtn.classList.remove('btn-secondary');
                } else {
                    resourcesBtn.textContent = 'ğŸ“‹ é¡¯ç¤ºå…¨éƒ¨';
                    resourcesBtn.classList.add('btn-secondary');
                    resourcesBtn.classList.remove('btn-primary');
                }
            }
            
            // æ›´æ–°é¡¯ç¤ºæ¨¡å¼æŒ‰éˆ•
            const modeBtn = document.getElementById('displayModeBtn');
            if (modeBtn) {
                modeBtn.textContent = displayMode === 'compact' ? 'ğŸ“„ ç°¡æ½”æ¨¡å¼' : 'ğŸ“‹ å®Œæ•´æ¨¡å¼';
            }
            
            // æ›´æ–°åˆä½µæŒ‰éˆ•
            const mergeBtn = document.getElementById('mergeRegionsBtn');
            if (mergeBtn) {
                mergeBtn.textContent = mergeRegions ? 'ğŸ”— å·²åˆä½µ' : 'ğŸ“‹ åˆ†é–‹é¡¯ç¤º';
            }
        }
        
        // æ¸¬è©¦ Apps Script é€£æ¥
        async function testAppsScriptConnection() {
            if (SHEET_CONFIG.APPS_SCRIPT_URL && SHEET_CONFIG.APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL') {
                try {
                    const response = await fetch(SHEET_CONFIG.APPS_SCRIPT_URL);
                    if (response.ok) {
                        const result = await response.json();
                        safeLog.log('âœ… Apps Script é€£æ¥æˆåŠŸ');
                        
                        // æ¸¬è©¦è®€å–å¼•è–¦è³‡æ–™
                        const referralsUrl = `${SHEET_CONFIG.APPS_SCRIPT_URL}?action=getReferrals`;
                        try {
                            const referralsResponse = await fetch(referralsUrl);
                            if (referralsResponse.ok) {
                                const referralsResult = await referralsResponse.json();
                                safeLog.log('âœ… è®€å–å¼•è–¦è³‡æ–™æ¸¬è©¦æˆåŠŸ');
                                safeLog.log(`   æ‰¾åˆ° ${referralsResult.data ? referralsResult.data.length : 0} ç­†å¼•è–¦è³‡æ–™`);
                            } else {
                                safeLog.warn('âš ï¸ è®€å–å¼•è–¦è³‡æ–™æ¸¬è©¦å¤±æ•—:', referralsResponse.status);
                            }
                        } catch (referralsError) {
                            safeLog.warn('âš ï¸ è®€å–å¼•è–¦è³‡æ–™æ¸¬è©¦éŒ¯èª¤:', referralsError);
                        }
                        
                        return true;
                    } else {
                        safeLog.warn('âš ï¸ Apps Script é€£æ¥å¤±æ•—:', response.status);
                        return false;
                    }
                } catch (error) {
                    safeLog.warn('âš ï¸ Apps Script é€£æ¥æ¸¬è©¦å¤±æ•—:', error);
                    return false;
                }
            }
            return false;
        }
        
        // æ¸¬è©¦ Google Sheets API é€£æ¥
        async function testGoogleSheetsConnection() {
            if (SHEET_CONFIG.API_KEY && SHEET_CONFIG.API_KEY !== 'YOUR_GOOGLE_SHEETS_API_KEY') {
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_CONFIG.REFERRAL_SHEET_ID}?key=${SHEET_CONFIG.API_KEY}`;
                    const response = await fetch(url);
                    if (response.ok) {
                        const result = await response.json();
                        safeLog.log('âœ… Google Sheets API é€£æ¥æˆåŠŸ:', result.properties.title);
                        return true;
                    } else {
                        safeLog.warn('âš ï¸ Google Sheets API é€£æ¥å¤±æ•—:', response.status);
                        return false;
                    }
                } catch (error) {
                    safeLog.warn('âš ï¸ Google Sheets API é€£æ¥æ¸¬è©¦å¤±æ•—:', error);
                    return false;
                }
            }
            return false;
        }
        
        // å¾ Google Sheets è¼‰å…¥æœƒå“¡è³‡æ–™
        async function loadMemberData() {
            // æª¢æŸ¥ç·©å­˜æ˜¯å¦æœ‰æ•ˆ
            if (memberDataCache && memberDataCacheTime && 
                (Date.now() - memberDataCacheTime) < MEMBER_CACHE_DURATION) {
                safeLog.log('âœ… ä½¿ç”¨ç·©å­˜çš„æœƒå“¡è³‡æ–™');
                return memberDataCache;
            }
            
            try {
                safeLog.log('é–‹å§‹å¾ Google Sheets è¼‰å…¥æœƒå“¡è³‡æ–™...');
                
                // ä½¿ç”¨ Apps Script Web App è®€å–æœƒå“¡è³‡æ–™
                if (SHEET_CONFIG.APPS_SCRIPT_URL && SHEET_CONFIG.APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL') {
                    const url = `${SHEET_CONFIG.APPS_SCRIPT_URL}?action=getMembers`;
                    safeLog.log('ğŸ”— è«‹æ±‚ URL:', url);
                    
                    try {
                        // æ·»åŠ è¶…æ™‚ä¿è­·ï¼ˆ20ç§’ï¼‰
                        const fetchWithTimeout = (url, timeout = 20000) => {
                            return Promise.race([
                                fetch(url),
                                new Promise((_, reject) => 
                                    setTimeout(() => reject(new Error('è«‹æ±‚è¶…æ™‚')), timeout)
                                )
                            ]);
                        };
                        
                        const response = await fetchWithTimeout(url);
                        safeLog.log('æœƒå“¡è³‡æ–™è«‹æ±‚å›æ‡‰ç‹€æ…‹:', response.status);
                        
                        if (response.ok) {
                            const result = await response.json();
                            safeLog.log('æœƒå“¡è³‡æ–™å›æ‡‰çµæœ:', result.success ? 'æˆåŠŸ' : 'å¤±æ•—');
                            
                            // æª¢æŸ¥æ˜¯å¦è¿”å›äº†é è¨­æ¸¬è©¦è¨Šæ¯ï¼ˆè¡¨ç¤º Apps Script å¯èƒ½æ²’æœ‰æ­£ç¢ºè™•ç† actionï¼‰
                            if (result.message && result.message.includes('é‹è¡Œæ­£å¸¸') && !result.data) {
                                safeLog.warn('âš ï¸ Apps Script è¿”å›äº†é è¨­æ¸¬è©¦è¨Šæ¯ï¼Œå¯èƒ½æ²’æœ‰æ­£ç¢ºè™•ç† getMembers action');
                                safeLog.warn('ğŸ’¡ è«‹ç¢ºèªï¼š');
                                safeLog.warn('   1. Google Apps Script å·²éƒ¨ç½²æœ€æ–°ç‰ˆæœ¬');
                                safeLog.warn('   2. doGet å‡½æ•¸ä¸­å·²æ·»åŠ  getMembers çš„è™•ç†é‚è¼¯');
                                safeLog.warn('   3. getMembers å‡½æ•¸å·²æ­£ç¢ºå®šç¾©');
                                safeLog.warn('   4. ã€Œæœƒå“¡è³‡æ–™ã€å·¥ä½œè¡¨å·²å»ºç«‹ä¸¦æœ‰è³‡æ–™');
                                
                                // è¿”å›ç©ºæ•¸æ“šï¼Œä½†ä¸é¡¯ç¤ºéŒ¯èª¤
                                memberDataCache = {};
                                memberDataCacheTime = Date.now();
                                return {};
                            }
                            
                            if (result.success) {
                                if (result.data && Array.isArray(result.data) && result.data.length > 0) {
                                    // å»ºç«‹æœƒå“¡ç·¨è™Ÿåˆ°æœƒå“¡è³‡è¨Šçš„æ˜ å°„
                                    const memberMap = {};
                                    result.data.forEach(member => {
                                        const code = String(member.code || member.memberCode || '').trim();
                                        const name = String(member.name || '').trim();
                                        const professionalCategory = String(member.professionalCategory || '').trim();
                                        const password = String(member.password || '').trim();
                                        
                                        if (code && name) {
                                            // å»ºç«‹æœƒå“¡è³‡è¨Šå°è±¡
                                            const memberInfo = {
                                                name: name,
                                                professionalCategory: professionalCategory,
                                                password: password,
                                                email: String(member.email || '').trim()
                                            };
                                            
                                            // åŸå§‹ç·¨è™Ÿ
                                            memberMap[code] = memberInfo;
                                            
                                            // è™•ç†æ•¸å­—æ ¼å¼ï¼šç¢ºä¿æ‰€æœ‰å¯èƒ½çš„æ ¼å¼éƒ½èƒ½åŒ¹é…
                                            const numericValue = parseInt(code, 10);
                                            if (!isNaN(numericValue)) {
                                                // æ˜ å°„å¤šç¨®æ ¼å¼ï¼šå¦‚ "001" -> ["001", "01", "1"]
                                                // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„æ ¼å¼ï¼ˆ1-3ä½æ•¸ï¼‰
                                                for (let digits = 1; digits <= 3; digits++) {
                                                    const formattedCode = String(numericValue).padStart(digits, '0');
                                                    if (formattedCode !== code) {
                                                        memberMap[formattedCode] = memberInfo;
                                                    }
                                                }
                                                // ä¹Ÿæ˜ å°„ç´”æ•¸å­—ç‰ˆæœ¬ï¼ˆå»æ‰å‰å°é›¶ï¼‰
                                                const pureNumber = String(numericValue);
                                                if (pureNumber !== code) {
                                                    memberMap[pureNumber] = memberInfo;
                                                }
                                            }
                                        }
                                    });
                                    
                                    memberDataCache = memberMap;
                                    memberDataCacheTime = Date.now();
                                    
                                    safeLog.log(`âœ… æˆåŠŸè¼‰å…¥ ${Object.keys(memberMap).length} ç­†æœƒå“¡è³‡æ–™`);
                                    return memberMap;
                                } else {
                                    safeLog.log('â„¹ï¸ æœƒå“¡è³‡æ–™ç‚ºç©ºï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼ˆå¦‚æœé‚„æ²’æœ‰å»ºç«‹æœƒå“¡è³‡æ–™å·¥ä½œè¡¨æˆ–æ·»åŠ æœƒå“¡è³‡æ–™ï¼‰');
                                    safeLog.log('ğŸ’¡ æç¤ºï¼š');
                                    safeLog.log('   1. åœ¨ Google Sheets ä¸­åŸ·è¡Œ initializeSheets() å‡½æ•¸å»ºç«‹ã€Œæœƒå“¡è³‡æ–™ã€å·¥ä½œè¡¨');
                                    safeLog.log('   2. åœ¨ã€Œæœƒå“¡è³‡æ–™ã€å·¥ä½œè¡¨ä¸­æ·»åŠ æœƒå“¡ç·¨è™Ÿå’Œå§“å');
                                    safeLog.log('   3. åˆ·æ–°é é¢å³å¯ä½¿ç”¨å¿«é€Ÿæœç´¢åŠŸèƒ½');
                                    
                                    // è¿”å›ç©ºå°è±¡ä½†æ¨™è¨˜ç‚ºæˆåŠŸï¼Œé€™æ¨£ä¸æœƒé¡¯ç¤ºéŒ¯èª¤
                                    memberDataCache = {};
                                    memberDataCacheTime = Date.now();
                                    return {};
                                }
                            } else {
                                safeLog.warn('âš ï¸ è®€å–æœƒå“¡è³‡æ–™å¤±æ•—:', result.message || 'æœªçŸ¥éŒ¯èª¤');
                                if (result.message && result.message.includes('æ‰¾ä¸åˆ°')) {
                                    safeLog.log('ğŸ’¡ æç¤ºï¼šè«‹å…ˆåœ¨ Google Sheets ä¸­åŸ·è¡Œ initializeSheets() å‡½æ•¸å»ºç«‹ã€Œæœƒå“¡è³‡æ–™ã€å·¥ä½œè¡¨');
                                }
                            }
                        } else {
                            const errorText = await response.text();
                            safeLog.warn('âš ï¸ HTTP è«‹æ±‚å¤±æ•—:', response.status, errorText);
                        }
                    } catch (fetchError) {
                        safeLog.warn('âš ï¸ Fetch è«‹æ±‚å¤±æ•—:', fetchError.message);
                        safeLog.warn('è©³ç´°éŒ¯èª¤:', fetchError);
                    }
                }
                
                // å¦‚æœè¼‰å…¥å¤±æ•—ï¼Œè¿”å›ç©ºå°è±¡
                safeLog.warn('âš ï¸ ç„¡æ³•è¼‰å…¥æœƒå“¡è³‡æ–™ï¼Œå°‡ä½¿ç”¨æœ¬åœ°è³‡æ–™');
                memberDataCache = {};
                memberDataCacheTime = Date.now();
                return {};
                
            } catch (error) {
                safeLog.warn('âš ï¸ è¼‰å…¥æœƒå“¡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                memberDataCache = {};
                memberDataCacheTime = Date.now();
                return {};
            }
        }
        
        // æœå°‹æœƒå“¡å§“åï¼ˆæ ¹æ“šæœƒå“¡ç·¨è™Ÿï¼‰- ç¾åœ¨è¿”å›å®Œæ•´çš„æœƒå“¡è³‡è¨Šå°è±¡
        async function searchMemberName(memberCode) {
            if (!memberCode || memberCode.trim() === '') {
                safeLog.log('ğŸ” æœç´¢æœƒå“¡ï¼šè¼¸å…¥ç‚ºç©º');
                return null;
            }
            
            // è¼‰å…¥æœƒå“¡è³‡æ–™ï¼ˆå¦‚æœé‚„æ²’æœ‰è¼‰å…¥ï¼‰
            const memberData = await loadMemberData();
            
            // èª¿è©¦ï¼šé¡¯ç¤ºæœƒå“¡è³‡æ–™å…§å®¹
            safeLog.log('ğŸ” æœç´¢æœƒå“¡ç·¨è™Ÿ:', memberCode);
            safeLog.log('ğŸ“Š ç•¶å‰æœƒå“¡è³‡æ–™åº«å¤§å°:', Object.keys(memberData).length);
            
            // æ¸…ç†è¼¸å…¥çš„ç·¨è™Ÿï¼ˆç§»é™¤ç©ºæ ¼å’Œéæ•¸å­—å­—ç¬¦ï¼‰
            const cleanCode = memberCode.trim().replace(/[^0-9]/g, '');
            
            if (!cleanCode) {
                safeLog.log('ğŸ” æœç´¢æœƒå“¡ï¼šæ¸…ç†å¾Œç·¨è™Ÿç‚ºç©º');
                return null;
            }
            
            safeLog.log('ğŸ” æ¸…ç†å¾Œçš„ç·¨è™Ÿ:', cleanCode);
            
            // å˜—è©¦å¤šç¨®ç·¨è™Ÿæ ¼å¼é€²è¡Œæœç´¢
            const searchPatterns = [
                cleanCode,                    // åŸæ¨£ï¼šå¦‚ "001" æˆ– "1"
                cleanCode.padStart(3, '0'),  // è£œé›¶åˆ°3ä½ï¼šå¦‚ "1" -> "001"
                String(parseInt(cleanCode, 10)) // å»æ‰å‰å°é›¶ï¼šå¦‚ "001" -> "1"
            ];
            
            // å»é™¤é‡è¤‡çš„æœç´¢æ¨¡å¼
            const uniquePatterns = [...new Set(searchPatterns)];
            
            safeLog.log('ğŸ” å˜—è©¦æœç´¢æ¨¡å¼:', uniquePatterns);
            
            // é€ä¸€å˜—è©¦æœç´¢
            for (const pattern of uniquePatterns) {
                safeLog.log(`ğŸ” å˜—è©¦æ¨¡å¼ "${pattern}":`, memberData[pattern] ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°');
                if (memberData[pattern]) {
                    // è¿”å›ä¸åŒ…å«å¯†ç¢¼çš„æœƒå“¡è³‡è¨Š
                    const memberInfo = memberData[pattern];
                    return {
                        name: memberInfo.name,
                        professionalCategory: memberInfo.professionalCategory
                    };
                }
            }
            
            // å¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œå˜—è©¦æ›´éˆæ´»çš„åŒ¹é…ï¼ˆæ”¯æ´ä»»æ„é•·åº¦çš„è£œé›¶ï¼‰
            const numericValue = parseInt(cleanCode, 10);
            if (!isNaN(numericValue)) {
                safeLog.log('ğŸ” å˜—è©¦éˆæ´»åŒ¹é…ï¼Œæ•¸å€¼ç‚º:', numericValue);
                // å˜—è©¦ 1-3 ä½æ•¸æ ¼å¼ï¼š1, 01, 001
                for (let digits = 1; digits <= 3; digits++) {
                    const paddedCode = String(numericValue).padStart(digits, '0');
                    safeLog.log(`ğŸ” å˜—è©¦ "${paddedCode}":`, memberData[paddedCode] ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°');
                    if (memberData[paddedCode]) {
                        // è¿”å›ä¸åŒ…å«å¯†ç¢¼çš„æœƒå“¡è³‡è¨Š
                        const memberInfo = memberData[paddedCode];
                        return {
                            name: memberInfo.name,
                            professionalCategory: memberInfo.professionalCategory
                        };
                    }
                }
            }
            
            safeLog.log('âŒ æœªæ‰¾åˆ°æœƒå“¡ç·¨è™Ÿ:', memberCode);
            safeLog.log('ğŸ’¡ æç¤ºï¼šè«‹ç¢ºèªæœƒå“¡è³‡æ–™å·²æ­£ç¢ºè¼‰å…¥ï¼Œæˆ–æª¢æŸ¥ç·¨è™Ÿæ ¼å¼');
            return null;
        }
        
        // è¼‰å…¥å¼•è–¦è³‡æ–™ï¼ˆåªå¾ Google Sheets è®€å–ï¼‰
        async function loadReferralData() {
            // æ¸…ç©ºç¾æœ‰çš„å¼•è–¦è³‡æ–™
            Object.keys(referralData).forEach(key => {
                delete referralData[key];
            });
            
            // å¾ Google Sheets è¼‰å…¥æœ€æ–°è³‡æ–™ï¼ˆåƒ…ä½¿ç”¨ Google Sheets çš„è³‡æ–™ï¼‰
            await loadReferralsFromSheets();
        }
        
        // å¾ Google Sheets è®€å–ä½¿ç”¨è¨˜éŒ„
        async function loadAccessLogsFromSheets() {
            try {
                safeLog.log('é–‹å§‹å¾ Google Sheets è®€å–ä½¿ç”¨è¨˜éŒ„...');
                
                // ä½¿ç”¨ Apps Script Web App è®€å–è³‡æ–™
                if (SHEET_CONFIG.APPS_SCRIPT_URL && SHEET_CONFIG.APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL') {
                    const url = `${SHEET_CONFIG.APPS_SCRIPT_URL}?action=getAccessLogs`;
                    
                    // æ–¹æ³•1ï¼šå˜—è©¦ä½¿ç”¨ fetchï¼ˆå¸¶ JSONP callback å›é€€ï¼‰
                    try {
                        // æ·»åŠ è¶…æ™‚ä¿è­·ï¼ˆ20ç§’ï¼‰
                        const fetchWithTimeout = (url, timeout = 20000) => {
                            return Promise.race([
                                fetch(url),
                                new Promise((_, reject) => 
                                    setTimeout(() => reject(new Error('è«‹æ±‚è¶…æ™‚')), timeout)
                                )
                            ]);
                        };
                        
                        const response = await fetchWithTimeout(url);
                        
                        if (response.ok) {
                            const result = await response.json();
                            return result;
                        } else {
                            safeLog.warn('âš ï¸ Fetch è«‹æ±‚å¤±æ•—ï¼Œå˜—è©¦ JSONP æ–¹å¼...');
                            return await tryJsonpMethodForLogs(url);
                        }
                    } catch (fetchError) {
                        safeLog.warn('âš ï¸ Fetch è«‹æ±‚å¤±æ•—:', fetchError.message);
                        safeLog.log('å˜—è©¦ä½¿ç”¨ JSONP æ–¹å¼...');
                        return await tryJsonpMethodForLogs(url);
                    }
                } else {
                    safeLog.log('â„¹ï¸ Apps Script URL æœªè¨­å®šï¼Œè·³éå¾ Google Sheets è®€å–');
                    return { success: false, data: [] };
                }
            } catch (error) {
                safeLog.warn('âš ï¸ å¾ Google Sheets è®€å–ä½¿ç”¨è¨˜éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                return { success: false, data: [] };
            }
        }
        
        // å˜—è©¦ä½¿ç”¨ JSONP æ–¹å¼è®€å–ä½¿ç”¨è¨˜éŒ„
        function tryJsonpMethodForLogs(url) {
            return new Promise((resolve) => {
                try {
                    const callbackName = 'loadAccessLogsCallback_' + Date.now();
                    const jsonpUrl = `${url}&callback=${callbackName}`;
                    
                    // å‰µå»ºå›èª¿å‡½æ•¸
                    window[callbackName] = function(result) {
                        try {
                            // æ¸…ç†å›èª¿å‡½æ•¸
                            delete window[callbackName];
                            
                            // ç§»é™¤ script æ¨™ç±¤
                            const script = document.getElementById('accessLogsJsonp');
                            if (script) {
                                document.body.removeChild(script);
                            }
                            
                            resolve(result);
                        } catch (error) {
                            safeLog.warn('âš ï¸ è™•ç†ä½¿ç”¨è¨˜éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                            resolve({ success: false, data: [] });
                        }
                    };
                    
                    // å‰µå»º script æ¨™ç±¤é€²è¡Œ JSONP è«‹æ±‚
                    const script = document.createElement('script');
                    script.id = 'accessLogsJsonp';
                    script.src = jsonpUrl;
                    script.onerror = function() {
                        safeLog.warn('âš ï¸ JSONP è«‹æ±‚å¤±æ•—');
                        delete window[callbackName];
                        const script = document.getElementById('accessLogsJsonp');
                        if (script) {
                            document.body.removeChild(script);
                        }
                        resolve({ success: false, data: [] });
                    };
                    
                    // è¨­ç½®è¶…æ™‚
                    setTimeout(() => {
                        if (window[callbackName]) {
                            safeLog.warn('âš ï¸ JSONP è«‹æ±‚è¶…æ™‚');
                            delete window[callbackName];
                            const script = document.getElementById('accessLogsJsonp');
                            if (script) {
                                document.body.removeChild(script);
                            }
                            resolve({ success: false, data: [] });
                        }
                    }, 10000);
                    
                    document.body.appendChild(script);
                } catch (error) {
                    safeLog.warn('âš ï¸ JSONP è«‹æ±‚å‰µå»ºå¤±æ•—:', error);
                    resolve({ success: false, data: [] });
                }
            });
        }
        
        // å¾ Google Sheets è®€å–å¼•è–¦è³‡æ–™ï¼ˆå¤šç¨®æ–¹å¼å˜—è©¦ï¼‰
        async function loadReferralsFromSheets() {
            try {
                safeLog.log('é–‹å§‹å¾ Google Sheets è®€å–å¼•è–¦è³‡æ–™...');
                
                // ä½¿ç”¨ Apps Script Web App è®€å–è³‡æ–™
                if (SHEET_CONFIG.APPS_SCRIPT_URL && SHEET_CONFIG.APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL') {
                    const url = `${SHEET_CONFIG.APPS_SCRIPT_URL}?action=getReferrals`;
                    
                    // æ–¹æ³•1ï¼šå˜—è©¦ä½¿ç”¨ fetchï¼ˆå¸¶ JSONP callback å›é€€ï¼‰
                    try {
                        // æ·»åŠ è¶…æ™‚ä¿è­·ï¼ˆ20ç§’ï¼‰
                        const fetchWithTimeout = (url, timeout = 20000) => {
                            return Promise.race([
                                fetch(url),
                                new Promise((_, reject) => 
                                    setTimeout(() => reject(new Error('è«‹æ±‚è¶…æ™‚')), timeout)
                                )
                            ]);
                        };
                        
                        const response = await fetchWithTimeout(url);
                        
                        if (response.ok) {
                            const result = await response.json();
                            return processReferralData(result);
                        } else {
                            safeLog.warn('âš ï¸ Fetch è«‹æ±‚å¤±æ•—ï¼Œå˜—è©¦ JSONP æ–¹å¼...');
                            return await tryJsonpMethod(url);
                        }
                    } catch (fetchError) {
                        safeLog.warn('âš ï¸ Fetch è«‹æ±‚å¤±æ•—:', fetchError.message);
                        safeLog.log('å˜—è©¦ä½¿ç”¨ JSONP æ–¹å¼...');
                        return await tryJsonpMethod(url);
                    }
                } else {
                    safeLog.log('â„¹ï¸ Apps Script URL æœªè¨­å®šï¼Œè·³éå¾ Google Sheets è®€å–');
                    return false;
                }
            } catch (error) {
                safeLog.warn('âš ï¸ å¾ Google Sheets è®€å–å¼•è–¦è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                return false;
            }
        }
        
        // è™•ç†å¼•è–¦è³‡æ–™ï¼ˆåªä½¿ç”¨ Google Sheets çš„è³‡æ–™ï¼Œä¸èˆ‡æœ¬åœ°è³‡æ–™åˆä½µï¼‰
        function processReferralData(result) {
            if (result.success && result.data && result.data.length > 0) {
                safeLog.log(`âœ… æˆåŠŸå¾ Google Sheets è®€å– ${result.data.length} ç­†å¼•è–¦è³‡æ–™`);
                
                // æ¸…ç©ºç¾æœ‰è³‡æ–™
                Object.keys(referralData).forEach(key => {
                    delete referralData[key];
                });
                
                // ä½¿ç”¨ Google Sheets çš„è³‡æ–™å®Œå…¨æ›¿æ›ï¼ˆä¸èˆ‡æœ¬åœ°è³‡æ–™åˆä½µï¼‰
                result.data.forEach(referral => {
                    const serviceItem = referral.serviceItem;
                    
                    if (serviceItem) {
                        // æº–å‚™å¼•è–¦è³‡æ–™æ ¼å¼ï¼ˆç¢ºä¿ phone å’Œ lineId æ˜¯å­—ä¸²ï¼‰
                        const referralInfo = {
                            referrerCode: referral.referrerCode || '',
                            companyName: referral.companyName || '',
                            phone: String(referral.phone || ''),
                            lineId: String(referral.lineId || ''),
                            area: referral.area || '',
                            note: referral.note || '',
                            referralDate: referral.referralDate || ''
                        };
                        
                        // å¦‚æœè©²æœå‹™é …ç›®é‚„æ²’æœ‰è³‡æ–™ï¼Œåˆå§‹åŒ–ç‚ºé™£åˆ—
                        if (!referralData[serviceItem]) {
                            referralData[serviceItem] = [];
                        }
                        
                        // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨å®Œå…¨ç›¸åŒçš„å¼•è–¦ï¼ˆæ‰€æœ‰æ¬„ä½éƒ½ç›¸åŒæ‰è¦–ç‚ºé‡è¤‡ï¼‰
                        const exists = referralData[serviceItem].some(
                            r => r.referrerCode === referralInfo.referrerCode && 
                                 r.phone === referralInfo.phone &&
                                 r.lineId === referralInfo.lineId &&
                                 r.area === referralInfo.area &&
                                 r.note === referralInfo.note &&
                                 r.companyName === referralInfo.companyName
                        );
                        
                        if (!exists) {
                            referralData[serviceItem].push(referralInfo);
                        } else {
                            safeLog.log('âš ï¸ è·³éé‡è¤‡çš„å¼•è–¦è¨˜éŒ„:', referralInfo);
                        }
                    }
                });
                
                // ä¿å­˜ Google Sheets çš„è³‡æ–™åˆ°æœ¬åœ°å­˜å„²ï¼ˆä½œç‚ºç·©å­˜ï¼‰
                localStorage.setItem('referralData', JSON.stringify(referralData));
                safeLog.log('âœ… å¼•è–¦è³‡æ–™å·²å¾ Google Sheets è¼‰å…¥ä¸¦ä¿å­˜åˆ°æœ¬åœ°å­˜å„²');
                
                return true;
            } else {
                safeLog.log('â„¹ï¸ Google Sheets ä¸­æš«ç„¡å¼•è–¦è³‡æ–™');
                return false;
            }
        }
        
        // å˜—è©¦ä½¿ç”¨ JSONP æ–¹å¼
        function tryJsonpMethod(url) {
            return new Promise((resolve) => {
                try {
                    const callbackName = 'loadReferralsCallback_' + Date.now();
                    const jsonpUrl = `${url}&callback=${callbackName}`;
                    
                    // å‰µå»ºå›èª¿å‡½æ•¸
                    window[callbackName] = function(result) {
                        try {
                            // æ¸…ç†å›èª¿å‡½æ•¸
                            delete window[callbackName];
                            
                            // ç§»é™¤ script æ¨™ç±¤
                            const script = document.getElementById('referralsJsonp');
                            if (script) {
                                document.body.removeChild(script);
                            }
                            
                            resolve(processReferralData(result));
                        } catch (error) {
                            safeLog.warn('âš ï¸ è™•ç†å¼•è–¦è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                            resolve(false);
                        }
                    };
                    
                    // å‰µå»º script æ¨™ç±¤é€²è¡Œ JSONP è«‹æ±‚
                    const script = document.createElement('script');
                    script.id = 'referralsJsonp';
                    script.src = jsonpUrl;
                    script.onerror = function() {
                        safeLog.warn('âš ï¸ JSONP è«‹æ±‚å¤±æ•—');
                        delete window[callbackName];
                        const script = document.getElementById('referralsJsonp');
                        if (script) {
                            document.body.removeChild(script);
                        }
                        resolve(false);
                    };
                    
                    // è¨­ç½®è¶…æ™‚
                    setTimeout(() => {
                        if (window[callbackName]) {
                            safeLog.warn('âš ï¸ JSONP è«‹æ±‚è¶…æ™‚');
                            delete window[callbackName];
                            const script = document.getElementById('referralsJsonp');
                            if (script) {
                                document.body.removeChild(script);
                            }
                            resolve(false);
                        }
                    }, 10000); // 10ç§’è¶…æ™‚
                    
                    document.body.appendChild(script);
                } catch (error) {
                    safeLog.warn('âš ï¸ JSONP è«‹æ±‚è¨­ç½®å¤±æ•—:', error);
                    resolve(false);
                }
            });
        }
        
        // Toast æç¤ºå‡½æ•¸
        function showSuccessToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(40, 167, 69, 0.95);
                color: white;
                padding: 15px 30px;
                border-radius: 25px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideDown 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 2ç§’å¾Œè‡ªå‹•é—œé–‰
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2000);
        }
        
        function showErrorToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(220, 53, 69, 0.95);
                color: white;
                padding: 15px 30px;
                border-radius: 25px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideDown 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 3ç§’å¾Œè‡ªå‹•é—œé–‰
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
        
        // æ‰‹å‹•é‡æ–°è¼‰å…¥å¼•è–¦è³‡æ–™
        async function refreshReferralData() {
            // é¡¯ç¤ºè¼‰å…¥æç¤º
            const loadingToast = document.createElement('div');
            loadingToast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(102, 126, 234, 0.95);
                color: white;
                padding: 15px 30px;
                border-radius: 25px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 3000;
                font-weight: 600;
            `;
            loadingToast.textContent = 'ğŸ”„ æ­£åœ¨é‡æ–°è¼‰å…¥ Google Sheets è³‡æ–™...';
            document.body.appendChild(loadingToast);
            
            try {
                // å…ˆæ¸…é™¤ç¾æœ‰çš„å¼•è–¦è³‡æ–™ï¼ˆä½†ä¿ç•™å·²è§£é–çš„è¯çµ¡è³‡è¨Šï¼‰
                Object.keys(referralData).forEach(key => {
                    delete referralData[key];
                });
                
                // å¾ Google Sheets é‡æ–°è¼‰å…¥
                const success = await loadReferralsFromSheets();
                
                // æ›´æ–°æç¤ºè¨Šæ¯
                if (success) {
                    loadingToast.textContent = 'âœ… è³‡æ–™è¼‰å…¥æˆåŠŸï¼';
                    loadingToast.style.background = 'rgba(40, 167, 69, 0.95)';
                    
                    // å¦‚æœç•¶å‰æœ‰é¡¯ç¤ºè©³ç´°è³‡è¨Šé¢æ¿ï¼Œé‡æ–°é¡¯ç¤ºä»¥æ›´æ–°è³‡æ–™
                    if (currentDetails) {
                        showDetails(currentDetails.item, currentDetails.category, currentDetails.subCategory);
                    }
                } else {
                    loadingToast.textContent = 'âš ï¸ è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨æœ¬åœ°è³‡æ–™';
                    loadingToast.style.background = 'rgba(255, 193, 7, 0.95)';
                }
                
                // 3ç§’å¾Œè‡ªå‹•é—œé–‰æç¤º
                setTimeout(() => {
                    if (document.body.contains(loadingToast)) {
                        document.body.removeChild(loadingToast);
                    }
                }, 3000);
                
            } catch (error) {
                console.error('é‡æ–°è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                loadingToast.textContent = 'âŒ è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
                loadingToast.style.background = 'rgba(220, 53, 69, 0.95)';
                
                setTimeout(() => {
                    if (document.body.contains(loadingToast)) {
                        document.body.removeChild(loadingToast);
                    }
                }, 3000);
            }
        }
        
        // è¼‰å…¥å·²è§£é–çš„è¯çµ¡è³‡è¨Š
        function loadUnlockedContacts() {
            const accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
            if (accessLogs.length > 0) {
                // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿DOMå·²ç¶“è¼‰å…¥
                setTimeout(() => {
                    accessLogs.forEach(log => {
                        updateContactDisplay(log.accessType, log.contactValue, log.serviceItem, log.referrerCode);
                    });
                }, 1000);
            }
        }

        function createMindmap() {
            const container = document.getElementById('mindmapContent');
            if (!container) {
                console.error('æ‰¾ä¸åˆ°å¿ƒæ™ºåœ–å®¹å™¨å…ƒç´ ');
                return;
            }
            
            // å‰µå»ºç°¡æ½”çš„å¡ç‰‡ä½ˆå±€
            createCardLayout(container);
        }

        function createCardLayout(container) {
            if (!container) {
                console.error('createCardLayout: å®¹å™¨ç‚º null');
                return;
            }
            
            // æª¢æŸ¥ mindmapData æ˜¯å¦å­˜åœ¨
            if (!mindmapData || !mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"]) {
                console.error('mindmapData æœªå®šç¾©æˆ–æ ¼å¼éŒ¯èª¤');
                container.textContent = 'éŒ¯èª¤ï¼šå¿ƒæ™ºåœ–è³‡æ–™æœªè¼‰å…¥';
                return;
            }
            
            // å‰µå»ºç°¡æ½”çš„å¡ç‰‡ä½ˆå±€
            const cardsContainer = document.createElement('div');
            cardsContainer.style.cssText = `
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 12px;
                padding: 15px;
                max-width: 1200px;
                margin: 0 auto;
                width: 100%;
            `;
            
            const categories = Object.keys(mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"]);
            
            if (categories.length === 0) {
                container.textContent = 'æš«ç„¡åˆ†é¡è³‡æ–™';
                return;
            }
            
            // å„ªåŒ–ï¼šä½¿ç”¨æ–‡æª”ç‰‡æ®µæ‰¹é‡æ·»åŠ DOMä»¥æé«˜æ€§èƒ½
            const fragment = document.createDocumentFragment();
            
            categories.forEach(category => {
                const card = createCategoryCard(category);
                if (card) {
                    fragment.appendChild(card);
                }
            });
            
            cardsContainer.appendChild(fragment);
            container.appendChild(cardsContainer);
        }
        
        function createCategoryCard(category) {
            // æª¢æ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
            const isMobile = window.innerWidth <= 768;
            
            const card = document.createElement('div');
            card.style.cssText = `
                background: white;
                border-radius: 10px;
                padding: 12px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.08);
                border: 1px solid #e9ecef;
                transition: all 0.3s ease;
                cursor: pointer;
            `;
            
            // å¡ç‰‡æ¨™é¡Œ
            const title = document.createElement('h3');
            title.style.cssText = `
                margin: 0 0 10px 0;
                font-size: 15px;
                color: #333;
                text-align: center;
                padding: 8px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border-radius: 6px;
                font-weight: 600;
                position: relative;
                cursor: ${(displayMode === 'compact' || isMobile) ? 'pointer' : 'default'};
            `;
            
            // æ¨™é¡Œæ–‡å­—å®¹å™¨
            const titleText = document.createElement('span');
            titleText.textContent = category;
            title.appendChild(titleText);
            
            // æ·»åŠ å±•é–‹/æ”¶åˆç®­é ­ï¼ˆç°¡æ½”æ¨¡å¼æˆ–æ‰‹æ©Ÿç‰ˆï¼‰
            if (displayMode === 'compact' || isMobile) {
                const expandIcon = document.createElement('span');
                expandIcon.className = 'category-expand-icon';
                expandIcon.style.cssText = `
                    position: absolute;
                    right: 15px;
                    top: 50%;
                    transform: translateY(-50%);
                    font-size: 14px;
                    transition: transform 0.3s ease;
                `;
                expandIcon.textContent = 'â–¼';
                title.appendChild(expandIcon);
            }
            
            // å­åˆ†é¡åˆ—è¡¨
            if (!mindmapData || !mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"] || !mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"][category]) {
                console.warn('æ‰¾ä¸åˆ°åˆ†é¡è³‡æ–™:', category);
                return card;
            }
            
            const subCategories = mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"][category];
            const subList = document.createElement('div');
            subList.className = 'category-sub-list';
            
            // æ ¹æ“šé¡¯ç¤ºæ¨¡å¼æ±ºå®šæ˜¯å¦é¡¯ç¤ºå­åˆ†é¡
            const shouldShowSubList = displayMode === 'full' && !isMobile;
            
            subList.style.cssText = `
                display: ${shouldShowSubList ? 'flex' : 'none'};
                flex-direction: column;
                gap: 6px;
                transition: all 0.3s ease;
                overflow: hidden;
            `;
            
            // ç°¡æ½”æ¨¡å¼æˆ–æ‰‹æ©Ÿç‰ˆï¼šæ¨™é¡Œé»æ“Šæ™‚æ”¶åˆ/å±•é–‹
            if (displayMode === 'compact' || isMobile) {
                title.onclick = (e) => {
                    e.stopPropagation();
                    const isCollapsed = subList.style.display === 'none';
                    const icon = title.querySelector('.category-expand-icon');
                    
                    if (isCollapsed) {
                        subList.style.display = 'flex';
                        if (icon) icon.style.transform = 'translateY(-50%) rotate(180deg)';
                        card.style.paddingBottom = '12px';
                    } else {
                        subList.style.display = 'none';
                        if (icon) icon.style.transform = 'translateY(-50%) rotate(0deg)';
                    }
                };
            }
            
            Object.keys(subCategories).forEach(subCategory => {
                // æª¢æŸ¥å­åˆ†é¡ä¸‹æ˜¯å¦æœ‰å¼•è–¦äºº
                const items = subCategories[subCategory];
                
                // å¦‚æœ items ä¸æ˜¯æ•¸çµ„ï¼ˆå¯èƒ½æ˜¯åµŒå¥—å°è±¡ï¼‰ï¼Œå‰‡è·³éé€™å€‹å­åˆ†é¡
                if (!Array.isArray(items)) {
                    return;
                }
                
                const hasAnyReferral = items.some(item => referralData[item]);
                
                // å¦‚æœåªé¡¯ç¤ºæœ‰å¼•è–¦äººçš„è³‡æºï¼Œä¸”é€™å€‹å­åˆ†é¡æ²’æœ‰ä»»ä½•å¼•è–¦äººï¼Œå‰‡è·³é
                if (showResourcesOnly && !hasAnyReferral) {
                    return;
                }
                
                const subItem = document.createElement('div');
                subItem.style.cssText = `
                    background: #f8f9fa;
                    padding: 6px 10px;
                    border-radius: 5px;
                    font-size: 13px;
                    color: #666;
                    border-left: 3px solid #667eea;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    position: relative;
                `;
                
                // æ·»åŠ å±•é–‹ç®­é ­
                const expandArrow = document.createElement('span');
                expandArrow.style.cssText = `
                    position: absolute;
                    right: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    font-size: 12px;
                    color: #667eea;
                    transition: transform 0.3s ease;
                `;
                expandArrow.textContent = 'â–¶';
                subItem.appendChild(expandArrow);
                
                subItem.textContent = subCategory;
                
                subItem.addEventListener('mouseenter', () => {
                    subItem.style.background = '#e9ecef';
                    subItem.style.color = '#333';
                });
                
                subItem.addEventListener('mouseleave', () => {
                    subItem.style.background = '#f8f9fa';
                    subItem.style.color = '#666';
                });
                
                subItem.onclick = (e) => {
                    e.stopPropagation();
                    toggleSubItems(subItem, category, subCategory, subCategories[subCategory]);
                };
                
                subList.appendChild(subItem);
            });
            
            // æ‡¸åœæ•ˆæœ
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-3px)';
                card.style.boxShadow = '0 8px 25px rgba(0,0,0,0.12)';
            });
            
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '0 4px 15px rgba(0,0,0,0.08)';
            });
            
            card.appendChild(title);
            card.appendChild(subList);
            
            return card;
        }
        
        function toggleSubItems(subItem, category, subCategory, items) {
            // æª¢æŸ¥åƒæ•¸æ˜¯å¦æœ‰æ•ˆ
            if (!subItem || !subItem.parentNode) {
                console.error('toggleSubItems: subItem æˆ– parentNode ç‚º null');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“å±•é–‹
            const existingSubItems = subItem.parentNode.querySelector('.sub-items-container');
            const expandArrow = subItem.querySelector('span');
            
            if (existingSubItems) {
                existingSubItems.remove();
                if (subItem) {
                    subItem.style.borderLeftColor = '#667eea';
                    subItem.style.background = '#f8f9fa';
                }
                if (expandArrow) {
                    expandArrow.style.transform = 'translateY(-50%) rotate(0deg)';
                }
                return;
            }
            
            // å‰µå»ºç´°é …å®¹å™¨
            const subItemsContainer = document.createElement('div');
            subItemsContainer.className = 'sub-items-container';
            subItemsContainer.style.cssText = `
                margin-top: 6px;
                display: flex;
                flex-direction: column;
                gap: 3px;
                position: relative;
                padding-left: 12px;
                border-left: 2px solid #667eea;
            `;
            
            // æ‡‰ç”¨åˆä½µé‚è¼¯
            const processedItems = mergeRegionalItems(items);
            
            // å‰µå»ºæ¯å€‹ç´°é …
            processedItems.forEach(item => {
                // æª¢æŸ¥é …ç›®æ˜¯å¦æœ‰å¼•è–¦äºº
                const itemName = typeof item === 'object' ? item.name : item;
                const hasReferral = checkItemHasReferral(item, itemName);
                
                // å¦‚æœåªé¡¯ç¤ºæœ‰å¼•è–¦äººçš„è³‡æºï¼Œä¸”é€™å€‹é …ç›®æ²’æœ‰å¼•è–¦äººï¼Œå‰‡è·³é
                if (showResourcesOnly && !hasReferral) {
                    return;
                }
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = `
                    background: white;
                    padding: 5px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    color: #555;
                    border: 1px solid #e9ecef;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    margin-left: 8px;
                    position: relative;
                `;
                
                // è™•ç†åˆä½µçš„é …ç›®
                if (typeof item === 'object' && item.merged) {
                    itemDiv.textContent = `${item.name} (${item.regions.length}å€‹å€åŸŸ)`;
                    itemDiv.dataset.merged = 'true';
                    itemDiv.dataset.regions = JSON.stringify(item.regions);
                    itemDiv.dataset.originalItems = JSON.stringify(item.originalItems);
                } else {
                    itemDiv.textContent = item;
                }
                
                // æ·»åŠ å¼•è–¦äººæŒ‡ç¤ºå™¨
                const referralIndicator = document.createElement('span');
                referralIndicator.style.cssText = `
                    position: absolute;
                    right: 8px;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    background: ${referralData[item] ? '#28a745' : '#dc3545'};
                `;
                itemDiv.appendChild(referralIndicator);
                
                itemDiv.addEventListener('mouseenter', () => {
                    itemDiv.style.background = '#e9ecef';
                    itemDiv.style.borderColor = '#667eea';
                });
                
                itemDiv.addEventListener('mouseleave', () => {
                    itemDiv.style.background = 'white';
                    itemDiv.style.borderColor = '#e9ecef';
                });
                
                itemDiv.onclick = (e) => {
                    e.stopPropagation();
                    
                    // å¦‚æœæ˜¯åˆä½µé …ç›®ï¼Œé¡¯ç¤ºå€åŸŸé¸æ“‡å°è©±æ¡†
                    if (itemDiv.dataset.merged === 'true') {
                        const regions = JSON.parse(itemDiv.dataset.regions);
                        const originalItems = JSON.parse(itemDiv.dataset.originalItems);
                        showMergedItemSelector(itemDiv.textContent, regions, originalItems, category, subCategory);
                    } else {
                        // æª¢æŸ¥æ˜¯å¦æœ‰é€²ä¸€æ­¥çš„ç´°åˆ†
                        const itemName = typeof item === 'object' ? item : item;
                        if (subdivisionData[itemName]) {
                            // æª¢æŸ¥æ˜¯å¦æŒ‰ä½ Shift éµï¼ˆè‡ªå‹•å±•é–‹å…¨éƒ¨ï¼‰
                            if (e.shiftKey) {
                                expandAllRelated(itemDiv, category, subCategory, itemName);
                            } else {
                                toggleSubdivision(itemDiv, category, subCategory, itemName);
                            }
                        } else {
                            showDetails(itemName, category, subCategory);
                        }
                    }
                };
                
                subItemsContainer.appendChild(itemDiv);
            });
            
            // æ’å…¥åˆ°å­åˆ†é¡é …ç›®å¾Œé¢
            subItem.parentNode.insertBefore(subItemsContainer, subItem.nextSibling);
            
            // æ›´æ–°å­åˆ†é¡é …ç›®çš„æ¨£å¼
            if (subItem) {
                subItem.style.borderLeftColor = '#28a745';
                subItem.style.background = '#e8f5e8';
            }
            if (expandArrow) {
                expandArrow.style.transform = 'translateY(-50%) rotate(90deg)';
            }
        }
        
        // æ‘ºç–Š/å±•é–‹å…¨éƒ¨
        function toggleCollapseAll() {
            isCollapsedAll = !isCollapsedAll;
            const collapseBtn = document.getElementById('collapseAllBtn');
            
            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            if (collapseBtn) {
                collapseBtn.textContent = isCollapsedAll ? 'ğŸ“‚ å±•é–‹å…¨éƒ¨' : 'ğŸ“‹ æ‘ºç–Šå…¨éƒ¨';
            }
            
            // ç²å–æ‰€æœ‰å­åˆ†é¡åˆ—è¡¨
            const subLists = document.querySelectorAll('.category-sub-list');
            subLists.forEach(subList => {
                subList.style.display = isCollapsedAll ? 'none' : 'flex';
            });
            
            // ç²å–æ‰€æœ‰å±•é–‹çš„ç´°é …å®¹å™¨
            const subItemsContainers = document.querySelectorAll('.sub-items-container');
            subItemsContainers.forEach(container => {
                container.remove();
            });
            
            // é‡ç½®æ‰€æœ‰å­åˆ†é¡é …ç›®çš„æ¨£å¼
            const subItems = document.querySelectorAll('.category-sub-list > div');
            subItems.forEach(subItem => {
                subItem.style.borderLeftColor = '#667eea';
                subItem.style.background = '#f8f9fa';
                const arrow = subItem.querySelector('span');
                if (arrow) {
                    arrow.style.transform = 'translateY(-50%) rotate(0deg)';
                }
            });
            
            // å¦‚æœæ˜¯æ‰‹æ©Ÿç‰ˆï¼Œä¹Ÿè¦æ›´æ–°å¡ç‰‡æ¨™é¡Œ
            const categoryExpandIcons = document.querySelectorAll('.category-expand-icon');
            categoryExpandIcons.forEach(icon => {
                icon.style.transform = isCollapsedAll ? 'translateY(-50%) rotate(0deg)' : 'translateY(-50%) rotate(180deg)';
            });
        }
        
        // åˆ‡æ›é¡¯ç¤ºæ¨¡å¼ï¼ˆç°¡æ½”/å®Œæ•´ï¼‰
        function toggleDisplayMode() {
            displayMode = displayMode === 'compact' ? 'full' : 'compact';
            const modeBtn = document.getElementById('displayModeBtn');
            
            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            if (modeBtn) {
                modeBtn.textContent = displayMode === 'compact' ? 'ğŸ“„ ç°¡æ½”æ¨¡å¼' : 'ğŸ“‹ å®Œæ•´æ¨¡å¼';
            }
            
            // é‡æ–°æ¸²æŸ“å¿ƒæ™ºåœ–
            const container = document.getElementById('mindmapContent');
            container.textContent = ''; // å®‰å…¨æ¸…ç©º
            createCardLayout(container);
            
            // ä¿å­˜ç”¨æˆ¶åå¥½
            localStorage.setItem('displayMode', displayMode);
        }
        
        // åˆ‡æ›åˆä½µå€åŸŸé …ç›®
        function toggleMergeRegions() {
            mergeRegions = !mergeRegions;
            const mergeBtn = document.getElementById('mergeRegionsBtn');
            
            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            if (mergeBtn) {
                mergeBtn.textContent = mergeRegions ? 'ğŸ”— å·²åˆä½µ' : 'ğŸ“‹ åˆ†é–‹é¡¯ç¤º';
            }
            
            // é‡æ–°æ¸²æŸ“å¿ƒæ™ºåœ–
            const container = document.getElementById('mindmapContent');
            container.textContent = ''; // å®‰å…¨æ¸…ç©º
            createCardLayout(container);
            
            // ä¿å­˜ç”¨æˆ¶åå¥½
            localStorage.setItem('mergeRegions', mergeRegions);
        }
        
        // åˆ‡æ›åªé¡¯ç¤ºæœ‰å¼•è–¦äººçš„è³‡æº
        function toggleShowResourcesOnly() {
            showResourcesOnly = !showResourcesOnly;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            updateButtonsState();
            
            // é‡æ–°æ¸²æŸ“å¿ƒæ™ºåœ–
            const container = document.getElementById('mindmapContent');
            container.textContent = ''; // å®‰å…¨æ¸…ç©º
            createCardLayout(container);
            
            // ä¿å­˜ç”¨æˆ¶åå¥½
            localStorage.setItem('showResourcesOnly', showResourcesOnly);
        }
        
        // é¡¯ç¤ºåˆä½µé …ç›®çš„å€åŸŸé¸æ“‡å™¨
        function showMergedItemSelector(itemName, regions, originalItems, category, subCategory) {
            // å‰µå»ºå°è©±æ¡†
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 3000;
                max-width: 500px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼å‰µå»ºå°è©±æ¡†å…§å®¹
            const header = safeCreateElement('div', '', { style: 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;' });
            const title = safeCreateElement('h3', itemName, { style: 'margin: 0; color: #333; font-size: 18px;' });
            const closeBtn = safeCreateElement('button', 'Ã—', { 
                style: 'background: none; border: none; font-size: 24px; cursor: pointer; color: #999;',
                onclick: 'this.closest(\'div[role="dialog"]\')?.remove()',
                'aria-label': 'é—œé–‰å°è©±æ¡†'
            });
            closeBtn.onclick = () => dialog.remove();
            header.appendChild(title);
            header.appendChild(closeBtn);
            
            const description = safeCreateElement('div', 'è«‹é¸æ“‡æ‚¨éœ€è¦çš„æœå‹™å€åŸŸï¼š', { 
                style: 'margin-bottom: 15px; color: #666; font-size: 14px;' 
            });
            
            const optionsContainer = safeCreateElement('div', '', { 
                style: 'display: flex; flex-direction: column; gap: 8px;' 
            });
            
            regions.forEach((region, index) => {
                const option = safeCreateElement('div', '', {
                    class: 'region-option',
                    style: 'padding: 12px; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; border: 2px solid transparent;',
                    role: 'button',
                    tabindex: '0',
                    'aria-label': `é¸æ“‡ ${region} å€åŸŸ`
                });
                const regionName = safeCreateElement('div', region, { style: 'font-weight: 600; color: #333;' });
                option.appendChild(regionName);
                
                option.addEventListener('click', () => selectRegion(region, originalItems[index], category, subCategory));
                option.addEventListener('mouseenter', () => {
                    option.style.background = '#e3e8ff';
                    option.style.borderColor = '#667eea';
                });
                option.addEventListener('mouseleave', () => {
                    option.style.background = '#f8f9fa';
                    option.style.borderColor = 'transparent';
                });
                option.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectRegion(region, originalItems[index], category, subCategory);
                    }
                });
                
                optionsContainer.appendChild(option);
            });
            
            dialog.setAttribute('role', 'dialog');
            dialog.setAttribute('aria-labelledby', 'dialog-title');
            dialog.setAttribute('aria-modal', 'true');
            title.id = 'dialog-title';
            dialog.appendChild(header);
            dialog.appendChild(description);
            dialog.appendChild(optionsContainer);
            
            document.body.appendChild(dialog);
        }
        
        // é¸æ“‡å€åŸŸ
        function selectRegion(region, originalItem, category, subCategory) {
            // ç§»é™¤å°è©±æ¡†
            const dialog = document.querySelector('div[style*="z-index: 3000"]');
            if (dialog) dialog.remove();
            
            // é¡¯ç¤ºè©²å€åŸŸçš„è©³ç´°è³‡è¨Š
            showDetails(originalItem, category, subCategory);
        }
        
        // æª¢æŸ¥é …ç›®æ˜¯å¦æœ‰å¼•è–¦äºº
        function checkItemHasReferral(item, itemName) {
            // å¦‚æœæ˜¯åˆä½µé …ç›®ï¼Œæª¢æŸ¥æ‰€æœ‰åŸå§‹é …ç›®
            if (typeof item === 'object' && item.merged) {
                return item.originalItems.some(originalItem => referralData[originalItem]);
            }
            
            // å–®å€‹é …ç›®ç›´æ¥æª¢æŸ¥
            return !!referralData[itemName];
        }
        
        // åˆä½µå€åŸŸé …ç›®
        function mergeRegionalItems(items) {
            if (!mergeRegions) return items;
            
            const mergedItems = [];
            const regionGroups = {};
            
            items.forEach(item => {
                // æª¢æŸ¥æ˜¯å¦ç‚ºå€åŸŸé …ç›®ï¼ˆåŒ…å« -å°åŒ—å¸‚ã€-åŒ—éƒ¨ã€-é«˜é›„ ç­‰å¾Œç¶´ï¼‰
                const regionMatch = item.match(/^(.+?)-(.+)$/);
                
                if (regionMatch) {
                    const baseName = regionMatch[1].trim();
                    const region = regionMatch[2].trim();
                    
                    if (!regionGroups[baseName]) {
                        regionGroups[baseName] = [];
                    }
                    regionGroups[baseName].push({ item, region });
                } else {
                    // éå€åŸŸé …ç›®ç›´æ¥æ·»åŠ 
                    mergedItems.push(item);
                }
            });
            
            // åˆä½µå€åŸŸé …ç›®
            Object.keys(regionGroups).forEach(baseName => {
                const regions = regionGroups[baseName];
                if (regions.length > 1) {
                    // æœ‰å¤šå€‹å€åŸŸï¼Œåˆä½µæˆä¸€å€‹é …ç›®
                    mergedItems.push({
                        name: baseName,
                        merged: true,
                        regions: regions.map(r => r.region),
                        originalItems: regions.map(r => r.item)
                    });
                } else {
                    // åªæœ‰ä¸€å€‹å€åŸŸï¼Œä¿æŒåŸæ¨£
                    mergedItems.push(regions[0].item);
                }
            });
            
            return mergedItems;
        }
        
        function showItemDetails(category, subCategory, item) {
            // é¡¯ç¤ºé …ç›®è©³ç´°è³‡è¨Š
            const detailsPanel = document.getElementById('detailsPanel');
            const detailsTitle = document.getElementById('detailsTitle');
            const detailsContent = document.getElementById('detailsContent');
            
            detailsTitle.textContent = item;
            
            // å®‰å…¨åœ°è¨­ç½®å…§å®¹
            detailsContent.textContent = ''; // æ¸…ç©º
            const infoDiv = safeCreateElement('div', '', { style: 'margin-bottom: 15px;' });
            const categoryLabel = safeCreateElement('strong', 'ä¸»åˆ†é¡ï¼š');
            const categoryText = document.createTextNode(category);
            const br1 = document.createElement('br');
            const subCategoryLabel = safeCreateElement('strong', 'å­åˆ†é¡ï¼š');
            const subCategoryText = document.createTextNode(subCategory);
            const br2 = document.createElement('br');
            const itemLabel = safeCreateElement('strong', 'æœå‹™é …ç›®ï¼š');
            const itemText = document.createTextNode(item);
            
            infoDiv.appendChild(categoryLabel);
            infoDiv.appendChild(categoryText);
            infoDiv.appendChild(br1);
            infoDiv.appendChild(subCategoryLabel);
            infoDiv.appendChild(subCategoryText);
            infoDiv.appendChild(br2);
            infoDiv.appendChild(itemLabel);
            infoDiv.appendChild(itemText);
            
            const descDiv = safeCreateElement('div', '', { style: 'background: #f8f9fa; padding: 15px; border-radius: 8px;' });
            const descLabel = safeCreateElement('strong', 'æœå‹™èªªæ˜ï¼š');
            const br3 = document.createElement('br');
            const descText = document.createTextNode(`é€™è£¡å¯ä»¥æ·»åŠ  ${item} çš„è©³ç´°æœå‹™èªªæ˜ã€åƒ¹æ ¼ã€æ™‚ç¨‹ç­‰ç›¸é—œè³‡è¨Šã€‚`);
            descDiv.appendChild(descLabel);
            descDiv.appendChild(br3);
            descDiv.appendChild(descText);
            
            detailsContent.appendChild(infoDiv);
            detailsContent.appendChild(descDiv);
            
            // é¡¯ç¤ºå¼•è–¦äººè³‡è¨Š
            const referralInfoEl = document.getElementById('referralInfo');
            const referral = referralData[item];
            if (referral) {
                // æ ¼å¼åŒ–é›»è©±è™Ÿç¢¼ï¼ˆä¸è¶³10ç¢¼å‰é¢è£œ0ï¼‰
                const formattedPhone = formatPhoneNumber(referral.phone);
                referralInfoEl.textContent = ''; // æ¸…ç©º
                
                const nameLabel = safeCreateElement('strong', 'å§“åï¼š');
                const nameText = document.createTextNode(referral.name);
                const br1 = document.createElement('br');
                const companyLabel = safeCreateElement('strong', 'å…¬å¸ï¼š');
                const companyText = document.createTextNode(referral.company);
                const br2 = document.createElement('br');
                const phoneLabel = safeCreateElement('strong', 'é›»è©±ï¼š');
                const phoneText = document.createTextNode(formattedPhone);
                const br3 = document.createElement('br');
                const emailLabel = safeCreateElement('strong', 'Emailï¼š');
                const emailText = document.createTextNode(referral.email);
                const br4 = document.createElement('br');
                const expLabel = safeCreateElement('strong', 'ç¶“é©—ï¼š');
                const expText = document.createTextNode(referral.experience);
                
                referralInfoEl.appendChild(nameLabel);
                referralInfoEl.appendChild(nameText);
                referralInfoEl.appendChild(br1);
                referralInfoEl.appendChild(companyLabel);
                referralInfoEl.appendChild(companyText);
                referralInfoEl.appendChild(br2);
                referralInfoEl.appendChild(phoneLabel);
                referralInfoEl.appendChild(phoneText);
                referralInfoEl.appendChild(br3);
                referralInfoEl.appendChild(emailLabel);
                referralInfoEl.appendChild(emailText);
                referralInfoEl.appendChild(br4);
                referralInfoEl.appendChild(expLabel);
                referralInfoEl.appendChild(expText);
            } else {
                referralInfoEl.textContent = 'æš«ç„¡å¼•è–¦äººè³‡è¨Šï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•æ·»åŠ ã€‚';
            }
            
            detailsPanel.classList.add('active');
            detailsPanel.setAttribute('aria-hidden', 'false');
        }
        
        function toggleSubdivision(itemDiv, category, subCategory, item) {
            // æª¢æŸ¥é€™å€‹ç‰¹å®š item æ˜¯å¦å·²ç¶“å±•é–‹ç´°åˆ†
            // åªæŸ¥æ‰¾ç·Šè·Ÿåœ¨é€™å€‹ itemDiv å¾Œé¢çš„ subdivision-container
            let nextSibling = itemDiv.nextSibling;
            while (nextSibling) {
                if (nextSibling.classList && nextSibling.classList.contains('subdivision-container')) {
                    nextSibling.remove();
                    return;
                }
                nextSibling = nextSibling.nextSibling;
            }
            
            // å‰µå»ºç´°åˆ†å®¹å™¨
            const subdivisionContainer = document.createElement('div');
            subdivisionContainer.className = 'subdivision-container';
            subdivisionContainer.style.cssText = `
                margin-top: 6px;
                display: flex;
                flex-direction: column;
                gap: 3px;
                margin-left: 15px;
                position: relative;
                padding-left: 12px;
                border-left: 2px solid #007bff;
            `;
            
            const subdivisions = subdivisionData[item];
            
            Object.keys(subdivisions).forEach(subdivisionName => {
                const subdivisionDiv = document.createElement('div');
                subdivisionDiv.style.cssText = `
                    background: #f0f8ff;
                    padding: 5px 8px;
                    border-radius: 3px;
                    font-size: 11px;
                    color: #444;
                    border: 1px solid #d0e7ff;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    position: relative;
                `;
                
                subdivisionDiv.textContent = subdivisionName;
                
                // æ·»åŠ ç´°åˆ†æŒ‡ç¤ºå™¨
                const subdivisionIndicator = document.createElement('span');
                subdivisionIndicator.style.cssText = `
                    position: absolute;
                    right: 6px;
                    top: 50%;
                    transform: translateY(-50%);
                    font-size: 10px;
                    color: #007bff;
                `;
                subdivisionIndicator.textContent = 'â–¶';
                subdivisionDiv.appendChild(subdivisionIndicator);
                
                subdivisionDiv.addEventListener('mouseenter', () => {
                    subdivisionDiv.style.background = '#e6f3ff';
                    subdivisionDiv.style.borderColor = '#007bff';
                });
                
                subdivisionDiv.addEventListener('mouseleave', () => {
                    subdivisionDiv.style.background = '#f0f8ff';
                    subdivisionDiv.style.borderColor = '#d0e7ff';
                });
                
                subdivisionDiv.onclick = (e) => {
                    e.stopPropagation();
                    // æª¢æŸ¥æ˜¯å¦æŒ‰ä½ Shift éµï¼ˆè‡ªå‹•å±•é–‹å…¨éƒ¨ï¼‰
                    if (e.shiftKey) {
                        expandAllFinalItems(subdivisionDiv, category, subCategory, item, subdivisionName, subdivisions[subdivisionName]);
                    } else {
                        toggleFinalItems(subdivisionDiv, category, subCategory, item, subdivisionName, subdivisions[subdivisionName]);
                    }
                };
                
                subdivisionContainer.appendChild(subdivisionDiv);
            });
            
            // æ’å…¥åˆ°é …ç›®å¾Œé¢
            itemDiv.parentNode.insertBefore(subdivisionContainer, itemDiv.nextSibling);
        }
        
        // è‡ªå‹•å±•é–‹æ‰€æœ‰ç›¸é—œé …ç›®ï¼ˆå¿ƒæ™ºåœ–æ¨¡å¼ï¼‰
        function expandAllRelated(itemDiv, category, subCategory, item) {
            // å…ˆå±•é–‹ç´°åˆ†
            let existingSubdivision = null;
            let nextSibling = itemDiv.nextSibling;
            while (nextSibling) {
                if (nextSibling.classList && nextSibling.classList.contains('subdivision-container')) {
                    existingSubdivision = nextSibling;
                    break;
                }
                nextSibling = nextSibling.nextSibling;
            }
            
            if (!existingSubdivision) {
                toggleSubdivision(itemDiv, category, subCategory, item);
            }
            
            // ç­‰å¾…DOMæ›´æ–°å¾Œï¼Œè‡ªå‹•å±•é–‹æ‰€æœ‰ç´°åˆ†é …ç›®
            setTimeout(() => {
                const subdivisionContainer = itemDiv.nextSibling;
                if (subdivisionContainer && subdivisionContainer.classList.contains('subdivision-container')) {
                    const subdivisionDivs = subdivisionContainer.querySelectorAll('div');
                    subdivisionDivs.forEach(subdivisionDiv => {
                        subdivisionDiv.click();
                    });
                }
            }, 100);
        }
        
        // è‡ªå‹•å±•é–‹æ‰€æœ‰æœ€çµ‚é …ç›®
        function expandAllFinalItems(subdivisionDiv, category, subCategory, item, subdivisionName, finalItems) {
            // å…ˆå±•é–‹æœ€çµ‚é …ç›®
            let existingFinalItems = null;
            let nextSibling = subdivisionDiv.nextSibling;
            while (nextSibling) {
                if (nextSibling.classList && nextSibling.classList.contains('final-items-container')) {
                    existingFinalItems = nextSibling;
                    break;
                }
                nextSibling = nextSibling.nextSibling;
            }
            
            if (!existingFinalItems) {
                toggleFinalItems(subdivisionDiv, category, subCategory, item, subdivisionName, finalItems);
            }
        }
        
        function toggleFinalItems(subdivisionDiv, category, subCategory, item, subdivisionName, finalItems) {
            // æª¢æŸ¥é€™å€‹ç‰¹å®š subdivision æ˜¯å¦å·²ç¶“å±•é–‹æœ€çµ‚é …ç›®
            // åªæŸ¥æ‰¾ç·Šè·Ÿåœ¨é€™å€‹ subdivisionDiv å¾Œé¢çš„ final-items-container
            let nextSibling = subdivisionDiv.nextSibling;
            while (nextSibling) {
                if (nextSibling.classList && nextSibling.classList.contains('final-items-container')) {
                    nextSibling.remove();
                    return;
                }
                nextSibling = nextSibling.nextSibling;
            }
            
            // å‰µå»ºæœ€çµ‚é …ç›®å®¹å™¨
            const finalItemsContainer = document.createElement('div');
            finalItemsContainer.className = 'final-items-container';
            finalItemsContainer.style.cssText = `
                margin-top: 4px;
                display: flex;
                flex-direction: column;
                gap: 2px;
                margin-left: 10px;
                position: relative;
                padding-left: 10px;
                border-left: 2px solid #28a745;
            `;
            
            finalItems.forEach(finalItem => {
                const finalItemDiv = document.createElement('div');
                finalItemDiv.style.cssText = `
                    background: white;
                    padding: 4px 6px;
                    border-radius: 2px;
                    font-size: 10px;
                    color: #666;
                    border: 1px solid #e9ecef;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    position: relative;
                `;
                
                finalItemDiv.textContent = finalItem;
                
                // æ·»åŠ æœ€çµ‚é …ç›®æŒ‡ç¤ºå™¨
                const finalIndicator = document.createElement('span');
                finalIndicator.style.cssText = `
                    position: absolute;
                    right: 5px;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 6px;
                    height: 6px;
                    border-radius: 50%;
                    background: ${referralData[finalItem] ? '#28a745' : '#dc3545'};
                `;
                finalItemDiv.appendChild(finalIndicator);
                
                finalItemDiv.addEventListener('mouseenter', () => {
                    finalItemDiv.style.background = '#f8f9fa';
                    finalItemDiv.style.borderColor = '#007bff';
                });
                
                finalItemDiv.addEventListener('mouseleave', () => {
                    finalItemDiv.style.background = 'white';
                    finalItemDiv.style.borderColor = '#e9ecef';
                });
                
                finalItemDiv.onclick = (e) => {
                    e.stopPropagation();
                    showDetails(finalItem, category, subCategory);
                };
                
                finalItemsContainer.appendChild(finalItemDiv);
            });
            
            // æ’å…¥åˆ°ç´°åˆ†é …ç›®å¾Œé¢
            subdivisionDiv.parentNode.insertBefore(finalItemsContainer, subdivisionDiv.nextSibling);
        }
        
        function showFinalItemDetails(category, subCategory, item, subdivisionName, finalItem) {
            // ç›´æ¥èª¿ç”¨ showDetails å‡½æ•¸ï¼Œç¢ºä¿ä¸€è‡´æ€§
            showDetails(finalItem, category, subCategory);
        }
        
        function createBranchNode(category, x, y, angle) {
            const branchContainer = document.createElement('div');
            branchContainer.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(${x}px, ${y}px);
                z-index: 50;
            `;
            
            // ä¸»åˆ†é¡ç¯€é»
            const mainNode = document.createElement('div');
            mainNode.style.cssText = `
                background: white;
                border: 3px solid #667eea;
                border-radius: 20px;
                padding: 15px 20px;
                font-size: 14px;
                font-weight: bold;
                color: #333;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 6px 20px rgba(0,0,0,0.1);
                text-align: center;
                min-width: 150px;
                position: relative;
            `;
            mainNode.textContent = category;
            
            // æ·»åŠ äººå“¡é ­åƒç¾¤çµ„
            const avatarGroup = document.createElement('div');
            avatarGroup.style.cssText = `
                display: flex;
                justify-content: center;
                gap: 3px;
                margin-top: 8px;
            `;
            
            // æ ¹æ“šåˆ†é¡å‰µå»ºä¸åŒæ•¸é‡çš„é ­åƒ
            const avatarCount = getAvatarCount(category);
            for (let i = 0; i < avatarCount; i++) {
                const avatar = document.createElement('div');
                avatar.style.cssText = `
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    border: 2px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                `;
                avatarGroup.appendChild(avatar);
            }
            
            mainNode.appendChild(avatarGroup);
            
            // æ‡¸åœæ•ˆæœ
            mainNode.addEventListener('mouseenter', () => {
                mainNode.style.transform = 'scale(1.1)';
                mainNode.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
            });
            
            mainNode.addEventListener('mouseleave', () => {
                mainNode.style.transform = 'scale(1)';
                mainNode.style.boxShadow = '0 6px 20px rgba(0,0,0,0.1)';
            });
            
            // é»æ“Šå±•é–‹å­åˆ†é¡
            mainNode.onclick = () => {
                showSubCategories(branchContainer, category);
            };
            
            branchContainer.appendChild(mainNode);
            
            // é€£æ¥ç·š
            const connectionLine = document.createElement('div');
            connectionLine.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                width: ${Math.sqrt(x*x + y*y)}px;
                height: 2px;
                background: linear-gradient(90deg, #667eea, rgba(102, 126, 234, 0.3));
                transform-origin: left center;
                transform: translate(-100%, -50%) rotate(${angle * 180 / Math.PI}deg);
                z-index: 10;
            `;
            
            branchContainer.appendChild(connectionLine);
            
            return branchContainer;
        }
        
        function getAvatarCount(category) {
            // æ ¹æ“šåˆ†é¡è¿”å›ä¸åŒçš„é ­åƒæ•¸é‡
            const counts = {
                "ğŸ”º ä¸Šæ¸¸ï½œä¾›æ‡‰ç«¯èˆ‡åŸææ–™": 8,
                "ğŸ—ï¸ ä¸­æ¸¸å‰æ®µï½œç ”ç™¼è¨­è¨ˆèˆ‡å·¥ç¨‹": 6,
                "ğŸ’¾ è³‡æ–™èˆ‡ç§‘æŠ€ï¼ˆPropTechï¼‰": 4,
                "ğŸ‘¥ äººæ‰èˆ‡æ•™è‚²è¨“ç·´": 5,
                "ğŸ¦ ä¸­æ¸¸æ ¸å¿ƒï½œè³‡é‡‘èˆ‡é¢¨éšª": 7,
                "ğŸ­ ä¸­æ¸¸å¾Œæ®µï½œè£½é€ ï¼æ–½å·¥ï¼äº¤ä»˜": 6,
                "ğŸ“£ ä¸‹æ¸¸æˆäº¤ï½œè¡ŒéŠ·ï¼æ¸ é“ï¼äº¤æ˜“": 9,
                "ğŸ§° ä¸‹æ¸¸é•·å°¾ï½œç‡Ÿé‹ï¼ç¶­é‹ï¼å”®å¾Œ": 8,
                "ğŸŒ å¤–éƒ¨ç”Ÿæ…‹èˆ‡æ²»ç†": 5,
                "ğŸ§­ éœ€æ±‚ç«¯ï¼ˆèª°ç”¨èˆ‡åœ¨å“ªè£¡ç”¨ï¼‰": 7,
                "âš™ï¸ å…¶ä»–ç”¢æ¥­éˆå¤¥ä¼´èˆ‡å¤–éƒ¨è³‡æº": 4
            };
            return counts[category] || 5;
        }
        
        function showSubCategories(branchContainer, category) {
            // ç§»é™¤ç¾æœ‰çš„å­åˆ†é¡
            const existingSub = branchContainer.querySelector('.sub-categories');
            if (existingSub) {
                existingSub.remove();
                return;
            }
            
            // å‰µå»ºå­åˆ†é¡å®¹å™¨
            const subContainer = document.createElement('div');
            subContainer.className = 'sub-categories';
            subContainer.style.cssText = `
                position: absolute;
                top: 100%;
                left: 50%;
                transform: translateX(-50%);
                margin-top: 10px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                z-index: 60;
            `;
            
            // æ‰‹æ©Ÿç‰ˆå…©æ¬„ä½ˆå±€
            if (window.innerWidth <= 768) {
                subContainer.style.cssText += `
                    flex-direction: row !important;
                    flex-wrap: wrap !important;
                    width: 90vw !important;
                    max-width: 500px !important;
                    gap: 6px !important;
                `;
            }
            
            const subCategories = mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"][category];
            Object.keys(subCategories).forEach(subCategory => {
                const subNode = document.createElement('div');
                let nodeStyle = `
                    background: white;
                    border: 2px solid #667eea;
                    border-radius: 15px;
                    padding: 10px 15px;
                    font-size: 12px;
                    color: #333;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                    text-align: center;
                    min-width: 120px;
                `;
                
                // æ‰‹æ©Ÿç‰ˆèª¿æ•´ç‚ºå¯ä¸¦æ’çš„å¯¬åº¦
                if (window.innerWidth <= 768) {
                    nodeStyle += `
                        flex: 0 0 calc(50% - 3px) !important;
                        min-width: 0 !important;
                        max-width: calc(50% - 3px) !important;
                    `;
                }
                
                subNode.style.cssText = nodeStyle;
                subNode.textContent = subCategory;
                
                // æ·»åŠ é …ç›®æ•¸é‡æŒ‡ç¤º
                const itemCount = subCategories[subCategory].length;
                const countBadge = document.createElement('div');
                countBadge.style.cssText = `
                    background: #667eea;
                    color: white;
                    border-radius: 10px;
                    padding: 2px 6px;
                    font-size: 10px;
                    margin-top: 5px;
                `;
                countBadge.textContent = `${itemCount} é …ç›®`;
                subNode.appendChild(countBadge);
                
                subNode.onclick = (e) => {
                    e.stopPropagation();
                    showDetails(subCategory, category, subCategories[subCategory]);
                };
                
                subContainer.appendChild(subNode);
            });
            
            branchContainer.appendChild(subContainer);
        }
        
        function createCategoryNode(category) {
            const categoryDiv = document.createElement('div');
            categoryDiv.style.cssText = `
                background: white;
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 6px 20px rgba(0,0,0,0.1);
                border: 2px solid #e9ecef;
                transition: all 0.3s ease;
                cursor: pointer;
                position: relative;
            `;
            
            // åˆ†é¡æ¨™é¡Œ
            const categoryTitle = document.createElement('div');
            categoryTitle.style.cssText = `
                font-size: 16px;
                font-weight: bold;
                color: #333;
                margin-bottom: 15px;
                text-align: center;
                padding: 10px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border-radius: 10px;
                position: relative;
            `;
            categoryTitle.textContent = category;
            
            // æ·»åŠ å±•é–‹ç®­é ­
            const arrow = document.createElement('span');
            arrow.style.cssText = `
                position: absolute;
                right: 15px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 14px;
                transition: transform 0.3s ease;
            `;
            arrow.textContent = 'â–¼';
            categoryTitle.appendChild(arrow);
            
            // å­åˆ†é¡å®¹å™¨
            const subCategoriesContainer = document.createElement('div');
            subCategoriesContainer.className = 'sub-categories';
            subCategoriesContainer.style.cssText = `
                display: none;
                flex-direction: column;
                gap: 12px;
                margin-top: 15px;
            `;
            
            const subCategories = mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"][category];
            
            Object.keys(subCategories).forEach(subCategory => {
                const subCategoryDiv = document.createElement('div');
                subCategoryDiv.style.cssText = `
                    background: #f8f9fa;
                    border-radius: 6px;
                    padding: 8px;
                    border-left: 3px solid #667eea;
                `;
                
                const subCategoryTitle = document.createElement('div');
                subCategoryTitle.style.cssText = `
                    font-weight: 600;
                    color: #667eea;
                    margin-bottom: 6px;
                    font-size: 13px;
                `;
                subCategoryTitle.textContent = subCategory;
                
                const itemsContainer = document.createElement('div');
                itemsContainer.style.cssText = `
                    display: flex;
                    flex-wrap: wrap;
                    gap: 4px;
                `;
                
                subCategories[subCategory].forEach(item => {
                    const itemSpan = document.createElement('span');
                    itemSpan.style.cssText = `
                        background: white;
                        color: #666;
                        padding: 2px 6px;
                        border-radius: 8px;
                        font-size: 11px;
                        border: 1px solid #e9ecef;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: inline-block;
                    `;
                    itemSpan.textContent = item;
                    itemSpan.title = item;
                    
                    itemSpan.addEventListener('mouseenter', () => {
                        itemSpan.style.background = '#667eea';
                        itemSpan.style.color = 'white';
                        itemSpan.style.transform = 'scale(1.05)';
                    });
                    
                    itemSpan.addEventListener('mouseleave', () => {
                        itemSpan.style.background = 'white';
                        itemSpan.style.color = '#666';
                        itemSpan.style.transform = 'scale(1)';
                    });
                    
                    itemSpan.onclick = (e) => {
                        e.stopPropagation();
                        showDetails(item, category, subCategory);
                    };
                    
                    itemsContainer.appendChild(itemSpan);
                });
                
                subCategoryDiv.appendChild(subCategoryTitle);
                subCategoryDiv.appendChild(itemsContainer);
                subCategoriesContainer.appendChild(subCategoryDiv);
            });
            
            // é»æ“Šå±•é–‹/æ”¶èµ·
            categoryDiv.onclick = () => {
                const isVisible = subCategoriesContainer.style.display !== 'none';
                subCategoriesContainer.style.display = isVisible ? 'none' : 'flex';
                
                // æ—‹è½‰ç®­é ­
                arrow.style.transform = isVisible ? 'translateY(-50%) rotate(0deg)' : 'translateY(-50%) rotate(180deg)';
                
                // æ›´æ–°å¡ç‰‡æ¨£å¼
                if (!isVisible) {
                    categoryDiv.style.background = 'linear-gradient(135deg, #f8f9fa, #e9ecef)';
                    categoryDiv.style.transform = 'scale(1.02)';
                } else {
                    categoryDiv.style.background = 'white';
                    categoryDiv.style.transform = 'scale(1)';
                }
            };
            
            // æ‡¸åœæ•ˆæœ
            categoryDiv.addEventListener('mouseenter', () => {
                categoryDiv.style.transform = 'translateY(-3px)';
                categoryDiv.style.boxShadow = '0 10px 25px rgba(0,0,0,0.15)';
            });
            
            categoryDiv.addEventListener('mouseleave', () => {
                if (subCategoriesContainer.style.display === 'none') {
                    categoryDiv.style.transform = 'translateY(0)';
                }
                categoryDiv.style.boxShadow = '0 6px 20px rgba(0,0,0,0.1)';
            });
            
            categoryDiv.appendChild(categoryTitle);
            categoryDiv.appendChild(subCategoriesContainer);
            
            return categoryDiv;
        }

        function setupEventListeners() {
            // åˆå§‹åŒ–å¢å¼·æœç´¢åŠŸèƒ½
            initEnhancedSearch();
            
            // æœå°‹åŠŸèƒ½
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // é»æ“Šå…¶ä»–åœ°æ–¹é—œé–‰æœå°‹çµæœ
            document.addEventListener('click', function(e) {
                const searchInput = document.getElementById('searchInput');
                const searchResults = document.getElementById('searchResults');
                if (searchResults && e.target !== searchInput && !searchResults.contains(e.target)) {
                    closeSearchResults();
                }
            });
            
            // æ‹–æ‹½åŠŸèƒ½
            const container = document.getElementById('mindmapContainer');
            const content = document.getElementById('mindmapContent');
            
            container.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // ç¸®æ”¾åŠŸèƒ½
            container.addEventListener('wheel', handleZoom);
            
            // éµç›¤å¿«æ·éµ
            document.addEventListener('keydown', handleKeydown);
            
            // ä¸­å¿ƒç¯€é»é»æ“Š
            document.getElementById('centerNode').onclick = expandMindmap;
            
            // æ»¾å‹•äº‹ä»¶ç›£è½å™¨ - é¡¯ç¤º/éš±è—å›åˆ°é ‚éƒ¨æŒ‰éˆ•
            const mindmapContainer = document.getElementById('mindmapContainer');
            const scrollToTopBtn = document.getElementById('scrollToTop');
            
            mindmapContainer.addEventListener('scroll', function() {
                if (mindmapContainer.scrollTop > 200) {
                    scrollToTopBtn.classList.add('active');
                } else {
                    scrollToTopBtn.classList.remove('active');
                }
            });
        }

        function expandMindmap() {
            // ç¤ºæ„å‡½æ•¸ï¼Œå¡ç‰‡ä½ˆå±€ä¸éœ€è¦å±•é–‹/æ”¶èµ·
            safeLog.log('å¡ç‰‡ä½ˆå±€å·²é¡¯ç¤º');
        }

        function collapseMindmap() {
            // ç¤ºæ„å‡½æ•¸ï¼Œå¡ç‰‡ä½ˆå±€ä¸éœ€è¦å±•é–‹/æ”¶èµ·
            safeLog.log('å¡ç‰‡ä½ˆå±€å·²é¡¯ç¤º');
        }

        // å›åˆ°é ‚éƒ¨åŠŸèƒ½
        function scrollToTop() {
            const mindmapContainer = document.getElementById('mindmapContainer');
            mindmapContainer.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        function toggleSubBranches(parentBranch, category) {
            const existingSubBranches = parentBranch.querySelectorAll('.sub-branch');
            const branchNode = parentBranch.querySelector('.branch-node');
            
            if (existingSubBranches.length > 0) {
                existingSubBranches.forEach(subBranch => {
                    subBranch.classList.toggle('active');
                });
                branchNode.classList.toggle('expanded');
            } else {
                const subCategories = mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"][category];
                const subRadius = 160;
                
                const subCategoryKeys = Object.keys(subCategories);
                subCategoryKeys.forEach((subCategory, index) => {
                    // å„ªåŒ–å­åˆ†æ”¯è§’åº¦åˆ†ä½ˆï¼Œè®“å®ƒå€‘æ›´å‡å‹»åœ°åœç¹ä¸»ç¯€é»
                    const subAngle = (index * 360 / subCategoryKeys.length - 90) * Math.PI / 180;
                    const subX = Math.cos(subAngle) * subRadius;
                    const subY = Math.sin(subAngle) * subRadius;
                    
                    const subBranch = document.createElement('div');
                    subBranch.className = 'sub-branch active fade-in-up';
                    subBranch.style.left = `${subX}px`;
                    subBranch.style.top = `${subY}px`;
                    
                    // å‰µå»ºå­åˆ†é¡æ¨™é¡Œ
                    const subCategoryTitle = document.createElement('div');
                    subCategoryTitle.className = 'sub-node';
                    subCategoryTitle.style.background = '#667eea';
                    subCategoryTitle.style.color = 'white';
                    subCategoryTitle.style.fontWeight = 'bold';
                    subCategoryTitle.style.fontSize = '12px';
                    subCategoryTitle.style.marginBottom = '8px';
                    subCategoryTitle.style.minWidth = '120px';
                    subCategoryTitle.textContent = subCategory;
                    subBranch.appendChild(subCategoryTitle);
                    
                    // å‰µå»ºå…·é«”é …ç›® - é™åˆ¶é¡¯ç¤ºæ•¸é‡é¿å…é‡ç–Š
                    const items = subCategories[subCategory];
                    const maxItems = 6; // æœ€å¤šé¡¯ç¤º6å€‹é …ç›®
                    const itemsToShow = items.slice(0, maxItems);
                    
                    itemsToShow.forEach(item => {
                        const subNode = document.createElement('div');
                        subNode.className = 'sub-node has-details';
                        subNode.textContent = item.length > 12 ? item.substring(0, 12) + '...' : item;
                        subNode.title = item; // å®Œæ•´æ–‡å­—é¡¯ç¤ºåœ¨tooltipä¸­
                        subNode.onclick = (e) => {
                            e.stopPropagation();
                            showDetails(item, category, subCategory);
                        };
                        
                        subBranch.appendChild(subNode);
                    });
                    
                    // å¦‚æœé …ç›®å¤ªå¤šï¼Œé¡¯ç¤ºçœç•¥è™Ÿ
                    if (items.length > maxItems) {
                        const moreNode = document.createElement('div');
                        moreNode.className = 'sub-node';
                        moreNode.style.background = '#ffc107';
                        moreNode.style.color = '#333';
                        moreNode.style.fontSize = '10px';
                        moreNode.textContent = `+${items.length - maxItems} æ›´å¤š`;
                        subBranch.appendChild(moreNode);
                    }
                    
                    parentBranch.appendChild(subBranch);
                });
                
                branchNode.classList.add('expanded');
            }
        }

        async function showDetails(item, category, subCategory) {
            currentDetails = { item, category, subCategory };
            
            document.getElementById('detailsTitle').textContent = item;
            
            // å®‰å…¨åœ°è¨­ç½®è©³ç´°å…§å®¹
            const detailsContent = document.getElementById('detailsContent');
            detailsContent.textContent = ''; // æ¸…ç©º
            
            const infoDiv = safeCreateElement('div', '', { style: 'margin-bottom: 15px;' });
            const categoryLabel = safeCreateElement('strong', 'åˆ†é¡ï¼š');
            const categoryText = document.createTextNode(category);
            const br1 = document.createElement('br');
            const subCategoryLabel = safeCreateElement('strong', 'å­åˆ†é¡ï¼š');
            const subCategoryText = document.createTextNode(subCategory);
            const br2 = document.createElement('br');
            const itemLabel = safeCreateElement('strong', 'é …ç›®ï¼š');
            const itemText = document.createTextNode(item);
            
            infoDiv.appendChild(categoryLabel);
            infoDiv.appendChild(categoryText);
            infoDiv.appendChild(br1);
            infoDiv.appendChild(subCategoryLabel);
            infoDiv.appendChild(subCategoryText);
            infoDiv.appendChild(br2);
            infoDiv.appendChild(itemLabel);
            infoDiv.appendChild(itemText);
            
            detailsContent.appendChild(infoDiv);
            
            // é¡¯ç¤ºå¼•è–¦äººè³‡è¨Š
            const referral = referralData[item];
            if (referral) {
            // æª¢æŸ¥æ˜¯å¦ç‚ºé™£åˆ—ï¼ˆå¤šå€‹å¼•è–¦äººï¼‰
            let referrals = [];
            if (Array.isArray(referral)) {
                referrals = referral;
            } else {
                referrals = [referral];
            }
                
                // åŠ è¼‰æœƒå“¡è³‡æ–™ä»¥é€²è¡Œæ’åº
                const memberData = await loadMemberData();
                
                // æ’åºå¼•è–¦äººåˆ—è¡¨
                referrals.sort((a, b) => {
                    const codeA = (a.referrerCode || '').trim();
                    const codeB = (b.referrerCode || '').trim();
                    
                    // æå–æ•¸å­—éƒ¨åˆ†ç”¨æ–¼æ’åº
                    const numA = parseInt(codeA.replace(/[^0-9]/g, '')) || 9999;
                    const numB = parseInt(codeB.replace(/[^0-9]/g, '')) || 9999;
                    
                    // æå–ç´”æ•¸å­—ç·¨è™Ÿç”¨æ–¼æª¢æŸ¥æœƒå“¡è³‡æ ¼
                    const cleanCodeA = codeA.replace(/[^0-9]/g, '');
                    const cleanCodeB = codeB.replace(/[^0-9]/g, '');
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºæœƒå“¡æˆå“¡ï¼ˆä½¿ç”¨ç´”æ•¸å­—ç·¨è™Ÿæª¢æŸ¥ï¼‰
                    const isMemberA = memberData && memberData[cleanCodeA];
                    const isMemberB = memberData && memberData[cleanCodeB];
                    
                    // æ’åºè¦å‰‡ï¼š
                    // 1. æœƒå“¡æˆå“¡å„ªå…ˆï¼ˆisMemberA > isMemberBï¼‰
                    // 2. æœƒå“¡æˆå“¡å…§éƒ¨æŒ‰ç·¨è™Ÿæ’åºï¼ˆnumA < numBï¼‰
                    // 3. éæœƒå“¡æˆå“¡æ’åœ¨æœ€å¾Œ
                    
                    if (isMemberA && !isMemberB) return -1;
                    if (!isMemberA && isMemberB) return 1;
                    if (isMemberA && isMemberB) return numA - numB;
                    return 0; // å…©å€‹éƒ½ä¸æ˜¯æœƒå“¡æˆå“¡ï¼Œä¿æŒåŸæœ‰é †åº
                });
                
                // åˆ†é è¨­å®š
                const itemsPerPage = 5; // æ¯é é¡¯ç¤º5å€‹
                const totalPages = Math.ceil(referrals.length / itemsPerPage);
                const uniqueItemId = `referral_${item.replace(/[^a-zA-Z0-9]/g, '_')}`;
                
                let referralsHTML = '';
                referralsHTML += `<div style="margin-bottom: 12px;">
                    <h4 style="color: #4a5568; margin-bottom: 8px; font-size: 14px;">ğŸ“‹ å¼•è–¦äººåˆ—è¡¨ (${referrals.length} ä½)</h4>
                </div>`;
                
                // å¼•è–¦åˆ—è¡¨å®¹å™¨ï¼ˆå›ºå®šé«˜åº¦ï¼Œå¯æ»¾å‹•ï¼‰
                referralsHTML += `<div id="${uniqueItemId}_container" style="max-height: 500px; overflow-y: auto; margin-bottom: 12px; position: relative;">
                    <style>
                        #${uniqueItemId}_container::-webkit-scrollbar {
                            width: 8px;
                        }
                        #${uniqueItemId}_container::-webkit-scrollbar-track {
                            background: #f1f1f1;
                            border-radius: 10px;
                        }
                        #${uniqueItemId}_container::-webkit-scrollbar-thumb {
                            background: #667eea;
                            border-radius: 10px;
                        }
                        #${uniqueItemId}_container::-webkit-scrollbar-thumb:hover {
                            background: #5568d3;
                        }
                    </style>`;
                
                referrals.forEach((ref, index) => {
                    // æª¢æŸ¥æ˜¯å¦ç‚ºæœƒå“¡æˆå“¡
                    const referrerCode = (ref.referrerCode || '').trim();
                    // æå–ç´”æ•¸å­—ç·¨è™Ÿç”¨æ–¼æª¢æŸ¥æœƒå“¡è³‡æ ¼
                    const cleanCode = referrerCode.replace(/[^0-9]/g, '');
                    const isMember = memberData && memberData[cleanCode];
                    const memberInfo = isMember ? memberData[cleanCode] : null;
                    
                    // å¦‚æœæ˜¯æœƒå“¡æˆå“¡ï¼Œæ·»åŠ æ¨™ç±¤
                    const memberTag = isMember ? 
                        `<span style="font-size: 10px; color: #fff; background: linear-gradient(135deg, #667eea, #764ba2); padding: 2px 6px; border-radius: 10px; font-weight: 600;">ğŸ‘¤ æœƒå“¡</span>` : 
                        '';
                    
                    // èª¿æ•´å¼•è–¦äººé¡¯ç¤ºé †åºï¼Œæœƒå“¡æˆå“¡åœ¨å‰
                    const displayIndex = index + 1;
                    const uniqueId = `${item.replace(/[^a-zA-Z0-9]/g, '_')}_${index}`;
                    referralsHTML += `
                        <div class="referral-item" style="margin-bottom: 12px;">
                            <div class="referral-summary" onclick="toggleReferralDetails('${uniqueId}')" style="cursor: pointer; padding: 10px; border: 2px solid #e3e8ff; border-radius: 10px; margin-bottom: 8px; transition: all 0.3s ease; background: linear-gradient(135deg, #f8f9ff, #ffffff);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                        <span style="background: #667eea; color: white; padding: 3px 6px; border-radius: 50%; font-size: 11px; font-weight: bold;">${displayIndex}</span>
                                        <div>
                                            <strong style="color: #4a5568; font-size: 13px;">å¼•è–¦äººï¼š</strong>
                                            <span style="color: #2d3748; font-weight: 600; font-size: 13px;">${ref.referrerCode || ref.name || 'æœªçŸ¥'}</span>
                                        </div>
                                        ${memberTag}
                                        <span style="font-size: 11px; color: #667eea; background: #e3e8ff; padding: 2px 6px; border-radius: 10px;">${ref.companyName || ref.company || 'æœªçŸ¥'}</span>
                                    </div>
                                    <span class="expand-icon" style="font-size: 14px; color: #667eea; transition: transform 0.3s ease;">â–¶</span>
                                </div>
                            </div>
                            
                            <div class="referral-details" id="referralDetails_${uniqueId}" style="display: none; padding: 15px; background: #f8f9ff; border-radius: 10px; margin-bottom: 10px;">
                                <div style="margin-bottom: 12px; font-size: 14px;">
                                    ${isMember && memberInfo ? `<div style="margin-bottom: 8px;">
                                        <strong style="color: #4a5568;">ğŸ‘¤ æœƒå“¡å§“åï¼š</strong>
                                        <span style="color: #2d3748;">${memberInfo.name}</span>
                                    </div>` : ''}
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #4a5568;">å» å•†åç¨±ï¼š</strong>
                                        <span style="color: #2d3748;">${ref.companyName || ref.company || 'æœªçŸ¥'}</span>
                                    </div>
                                    ${ref.area ? `<div style="margin-bottom: 8px;">
                                        <strong style="color: #4a5568;">æœå‹™å€åŸŸï¼š</strong>
                                        <span style="color: #2d3748;">${ref.area}</span>
                                    </div>` : ''}
                                    ${ref.note || ref.experience ? `<div style="margin-bottom: 8px;">
                                        <strong style="color: #4a5568;">å‚™è¨»ï¼š</strong>
                                        <span style="color: #2d3748;">${ref.note || ref.experience}</span>
                                    </div>` : ''}
                                </div>
                                
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: #4a5568; font-size: 14px;">è¯çµ¡è³‡è¨Šï¼š</strong>
                                    <div style="margin-top: 6px; display: flex; flex-direction: column; gap: 4px;">
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <span style="font-size: 14px;">ğŸ“</span>
                                            <span class="masked-info" data-type="phone" data-value="${ref.phone}" style="font-size: 13px; color: #667eea;">${maskPhone(ref.phone)}</span>
                                        </div>
                                        ${ref.lineId ? `<div style="display: flex; align-items: center; gap: 6px;">
                                            <span style="font-size: 14px;">ğŸ’¬</span>
                                            <span class="masked-info" data-type="lineid" data-value="${ref.lineId}" style="font-size: 13px; color: #667eea;">${maskLineId(ref.lineId)}</span>
                                        </div>` : ''}
                                    </div>
                                </div>
                                
                                <button onclick="showAllContactDetails('${ref.phone}', '${ref.lineId || ''}', '${item}', '${ref.referrerCode || ref.name || 'æœªçŸ¥'}', ${isMember ? 'true' : 'false'}, '${cleanCode}')" 
                                        style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.3s ease; width: 100%;">
                                    ğŸ”“ æŸ¥çœ‹è¯çµ¡è³‡è¨Š
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                // é—œé–‰å®¹å™¨
                referralsHTML += `</div>`;
                
                // æ·»åŠ åˆ†é æŒ‰éˆ•ï¼ˆå¦‚æœè¶…éä¸€é ï¼‰
                if (totalPages > 1) {
                    referralsHTML += `<div style="display: flex; justify-content: center; gap: 8px; margin-top: 12px;">`;
                    for (let i = 1; i <= totalPages; i++) {
                        referralsHTML += `<button id="${uniqueItemId}_page_${i}" onclick="showReferralPage('${uniqueItemId}', ${i}, ${itemsPerPage})" 
                            style="background: ${i === 1 ? '#667eea' : '#e3e8ff'}; color: ${i === 1 ? 'white' : '#667eea'}; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                            ${i}
                        </button>`;
                    }
                    referralsHTML += `</div>`;
                }
                
                // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®å¼•è–¦äººè³‡è¨Š
                const referralInfoEl = document.getElementById('referralInfo');
                safeSetHTML(referralInfoEl, referralsHTML);
                
                // åˆå§‹åŒ–ç¬¬ä¸€é é¡¯ç¤º
                if (totalPages > 1) {
                    showReferralPage(uniqueItemId, 1, itemsPerPage);
                }
            } else {
                document.getElementById('referralInfo').textContent = 'æš«ç„¡å¼•è–¦äººè³‡è¨Šï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•æ·»åŠ ã€‚';
            }
            
            // ç¢ºä¿æ·»åŠ å¼•è–¦äººæŒ‰éˆ•æœ‰æ­£ç¢ºçš„é»æ“Šäº‹ä»¶
            const addReferralBtn = document.querySelector('.add-referral-btn');
            if (addReferralBtn) {
                addReferralBtn.onclick = addReferral;
            }
            
            document.getElementById('detailsPanel').classList.add('active');
        }

        function closeDetails() {
            document.getElementById('detailsPanel').classList.remove('active');
            currentDetails = null;
        }

        // é—œé–‰ä½¿ç”¨èªªæ˜æ¡†
        function closeUsageNotice() {
            const notice = document.getElementById('usageNotice');
            const mindmapContainer = document.getElementById('mindmapContainer');
            if (notice) {
                notice.classList.add('collapsed');
                // ä¿å­˜é—œé–‰ç‹€æ…‹åˆ° localStorage
                localStorage.setItem('usageNoticeClosed', 'true');
                // èª¿æ•´å¿ƒæ™ºåœ–å®¹å™¨ä½ç½®
                if (mindmapContainer) {
                    mindmapContainer.classList.remove('with-notice');
                }
            }
        }

        // æª¢æŸ¥ä½¿ç”¨èªªæ˜æ¡†æ˜¯å¦æ‡‰è©²é¡¯ç¤º
        function checkUsageNotice() {
            const isClosed = localStorage.getItem('usageNoticeClosed');
            const notice = document.getElementById('usageNotice');
            const mindmapContainer = document.getElementById('mindmapContainer');
            
            if (isClosed === 'true') {
                if (notice) {
                    notice.classList.add('collapsed');
                }
                if (mindmapContainer) {
                    mindmapContainer.classList.remove('with-notice');
                }
            } else {
                // å¦‚æœæ²’æœ‰é—œé–‰éï¼Œé¡¯ç¤ºä½¿ç”¨èªªæ˜æ¡†ä¸¦èª¿æ•´å¿ƒæ™ºåœ–å®¹å™¨
                if (mindmapContainer) {
                    mindmapContainer.classList.add('with-notice');
                }
            }
        }
        
        // å¼•è–¦äººåˆ—è¡¨åˆ†é åŠŸèƒ½
        function showReferralPage(uniqueItemId, page, itemsPerPage) {
            const container = document.getElementById(`${uniqueItemId}_container`);
            if (!container) return;
            
            const items = container.querySelectorAll('.referral-item');
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            
            // éš±è—æ‰€æœ‰é …ç›®
            items.forEach((item, index) => {
                if (index >= startIndex && index < endIndex) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // æ›´æ–°åˆ†é æŒ‰éˆ•æ¨£å¼
            const totalPages = Math.ceil(items.length / itemsPerPage);
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.getElementById(`${uniqueItemId}_page_${i}`);
                if (btn) {
                    if (i === page) {
                        btn.style.background = '#667eea';
                        btn.style.color = 'white';
                    } else {
                        btn.style.background = '#e3e8ff';
                        btn.style.color = '#667eea';
                    }
                }
            }
        }

        function addReferral() {
            // å‰µå»ºå¼•è–¦ç™»è¨˜è¡¨å–®
            showReferralForm();
        }
        
        function showReferralForm() {
            // æª¢æ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
            const isMobile = window.innerWidth <= 768;
            
            // å‰µå»ºè¡¨å–®å®¹å™¨
            const formContainer = document.createElement('div');
            formContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: ${isMobile ? 'flex-start' : 'center'};
                justify-content: center;
                z-index: 2000;
                overflow-y: auto;
                padding: ${isMobile ? '0' : '20px'};
            `;
            
            // å‰µå»ºè¡¨å–®
            const form = document.createElement('div');
            form.style.cssText = `
                background: white;
                padding: ${isMobile ? '20px' : '30px'};
                border-radius: ${isMobile ? '0' : '15px'};
                width: ${isMobile ? '100%' : '90%'};
                max-width: 500px;
                max-height: ${isMobile ? '100vh' : '80vh'};
                overflow-y: auto;
                box-shadow: ${isMobile ? 'none' : '0 10px 30px rgba(0,0,0,0.3)'};
                margin-top: ${isMobile ? '0' : 'auto'};
            `;
            
            // æ§‹å»ºè¡¨å–® HTMLï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼Œéœ€è¦ä½¿ç”¨å®‰å…¨æ–¹å¼ï¼‰
            const formHTML = `
                <style>
                    @media (max-width: 768px) {
                        .referral-form-header {
                            padding-bottom: 15px;
                            border-bottom: 2px solid #e9ecef;
                            margin-bottom: 15px !important;
                        }
                        .referral-form-title {
                            font-size: 18px !important;
                        }
                        .referral-form-field {
                            margin-bottom: 12px !important;
                        }
                        .referral-form-label {
                            font-size: 14px !important;
                            margin-bottom: 6px !important;
                        }
                        .referral-form-input {
                            padding: 10px !important;
                            font-size: 14px !important;
                        }
                        .referral-form-textarea {
                            padding: 10px !important;
                            font-size: 14px !important;
                        }
                        .referral-form-buttons {
                            flex-direction: column !important;
                            gap: 10px !important;
                            margin-top: 20px !important;
                        }
                        .referral-form-button {
                            width: 100% !important;
                            padding: 12px !important;
                            font-size: 14px !important;
                        }
                    }
                </style>
                <div class="referral-form-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 class="referral-form-title" style="margin: 0; color: #333; font-size: 20px;">ğŸ‘¥ å¼•è–¦ç™»è¨˜è¡¨å–®</h3>
                    <button onclick="closeReferralForm()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseenter="this.style.background='#f1f3f4'; this.style.color='#333';" onmouseleave="this.style.background='none'; this.style.color='#666';">Ã—</button>
                </div>
                
                <form id="referralForm">
                    <div class="referral-form-field" style="margin-bottom: 15px;">
                        <label class="referral-form-label" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 14px;">è¢«å¼•è–¦æœå‹™é …ç›® *</label>
                        ${currentDetails ? 
                            `<input type="text" id="referredService" class="referral-form-input" value="${currentDetails.item}" readonly 
                                   style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: #f8f9fa;">` :
                            `<select id="referredService" class="referral-form-input" required 
                                    style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
                                <option value="">è«‹é¸æ“‡æœå‹™é …ç›®</option>
                                <optgroup label="ğŸ”º ä¸Šæ¸¸ï½œä¾›æ‡‰ç«¯èˆ‡åŸææ–™">
                                    <option value="å®¤å…§æ³¥ä½œ">å®¤å…§æ³¥ä½œ</option>
                                    <option value="å®¤å¤–æ³¥ä½œ">å®¤å¤–æ³¥ä½œ</option>
                                    <option value="é‹¼æ§‹å·¥ç¨‹">é‹¼æ§‹å·¥ç¨‹</option>
                                    <option value="æœ¨ä½œå·¥ç¨‹">æœ¨ä½œå·¥ç¨‹</option>
                                    <option value="çŸ³æå·¥ç¨‹">çŸ³æå·¥ç¨‹</option>
                                    <option value="ç»ç’ƒå·¥ç¨‹">ç»ç’ƒå·¥ç¨‹</option>
                                    <option value="ç£ç£šå·¥ç¨‹">ç£ç£šå·¥ç¨‹</option>
                                    <option value="é‹é–€çª—å·¥ç¨‹">é‹é–€çª—å·¥ç¨‹</option>
                                    <option value="å¡—æ–™å·¥ç¨‹">å¡—æ–™å·¥ç¨‹</option>
                                </optgroup>
                                <optgroup label="ğŸ—ï¸ ä¸­æ¸¸å‰æ®µï½œç ”ç™¼è¨­è¨ˆèˆ‡å·¥ç¨‹">
                                    <option value="å»ºç¯‰å¸«">å»ºç¯‰å¸«</option>
                                    <option value="çµæ§‹æŠ€å¸«">çµæ§‹æŠ€å¸«</option>
                                    <option value="å®¤å…§è¨­è¨ˆå¸«">å®¤å…§è¨­è¨ˆå¸«</option>
                                    <option value="æ™¯è§€è¨­è¨ˆ">æ™¯è§€è¨­è¨ˆ</option>
                                    <option value="BIM é¡§å•">BIM é¡§å•</option>
                                </optgroup>
                                <optgroup label="ğŸ­ ä¸­æ¸¸å¾Œæ®µï½œè£½é€ ï¼æ–½å·¥ï¼äº¤ä»˜">
                                    <option value="æ°´é›»å®‰è£">æ°´é›»å®‰è£</option>
                                    <option value="æ©Ÿé›»è¨­å‚™">æ©Ÿé›»è¨­å‚™</option>
                                    <option value="æ¶ˆé˜²è¨­å‚™">æ¶ˆé˜²è¨­å‚™</option>
                                    <option value="ç›£æ§ç³»çµ±">ç›£æ§ç³»çµ±</option>
                                    <option value="é›»æ¢¯">é›»æ¢¯</option>
                                </optgroup>
                                <optgroup label="ğŸ“£ ä¸‹æ¸¸æˆäº¤ï½œè¡ŒéŠ·ï¼æ¸ é“ï¼äº¤æ˜“">
                                    <option value="ä½å®…ä»²ä»‹">ä½å®…ä»²ä»‹</option>
                                    <option value="å•†è¾¦ä»²ä»‹">å•†è¾¦ä»²ä»‹</option>
                                    <option value="å·¥æ¥­å» æˆ¿">å·¥æ¥­å» æˆ¿</option>
                                    <option value="åœ°æ”¿ä»£æ›¸">åœ°æ”¿ä»£æ›¸</option>
                                </optgroup>
                                <optgroup label="ğŸ§° ä¸‹æ¸¸é•·å°¾ï½œç‡Ÿé‹ï¼ç¶­é‹ï¼å”®å¾Œ">
                                    <option value="ç‰©æ¥­ç®¡ç†">ç‰©æ¥­ç®¡ç†</option>
                                    <option value="ä¿å…¨">ä¿å…¨</option>
                                    <option value="æ¸…æ½”æœå‹™">æ¸…æ½”æœå‹™</option>
                                    <option value="æ°´é›»ç¶­ä¿®">æ°´é›»ç¶­ä¿®</option>
                                    <option value="æ¬å®¶æœå‹™">æ¬å®¶æœå‹™</option>
                                </optgroup>
                                <optgroup label="ğŸ’¾ ç§‘æŠ€èˆ‡æ•¸ä½æœå‹™">
                                    <option value="æ™ºæ…§å®¶é›»">æ™ºæ…§å®¶é›»</option>
                                    <option value="BIM å»ºæ¨¡">BIM å»ºæ¨¡</option>
                                    <option value="ç‰©æ¥­ç®¡ç†ç³»çµ±">ç‰©æ¥­ç®¡ç†ç³»çµ±</option>
                                </optgroup>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>`
                        }
                    </div>
                    
                    <div class="referral-form-field" style="margin-bottom: 15px;">
                        <label class="referral-form-label" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 14px;">å¼•è–¦äººï¼ˆæœƒå“¡ç·¨è™Ÿï¼‰ *</label>
                        <div style="display: flex; gap: 8px;">
                            <div style="position: relative; flex: 1;">
                                <input type="text" id="referrerCode" class="referral-form-input" placeholder="ä¾‹å¦‚ï¼š016 æˆ– 016æ¿¬ç‘’" required 
                                       style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; padding-right: 120px;">
                                <div id="memberNameHint" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #667eea; font-size: 13px; font-weight: 600; pointer-events: none; display: none;">
                                    ğŸ” æœç´¢ä¸­...
                                </div>
                            </div>
                            <button type="button" id="selectMemberBtn" onclick="showMemberList()" style="padding: 10px 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.3s ease;" onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)'" onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                ğŸ‘¥ é¸æ“‡æœƒå“¡
                            </button>
                        </div>
                        <div id="memberNameDisplay" style="margin-top: 5px; font-size: 13px; color: #28a745; font-weight: 600; display: none;">
                            <span id="memberNameText"></span>
                        </div>
                    </div>
                    
                    <div class="referral-form-field" style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <label class="referral-form-label" style="font-weight: 600; color: #333; font-size: 14px;">è¢«å¼•è–¦å» å•†åç¨± *</label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="recommendMyself" style="width: 18px; height: 18px; cursor: pointer;" onchange="toggleRecommendMyself()">
                                <span style="font-size: 13px; color: #667eea; font-weight: 600;">ğŸ‘¤ æ¨è–¦æˆ‘è‡ªå·±</span>
                            </label>
                        </div>
                        <input type="text" id="referredCompany" class="referral-form-input" placeholder="è«‹è¼¸å…¥å» å•†åç¨±" required 
                               style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>
                    
                    <div class="referral-form-field" style="margin-bottom: 15px;">
                        <label class="referral-form-label" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 14px;">å» å•†è¯çµ¡é›»è©± *</label>
                        <input type="tel" id="companyPhone" class="referral-form-input" placeholder="è«‹è¼¸å…¥å» å•†é›»è©±ï¼Œè‹¥ç„¡å¯å¡«è‡ªå·±é›»è©±" required 
                               style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>
                    
                    <div class="referral-form-field" style="margin-bottom: 15px;">
                        <label class="referral-form-label" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 14px;">å» å•†LINE ID</label>
                        <input type="text" id="companyLineId" class="referral-form-input" placeholder="è«‹è¼¸å…¥LINE IDï¼Œæˆ–ç§LINEå‚³LINEå¥½å‹åå–®" 
                               style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>
                    
                    <div class="referral-form-field" style="margin-bottom: 15px;">
                        <label class="referral-form-label" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 14px;">å» å•†æœå‹™å€åŸŸ</label>
                        <input type="text" id="companyArea" class="referral-form-input" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚ã€æ–°åŒ—å¸‚" 
                               style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
                    </div>
                    
                    <div class="referral-form-field" style="margin-bottom: 20px;">
                        <label class="referral-form-label" style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 14px;">å¼•è–¦å‚™è¨»</label>
                        <textarea id="referralNote" class="referral-form-textarea" rows="3" placeholder="è«‹ç°¡è¿°å¼•è–¦åŸå› æˆ–å» å•†ç‰¹è‰²"
                                  style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; resize: vertical;"></textarea>
                    </div>
                    
                    <div class="referral-form-buttons" style="display: flex; gap: 10px;">
                        <button type="submit" class="referral-form-button" style="flex: 1; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            æäº¤å¼•è–¦
                        </button>
                        <button type="button" class="referral-form-button" onclick="closeReferralForm()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            å–æ¶ˆ
                        </button>
                    </div>
                </form>
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®è¡¨å–®å…§å®¹ï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼‰
            safeSetHTML(form, formHTML);
            
            formContainer.appendChild(form);
            document.body.appendChild(formContainer);
            
            // è™•ç†è¡¨å–®æäº¤
            const referralForm = document.getElementById('referralForm');
            if (referralForm) {
                referralForm.addEventListener('submit', handleReferralSubmit);
            }
            
            // è¨­ç½® ARIA å±¬æ€§
            form.setAttribute('role', 'dialog');
            form.setAttribute('aria-labelledby', 'referral-form-title');
            form.setAttribute('aria-modal', 'true');
            
            // æ·»åŠ æœƒå“¡ç·¨è™Ÿè‡ªå‹•æœç´¢åŠŸèƒ½
            setupMemberCodeSearch();
            
            // æ·»åŠ é›»è©±è™Ÿç¢¼è‡ªå‹•æ ¼å¼åŒ–åŠŸèƒ½
            setupPhoneFormatting();
        }
        
        // é¡¯ç¤ºæœƒå“¡åˆ—è¡¨é¸æ“‡å™¨
        async function showMemberList() {
            const memberData = await loadMemberData();
            
            if (!memberData || Object.keys(memberData).length === 0) {
                alert('ç›®å‰æ²’æœ‰æœƒå“¡è³‡æ–™ï¼Œè«‹å…ˆå»ºç«‹æœƒå“¡è³‡æ–™å·¥ä½œè¡¨ã€‚');
                return;
            }
            
            // å‰µå»ºæœƒå“¡åˆ—è¡¨å½ˆçª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 25px;
                border-radius: 15px;
                width: 90%;
                max-width: 500px;
                max-height: 70vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼å‰µå»ºæœƒå“¡åˆ—è¡¨å…§å®¹
            const header = safeCreateElement('div', '', {
                style: 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;'
            });
            const title = safeCreateElement('h3', 'ğŸ‘¥ é¸æ“‡æœƒå“¡æˆå“¡', {
                style: 'margin: 0; color: #333; font-size: 18px;'
            });
            const closeBtn = safeCreateElement('button', 'Ã—', {
                onclick: 'closeMemberList()',
                style: 'background: none; border: none; font-size: 24px; cursor: pointer; color: #666; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;',
                'aria-label': 'é—œé–‰æœƒå“¡åˆ—è¡¨'
            });
            closeBtn.onclick = closeMemberList;
            closeBtn.addEventListener('mouseenter', () => {
                closeBtn.style.background = '#f1f3f4';
                closeBtn.style.color = '#333';
            });
            closeBtn.addEventListener('mouseleave', () => {
                closeBtn.style.background = 'none';
                closeBtn.style.color = '#666';
            });
            header.appendChild(title);
            header.appendChild(closeBtn);
            
            const searchDiv = safeCreateElement('div', '', {
                style: 'margin-bottom: 15px;'
            });
            const memberSearchInput = safeCreateElement('input', '', {
                type: 'text',
                id: 'memberSearchInput',
                placeholder: 'ğŸ” æœå°‹æœƒå“¡å§“åæˆ–ç·¨è™Ÿ...',
                style: 'width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px;',
                'aria-label': 'æœå°‹æœƒå“¡'
            });
            searchDiv.appendChild(memberSearchInput);
            
            const memberListContainer = safeCreateElement('div', '', {
                id: 'memberListContainer',
                style: 'max-height: 50vh; overflow-y: auto;',
                role: 'listbox',
                'aria-label': 'æœƒå“¡åˆ—è¡¨'
            });
            
            content.appendChild(header);
            content.appendChild(searchDiv);
            content.appendChild(memberListContainer);
            
            // è¨­ç½® ARIA å±¬æ€§
            content.setAttribute('role', 'dialog');
            content.setAttribute('aria-labelledby', 'member-list-title');
            content.setAttribute('aria-modal', 'true');
            title.id = 'member-list-title';
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // å®‰å…¨åœ°æ·»åŠ æœƒå“¡é …ç›®
            const memberContainer = document.getElementById('memberListContainer');
            
            Object.entries(memberData).forEach(([code, info]) => {
                const item = document.createElement('div');
                item.className = 'member-item';
                item.dataset.code = code;
                item.dataset.name = info.name;
                item.style.cssText = 'padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s ease;';
                
                item.onmouseenter = function() {
                    this.style.borderColor = '#667eea';
                    this.style.background = '#f8f9fa';
                };
                item.onmouseleave = function() {
                    this.style.borderColor = '#e9ecef';
                    this.style.background = 'white';
                };
                item.onclick = function() {
                    selectMember(code, info.name);
                };
                
                const nameDiv = document.createElement('div');
                nameDiv.style.cssText = 'font-weight: 600; color: #333; font-size: 14px;';
                nameDiv.textContent = `${code} - ${info.name}`;
                item.appendChild(nameDiv);
                
                if (info.professionalCategory) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.style.cssText = 'font-size: 12px; color: #666; margin-top: 4px;';
                    categoryDiv.textContent = info.professionalCategory;
                    item.appendChild(categoryDiv);
                }
                
                memberContainer.appendChild(item);
            });
            
            // æ·»åŠ æœç´¢åŠŸèƒ½
            const memberSearchInputEl = document.getElementById('memberSearchInput');
            if (memberSearchInputEl) {
                memberSearchInputEl.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const items = modal.querySelectorAll('.member-item');
                    
                    items.forEach(item => {
                        const code = item.dataset.code.toLowerCase();
                        const name = item.dataset.name.toLowerCase();
                        const matches = code.includes(searchTerm) || name.includes(searchTerm);
                        item.style.display = matches ? 'block' : 'none';
                    });
                });
            }
        }
        
        // é—œé–‰æœƒå“¡åˆ—è¡¨å½ˆçª—
        function closeMemberList() {
            const modal = document.querySelector('[style*="z-index: 3000"]');
            if (modal) {
                modal.remove();
            }
        }
        
        // é¸æ“‡æœƒå“¡
        function selectMember(code, name) {
            const referrerCodeInput = document.getElementById('referrerCode');
            if (referrerCodeInput) {
                referrerCodeInput.value = `${code}${name}`;
                
                // è§¸ç™¼æœç´¢ä»¥é¡¯ç¤ºç¢ºèªè¨Šæ¯
                referrerCodeInput.dispatchEvent(new Event('input'));
            }
            
            closeMemberList();
        }
        
        // åˆ‡æ›ã€Œæ¨è–¦æˆ‘è‡ªå·±ã€åŠŸèƒ½
        async function toggleRecommendMyself() {
            const checkbox = document.getElementById('recommendMyself');
            const referrerCodeInput = document.getElementById('referrerCode');
            const referredCompanyInput = document.getElementById('referredCompany');
            const companyPhoneInput = document.getElementById('companyPhone');
            const companyLineIdInput = document.getElementById('companyLineId');
            const companyAreaInput = document.getElementById('companyArea');
            
            if (!checkbox || !referrerCodeInput) return;
            
            if (checkbox.checked) {
                // ç²å–å¼•è–¦äººç·¨è™Ÿ
                const referrerCode = referrerCodeInput.value.trim();
                
                if (!referrerCode) {
                    alert('è«‹å…ˆé¸æ“‡æˆ–è¼¸å…¥å¼•è–¦äººï¼ˆæœƒå“¡ç·¨è™Ÿï¼‰');
                    checkbox.checked = false;
                    return;
                }
                
                // æå–æœƒå“¡ç·¨è™Ÿ
                const codeMatch = referrerCode.match(/(\d+)/);
                if (!codeMatch) {
                    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœƒå“¡ç·¨è™Ÿ');
                    checkbox.checked = false;
                    return;
                }
                
                const memberCode = codeMatch[1];
                
                // å¾æœƒå“¡è³‡æ–™ä¸­æŸ¥æ‰¾
                const memberData = await loadMemberData();
                const memberInfo = memberData[memberCode];
                
                if (memberInfo) {
                    // è‡ªå‹•å¡«å……å» å•†åç¨±ï¼ˆä½¿ç”¨æœƒå“¡å§“åï¼‰
                    referredCompanyInput.value = `${memberCode} - ${memberInfo.name}`;
                    
                    // å¦‚æœç•¶å‰æ²’æœ‰è¼¸å…¥é›»è©±ï¼Œæ·»åŠ æç¤º
                    if (!companyPhoneInput.value.trim()) {
                        companyPhoneInput.placeholder = 'è«‹è¼¸å…¥æ‚¨çš„è¯çµ¡é›»è©±ï¼ˆè‹¥ç„¡å» å•†é›»è©±ï¼‰';
                    }
                    
                    if (!companyLineIdInput.value.trim()) {
                        companyLineIdInput.placeholder = 'è«‹è¼¸å…¥æ‚¨çš„ LINE IDï¼ˆé¸å¡«ï¼‰';
                    }
                    
                    if (!companyAreaInput.value.trim()) {
                        companyAreaInput.placeholder = 'è«‹è¼¸å…¥æ‚¨çš„æœå‹™å€åŸŸï¼ˆé¸å¡«ï¼‰';
                    }
                    
                    // æ¨™è¨˜é€™äº›æ¬„ä½éœ€è¦å¡«å¯«
                    companyPhoneInput.style.borderColor = '#ffc107';
                    companyPhoneInput.title = 'âš ï¸ è«‹å¡«å¯«æ‚¨çš„è¯çµ¡é›»è©±';
                } else {
                    alert('æ‰¾ä¸åˆ°æœƒå“¡è³‡æ–™ï¼Œè«‹ç¢ºèªæœƒå“¡ç·¨è™Ÿæ˜¯å¦æ­£ç¢º');
                    checkbox.checked = false;
                }
            } else {
                // å–æ¶ˆå‹¾é¸æ™‚æ¸…ç©ºå» å•†åç¨±ä¸¦æ¢å¾©æ¨£å¼
                referredCompanyInput.value = '';
                companyPhoneInput.style.borderColor = '#e9ecef';
                companyPhoneInput.title = '';
                companyPhoneInput.placeholder = 'è«‹è¼¸å…¥å» å•†é›»è©±ï¼Œè‹¥ç„¡å¯å¡«è‡ªå·±é›»è©±';
                companyLineIdInput.placeholder = 'è«‹è¼¸å…¥LINE IDï¼Œæˆ–ç§LINEå‚³LINEå¥½å‹åå–®';
                companyAreaInput.placeholder = 'ä¾‹å¦‚ï¼šå°åŒ—å¸‚ã€æ–°åŒ—å¸‚';
            }
        }
        
        // è¨­ç½®æœƒå“¡ç·¨è™Ÿè‡ªå‹•æœç´¢åŠŸèƒ½
        function setupMemberCodeSearch() {
            const referrerCodeInput = document.getElementById('referrerCode');
            const memberNameHint = document.getElementById('memberNameHint');
            const memberNameDisplay = document.getElementById('memberNameDisplay');
            const memberNameText = document.getElementById('memberNameText');
            
            if (!referrerCodeInput) return;
            
            let searchTimeout = null;
            
            referrerCodeInput.addEventListener('input', async function(e) {
                const inputValue = e.target.value.trim();
                
                // æ¸…é™¤ä¹‹å‰çš„æœç´¢
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                // éš±è—é¡¯ç¤ºå€åŸŸ
                if (memberNameDisplay) {
                    memberNameDisplay.style.display = 'none';
                }
                
                // å¦‚æœè¼¸å…¥ç‚ºç©ºï¼Œéš±è—æç¤º
                if (!inputValue) {
                    if (memberNameHint) {
                        memberNameHint.style.display = 'none';
                    }
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦åŒ…å«æ•¸å­—ï¼ˆæœƒå“¡ç·¨è™Ÿï¼‰
                const codeMatch = inputValue.match(/(\d+)/);
                if (!codeMatch) {
                    if (memberNameHint) {
                        memberNameHint.style.display = 'none';
                    }
                    return;
                }
                
                const memberCode = codeMatch[1];
                
                // é¡¯ç¤ºæœç´¢æç¤º
                if (memberNameHint) {
                    memberNameHint.style.display = 'block';
                    memberNameHint.textContent = 'ğŸ” æœç´¢ä¸­...';
                }
                
                // å»¶é²æœç´¢ï¼ˆé¿å…é »ç¹è«‹æ±‚ï¼‰
                searchTimeout = setTimeout(async () => {
                    try {
                        // å…ˆæª¢æŸ¥æœƒå“¡è³‡æ–™æ˜¯å¦å·²è¼‰å…¥
                        const memberData = await loadMemberData();
                        const hasMemberData = memberData && Object.keys(memberData).length > 0;
                        
                        if (!hasMemberData) {
                            // æœƒå“¡è³‡æ–™ç‚ºç©ºï¼Œä¸é¡¯ç¤ºæœç´¢çµæœ
                            if (memberNameHint) {
                                memberNameHint.style.display = 'none';
                            }
                            if (memberNameDisplay) {
                                memberNameDisplay.style.display = 'none';
                            }
                            return;
                        }
                        
                        const memberInfo = await searchMemberName(memberCode);
                        
                        if (memberNameHint) {
                            memberNameHint.style.display = 'none';
                        }
                        
                        if (memberInfo && memberInfo.name) {
                            // é¡¯ç¤ºæ‰¾åˆ°çš„æœƒå“¡è³‡è¨Šï¼ˆä½œç‚ºå¯é»é¸çš„é¸é …ï¼‰
                            if (memberNameDisplay && memberNameText) {
                                // çµ„å»ºé¡¯ç¤ºæ–‡å­—ï¼šå§“å + å°ˆæ¥­é¡åˆ¥ï¼ˆå¦‚æœæœ‰ï¼‰
                                let displayText = `âœ… é»æ“Šé¸æ“‡ï¼š${memberInfo.name}`;
                                if (memberInfo.professionalCategory) {
                                    displayText += `ï¼ˆ${memberInfo.professionalCategory}ï¼‰`;
                                }
                                memberNameText.textContent = displayText;
                                memberNameDisplay.style.display = 'block';
                                memberNameDisplay.style.color = '#667eea';
                                memberNameDisplay.style.cursor = 'pointer';
                                memberNameDisplay.style.backgroundColor = '#f0f4ff';
                                memberNameDisplay.style.padding = '8px';
                                memberNameDisplay.style.borderRadius = '6px';
                                memberNameDisplay.style.transition = 'all 0.2s ease';
                                
                                // æ·»åŠ é»æ“Šäº‹ä»¶
                                memberNameDisplay.onclick = function() {
                                    referrerCodeInput.value = `${memberCode}${memberInfo.name}`;
                                    memberNameDisplay.style.display = 'none';
                                };
                                
                                // æ·»åŠ hoveræ•ˆæœ
                                memberNameDisplay.onmouseenter = function() {
                                    this.style.backgroundColor = '#e3e8ff';
                                    this.style.transform = 'translateX(3px)';
                                };
                                memberNameDisplay.onmouseleave = function() {
                                    this.style.backgroundColor = '#f0f4ff';
                                    this.style.transform = 'translateX(0)';
                                };
                            }
                        } else {
                            // æœªæ‰¾åˆ°æœƒå“¡ï¼ˆåªæœ‰åœ¨æœƒå“¡è³‡æ–™åº«ä¸ç‚ºç©ºæ™‚æ‰é¡¯ç¤ºï¼‰
                            if (memberNameDisplay && memberNameText) {
                                memberNameText.textContent = 'âš ï¸ æœªæ‰¾åˆ°è©²æœƒå“¡ç·¨è™Ÿ';
                                memberNameDisplay.style.display = 'block';
                                memberNameDisplay.style.color = '#ff9800';
                                memberNameDisplay.style.cursor = 'default';
                                memberNameDisplay.style.backgroundColor = '#fff3cd';
                                memberNameDisplay.onclick = null;
                                memberNameDisplay.onmouseenter = null;
                                memberNameDisplay.onmouseleave = null;
                            }
                        }
                    } catch (error) {
                        console.error('æœç´¢æœƒå“¡å§“åå¤±æ•—:', error);
                        if (memberNameHint) {
                            memberNameHint.style.display = 'none';
                        }
                    }
                }, 500); // 500ms å»¶é²
            });
            
            // ç•¶å¤±å»ç„¦é»æ™‚ï¼Œå¦‚æœæ‰¾åˆ°äº†å§“åï¼Œç¢ºä¿è¼¸å…¥æ¡†æ ¼å¼æ­£ç¢º
            referrerCodeInput.addEventListener('blur', function() {
                const inputValue = this.value.trim();
                const codeMatch = inputValue.match(/(\d+)/);
                if (codeMatch) {
                    const memberCode = codeMatch[1];
                    // å¯ä»¥é¸æ“‡è‡ªå‹•è£œé½Šæ ¼å¼ï¼Œä½†é€™è£¡ä¿æŒç”¨æˆ¶è¼¸å…¥çš„è‡ªç”±åº¦
                }
            });
        }
        
        async function handleReferralSubmit(e) {
            e.preventDefault();
            
            const formData = {
                referredService: document.getElementById('referredService').value,
                referrerCode: document.getElementById('referrerCode').value,
                referredCompany: document.getElementById('referredCompany').value,
                companyPhone: document.getElementById('companyPhone').value,
                companyLineId: document.getElementById('companyLineId').value,
                companyArea: document.getElementById('companyArea').value,
                referralNote: document.getElementById('referralNote').value,
                referralDate: new Date().toISOString()
            };
            
            // æäº¤åˆ° Google Sheetsï¼ˆä¸ç›´æ¥æ·»åŠ åˆ°æœ¬åœ°è³‡æ–™ï¼‰
            const serviceItem = currentDetails ? currentDetails.item : formData.referredService;
            
            if (serviceItem) {
                // ç›´æ¥æäº¤åˆ° Google Sheets
                const success = await handleReferralRegistration(formData);
                
                if (success) {
                    // å…ˆé—œé–‰è¡¨å–®è¦–çª—
                    closeReferralForm();
                    
                    // æº–å‚™å¼•è–¦è³‡æ–™æ ¼å¼ï¼ˆèˆ‡ Google Sheets æ ¼å¼ä¸€è‡´ï¼‰
                    const formattedPhone = formatPhoneNumber(formData.companyPhone);
                    const referralInfo = {
                        referrerCode: formData.referrerCode || '',
                        companyName: formData.referredCompany || '',
                        phone: formattedPhone,
                        lineId: formData.companyLineId || '',
                        area: formData.companyArea || '',
                        note: formData.referralNote || '',
                        referralDate: formData.referralDate || new Date().toISOString()
                    };
                    
                    // å°‡æ–°è³‡æ–™æ·»åŠ åˆ° referralDataï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
                    // å¦‚æœè©²æœå‹™é …ç›®é‚„æ²’æœ‰è³‡æ–™ï¼Œåˆå§‹åŒ–ç‚ºé™£åˆ—
                    if (!referralData[serviceItem]) {
                        referralData[serviceItem] = [];
                    }
                    
                    // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨å®Œå…¨ç›¸åŒçš„å¼•è–¦ï¼ˆæ‰€æœ‰æ¬„ä½éƒ½ç›¸åŒæ‰è¦–ç‚ºé‡è¤‡ï¼‰
                    const exists = referralData[serviceItem].some(
                        r => r.referrerCode === referralInfo.referrerCode && 
                             r.phone === referralInfo.phone &&
                             r.lineId === referralInfo.lineId &&
                             r.area === referralInfo.area &&
                             r.note === referralInfo.note &&
                             r.companyName === referralInfo.companyName
                    );
                    
                    if (!exists) {
                        referralData[serviceItem].push(referralInfo);
                        safeLog.log('âœ… æ–°å¢å¼•è–¦è¨˜éŒ„:', referralInfo);
                    } else {
                        safeLog.log('âš ï¸ è·³éé‡è¤‡çš„å¼•è–¦è¨˜éŒ„ï¼ˆæ‰€æœ‰æ¬„ä½éƒ½ç›¸åŒï¼‰:', referralInfo);
                    }
                    
                    // ç«‹å³é‡æ–°é¡¯ç¤ºè©³ç´°è³‡è¨Šï¼ˆé¡¯ç¤ºæ–°è¨˜éŒ„ï¼‰
                    if (currentDetails) {
                        // ä½¿ç”¨ setTimeout ç¢ºä¿ DOM æ›´æ–°å®Œæˆ
                        setTimeout(() => {
                            showDetails(currentDetails.item, currentDetails.category, currentDetails.subCategory);
                            // ç¢ºä¿è©³ç´°è³‡è¨Šé¢æ¿æ˜¯æ‰“é–‹çš„
                            const detailsPanel = document.getElementById('detailsPanel');
                            if (detailsPanel) {
                                detailsPanel.classList.add('active');
                            }
                        }, 100);
                    }
                    
                    // é¡¯ç¤ºæˆåŠŸæç¤ºï¼ˆä½¿ç”¨ toast è€Œä¸æ˜¯ alertï¼‰
                    showSuccessToast('âœ… å¼•è–¦ç™»è¨˜æˆåŠŸï¼å·²ç«‹å³é¡¯ç¤ºåœ¨é é¢ä¸Šã€‚');
                } else {
                    showErrorToast('âŒ å¼•è–¦ç™»è¨˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                }
            } else {
                console.error('ç„¡æ³•ç¢ºå®šæœå‹™é …ç›®ï¼Œå¼•è–¦è³‡æ–™æœªä¿å­˜');
                alert('éŒ¯èª¤ï¼šç„¡æ³•ç¢ºå®šæœå‹™é …ç›®ï¼Œè«‹é‡æ–°é¸æ“‡æœå‹™é …ç›®å¾Œå†è©¦ã€‚');
            }
        }
        
        // è¨­ç½®é›»è©±è™Ÿç¢¼è‡ªå‹•æ ¼å¼åŒ–åŠŸèƒ½
        function setupPhoneFormatting() {
            const phoneInput = document.getElementById('companyPhone');
            
            if (!phoneInput) return;
            
            // å¤±å»ç„¦é»æ™‚è‡ªå‹•æ ¼å¼åŒ–
            phoneInput.addEventListener('blur', function() {
                const inputValue = this.value.trim();
                
                if (inputValue) {
                    const formatted = formatPhoneNumber(inputValue);
                    this.value = formatted;
                    
                    // é¡¯ç¤ºæ ¼å¼åŒ–æç¤º
                    if (formatted !== inputValue) {
                        safeLog.log(`é›»è©±è™Ÿç¢¼å·²æ ¼å¼åŒ–ï¼š${inputValue} â†’ ${formatted}`);
                    }
                }
            });
        }
        
        // è¨­ç½®æˆå“¡ç·¨è™Ÿè‡ªå‹•æœç´¢åŠŸèƒ½ï¼ˆç”¨æ–¼éš±ç§ä¿è­·ç¢ºèªï¼‰
        function setupMemberCodeSearchForPrivacy() {
            const memberCodeInput = document.getElementById('memberCodeInput');
            const memberNameHint = document.getElementById('memberNameHintPrivacy');
            const memberNameDisplay = document.getElementById('memberNameDisplayPrivacy');
            const memberNameText = document.getElementById('memberNameTextPrivacy');
            
            if (!memberCodeInput) return;
            
            let searchTimeout = null;
            
            memberCodeInput.addEventListener('input', async function(e) {
                const inputValue = e.target.value.trim();
                
                // æ¸…é™¤ä¹‹å‰çš„æœç´¢
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                // éš±è—é¡¯ç¤ºå€åŸŸ
                if (memberNameDisplay) {
                    memberNameDisplay.style.display = 'none';
                }
                
                // å¦‚æœè¼¸å…¥ç‚ºç©ºï¼Œéš±è—æç¤º
                if (!inputValue) {
                    if (memberNameHint) {
                        memberNameHint.style.display = 'none';
                    }
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦åŒ…å«æ•¸å­—ï¼ˆæœƒå“¡ç·¨è™Ÿï¼‰
                const codeMatch = inputValue.match(/(\d+)/);
                if (!codeMatch) {
                    if (memberNameHint) {
                        memberNameHint.style.display = 'none';
                    }
                    return;
                }
                
                const memberCode = codeMatch[1];
                
                // é¡¯ç¤ºæœç´¢æç¤º
                if (memberNameHint) {
                    memberNameHint.style.display = 'block';
                    memberNameHint.textContent = 'ğŸ” æœç´¢ä¸­...';
                }
                
                // å»¶é²æœç´¢ï¼ˆé¿å…é »ç¹è«‹æ±‚ï¼‰
                searchTimeout = setTimeout(async () => {
                    try {
                        // å…ˆæª¢æŸ¥æœƒå“¡è³‡æ–™æ˜¯å¦å·²è¼‰å…¥
                        const memberData = await loadMemberData();
                        const hasMemberData = memberData && Object.keys(memberData).length > 0;
                        
                        if (!hasMemberData) {
                            // æœƒå“¡è³‡æ–™ç‚ºç©ºï¼Œä¸é¡¯ç¤ºæœç´¢çµæœ
                            if (memberNameHint) {
                                memberNameHint.style.display = 'none';
                            }
                            if (memberNameDisplay) {
                                memberNameDisplay.style.display = 'none';
                            }
                            return;
                        }
                        
                        const memberInfo = await searchMemberName(memberCode);
                        
                        if (memberNameHint) {
                            memberNameHint.style.display = 'none';
                        }
                        
                        if (memberInfo && memberInfo.name) {
                            // é¡¯ç¤ºæ‰¾åˆ°çš„æœƒå“¡è³‡è¨Šï¼ˆä½œç‚ºå¯é»é¸çš„é¸é …ï¼‰
                            if (memberNameDisplay && memberNameText) {
                                // çµ„å»ºé¡¯ç¤ºæ–‡å­—ï¼šå§“å + å°ˆæ¥­é¡åˆ¥ï¼ˆå¦‚æœæœ‰ï¼‰
                                let displayText = `âœ… é»æ“Šé¸æ“‡ï¼š${memberInfo.name}`;
                                if (memberInfo.professionalCategory) {
                                    displayText += `ï¼ˆ${memberInfo.professionalCategory}ï¼‰`;
                                }
                                memberNameText.textContent = displayText;
                                memberNameDisplay.style.display = 'block';
                                memberNameDisplay.style.color = '#667eea';
                                memberNameDisplay.style.cursor = 'pointer';
                                memberNameDisplay.style.backgroundColor = '#f0f4ff';
                                memberNameDisplay.style.padding = '8px';
                                memberNameDisplay.style.borderRadius = '6px';
                                memberNameDisplay.style.transition = 'all 0.2s ease';
                                
                                // æ·»åŠ é»æ“Šäº‹ä»¶
                                memberNameDisplay.onclick = function() {
                                    memberCodeInput.value = `${memberCode}${memberInfo.name}`;
                                    memberNameDisplay.style.display = 'none';
                                };
                                
                                // æ·»åŠ hoveræ•ˆæœ
                                memberNameDisplay.onmouseenter = function() {
                                    this.style.backgroundColor = '#e3e8ff';
                                    this.style.transform = 'translateX(3px)';
                                };
                                memberNameDisplay.onmouseleave = function() {
                                    this.style.backgroundColor = '#f0f4ff';
                                    this.style.transform = 'translateX(0)';
                                };
                            }
                        } else {
                            // æœªæ‰¾åˆ°æœƒå“¡ï¼ˆåªæœ‰åœ¨æœƒå“¡è³‡æ–™åº«ä¸ç‚ºç©ºæ™‚æ‰é¡¯ç¤ºï¼‰
                            if (memberNameDisplay && memberNameText) {
                                memberNameText.textContent = 'âš ï¸ æœªæ‰¾åˆ°è©²æœƒå“¡ç·¨è™Ÿ';
                                memberNameDisplay.style.display = 'block';
                                memberNameDisplay.style.color = '#ff9800';
                                memberNameDisplay.style.cursor = 'default';
                                memberNameDisplay.style.backgroundColor = '#fff3cd';
                                memberNameDisplay.onclick = null;
                                memberNameDisplay.onmouseenter = null;
                                memberNameDisplay.onmouseleave = null;
                            }
                        }
                    } catch (error) {
                        console.error('æœç´¢æœƒå“¡å§“åå¤±æ•—:', error);
                        if (memberNameHint) {
                            memberNameHint.style.display = 'none';
                        }
                    }
                }, 500); // 500ms å»¶é²
            });
            
            // ç•¶å¤±å»ç„¦é»æ™‚ï¼Œå¦‚æœæ‰¾åˆ°äº†å§“åï¼Œç¢ºä¿è¼¸å…¥æ¡†æ ¼å¼æ­£ç¢º
            memberCodeInput.addEventListener('blur', function() {
                const inputValue = this.value.trim();
                const codeMatch = inputValue.match(/(\d+)/);
                if (codeMatch) {
                    const memberCode = codeMatch[1];
                    // å¯ä»¥é¸æ“‡è‡ªå‹•è£œé½Šæ ¼å¼ï¼Œä½†é€™è£¡ä¿æŒç”¨æˆ¶è¼¸å…¥çš„è‡ªç”±åº¦
                }
            });
        }
        
        function closeReferralForm() {
            // æ–¹æ³•1ï¼šå°‹æ‰¾åŒ…å« referralForm çš„å®¹å™¨
            const referralForm = document.getElementById('referralForm');
            if (referralForm) {
                const formContainer = referralForm.closest('div[style*="position: fixed"]');
                if (formContainer) {
                    formContainer.remove();
                    return;
                }
                // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå‘ä¸ŠæŸ¥æ‰¾çˆ¶å®¹å™¨
                let parent = referralForm.parentElement;
                while (parent) {
                    if (parent.style && parent.style.position === 'fixed') {
                        parent.remove();
                        return;
                    }
                    parent = parent.parentElement;
                }
            }
            
            // æ–¹æ³•2ï¼šæŸ¥æ‰¾æ‰€æœ‰å›ºå®šå®šä½çš„å®¹å™¨ï¼Œæ‰¾åˆ°åŒ…å« referralForm çš„
            const fixedContainers = document.querySelectorAll('div[style*="position: fixed"]');
            for (let container of fixedContainers) {
                if (container.querySelector('#referralForm')) {
                    container.remove();
                    return;
                }
            }
            
            // æ–¹æ³•3ï¼šä½¿ç”¨ z-index 2000 æŸ¥æ‰¾ï¼ˆå¼•è–¦è¡¨å–®çš„ z-indexï¼‰
            const zIndexContainers = document.querySelectorAll('div[style*="z-index: 2000"]');
            for (let container of zIndexContainers) {
                if (container.querySelector('#referralForm') || container.querySelector('.referral-form-header')) {
                    container.remove();
                    return;
                }
            }
        }
        
        // é¦¬è³½å…‹åŠŸèƒ½
        function maskPhone(phone) {
            if (!phone) return '****-****';
            // ç¢ºä¿ phone æ˜¯å­—ä¸²é¡å‹
            const phoneStr = String(phone);
            if (phoneStr.length <= 4) return '****';
            const start = phoneStr.substring(0, 2);
            const end = phoneStr.substring(phoneStr.length - 2);
            const middle = '*'.repeat(phoneStr.length - 4);
            return start + middle + end;
        }
        
        function maskLineId(lineId) {
            if (!lineId) return '****';
            // ç¢ºä¿ lineId æ˜¯å­—ä¸²é¡å‹
            const lineIdStr = String(lineId);
            if (lineIdStr.length <= 2) return '**';
            const start = lineIdStr.substring(0, 1);
            const end = lineIdStr.substring(lineIdStr.length - 1);
            const middle = '*'.repeat(Math.max(1, lineIdStr.length - 2));
            return start + middle + end;
        }
        
        // é©—è­‰å¯†ç¢¼ä¸¦é¡¯ç¤ºè¯çµ¡è³‡è¨Š
        function verifyPasswordAndShow(phone, lineId, serviceItem, referrerCode, memberCode, correctPassword) {
            const input = document.getElementById('memberPasswordInput');
            const password = input ? input.value.trim() : '';
            
            if (password === correctPassword) {
                // å¯†ç¢¼æ­£ç¢ºï¼Œé—œé–‰å¯†ç¢¼å½ˆçª—
                const passwordContainer = document.querySelector('[style*="z-index: 4000"]');
                if (passwordContainer) {
                    passwordContainer.remove();
                }
                
                // é¡¯ç¤ºè¯çµ¡è³‡è¨Šï¼ˆè·³ééš±ç§ä¿è­·ç¢ºèªï¼‰
                showContactDetailsDirectly(phone, lineId, serviceItem, referrerCode);
            } else {
                // å¯†ç¢¼éŒ¯èª¤
                alert('âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥');
                if (input) {
                    input.value = '';
                    input.focus();
                }
            }
        }
        
        // ç›´æ¥é¡¯ç¤ºè¯çµ¡è³‡è¨Šï¼ˆç„¡éœ€éš±ç§ä¿è­·ç¢ºèªï¼‰
        function showContactDetailsDirectly(phone, lineId, serviceItem, referrerCode) {
            // é¡¯ç¤ºè¯çµ¡è³‡è¨Š
            let contactHTML = '<div style="text-align: center; padding: 20px;">';
            contactHTML += '<h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“ è¯çµ¡è³‡è¨Š</h3>';
            
            if (phone) {
                contactHTML += `<div style="margin-bottom: 12px;">
                    <strong style="color: #4a5568;">é›»è©±ï¼š</strong>
                    <span style="color: #667eea; font-size: 16px; font-weight: 600;">${phone}</span>
                </div>`;
            }
            
            if (lineId) {
                contactHTML += `<div style="margin-bottom: 12px;">
                    <strong style="color: #4a5568;">LINE IDï¼š</strong>
                    <span style="color: #667eea; font-size: 16px; font-weight: 600;">${lineId}</span>
                </div>`;
            }
            
            contactHTML += '</div>';
            
            // å‰µå»ºå½ˆçª—é¡¯ç¤ºè¯çµ¡è³‡è¨Š
            const infoContainer = document.createElement('div');
            infoContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 4000;
            `;
            
            const infoDialog = document.createElement('div');
            infoDialog.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®å°è©±æ¡†å…§å®¹
            safeSetHTML(infoDialog, contactHTML);
            const closeBtn = safeCreateElement('button', 'é—œé–‰', {
                style: 'width: 100%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 15px;',
                onclick: 'this.closest(\'[style*="z-index: 4000"]\')?.remove()',
                'aria-label': 'é—œé–‰å°è©±æ¡†'
            });
            closeBtn.onclick = () => infoContainer.remove();
            infoDialog.appendChild(closeBtn);
            
            infoContainer.appendChild(infoDialog);
            document.body.appendChild(infoContainer);
        }
        
        // é¡¯ç¤ºæ‰€æœ‰è¯çµ¡è³‡è¨Šè©³æƒ…
        async function showAllContactDetails(phone, lineId, serviceItem, referrerCode, isMember = false, memberCode = '') {
            // æŸ¥æ‰¾å®Œæ•´çš„å¼•è–¦ç™»è¨˜è³‡æ–™
            // å„ªå…ˆä½¿ç”¨ phone å’Œ referrerCode ä¾†ç²¾ç¢ºåŒ¹é…ï¼Œé¿å…åŒä¸€å€‹å¼•è–¦äººæœ‰å¤šç­†ä¸åŒå» å•†çš„æƒ…æ³
            let referralInfo = null;
            if (serviceItem && referrerCode && referralData[serviceItem]) {
                const formattedPhone = phone ? formatPhoneNumber(phone) : '';
                referralInfo = referralData[serviceItem].find(r => {
                    const matchReferrerCode = r.referrerCode === referrerCode;
                    const matchPhone = formattedPhone ? (formatPhoneNumber(r.phone) === formattedPhone) : true;
                    const matchLineId = lineId ? (r.lineId === lineId) : true;
                    return matchReferrerCode && matchPhone && matchLineId;
                });
                
                // å¦‚æœæ²’æ‰¾åˆ°ç²¾ç¢ºåŒ¹é…ï¼Œå˜—è©¦åªç”¨ referrerCode å’Œ phone
                if (!referralInfo && formattedPhone) {
                    referralInfo = referralData[serviceItem].find(r => 
                        r.referrerCode === referrerCode && formatPhoneNumber(r.phone) === formattedPhone
                    );
                }
                
                // å¦‚æœé‚„æ˜¯æ²’æ‰¾åˆ°ï¼Œåªç”¨ referrerCodeï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰
                if (!referralInfo) {
                    referralInfo = referralData[serviceItem].find(r => r.referrerCode === referrerCode);
                }
            }
            
            // å‰µå»ºéš±ç§ä¿è­·ç¢ºèªå½ˆçª—ï¼ˆçµ±ä¸€ä½¿ç”¨ï¼‰
            const confirmContainer = document.createElement('div');
            confirmContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
                backdrop-filter: blur(10px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
                animation: fadeIn 0.3s ease-out;
            `;
            
            const confirmDialog = document.createElement('div');
            confirmDialog.style.cssText = `
                background: linear-gradient(145deg, #ffffff, #f8f9fa);
                padding: 0;
                border-radius: 20px;
                width: 95%;
                max-width: 520px;
                max-height: 90vh;
                box-shadow: 0 25px 50px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.1);
                text-align: center;
                overflow-y: auto;
                overflow-x: hidden;
                animation: slideUp 0.4s ease-out;
                display: flex;
                flex-direction: column;
            `;
            
            const maskedPhone = maskPhone(phone);
            const maskedLineId = lineId ? maskLineId(lineId) : '';
            
            // æº–å‚™å» å•†è³‡è¨Šé¡¯ç¤º - å¿…é ˆæœ‰å®Œæ•´çš„å¼•è–¦è³‡æ–™æ‰èƒ½ç¹¼çºŒ
            const companyName = referralInfo?.companyName || 'æœªçŸ¥';
            const area = referralInfo?.area || '';
            const note = referralInfo?.note || '';
            const referralDate = referralInfo?.referralDate || '';
            
            // è¨˜éŒ„å®Œæ•´çš„å¼•è–¦è³‡æ–™åˆ° sessionStorageï¼Œä»¥ä¾¿å¾ŒçºŒä½¿ç”¨
            if (referralInfo) {
                sessionStorage.setItem('currentReferralInfo', JSON.stringify({
                    companyName: companyName,
                    referrerCode: referrerCode,
                    phone: phone,
                    lineId: lineId || '',
                    serviceItem: serviceItem,
                    area: area,
                    note: note
                }));
                safeLog.log('âœ… å·²ä¿å­˜å®Œæ•´å¼•è–¦è³‡æ–™åˆ° sessionStorage:', {
                    companyName: companyName,
                    referrerCode: referrerCode,
                    phone: phone,
                    lineId: lineId || ''
                });
            } else {
                safeLog.warn('âš ï¸ æœªæ‰¾åˆ°å®Œæ•´çš„å¼•è–¦è³‡æ–™ï¼Œå¯èƒ½ç„¡æ³•æ­£ç¢ºç™¼é€éƒµä»¶');
            }
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼å‰µå»ºç¢ºèªå°è©±æ¡†
            // æ§‹å»ºå®Œæ•´çš„å°è©±æ¡† HTMLï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼Œéœ€è¦ä½¿ç”¨å®‰å…¨æ–¹å¼ï¼‰
            const confirmDialogHTML = `
                <style>
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                .modal-header {
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    padding: 15px 20px;
                    margin: 0;
                }
                .modal-title {
                    font-size: 18px;
                    font-weight: 700;
                    margin: 0;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                }
                .modal-body {
                    padding: 20px;
                    flex: 1;
                    overflow-y: auto;
                    overflow-x: hidden;
                    display: flex;
                    flex-direction: column;
                    min-height: 0;
                }
                @media (max-width: 480px) {
                    .modal-body {
                        padding: 20px 15px;
                        max-height: calc(90vh - 100px) !important;
                        overflow-y: auto !important;
                        overflow-x: hidden !important;
                    }
                    .modal-header {
                        padding: 20px 15px;
                    }
                    .modal-title {
                        font-size: 18px;
                    }
                    .info-card {
                        padding: 12px;
                        margin: 15px 0;
                        grid-template-columns: 1fr 1fr;
                        gap: 8px;
                    }
                    .info-item {
                        flex-direction: column;
                        align-items: flex-start;
                        gap: 4px;
                        padding: 8px;
                    }
                    .info-label {
                        font-size: 12px;
                    }
                    .info-value {
                        font-size: 12px;
                        word-break: break-all;
                    }
                    .warning-card {
                        padding: 15px;
                        margin: 15px 0;
                    }
                    .warning-text {
                            font-size: 14px;
                        }
                        .warning-text strong {
                            font-size: 15px;
                        }
                        .button-group {
                            flex-direction: column;
                            gap: 10px;
                            margin-top: 20px;
                        }
                        .btn-primary, .btn-secondary {
                            width: 100%;
                            padding: 12px 20px;
                            font-size: 14px;
                        }
                        input[type="text"] {
                            font-size: 16px;
                            padding: 10px;
                        }
                        label {
                            font-size: 13px;
                        }
                        p {
                            font-size: 13px;
                            margin: 15px 0;
                        }
                    }
                    .info-card {
                        background: linear-gradient(135deg, #f8f9ff, #ffffff);
                        border: 2px solid #e3e8ff;
                        border-radius: 12px;
                        padding: 12px 15px;
                        margin: 10px 0;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 10px;
                    }
                    .info-item {
                        display: flex;
                        flex-direction: column;
                        gap: 4px;
                        padding: 8px;
                        background: rgba(255, 255, 255, 0.5);
                        border-radius: 8px;
                        border: 1px solid #e3e8ff;
                    }
                    .info-item:last-child {
                        border-bottom: none;
                    }
                    .info-label {
                        font-weight: 600;
                        color: #4a5568;
                        font-size: 12px;
                    }
                    .info-value {
                        color: #2d3748;
                        font-weight: 500;
                        font-size: 13px;
                        word-break: break-word;
                    }
                    .warning-card {
                        background: linear-gradient(135deg, #fff3cd, #ffe69c);
                        border: 3px solid #ff9800;
                        border-radius: 12px;
                        padding: 12px 15px;
                        margin: 10px 0;
                        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
                        animation: pulse-warning 2s infinite;
                    }
                    @keyframes pulse-warning {
                        0%, 100% { box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3); }
                        50% { box-shadow: 0 4px 20px rgba(255, 152, 0, 0.5); }
                    }
                    .warning-icon {
                        font-size: 20px;
                        margin-bottom: 5px;
                    }
                    .warning-text {
                        color: #d84315;
                        font-weight: 600;
                        line-height: 1.4;
                        font-size: 13px;
                    }
                    .warning-text strong {
                        color: #e65100;
                        font-size: 14px;
                        font-weight: 700;
                        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
                    }
                    .button-group {
                        display: flex;
                        gap: 10px;
                        justify-content: center;
                        margin-top: 15px;
                    }
                    .btn-primary {
                        background: linear-gradient(135deg, #28a745, #20c997);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 10px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3);
                    }
                    .btn-primary:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 5px 18px rgba(40, 167, 69, 0.4);
                    }
                    .btn-secondary {
                        background: linear-gradient(135deg, #6c757d, #495057);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 10px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 3px 12px rgba(108, 117, 125, 0.3);
                    }
                    .btn-secondary:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 5px 18px rgba(108, 117, 125, 0.4);
                    }
                    /* æ»¾è¼ªæ¨£å¼ */
                    .modal-content::-webkit-scrollbar {
                        width: 8px;
                    }
                    .modal-content::-webkit-scrollbar-track {
                        background: #f1f1f1;
                        border-radius: 4px;
                    }
                    .modal-content::-webkit-scrollbar-thumb {
                        background: #667eea;
                        border-radius: 4px;
                    }
                    .modal-content::-webkit-scrollbar-thumb:hover {
                        background: #5a6fd8;
                    }
                </style>
                
                <div class="modal-header">
                    <h3 class="modal-title">
                        ğŸ”’ éš±ç§ä¿è­·ç¢ºèª
                    </h3>
                </div>
                
                <div class="modal-body modal-content" style="overflow-x: hidden; overflow-y: auto;">
                    <div class="info-card">
                        <div class="info-item">
                            <span class="info-label">æœå‹™é …ç›®</span>
                            <span class="info-value">${serviceItem}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å¼•è–¦äººç·¨è™Ÿ</span>
                            <span class="info-value">${referrerCode}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å» å•†åç¨±</span>
                            <span class="info-value">${companyName}</span>
                        </div>
                        ${area ? `<div class="info-item">
                            <span class="info-label">æœå‹™å€åŸŸ</span>
                            <span class="info-value">${area}</span>
                        </div>` : ''}
                        <div class="info-item">
                            <span class="info-label">è¯çµ¡é›»è©±</span>
                            <span class="info-value">${maskedPhone}</span>
                        </div>
                        ${lineId ? `<div class="info-item">
                            <span class="info-label">LINE ID</span>
                            <span class="info-value">${maskedLineId}</span>
                        </div>` : ''}
                        ${referralDate ? `<div class="info-item">
                            <span class="info-label">å¼•è–¦æ—¥æœŸ</span>
                            <span class="info-value">${referralDate}</span>
                        </div>` : ''}
                    </div>
                    ${note ? `<div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: left; border-left: 3px solid #667eea;">
                        <strong style="color: #4a5568; font-size: 13px;">ğŸ“ å¼•è–¦å‚™è¨»ï¼š</strong>
                        <div style="color: #2d3748; font-size: 13px; margin-top: 5px; line-height: 1.5;">${note}</div>
                    </div>` : ''}
                    
                    <p style="color: #6c757d; margin: 8px 0; font-size: 13px; line-height: 1.4;">
                        é€™æ˜¯å¤–éƒ¨å¼•è–¦è³‡è¨Šï¼Œä½¿ç”¨å¼•è–¦ç³»çµ±è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡
                    </p>
                    
                    <div style="margin: 8px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568; font-size: 13px;">
                            ğŸ‘¤ è«‹è¼¸å…¥æ‚¨çš„è¯åœ°ç”¢æˆå“¡ç·¨è™Ÿ *
                        </label>
                        <div style="position: relative;">
                            <input type="text" id="memberCodeInput" placeholder="ä¾‹å¦‚ï¼š016 æˆ– 016æ¿¬ç‘’" required
                                   style="width: 100%; padding: 10px; border: 2px solid #e3e8ff; border-radius: 8px; font-size: 13px; transition: all 0.3s ease; padding-right: 120px;"
                                   onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)';"
                                   onblur="this.style.borderColor='#e3e8ff'; this.style.boxShadow='none';">
                            <div id="memberNameHintPrivacy" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #667eea; font-size: 13px; font-weight: 600; pointer-events: none; display: none;">
                                ğŸ” æœç´¢ä¸­...
                            </div>
                        </div>
                        <div id="memberNameDisplayPrivacy" style="margin-top: 5px; font-size: 13px; color: #28a745; font-weight: 600; display: none;">
                            <span id="memberNameTextPrivacy"></span>
                        </div>
                        <p style="color: #6c757d; font-size: 11px; margin-top: 3px; text-align: left;">
                            æ­¤ç·¨è™Ÿå°‡è¨˜éŒ„åœ¨ä½¿ç”¨è¨˜éŒ„ä¸­ä»¥è¿½è¹¤æ˜¯å“ªä½æˆå“¡èª¿ç”¨äº†è¯çµ¡è³‡è¨Š
                        </p>
                    </div>
                    
                    <div style="margin: 8px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #4a5568; font-size: 13px;">
                            ğŸ” è«‹è¼¸å…¥æ‚¨çš„æœƒå“¡å¯†ç¢¼ *
                        </label>
                        <input type="password" id="memberPasswordInputPrivacy" maxlength="4" placeholder="è«‹è¼¸å…¥4ç¢¼å¯†ç¢¼" required
                               style="width: 100%; padding: 10px; border: 2px solid #e3e8ff; border-radius: 8px; font-size: 13px; transition: all 0.3s ease; text-align: center; letter-spacing: 8px;"
                               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)';"
                               onblur="this.style.borderColor='#e3e8ff'; this.style.boxShadow='none';"
                               onkeypress="if(event.key==='Enter') confirmAllContactAccessWithMemberCode('${phone}', '${lineId}', '${serviceItem}', '${referrerCode}')">
                        <p style="color: #6c757d; font-size: 11px; margin-top: 3px; text-align: left;">
                            è«‹è¼¸å…¥æ‚¨çš„æœƒå“¡å¯†ç¢¼ä»¥é©—è­‰èº«ä»½
                        </p>
                    </div>
                    
                    <div class="warning-card">
                        <div class="warning-icon">âš ï¸</div>
                        <div class="warning-text">
                            <strong>é‡è¦æé†’ï¼š</strong><br>
                            é»æ“ŠåŒæ„å¾Œï¼Œæ‚¨çš„æ“ä½œè¨˜éŒ„å°‡è¢«è¨˜éŒ„ç”¨æ–¼æ ¸å¯¦æ˜¯å¦æœ‰ KEY å¼•è–¦
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn-primary" onclick="confirmAllContactAccessWithMemberCode('${phone}', '${lineId}', '${serviceItem}', '${referrerCode}', '${companyName.replace(/'/g, "\\'")}')">
                            âœ… åŒæ„æŸ¥çœ‹
                        </button>
                        <button class="btn-secondary" onclick="closeContactConfirm()">
                            âŒ å–æ¶ˆ
                        </button>
                    </div>
                </div>
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®å°è©±æ¡†å…§å®¹ï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼‰
            safeSetHTML(confirmDialog, confirmDialogHTML);
            
            confirmContainer.appendChild(confirmDialog);
            document.body.appendChild(confirmContainer);
            
            // æ·»åŠ æˆå“¡ç·¨è™Ÿå¿«æœåŠŸèƒ½
            setupMemberCodeSearchForPrivacy();
            
            // è¨­ç½® ARIA å±¬æ€§
            confirmDialog.setAttribute('role', 'dialog');
            confirmDialog.setAttribute('aria-labelledby', 'modal-title-privacy');
            confirmDialog.setAttribute('aria-modal', 'true');
            
            // è‡ªå‹•èšç„¦åˆ°å¯†ç¢¼è¼¸å…¥æ¡†
            setTimeout(() => {
                const passwordInput = document.getElementById('memberPasswordInputPrivacy');
                if (passwordInput) {
                    passwordInput.focus();
                }
            }, 100);
        }
        
        // ç¢ºèªæŸ¥çœ‹æ‰€æœ‰è¯çµ¡è³‡è¨Šï¼ˆå¸¶æˆå“¡ç·¨è™Ÿï¼‰
        async function confirmAllContactAccessWithMemberCode(phone, lineId, serviceItem, referrerCode, companyNameFromModal = '') {
            // ç²å–æˆå“¡ç·¨è™Ÿ
            const memberCodeInput = document.getElementById('memberCodeInput');
            const memberCode = memberCodeInput ? memberCodeInput.value.trim() : '';
            
            // ç²å–å¯†ç¢¼
            const passwordInput = document.getElementById('memberPasswordInputPrivacy');
            const password = passwordInput ? passwordInput.value.trim() : '';
            
            // é©—è­‰æˆå“¡ç·¨è™Ÿ
            if (!memberCode) {
                alert('âš ï¸ è«‹è¼¸å…¥æ‚¨çš„è¯åœ°ç”¢æˆå“¡ç·¨è™Ÿï¼');
                if (memberCodeInput) {
                    memberCodeInput.focus();
                }
                return;
            }
            
            // é©—è­‰å¯†ç¢¼
            if (!password) {
                alert('âš ï¸ è«‹è¼¸å…¥æ‚¨çš„æœƒå“¡å¯†ç¢¼ï¼');
                if (passwordInput) {
                    passwordInput.focus();
                }
                return;
            }
            
            // æå–ç´”æ•¸å­—ç·¨è™Ÿ
            const cleanCode = memberCode.replace(/[^0-9]/g, '');
            
            // å¾æœƒå“¡è³‡æ–™ä¸­æŸ¥æ‰¾ä¸¦é©—è­‰å¯†ç¢¼
            const memberData = await loadMemberData();
            const memberInfo = memberData[cleanCode];
            
            if (!memberInfo) {
                alert('âŒ æ‰¾ä¸åˆ°è©²æœƒå“¡ç·¨è™Ÿï¼Œè«‹ç¢ºèªç·¨è™Ÿæ˜¯å¦æ­£ç¢º');
                return;
            }
            
            // æª¢æŸ¥æœƒå“¡æ˜¯å¦æœ‰è¨­ç½®å¯†ç¢¼
            if (!memberInfo.password || memberInfo.password.trim() === '') {
                alert('âŒ è©²æœƒå“¡å°šæœªè¨­ç½®å¯†ç¢¼ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡è¨­ç½®å¯†ç¢¼');
                return;
            }
            
            // é©—è­‰å¯†ç¢¼
            if (memberInfo.password !== password) {
                alert('âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥');
                if (passwordInput) {
                    passwordInput.value = '';
                    passwordInput.focus();
                }
                return;
            }
            
            safeLog.log('âœ… å¯†ç¢¼é©—è­‰æˆåŠŸ');
            safeLog.log('æˆå“¡ç·¨è™Ÿ:', memberCode);
            
            // ç²å–æœƒå“¡å§“å
            const memberName = memberInfo.name || '';
            
            // åˆä½µè¯çµ¡è³‡è¨Šæ ¼å¼ï¼šé›»è©±å’Œ LINE ID æ•´åˆåœ¨ä¸€ç­†è¨˜éŒ„ä¸­
            // æ ¼å¼åŒ–é›»è©±è™Ÿç¢¼ï¼ˆä¸è¶³10ç¢¼å‰é¢è£œ0ï¼‰
            const formattedPhone = phone ? formatPhoneNumber(phone) : '';
            
            const contactParts = [];
            if (formattedPhone) contactParts.push(`é›»è©±ï¼š${formattedPhone}`);
            if (lineId) contactParts.push(`LINE IDï¼š${lineId}`);
            const combinedContact = contactParts.join(' | ');
            
            // å–®ç­†è¨˜éŒ„åŒ…å«æ‰€æœ‰è¯çµ¡è³‡è¨Š
            const accessInfo = {
                accessTime: new Date().toISOString(),
                accessType: 'contact',  // çµ±ä¸€ç‚ºè¯çµ¡è³‡è¨Šé¡å‹
                contactValue: combinedContact,  // åˆä½µå¾Œçš„è¯çµ¡è³‡è¨Š
                phone: formattedPhone,  // ä¿å­˜æ ¼å¼åŒ–å¾Œçš„é›»è©±è™Ÿç¢¼
                lineId: lineId || '',  // ä¿å­˜åŸå§‹ LINE ID
                serviceItem: serviceItem,
                referrerCode: referrerCode,
                memberCode: memberCode,
                memberName: memberName,
                userAgent: navigator.userAgent,
                timestamp: Date.now()
            };
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
            let accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
            accessLogs.push(accessInfo);
            localStorage.setItem('contactAccessLogs', JSON.stringify(accessLogs));
            
            // ç²å–å» å•†åç¨± - å„ªå…ˆä½¿ç”¨å½ˆçª—å‚³éçš„å®Œæ•´è³‡æ–™ï¼Œç¢ºä¿æ­£ç¢ºæ€§
            let companyName = companyNameFromModal || '';
            
            // å¦‚æœæ²’æœ‰å¾å½ˆçª—å‚³éï¼Œå˜—è©¦å¾ sessionStorage ç²å–
            if (!companyName) {
                try {
                    const savedReferralInfo = sessionStorage.getItem('currentReferralInfo');
                    if (savedReferralInfo) {
                        const referralInfo = JSON.parse(savedReferralInfo);
                        if (referralInfo.companyName && 
                            referralInfo.referrerCode === referrerCode &&
                            referralInfo.phone === phone &&
                            referralInfo.serviceItem === serviceItem) {
                            companyName = referralInfo.companyName;
                            safeLog.log('âœ… å¾ sessionStorage ç²å–å» å•†åç¨±:', companyName);
                        }
                    }
                } catch (e) {
                    safeLog.warn('è®€å– sessionStorage å¤±æ•—:', e);
                }
            }
            
            // å¦‚æœé‚„æ˜¯æ²’æœ‰ï¼Œä½¿ç”¨ç²¾ç¢ºåŒ¹é…æŸ¥æ‰¾
            if (!companyName && serviceItem && referrerCode && referralData[serviceItem]) {
                const formattedPhone = phone ? formatPhoneNumber(phone) : '';
                
                safeLog.log('ğŸ” æŸ¥æ‰¾å» å•†åç¨± - æŸ¥è©¢æ¢ä»¶:');
                safeLog.log('  - æœå‹™é …ç›®:', serviceItem);
                safeLog.log('  - å¼•è–¦äººç·¨è™Ÿ:', referrerCode);
                safeLog.log('  - é›»è©±è™Ÿç¢¼:', formattedPhone);
                safeLog.log('  - LINE ID:', lineId);
                
                // å¿…é ˆå®Œå…¨åŒ¹é…ï¼šæœå‹™é …ç›® + å¼•è–¦äººç·¨è™Ÿ + é›»è©±è™Ÿç¢¼
                let referralInfo = null;
                if (formattedPhone) {
                    referralInfo = referralData[serviceItem].find(r => {
                        const matchReferrerCode = r.referrerCode === referrerCode;
                        const matchPhone = formatPhoneNumber(r.phone) === formattedPhone;
                        const matchLineId = lineId ? (r.lineId === lineId) : true;
                        return matchReferrerCode && matchPhone && matchLineId;
                    });
                    
                    if (referralInfo) {
                        companyName = referralInfo.companyName || '';
                        safeLog.log('âœ… æ‰¾åˆ°ç²¾ç¢ºåŒ¹é…:', companyName);
                    } else {
                        safeLog.log('âš ï¸ æœªæ‰¾åˆ°ç²¾ç¢ºåŒ¹é…');
                        safeLog.log('æ‰€æœ‰åŒ¹é…æœå‹™é …ç›®å’Œå¼•è–¦äººç·¨è™Ÿçš„è¨˜éŒ„:');
                        referralData[serviceItem].filter(r => r.referrerCode === referrerCode).forEach((r, idx) => {
                            safeLog.log(`  ${idx + 1}. å» å•†: ${r.companyName}, é›»è©±: ${r.phone}, LINE ID: ${r.lineId || 'ç„¡'}`);
                        });
                    }
                }
            }
            
            if (!companyName) {
                safeLog.warn('âŒ ç„¡æ³•ç¢ºå®šå» å•†åç¨±ï¼Œéƒµä»¶å¯èƒ½åŒ…å«éŒ¯èª¤è³‡è¨Š');
            } else {
                safeLog.log('âœ… æœ€çµ‚ä½¿ç”¨çš„å» å•†åç¨±:', companyName);
            }
            
            // æäº¤ä½¿ç”¨è¨˜éŒ„åˆ° Google Sheetsï¼ˆåªæäº¤ä¸€æ¬¡ï¼‰
            // æ³¨æ„ï¼šmemberCode æ‡‰è©²ä½¿ç”¨ cleanCodeï¼ˆç´”æ•¸å­—æ ¼å¼ï¼‰
            const cleanMemberCode = cleanCode;
            safeLog.log('ğŸ“¤ æº–å‚™æäº¤ä½¿ç”¨è¨˜éŒ„åˆ° Google Sheets');
            safeLog.log('æœƒå“¡ç·¨è™Ÿ:', cleanMemberCode);
            safeLog.log('æœƒå“¡å§“å:', memberName);
            safeLog.log('å» å•†åç¨±:', companyName);
            safeLog.log('å¼•è–¦äººç·¨è™Ÿ:', referrerCode);
            safeLog.log('æœå‹™é …ç›®:', serviceItem);
            
            // ç²å–å®Œæ•´çš„å¼•è–¦è³‡æ–™ä»¥é€²è¡Œå¤šæ¢ä»¶æ¯”å°
            let referralInfoForMatch = null;
            if (serviceItem && referrerCode && referralData[serviceItem]) {
                const formattedPhoneForMatch = phone ? formatPhoneNumber(phone) : '';
                referralInfoForMatch = referralData[serviceItem].find(r => {
                    const matchReferrerCode = r.referrerCode === referrerCode;
                    const matchPhone = formattedPhoneForMatch ? (formatPhoneNumber(r.phone) === formattedPhoneForMatch) : true;
                    const matchLineId = lineId ? (r.lineId === lineId) : true;
                    return matchReferrerCode && matchPhone && matchLineId;
                });
            }
            
            handleAccessLogSubmission({
                accessTime: new Date().toISOString(),
                accessType: 'contact',
                contactValue: combinedContact,
                phone: formattedPhone,  // ç›´æ¥å‚³éé›»è©±è™Ÿç¢¼
                lineId: lineId || '',   // ç›´æ¥å‚³é LINE ID
                serviceItem: serviceItem,
                referrerCode: referrerCode,
                memberCode: cleanMemberCode,  // ä½¿ç”¨æ¸…ç†å¾Œçš„ç·¨è™Ÿ
                memberName: memberName,       // æ·»åŠ æœƒå“¡å§“å
                companyName: companyName,     // æ·»åŠ å» å•†åç¨±
                area: referralInfoForMatch?.area || '',  // æ·»åŠ æœå‹™å€åŸŸç”¨æ–¼å¤šæ¢ä»¶æ¯”å°
                note: referralInfoForMatch?.note || '',  // æ·»åŠ å¼•è–¦å‚™è¨»ç”¨æ–¼å¤šæ¢ä»¶æ¯”å°
                userAgent: navigator.userAgent  // æ·»åŠ ç€è¦½å™¨è³‡è¨Š
            });
            
            // é—œé–‰éš±ç§ä¿è­·ç¢ºèªå½ˆçª—
            closeContactConfirm();
            
            // æ›´æ–°é é¢ä¸Šçš„è¯çµ¡è³‡è¨Šé¡¯ç¤º
            if (phone) {
                updateContactDisplay('phone', phone, serviceItem, referrerCode);
            }
            if (lineId) {
                updateContactDisplay('lineid', lineId, serviceItem, referrerCode);
            }
            
            // ç²å–å®Œæ•´çš„å¼•è–¦è³‡æ–™ï¼Œæº–å‚™ç™¼é€éƒµä»¶çµ¦å®¢æˆ¶
            let referralInfo = null;
            if (serviceItem && referrerCode && referralData[serviceItem]) {
                const formattedPhoneForSearch = phone ? formatPhoneNumber(phone) : '';
                referralInfo = referralData[serviceItem].find(r => {
                    const matchReferrerCode = r.referrerCode === referrerCode;
                    const matchPhone = formattedPhoneForSearch ? (formatPhoneNumber(r.phone) === formattedPhoneForSearch) : true;
                    const matchLineId = lineId ? (r.lineId === lineId) : true;
                    return matchReferrerCode && matchPhone && matchLineId;
                });
            }
            
            // ç²å–å®¢æˆ¶ Email ä¸¦ç™¼é€éƒµä»¶
            const customerEmail = memberInfo.email || '';
            if (customerEmail && referralInfo) {
                // ç²å–å®Œæ•´çš„å¼•è–¦è³‡æ–™
                const completeReferralData = {
                    serviceItem: serviceItem,
                    companyName: referralInfo.companyName || companyName || 'æœªçŸ¥',
                    phone: formattedPhone,
                    lineId: lineId || '',
                    area: referralInfo.area || '',
                    note: referralInfo.note || '',
                    referralDate: referralInfo.referralDate || '',
                    referrerCode: referrerCode
                };
                
                // ç™¼é€éƒµä»¶çµ¦å®¢æˆ¶
                safeLog.log('ğŸ“§ æº–å‚™ç™¼é€å¼•è–¦è³‡æ–™éƒµä»¶çµ¦å®¢æˆ¶:', customerEmail);
                sendReferralInfoEmailToCustomer(
                    customerEmail,
                    memberName,
                    cleanMemberCode,
                    completeReferralData
                );
            } else if (customerEmail && !referralInfo) {
                safeLog.warn('âš ï¸ æœªæ‰¾åˆ°å®Œæ•´å¼•è–¦è³‡æ–™ï¼Œç„¡æ³•ç™¼é€éƒµä»¶');
            } else if (!customerEmail) {
                safeLog.warn('âš ï¸ å®¢æˆ¶æœªè¨­å®š Emailï¼Œç„¡æ³•ç™¼é€éƒµä»¶');
            }
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            alert(`âœ… è¯çµ¡è³‡è¨Šå·²è§£é–\n\nâš ï¸ è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼`);
        }
        
        // é¡¯ç¤ºè¯çµ¡è³‡è¨Šè©³æƒ…ï¼ˆä¿ç•™åŸå‡½æ•¸ä»¥å‚™ç”¨ï¼‰
        function showContactDetails(type, value, serviceItem, referrerCode) {
            // å‰µå»ºéš±ç§ä¿è­·ç¢ºèªå½ˆçª—
            const confirmContainer = document.createElement('div');
            confirmContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
            `;
            
            const confirmDialog = document.createElement('div');
            confirmDialog.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                width: 95%;
                max-width: 500px;
                max-height: 90vh;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                overflow-y: auto;
                overflow-x: hidden;
                display: flex;
                flex-direction: column;
            `;
            
            const typeText = type === 'phone' ? 'é›»è©±' : 'LINE ID';
            const maskedValue = type === 'phone' ? maskPhone(value) : maskLineId(value);
            
            // æ§‹å»ºå°è©±æ¡† HTMLï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼Œéœ€è¦ä½¿ç”¨å®‰å…¨æ–¹å¼ï¼‰
            const confirmDialogHTML = `
                <style>
                    @media (max-width: 480px) {
                        .contact-confirm-content {
                            padding: 20px 15px !important;
                        }
                        .contact-confirm-title {
                            font-size: 18px !important;
                        }
                        .contact-confirm-info {
                            padding: 15px !important;
                            font-size: 13px !important;
                        }
                        .contact-confirm-warning {
                            padding: 15px !important;
                            font-size: 14px !important;
                        }
                        .contact-confirm-buttons {
                            flex-direction: column !important;
                            gap: 10px !important;
                        }
                        .contact-confirm-button {
                            width: 100% !important;
                            padding: 12px 20px !important;
                        }
                    }
                </style>
                <div class="contact-confirm-content" style="flex: 1; overflow-y: auto; overflow-x: hidden; min-height: 0;">
                    <h3 class="contact-confirm-title" style="margin: 0 0 15px 0; color: #333; font-size: 20px;">ğŸ”’ éš±ç§ä¿è­·ç¢ºèª</h3>
                    <div class="contact-confirm-info" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: left;">
                        <strong>æœå‹™é …ç›®ï¼š</strong>${serviceItem}<br>
                        <strong>å¼•è–¦äººï¼š</strong>${referrerCode}<br>
                        <strong>${typeText}ï¼š</strong>${maskedValue}
                    </div>
                    <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                        é€™æ˜¯å¤–éƒ¨å¼•è–¦è³‡è¨Šï¼Œä½¿ç”¨å¼•è–¦ç³»çµ±è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡
                    </p>
                    <div class="contact-confirm-warning" style="background: linear-gradient(135deg, #fff3cd, #ffe69c); padding: 15px; border-radius: 8px; border: 3px solid #ff9800; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);">
                        <strong style="color: #e65100; font-size: 16px;">âš ï¸ é‡è¦æé†’ï¼š</strong><br>
                        <span style="color: #d84315; font-weight: 600;">é»æ“ŠåŒæ„å¾Œï¼Œæ‚¨çš„æ“ä½œè¨˜éŒ„å°‡è¢«è¨˜éŒ„ç”¨æ–¼æ ¸å¯¦æ˜¯å¦æœ‰ KEY å¼•è–¦</span>
                    </div>
                </div>
                
                <div class="contact-confirm-buttons" style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <button onclick="confirmContactAccess('${type}', '${value}', '${serviceItem}', '${referrerCode}')" 
                            class="contact-confirm-button"
                            style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                        åŒæ„æŸ¥çœ‹
                    </button>
                    <button onclick="closeContactConfirm()" 
                            class="contact-confirm-button"
                            style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                        å–æ¶ˆ
                    </button>
                </div>
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®å°è©±æ¡†å…§å®¹ï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼‰
            safeSetHTML(confirmDialog, confirmDialogHTML);
            
            // è¨­ç½® ARIA å±¬æ€§
            confirmDialog.setAttribute('role', 'dialog');
            confirmDialog.setAttribute('aria-labelledby', 'contact-confirm-title');
            confirmDialog.setAttribute('aria-modal', 'true');
            
            confirmContainer.appendChild(confirmDialog);
            document.body.appendChild(confirmContainer);
        }
        
        // ç¢ºèªæŸ¥çœ‹è¯çµ¡è³‡è¨Š
        async function confirmContactAccess(type, value, serviceItem, referrerCode) {
            try {
                safeLog.log('é–‹å§‹è™•ç†éš±ç§ä¿è­·ç¢ºèª:', { type, value, serviceItem, referrerCode });
                
                // å˜—è©¦å¾ sessionStorage æˆ– localStorage ç²å–æœƒå“¡ç·¨è™Ÿï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                let memberCode = sessionStorage.getItem('currentMemberCode') || '';
                let memberName = '';
                
                // å¦‚æœæœ‰æˆå“¡ç·¨è™Ÿï¼ŒæŸ¥è©¢æœƒå“¡å§“å
                if (memberCode) {
                    const cleanCode = memberCode.replace(/[^0-9]/g, '');
                    const memberData = await loadMemberData();
                    const memberInfo = memberData[cleanCode];
                    if (memberInfo) {
                        memberName = memberInfo.name || '';
                    }
                }
                
                // æŸ¥æ‰¾å» å•†åç¨±
                let companyName = '';
                if (serviceItem && referrerCode && referralData[serviceItem]) {
                    const referralInfo = referralData[serviceItem].find(r => r.referrerCode === referrerCode);
                    if (referralInfo) {
                        companyName = referralInfo.companyName || '';
                    }
                }
                
                // è¨˜éŒ„ä½¿ç”¨è€…è³‡è¨Šï¼ˆåŒ…å« memberCodeã€memberName å’Œ companyNameï¼‰
                const userInfo = {
                    accessTime: new Date().toISOString(),
                    accessType: type,
                    contactValue: value,
                    phone: type === 'phone' ? value : '',  // å¦‚æœæ˜¯é›»è©±é¡å‹ï¼Œå‚³éé›»è©±è™Ÿç¢¼
                    lineId: type === 'lineid' ? value : '', // å¦‚æœæ˜¯ LINE ID é¡å‹ï¼Œå‚³é LINE ID
                    serviceItem: serviceItem,
                    referrerCode: referrerCode,
                    memberCode: memberCode,      // æ·»åŠ æœƒå“¡ç·¨è™Ÿ
                    memberName: memberName,      // æ·»åŠ æœƒå“¡å§“å
                    companyName: companyName,    // æ·»åŠ å» å•†åç¨±
                    userAgent: navigator.userAgent,
                    timestamp: Date.now()
                };
                
                safeLog.log('ä½¿ç”¨è€…è³‡è¨Š:', userInfo);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
                let accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
                accessLogs.push(userInfo);
                localStorage.setItem('contactAccessLogs', JSON.stringify(accessLogs));
                safeLog.log('âœ… ä½¿ç”¨è¨˜éŒ„å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å„²');
                
                // æäº¤åˆ° Google Sheetsï¼ˆå¦‚æœ memberCode å­˜åœ¨ï¼Œæœƒè§¸ç™¼éƒµä»¶é€šçŸ¥ï¼‰
                const success = await handleAccessLogSubmission(userInfo);
                
                if (success) {
                    safeLog.log('âœ… ä½¿ç”¨è¨˜éŒ„å·²æˆåŠŸæäº¤åˆ° Google Sheets');
                    if (memberCode && referrerCode) {
                        safeLog.log('ğŸ“§ éƒµä»¶é€šçŸ¥å·²è§¸ç™¼ï¼ˆå¦‚æœå¼•è–¦äººæœ‰è¨­å®š Emailï¼‰');
                    }
                } else {
                    safeLog.warn('âš ï¸ ä½¿ç”¨è¨˜éŒ„æäº¤åˆ° Google Sheets å¤±æ•—ï¼Œä½†å·²ä¿å­˜åˆ°æœ¬åœ°');
                }
                
                // æ›´æ–°é é¢ä¸Šçš„è¯çµ¡è³‡è¨Šé¡¯ç¤º
                updateContactDisplay(type, value, serviceItem, referrerCode);
                
                // é—œé–‰ç¢ºèªå½ˆçª—
                closeContactConfirm();
                
                // é¡¯ç¤ºæé†’è¨Šæ¯
                const typeText = type === 'phone' ? 'é›»è©±' : 'LINE ID';
                const statusMessage = success ? 'âœ… ä½¿ç”¨è¨˜éŒ„å·²è¨˜éŒ„' : 'âš ï¸ ä½¿ç”¨è¨˜éŒ„å·²ä¿å­˜åˆ°æœ¬åœ°';
                alert(`${typeText}ï¼š${value}\n\n${statusMessage}\n\nâš ï¸ è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼`);
                
            } catch (error) {
                console.error('éš±ç§ä¿è­·ç¢ºèªè™•ç†å¤±æ•—:', error);
                
                // å³ä½¿å‡ºéŒ¯ä¹Ÿè¦é¡¯ç¤ºè¯çµ¡è³‡è¨Š
                updateContactDisplay(type, value, serviceItem, referrerCode);
                closeContactConfirm();
                
                const typeText = type === 'phone' ? 'é›»è©±' : 'LINE ID';
                alert(`${typeText}ï¼š${value}\n\nâš ï¸ è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼`);
            }
        }
        
        // è¤‡è£½åˆ°å‰ªè²¼æ¿
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                // å‚™ç”¨æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return true;
                } catch (err) {
                    document.body.removeChild(textArea);
                    return false;
                }
            }
        }
        
        // é¡¯ç¤ºè¤‡è£½æˆåŠŸæç¤º
        function showCopySuccess(element) {
            const originalText = element.textContent;
            element.textContent = 'âœ… å·²è¤‡è£½ï¼';
            element.style.color = '#28a745';
            setTimeout(() => {
                element.textContent = originalText;
                element.style.color = '';
            }, 1500);
        }
        
        // æ’¥æ‰“é›»è©±
        function makePhoneCall(phone) {
            window.location.href = `tel:${phone}`;
        }
        
        // è¤‡è£½ LINE ID
        async function copyLineId(lineId) {
            const success = await copyToClipboard(lineId);
            if (success) {
                // é¡¯ç¤ºæç¤º
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #28a745;
                    color: white;
                    padding: 12px 24px;
                    border-radius: 25px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 5000;
                    font-weight: 600;
                `;
                toast.textContent = 'âœ… LINE ID å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼';
                document.body.appendChild(toast);
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 2000);
            } else {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š' + lineId);
            }
        }
        
        // æ›´æ–°è¯çµ¡è³‡è¨Šé¡¯ç¤º
        function updateContactDisplay(type, value, serviceItem, referrerCode) {
            // æ‰¾åˆ°å°æ‡‰çš„é¦¬è³½å…‹è³‡è¨Šå…ƒç´ 
            const maskedElements = document.querySelectorAll('.masked-info');
            maskedElements.forEach(element => {
                if (element.getAttribute('data-type') === type && element.getAttribute('data-value') === value) {
                    // ç§»é™¤æŸ¥çœ‹è©³æƒ…æŒ‰éˆ•
                    const button = element.parentNode.querySelector('button');
                    if (button) {
                        button.remove();
                    }
                    
                    // å‰µå»ºæ–°çš„é¡¯ç¤ºå®¹å™¨
                    const container = document.createElement('div');
                    container.style.cssText = 'display: flex; align-items: center; gap: 8px;';
                    
                    // é¡¯ç¤ºå®Œæ•´è³‡è¨Šï¼ˆå¦‚æœæ˜¯é›»è©±ï¼Œæ ¼å¼åŒ–ç‚º10ç¢¼ï¼‰
                    const displayValue = type === 'phone' ? formatPhoneNumber(value) : value;
                    const infoSpan = document.createElement('span');
                    infoSpan.textContent = displayValue;
                    infoSpan.style.cssText = 'color: #28a745; font-weight: bold; font-size: 13px;';
                    container.appendChild(infoSpan);
                    
                    // æ·»åŠ æ“ä½œæŒ‰éˆ•
                    if (type === 'phone') {
                        // é›»è©±ï¼šæ·»åŠ æ’¥è™ŸæŒ‰éˆ•
                        const callBtn = document.createElement('button');
                        callBtn.textContent = 'ğŸ“';
                        callBtn.setAttribute('aria-label', 'æ’¥æ‰“é›»è©±');
                        callBtn.title = 'æ’¥æ‰“é›»è©±';
                        callBtn.style.cssText = `
                            background: #28a745;
                            color: white;
                            border: none;
                            border-radius: 50%;
                            width: 28px;
                            height: 28px;
                            font-size: 14px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            transition: all 0.3s ease;
                            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
                        `;
                        callBtn.onclick = (e) => {
                            e.stopPropagation();
                            makePhoneCall(displayValue);
                        };
                        callBtn.onmouseenter = () => {
                            callBtn.style.transform = 'scale(1.1)';
                            callBtn.style.boxShadow = '0 4px 12px rgba(40, 167, 69, 0.4)';
                        };
                        callBtn.onmouseleave = () => {
                            callBtn.style.transform = 'scale(1)';
                            callBtn.style.boxShadow = '0 2px 8px rgba(40, 167, 69, 0.3)';
                        };
                        container.appendChild(callBtn);
                    } else if (type === 'lineid') {
                        // LINE IDï¼šæ·»åŠ è¤‡è£½æŒ‰éˆ•
                        const copyBtn = document.createElement('button');
                        copyBtn.textContent = 'ğŸ“‹';
                        copyBtn.setAttribute('aria-label', 'è¤‡è£½åˆ°å‰ªè²¼æ¿');
                        copyBtn.title = 'è¤‡è£½ LINE ID';
                        copyBtn.style.cssText = `
                            background: #00c300;
                            color: white;
                            border: none;
                            border-radius: 50%;
                            width: 28px;
                            height: 28px;
                            font-size: 14px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            transition: all 0.3s ease;
                            box-shadow: 0 2px 8px rgba(0, 195, 0, 0.3);
                        `;
                        copyBtn.onclick = async (e) => {
                            e.stopPropagation();
                            const success = await copyToClipboard(value);
                            if (success) {
                                showCopySuccess(copyBtn);
                            } else {
                                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š' + value);
                            }
                        };
                        copyBtn.onmouseenter = () => {
                            copyBtn.style.transform = 'scale(1.1)';
                            copyBtn.style.boxShadow = '0 4px 12px rgba(0, 195, 0, 0.4)';
                        };
                        copyBtn.onmouseleave = () => {
                            copyBtn.style.transform = 'scale(1)';
                            copyBtn.style.boxShadow = '0 2px 8px rgba(0, 195, 0, 0.3)';
                        };
                        container.appendChild(copyBtn);
                    }
                    
                    // æ›¿æ›åŸå…ƒç´ 
                    element.parentNode.replaceChild(container, element);
                }
            });
        }
        
        // é—œé–‰è¯çµ¡è³‡è¨Šç¢ºèªå½ˆçª—
        function closeContactConfirm() {
            const confirmContainer = document.querySelector('div[style*="position: fixed"][style*="z-index: 3000"]');
            if (confirmContainer) {
                confirmContainer.remove();
            }
        }
        
        // åˆ‡æ›å¼•è–¦äººè©³ç´°è³‡è¨Š
        function toggleReferralDetails(item) {
            // item åƒæ•¸å·²ç¶“åŒ…å«äº†å®Œæ•´çš„ uniqueIdï¼Œç›´æ¥ä½¿ç”¨
            const detailsDiv = document.getElementById(`referralDetails_${item}`);
            
            if (!detailsDiv) return;
            
            // æ‰¾åˆ°åŒä¸€å€‹ referral-item å…§çš„ expand-icon
            const parentItem = detailsDiv.closest('.referral-item');
            if (!parentItem) return;
            
            const expandIcon = parentItem.querySelector('.expand-icon');
            if (!expandIcon) return;
            
            // ç¨ç«‹å±•é–‹/æ”¶åˆæ¯å€‹å¡ç‰‡
            const isHidden = detailsDiv.style.display === 'none' || detailsDiv.style.display === '';
            
            if (isHidden) {
                detailsDiv.style.display = 'block';
                expandIcon.style.transform = 'rotate(90deg)';
                expandIcon.textContent = 'â–¼';
            } else {
                detailsDiv.style.display = 'none';
                expandIcon.style.transform = 'rotate(0deg)';
                expandIcon.textContent = 'â–¶';
            }
        }
        
        // æ›´æ–°å½ˆçª—ä¸­çš„è¯çµ¡è³‡è¨Šé¡¯ç¤ºï¼ˆå·²åˆªé™¤ï¼‰
        function _updateModalContactInfo_removed(phone, lineId, serviceItem, referrerCode) {
            return; // æ­¤å‡½æ•¸å·²åˆªé™¤
            // æŸ¥æ‰¾å®Œæ•´çš„å¼•è–¦ç™»è¨˜è³‡æ–™
            // å„ªå…ˆä½¿ç”¨ phone å’Œ referrerCode ä¾†ç²¾ç¢ºåŒ¹é…ï¼Œé¿å…åŒä¸€å€‹å¼•è–¦äººæœ‰å¤šç­†ä¸åŒå» å•†çš„æƒ…æ³
            let referralInfo = null;
            if (serviceItem && referrerCode && referralData[serviceItem]) {
                const formattedPhone = phone ? formatPhoneNumber(phone) : '';
                referralInfo = referralData[serviceItem].find(r => {
                    const matchReferrerCode = r.referrerCode === referrerCode;
                    const matchPhone = formattedPhone ? (formatPhoneNumber(r.phone) === formattedPhone) : true;
                    const matchLineId = lineId ? (r.lineId === lineId) : true;
                    return matchReferrerCode && matchPhone && matchLineId;
                });
                
                // å¦‚æœæ²’æ‰¾åˆ°ç²¾ç¢ºåŒ¹é…ï¼Œå˜—è©¦åªç”¨ referrerCode å’Œ phone
                if (!referralInfo && formattedPhone) {
                    referralInfo = referralData[serviceItem].find(r => 
                        r.referrerCode === referrerCode && formatPhoneNumber(r.phone) === formattedPhone
                    );
                }
                
                // å¦‚æœé‚„æ˜¯æ²’æ‰¾åˆ°ï¼Œåªç”¨ referrerCodeï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰
                if (!referralInfo) {
                    referralInfo = referralData[serviceItem].find(r => r.referrerCode === referrerCode);
                }
            }
            
            const companyName = referralInfo?.companyName || 'æœªçŸ¥';
            const area = referralInfo?.area || '';
            const note = referralInfo?.note || '';
            const referralDate = referralInfo?.referralDate || '';
            
            // åªæŸ¥æ‰¾ z-index: 3000 çš„å½ˆçª—ï¼ˆé¿å…å½±éŸ¿ showUnlockedContactModal çš„ z-index: 4000 å½ˆçª—ï¼‰
            const confirmContainer = document.querySelector('div[style*="z-index: 3000"]');
            if (confirmContainer) {
                const confirmDialog = confirmContainer.querySelector('div[style*="border-radius: 20px"]');
                if (confirmDialog) {
                    // æ›´æ–°æ¨™é¡Œ
                    const titleElement = confirmDialog.querySelector('.modal-title');
                    if (titleElement) {
                        titleElement.textContent = 'ğŸ”“ è¯çµ¡è³‡è¨Šå·²è§£é–';
                    }
                    
                    // æ›´æ–°æ¨™é¡ŒèƒŒæ™¯è‰²
                    const headerElement = confirmDialog.querySelector('.modal-header');
                    if (headerElement) {
                        headerElement.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                    }
                    
                    // æŸ¥æ‰¾ä¸¦æ›´æ–°å» å•†åç¨±è³‡è¨Š
                    const infoItems = confirmDialog.querySelectorAll('.info-item');
                    let companyItem = null;
                    let areaItem = null;
                    let phoneItem = null;
                    let lineItem = null;
                    let dateItem = null;
                    
                    // é€šéæ¨™ç±¤æ–‡å­—æ‰¾åˆ°å°æ‡‰çš„å…ƒç´ 
                    infoItems.forEach(item => {
                        const label = item.querySelector('.info-label');
                        if (label) {
                            const labelText = label.textContent.trim();
                            if (labelText.includes('å» å•†åç¨±')) {
                                companyItem = item;
                            } else if (labelText.includes('æœå‹™å€åŸŸ')) {
                                areaItem = item;
                            } else if (labelText.includes('è¯çµ¡é›»è©±') || labelText.includes('é›»è©±')) {
                                phoneItem = item;
                            } else if (labelText.includes('LINE ID') || labelText.includes('LINE')) {
                                lineItem = item;
                            } else if (labelText.includes('å¼•è–¦æ—¥æœŸ')) {
                                dateItem = item;
                            }
                        }
                    });
                    
                    // æ›´æ–°å» å•†åç¨±è³‡è¨Š
                    if (companyItem) {
                        companyItem.textContent = ''; // æ¸…ç©º
                        const label = safeCreateElement('span', 'å» å•†åç¨±', { class: 'info-label' });
                        const value = safeCreateElement('span', companyName, { 
                            class: 'info-value',
                            style: 'color: #155724; font-weight: 700;'
                        });
                        companyItem.appendChild(label);
                        companyItem.appendChild(value);
                    }
                    
                    // æ›´æ–°æœå‹™å€åŸŸè³‡è¨Š
                    if (area) {
                        if (areaItem) {
                            areaItem.textContent = ''; // æ¸…ç©º
                            const label = safeCreateElement('span', 'æœå‹™å€åŸŸ', { class: 'info-label' });
                            const value = safeCreateElement('span', area, { class: 'info-value' });
                            areaItem.appendChild(label);
                            areaItem.appendChild(value);
                        } else {
                            // å¦‚æœæ²’æœ‰æœå‹™å€åŸŸé …ç›®ï¼Œæ·»åŠ åˆ°info-cardä¸­
                            const infoCard = confirmDialog.querySelector('.info-card');
                            if (infoCard) {
                                const newAreaItem = document.createElement('div');
                                newAreaItem.className = 'info-item';
                                const label = safeCreateElement('span', 'æœå‹™å€åŸŸ', { class: 'info-label' });
                                const value = safeCreateElement('span', area, { class: 'info-value' });
                                newAreaItem.appendChild(label);
                                newAreaItem.appendChild(value);
                                // æ’å…¥åˆ°å» å•†åç¨±ä¹‹å¾Œ
                                if (companyItem && companyItem.nextSibling) {
                                    companyItem.parentNode.insertBefore(newAreaItem, companyItem.nextSibling);
                                }
                            }
                        }
                    }
                    
                    // æ›´æ–°é›»è©±è³‡è¨Šï¼ˆæ ¼å¼åŒ–ç‚º10ç¢¼ï¼‰
                    if (phoneItem && phone) {
                        const formattedPhone = formatPhoneNumber(phone);
                        phoneItem.textContent = ''; // æ¸…ç©º
                        const label = safeCreateElement('span', 'è¯çµ¡é›»è©±', { class: 'info-label' });
                        const valueContainer = safeCreateElement('div', '', { 
                            style: 'display: flex; align-items: center; gap: 8px;' 
                        });
                        const value = safeCreateElement('span', formattedPhone, { 
                            class: 'info-value',
                            style: 'color: #155724; font-weight: 700; background: #e8f5e8; padding: 4px 8px; border-radius: 4px;'
                        });
                        const callBtn = safeCreateElement('button', 'ğŸ“', {
                            onclick: `makePhoneCall('${formattedPhone.replace(/'/g, "\\'")}')`,
                            title: 'æ’¥æ‰“é›»è©±',
                            style: 'background: #28a745; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);',
                            'aria-label': 'æ’¥æ‰“é›»è©±'
                        });
                        callBtn.onclick = () => makePhoneCall(formattedPhone);
                        valueContainer.appendChild(value);
                        valueContainer.appendChild(callBtn);
                        phoneItem.appendChild(label);
                        phoneItem.appendChild(valueContainer);
                    }
                    
                    // æ›´æ–° LINE ID è³‡è¨Š
                    if (lineItem && lineId) {
                        lineItem.textContent = ''; // æ¸…ç©º
                        const label = safeCreateElement('span', 'LINE ID', { class: 'info-label' });
                        const valueContainer = safeCreateElement('div', '', { 
                            style: 'display: flex; align-items: center; gap: 8px;' 
                        });
                        const value = safeCreateElement('span', lineId, { 
                            class: 'info-value',
                            style: 'color: #155724; font-weight: 700; background: #e8f5e8; padding: 4px 8px; border-radius: 4px;'
                        });
                        const copyBtn = safeCreateElement('button', 'ğŸ“‹', {
                            onclick: `copyLineId('${lineId.replace(/'/g, "\\'")}')`,
                            title: 'è¤‡è£½ LINE ID',
                            style: 'background: #00c300; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 195, 0, 0.3);',
                            'aria-label': 'è¤‡è£½ LINE ID'
                        });
                        copyBtn.onclick = () => copyLineId(lineId);
                        valueContainer.appendChild(value);
                        valueContainer.appendChild(copyBtn);
                        lineItem.appendChild(label);
                        lineItem.appendChild(valueContainer);
                    }
                    
                    // æ›´æ–°å¼•è–¦æ—¥æœŸè³‡è¨Š
                    if (referralDate) {
                        if (dateItem) {
                            dateItem.textContent = ''; // æ¸…ç©º
                            const label = safeCreateElement('span', 'å¼•è–¦æ—¥æœŸ', { class: 'info-label' });
                            const value = safeCreateElement('span', referralDate, { class: 'info-value' });
                            dateItem.appendChild(label);
                            dateItem.appendChild(value);
                        }
                    }
                    
                    // æ›´æ–°æˆ–æ·»åŠ å‚™è¨»è³‡è¨Š
                    if (note) {
                        // æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„å‚™è¨»å®¹å™¨ï¼ˆä½¿ç”¨æ›´ç²¾ç¢ºçš„é¸æ“‡å™¨ï¼‰
                        const allNoteContainers = confirmDialog.querySelectorAll('div');
                        let noteContainer = null;
                        
                        // æŸ¥æ‰¾å·²ç¶“å­˜åœ¨çš„å‚™è¨»å®¹å™¨
                        for (let container of allNoteContainers) {
                            if (container.textContent && container.textContent.includes('å¼•è–¦å‚™è¨»')) {
                                noteContainer = container;
                                break;
                            }
                        }
                        
                        if (!noteContainer) {
                            // å¦‚æœæ²’æœ‰å‚™è¨»å®¹å™¨ï¼Œå‰µå»ºä¸€å€‹
                            const modalBody = confirmDialog.querySelector('.modal-body');
                            if (modalBody) {
                                // æŸ¥æ‰¾ info-card ä¹‹å¾Œçš„ä½ç½®æ’å…¥å‚™è¨»
                                const infoCard = modalBody.querySelector('.info-card');
                                if (infoCard && infoCard.nextSibling) {
                                    noteContainer = document.createElement('div');
                                    noteContainer.style.cssText = 'background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: left; border-left: 3px solid #667eea;';
                                    modalBody.insertBefore(noteContainer, infoCard.nextSibling);
                                }
                            }
                        }
                        
                        if (noteContainer) {
                            noteContainer.textContent = ''; // æ¸…ç©º
                            const strong = safeCreateElement('strong', 'ğŸ“ å¼•è–¦å‚™è¨»ï¼š', { 
                                style: 'color: #4a5568; font-size: 13px;' 
                            });
                            const noteDiv = safeCreateElement('div', note, { 
                                style: 'color: #2d3748; font-size: 13px; margin-top: 5px; line-height: 1.5;' 
                            });
                            noteContainer.appendChild(strong);
                            noteContainer.appendChild(noteDiv);
                        }
                    } else {
                        // å¦‚æœæ²’æœ‰å‚™è¨»ï¼Œç§»é™¤ç¾æœ‰çš„å‚™è¨»å®¹å™¨
                        const allNoteContainers = confirmDialog.querySelectorAll('div');
                        for (let container of allNoteContainers) {
                            if (container.textContent && container.textContent.includes('å¼•è–¦å‚™è¨»')) {
                                container.remove();
                                break;
                            }
                        }
                    }
                    
                    // ç§»é™¤å¯†ç¢¼è¼¸å…¥æ¡†ï¼ˆå› ç‚ºå·²ç¶“è§£é–ï¼Œä¸éœ€è¦å¯†ç¢¼ï¼‰
                    const passwordInput = confirmDialog.querySelector('#memberPasswordInputPrivacy');
                    if (passwordInput) {
                        const passwordContainer = passwordInput.closest('div[style*="margin: 8px 0"]');
                        if (passwordContainer) {
                            passwordContainer.style.display = 'none';
                        }
                    }
                    
                    // ç§»é™¤æˆå“¡ç·¨è™Ÿè¼¸å…¥æ¡†ï¼ˆå› ç‚ºå·²ç¶“è§£é–ï¼Œä¸éœ€è¦è¨˜éŒ„ï¼‰
                    const memberCodeInput = confirmDialog.querySelector('#memberCodeInput');
                    if (memberCodeInput) {
                        const inputContainer = memberCodeInput.closest('div[style*="margin: 8px 0"]');
                        if (inputContainer) {
                            inputContainer.style.display = 'none';
                        }
                    }
                    
                    // æ›´æ–°æŒ‰éˆ• - æ”¹ç‚ºç›´æ¥é—œé–‰
                    const buttonGroup = confirmDialog.querySelector('.button-group');
                    if (buttonGroup) {
                        buttonGroup.textContent = ''; // æ¸…ç©º
                        const closeBtn = safeCreateElement('button', 'âœ… æˆ‘çŸ¥é“äº†', {
                            class: 'btn-primary',
                            onclick: 'closeContactConfirm()',
                            style: 'background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 12px rgba(40, 167, 69, 0.3); width: 100%;',
                            'aria-label': 'é—œé–‰å°è©±æ¡†'
                        });
                        closeBtn.onclick = closeContactConfirm;
                        buttonGroup.appendChild(closeBtn);
                    }
                    
                    // æ›´æ–°è­¦å‘Šæ–‡å­—
                    const warningText = confirmDialog.querySelector('.warning-text');
                    if (warningText) {
                        warningText.textContent = ''; // æ¸…ç©º
                        const strong = safeCreateElement('strong', 'é‡è¦æé†’ï¼š');
                        const br = document.createElement('br');
                        const text = document.createTextNode('è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼');
                        warningText.appendChild(strong);
                        warningText.appendChild(br);
                        warningText.appendChild(text);
                    }
                }
                
                // åŒæ™‚æ›´æ–°é é¢ä¸Šçš„è¯çµ¡è³‡è¨Šé¡¯ç¤ºï¼ˆæ ¼å¼åŒ–é›»è©±ï¼‰
                if (phone) {
                    updateContactDisplay('phone', phone, serviceItem, referrerCode);
                }
                if (lineId) {
                    updateContactDisplay('lineid', lineId, serviceItem, referrerCode);
                }
            }
        }
        
        // è¨˜éŒ„å·²è§£é–è¯çµ¡è³‡è¨Šçš„ä½¿ç”¨
        async function recordUnlockedContactUsage(phone, lineId, serviceItem, referrerCode) {
            try {
                // ç²å–æˆå“¡ç·¨è™Ÿ
                const memberCodeInput = document.getElementById('memberCodeInput');
                const memberCode = memberCodeInput ? memberCodeInput.value.trim() : '';
                
                // é©—è­‰æˆå“¡ç·¨è™Ÿ
                if (!memberCode) {
                    alert('âš ï¸ è«‹è¼¸å…¥æ‚¨çš„è¯åœ°ç”¢æˆå“¡ç·¨è™Ÿï¼');
                    if (memberCodeInput) {
                        memberCodeInput.focus();
                    }
                    return;
                }
                
                // æå–ç´”æ•¸å­—ç·¨è™Ÿ
                const cleanCode = memberCode.replace(/[^0-9]/g, '');
                
                // å¾æœƒå“¡è³‡æ–™ä¸­æŸ¥æ‰¾å§“å
                const memberData = await loadMemberData();
                const memberInfo = memberData[cleanCode];
                const memberName = memberInfo ? (memberInfo.name || '') : '';
                
                // åˆä½µè¯çµ¡è³‡è¨Šæ ¼å¼ï¼šé›»è©±å’Œ LINE ID æ•´åˆåœ¨ä¸€ç­†è¨˜éŒ„ä¸­
                const formattedPhone = phone ? formatPhoneNumber(phone) : '';
                const contactParts = [];
                if (formattedPhone) contactParts.push(`é›»è©±ï¼š${formattedPhone}`);
                if (lineId) contactParts.push(`LINE IDï¼š${lineId}`);
                const combinedContact = contactParts.join(' | ');
                
                // æº–å‚™ä½¿ç”¨è¨˜éŒ„è³‡æ–™
                const accessInfo = {
                    accessTime: new Date().toISOString(),
                    accessType: 'contact',
                    contactValue: combinedContact,
                    phone: formattedPhone,
                    lineId: lineId || '',
                    serviceItem: serviceItem,
                    referrerCode: referrerCode,
                    memberCode: cleanCode,
                    memberName: memberName,
                    userAgent: navigator.userAgent,
                    timestamp: Date.now()
                };
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
                let accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
                accessLogs.push(accessInfo);
                localStorage.setItem('contactAccessLogs', JSON.stringify(accessLogs));
                
                // æäº¤ä½¿ç”¨è¨˜éŒ„åˆ° Google Sheets
                await handleAccessLogSubmission({
                    accessTime: new Date().toISOString(),
                    accessType: 'contact',
                    contactValue: combinedContact,
                    phone: formattedPhone,  // ç›´æ¥å‚³éé›»è©±è™Ÿç¢¼
                    lineId: lineId || '',   // ç›´æ¥å‚³é LINE ID
                    serviceItem: serviceItem,
                    referrerCode: referrerCode,
                    memberCode: cleanCode,
                    memberName: memberName,
                    userAgent: navigator.userAgent
                });
                
                // é—œé–‰å½ˆçª—
                closeContactConfirm();
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                alert(`âœ… ä½¿ç”¨è¨˜éŒ„å·²è¨˜éŒ„\n\nä½¿ç”¨äººï¼š${cleanCode}${memberName ? ' ' + memberName : ''}\n\nâš ï¸ è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼`);
                
            } catch (error) {
                console.error('è¨˜éŒ„ä½¿ç”¨è³‡è¨Šå¤±æ•—:', error);
                alert('è¨˜éŒ„ä½¿ç”¨è³‡è¨Šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œä½†è¯çµ¡è³‡è¨Šå·²é¡¯ç¤º');
                closeContactConfirm();
            }
        }
        
        // è¨˜éŒ„å·²è§£é–è¯çµ¡è³‡è¨Šçš„ä½¿ç”¨ï¼ˆç”¨æ–¼ showUnlockedContactModal å½ˆçª—ï¼‰ï¼ˆå·²åˆªé™¤ï¼‰
        async function _recordUnlockedContactUsageInModal_removed(phone, lineId, serviceItem, referrerCode) {
            return; // æ­¤å‡½æ•¸å·²åˆªé™¤
            try {
                // ç²å–æˆå“¡ç·¨è™Ÿ
                const memberCodeInput = document.getElementById('memberCodeInputUnlocked');
                const memberCode = memberCodeInput ? memberCodeInput.value.trim() : '';
                
                // é©—è­‰æˆå“¡ç·¨è™Ÿ
                if (!memberCode) {
                    alert('âš ï¸ è«‹è¼¸å…¥æ‚¨çš„è¯åœ°ç”¢æˆå“¡ç·¨è™Ÿï¼');
                    if (memberCodeInput) {
                        memberCodeInput.focus();
                    }
                    return;
                }
                
                // æå–ç´”æ•¸å­—ç·¨è™Ÿ
                const cleanCode = memberCode.replace(/[^0-9]/g, '');
                
                // å¾æœƒå“¡è³‡æ–™ä¸­æŸ¥æ‰¾å§“å
                const memberData = await loadMemberData();
                const memberInfo = memberData[cleanCode];
                const memberName = memberInfo ? (memberInfo.name || '') : '';
                
                // åˆä½µè¯çµ¡è³‡è¨Šæ ¼å¼ï¼šé›»è©±å’Œ LINE ID æ•´åˆåœ¨ä¸€ç­†è¨˜éŒ„ä¸­
                const formattedPhone = phone ? formatPhoneNumber(phone) : '';
                const contactParts = [];
                if (formattedPhone) contactParts.push(`é›»è©±ï¼š${formattedPhone}`);
                if (lineId) contactParts.push(`LINE IDï¼š${lineId}`);
                const combinedContact = contactParts.join(' | ');
                
                // æº–å‚™ä½¿ç”¨è¨˜éŒ„è³‡æ–™
                const accessInfo = {
                    accessTime: new Date().toISOString(),
                    accessType: 'contact',
                    contactValue: combinedContact,
                    phone: formattedPhone,
                    lineId: lineId || '',
                    serviceItem: serviceItem,
                    referrerCode: referrerCode,
                    memberCode: cleanCode,
                    memberName: memberName,
                    userAgent: navigator.userAgent,
                    timestamp: Date.now()
                };
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
                let accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
                accessLogs.push(accessInfo);
                localStorage.setItem('contactAccessLogs', JSON.stringify(accessLogs));
                
                // æäº¤ä½¿ç”¨è¨˜éŒ„åˆ° Google Sheets
                await handleAccessLogSubmission({
                    accessTime: new Date().toISOString(),
                    accessType: 'contact',
                    contactValue: combinedContact,
                    phone: formattedPhone,  // ç›´æ¥å‚³éé›»è©±è™Ÿç¢¼
                    lineId: lineId || '',   // ç›´æ¥å‚³é LINE ID
                    serviceItem: serviceItem,
                    referrerCode: referrerCode,
                    memberCode: cleanCode,
                    memberName: memberName,
                    userAgent: navigator.userAgent
                });
                
            } catch (error) {
                console.error('è¨˜éŒ„ä½¿ç”¨è³‡è¨Šå¤±æ•—:', error);
            }
        }
        
        // æ›´æ–°ç•¶å‰å½ˆçª—é¡¯ç¤ºå®Œæ•´è¯çµ¡è³‡è¨Šï¼ˆä¿ç•™åŸå‡½æ•¸ä»¥å‚™ç”¨ï¼‰
        function updateCurrentModalWithContactInfo(phone, lineId, serviceItem, referrerCode) {
            const confirmContainer = document.querySelector('div[style*="z-index: 3000"]');
            if (confirmContainer) {
                const confirmDialog = confirmContainer.querySelector('div[style*="border-radius: 20px"]');
                if (confirmDialog) {
                    // æ§‹å»ºæ›´æ–°å¾Œçš„å°è©±æ¡† HTMLï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼Œéœ€è¦ä½¿ç”¨å®‰å…¨æ–¹å¼ï¼‰
                    const updatedDialogHTML = `
                        <style>
                            @keyframes fadeIn {
                                from { opacity: 0; }
                                to { opacity: 1; }
                            }
                            @keyframes slideUp {
                                from { transform: translateY(50px); opacity: 0; }
                                to { transform: translateY(0); opacity: 1; }
                            }
                            /* æ»¾è¼ªæ¨£å¼ */
                            .modal-content::-webkit-scrollbar {
                                width: 8px;
                            }
                            .modal-content::-webkit-scrollbar-track {
                                background: #f1f1f1;
                                border-radius: 4px;
                            }
                            .modal-content::-webkit-scrollbar-thumb {
                                background: #667eea;
                                border-radius: 4px;
                            }
                            .modal-content::-webkit-scrollbar-thumb:hover {
                                background: #5a6fd8;
                            }
                            .unlocked-header {
                                background: linear-gradient(135deg, #28a745, #20c997);
                                color: white;
                                padding: 25px 30px;
                                margin: 0;
                            }
                            .unlocked-title {
                                font-size: 22px;
                                font-weight: 700;
                                margin: 0;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                gap: 10px;
                            }
                            .unlocked-body {
                                padding: 30px;
                            }
                            .contact-info-card {
                                background: linear-gradient(135deg, #e8f5e8, #ffffff);
                                border: 2px solid #28a745;
                                border-radius: 15px;
                                padding: 25px;
                                margin: 20px 0;
                                box-shadow: 0 8px 25px rgba(40, 167, 69, 0.1);
                            }
                            .contact-item {
                                display: flex;
                                align-items: center;
                                justify-content: space-between;
                                padding: 15px 20px;
                                margin: 10px 0;
                                background: rgba(255, 255, 255, 0.8);
                                border-radius: 12px;
                                border: 1px solid #d4edda;
                                transition: all 0.3s ease;
                            }
                            .contact-item:hover {
                                background: rgba(255, 255, 255, 1);
                                transform: translateY(-2px);
                                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2);
                            }
                            .contact-left {
                                display: flex;
                                align-items: center;
                                gap: 12px;
                            }
                            .contact-icon {
                                font-size: 24px;
                                width: 40px;
                                height: 40px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                background: linear-gradient(135deg, #28a745, #20c997);
                                border-radius: 50%;
                                color: white;
                            }
                            .contact-label {
                                color: #4a5568;
                                font-weight: 600;
                                font-size: 14px;
                                text-transform: uppercase;
                                letter-spacing: 0.5px;
                            }
                            .contact-value {
                                color: #155724;
                                font-weight: 700;
                                font-size: 18px;
                                font-family: 'Courier New', monospace;
                                background: #f8f9fa;
                                padding: 8px 12px;
                                border-radius: 8px;
                                border: 1px solid #e9ecef;
                            }
                            .warning-card {
                                background: linear-gradient(135deg, #fff3cd, #ffffff);
                                border: 2px solid #ffc107;
                                border-radius: 15px;
                                padding: 20px;
                                margin: 20px 0;
                                box-shadow: 0 8px 25px rgba(255, 193, 7, 0.1);
                            }
                            .warning-icon {
                                font-size: 24px;
                                margin-bottom: 10px;
                            }
                            .warning-text {
                                color: #856404;
                                font-weight: 500;
                                line-height: 1.5;
                            }
                            .close-btn {
                                background: linear-gradient(135deg, #6c757d, #495057);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 12px;
                                font-size: 14px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
                                margin-top: 20px;
                            }
                            .close-btn:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
                            }
                        </style>
                        
                        <div class="unlocked-header">
                            <h3 class="unlocked-title">
                                ğŸ”“ è¯çµ¡è³‡è¨Šå·²è§£é–
                            </h3>
                        </div>
                        
                        <div class="unlocked-body modal-content" style="max-height: calc(80vh - 120px); overflow-y: auto;">
                            <div class="contact-info-card">
                                <div class="contact-item">
                                    <div class="contact-left">
                                        <div class="contact-icon">ğŸ“</div>
                                        <span class="contact-label">è¯çµ¡é›»è©±</span>
                                    </div>
                                    <span class="contact-value">${phone}</span>
                                </div>
                                ${lineId ? `<div class="contact-item">
                                    <div class="contact-left">
                                        <div class="contact-icon">ğŸ’¬</div>
                                        <span class="contact-label">LINE ID</span>
                                    </div>
                                    <span class="contact-value">${lineId}</span>
                                </div>` : ''}
                            </div>
                            
                            <div class="warning-card">
                                <div class="warning-icon">âš ï¸</div>
                                <div class="warning-text">
                                    <strong>é‡è¦æé†’ï¼š</strong><br>
                                    è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼
                                </div>
                            </div>
                            
                            <button class="close-btn" onclick="closeContactConfirm()">
                                âœ… æˆ‘çŸ¥é“äº†
                            </button>
                        </div>
                    `;
                    
                    // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®å°è©±æ¡†å…§å®¹ï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼‰
                    safeSetHTML(confirmDialog, updatedDialogHTML);
                    
                    // åŒæ™‚æ›´æ–°é é¢ä¸Šçš„è¯çµ¡è³‡è¨Šé¡¯ç¤º
                    if (phone) {
                        updateContactDisplay('phone', phone, serviceItem, referrerCode);
                    }
                    if (lineId) {
                        updateContactDisplay('lineid', lineId, serviceItem, referrerCode);
                    }
                }
            }
        }
        
        // é¡¯ç¤ºä½¿ç”¨è¨˜éŒ„ï¼ˆå¾ Google Sheets è®€å–ï¼‰
        async function showAccessLogs() {
            // å‰µå»ºè¨˜éŒ„æŸ¥çœ‹å®¹å™¨
            const logsContainer = document.createElement('div');
            logsContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            const logsDialog = document.createElement('div');
            logsDialog.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                width: 90%;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            // é¡¯ç¤ºè¼‰å…¥ä¸­
            // ä½¿ç”¨å®‰å…¨æ–¹å¼å‰µå»ºè¼‰å…¥ä¸­å…§å®¹
            const loadingHeader = safeCreateElement('div', '', {
                style: 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;'
            });
            const loadingTitle = safeCreateElement('h3', 'ğŸ“‹ è¯çµ¡è³‡è¨Šä½¿ç”¨è¨˜éŒ„', {
                style: 'margin: 0; color: #333;'
            });
            const loadingCloseBtn = safeCreateElement('button', 'Ã—', {
                onclick: 'closeAccessLogs()',
                style: 'background: none; border: none; font-size: 20px; cursor: pointer; color: #666;',
                'aria-label': 'é—œé–‰'
            });
            loadingCloseBtn.onclick = closeAccessLogs;
            loadingHeader.appendChild(loadingTitle);
            loadingHeader.appendChild(loadingCloseBtn);
            
            const loadingDiv = safeCreateElement('div', 'ğŸ”„ æ­£åœ¨è¼‰å…¥ä½¿ç”¨è¨˜éŒ„...', {
                style: 'text-align: center; padding: 40px; color: #666;'
            });
            
            logsDialog.appendChild(loadingHeader);
            logsDialog.appendChild(loadingDiv);
            
            logsContainer.appendChild(logsDialog);
            document.body.appendChild(logsContainer);
            
            // å¾ Google Sheets è®€å–ä½¿ç”¨è¨˜éŒ„ï¼ˆåªè®€å– Google Sheets çš„è³‡æ–™ï¼‰
            let accessLogs = [];
            try {
                const logsResult = await loadAccessLogsFromSheets();
                if (logsResult.success && logsResult.data) {
                    accessLogs = logsResult.data;
                    safeLog.log(`âœ… æˆåŠŸå¾ Google Sheets è®€å– ${accessLogs.length} ç­†ä½¿ç”¨è¨˜éŒ„`);
                } else {
                    safeLog.warn('âš ï¸ å¾ Google Sheets è®€å–ä½¿ç”¨è¨˜éŒ„å¤±æ•—');
                    accessLogs = [];
                }
            } catch (error) {
                console.error('è¼‰å…¥ä½¿ç”¨è¨˜éŒ„å¤±æ•—:', error);
                accessLogs = [];
            }
            
            // æ›´æ–°é¡¯ç¤ºå…§å®¹
            let logsHTML = `
                <style>
                    .logs-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 20px;
                        padding-bottom: 15px;
                        border-bottom: 2px solid #e9ecef;
                    }
                    .logs-title {
                        margin: 0;
                        color: #333;
                        font-size: 20px;
                        font-weight: 700;
                    }
                    .logs-actions {
                        display: flex;
                        gap: 10px;
                        align-items: center;
                    }
                    .refresh-btn {
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 8px;
                        font-size: 13px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                    }
                    .refresh-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
                    }
                    .refresh-btn:active {
                        transform: translateY(0);
                    }
                    .close-log-btn {
                        background: none;
                        border: none;
                        font-size: 24px;
                        cursor: pointer;
                        color: #666;
                        width: 32px;
                        height: 32px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    }
                    .close-log-btn:hover {
                        background: #f1f3f4;
                        color: #333;
                    }
                    .logs-stats {
                        margin-bottom: 15px;
                        padding: 12px;
                        background: linear-gradient(135deg, #f8f9ff, #ffffff);
                        border-radius: 8px;
                        border-left: 4px solid #667eea;
                        color: #666;
                        font-weight: 600;
                    }
                </style>
                <div class="logs-header">
                    <h3 class="logs-title">ğŸ“‹ è¯çµ¡è³‡è¨Šä½¿ç”¨è¨˜éŒ„</h3>
                    <div class="logs-actions">
                        <button class="refresh-btn" onclick="refreshAccessLogs()" title="é‡æ–°è¼‰å…¥è¨˜éŒ„">
                            ğŸ”„ é‡æ–°è¼‰å…¥
                        </button>
                        <button class="close-log-btn" onclick="closeAccessLogs()" title="é—œé–‰">Ã—</button>
                    </div>
                </div>
                <div class="logs-stats">
                    ç¸½å…± ${accessLogs.length} ç­†ä½¿ç”¨è¨˜éŒ„
                </div>
            `;
            
            if (accessLogs.length > 0) {
                logsHTML += '<div style="max-height: 400px; overflow-y: auto;">';
                accessLogs.reverse().forEach((log, index) => {
                    // è™•ç†æ™‚é–“æ ¼å¼ï¼ˆå¯èƒ½æ˜¯å­—ä¸²æˆ– ISO æ ¼å¼ï¼‰
                    let accessTime;
                    try {
                        if (log.accessTime) {
                            accessTime = new Date(log.accessTime).toLocaleString('zh-TW');
                        } else {
                            accessTime = 'æœªçŸ¥æ™‚é–“';
                        }
                    } catch (e) {
                        accessTime = log.accessTime || 'æœªçŸ¥æ™‚é–“';
                    }
                    // å¾è¨˜éŒ„ä¸­ç²å– phone å’Œ lineIdï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                    const phone = log.phone || '';
                    const lineId = log.lineId || '';
                    const hasContactInfo = phone || lineId || log.contactValue;
                    const logIndex = accessLogs.length - index - 1; // ç”¨æ–¼è§£é–æ™‚å‚³éæ­£ç¢ºçš„ç´¢å¼•
                    
                    logsHTML += `
                        <div style="background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #667eea;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <strong style="color: #333;">è¨˜éŒ„ #${accessLogs.length - index}</strong>
                                <span style="font-size: 12px; color: #666;">${accessTime}</span>
                            </div>
                            <div style="font-size: 14px; color: #666;">
                                <strong>æœå‹™é …ç›®ï¼š</strong>${log.serviceItem}<br>
                                <strong>å¼•è–¦äººï¼š</strong>${log.referrerCode}<br>
                                <strong>æŸ¥çœ‹é¡å‹ï¼š</strong>${
                                    log.accessType === 'phone' ? 'é›»è©±' : 
                                    log.accessType === 'lineid' ? 'LINE ID' : 
                                    log.accessType === 'contact' ? 'è¯çµ¡è³‡è¨Š' : 
                                    'è¯çµ¡è³‡è¨Š'
                                }<br>
                                ${log.memberCode ? `<strong>æˆå“¡ç·¨è™Ÿï¼š</strong>${log.memberCode}${log.memberName ? ` (${log.memberName})` : ''}<br>` : ''}
                                <strong>ç€è¦½å™¨ï¼š</strong>${log.userAgent ? log.userAgent.substring(0, 50) + '...' : 'æœªçŸ¥'}
                            </div>
                            ${hasContactInfo ? `
                                <div style="margin-top: 10px; text-align: center;">
                                    <button onclick="unlockContactFromLog(${logIndex})" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.3s ease;">
                                        ğŸ”“ è§£é–æŸ¥çœ‹è¯çµ¡è³‡è¨Š
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                logsHTML += '</div>';
            } else {
                logsHTML += '<div style="text-align: center; color: #666; padding: 40px;">æš«ç„¡ä½¿ç”¨è¨˜éŒ„</div>';
            }
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®æ—¥èªŒå…§å®¹
            safeSetHTML(logsDialog, logsHTML);
            logsContainer.appendChild(logsDialog);
            document.body.appendChild(logsContainer);
        }
        
        // é—œé–‰ä½¿ç”¨è¨˜éŒ„
        function closeAccessLogs() {
            const logsContainer = document.querySelector('div[style*="z-index: 2000"]');
            if (logsContainer) {
                logsContainer.remove();
            }
        }
        
        // é‡æ–°è¼‰å…¥ä½¿ç”¨è¨˜éŒ„
        async function refreshAccessLogs() {
            const refreshBtn = document.querySelector('.refresh-btn');
            const logsDialog = document.querySelector('div[style*="max-width: 800px"]');
            
            if (!refreshBtn || !logsDialog) return;
            
            const originalText = refreshBtn.innerHTML;
            refreshBtn.textContent = 'ğŸ”„ è¼‰å…¥ä¸­...';
            refreshBtn.setAttribute('aria-busy', 'true');
            refreshBtn.disabled = true;
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            const statsDiv = logsDialog.querySelector('.logs-stats');
            const logsContainer = logsDialog.querySelector('div[style*="max-height: 400px"]') || 
                                  logsDialog.querySelector('div[style*="text-align: center"]');
            
            if (statsDiv) {
                statsDiv.textContent = 'ğŸ”„ æ­£åœ¨é‡æ–°è¼‰å…¥ä½¿ç”¨è¨˜éŒ„...';
            }
            
            try {
                // å¾ Google Sheets é‡æ–°è®€å–ä½¿ç”¨è¨˜éŒ„
                const logsResult = await loadAccessLogsFromSheets();
                const accessLogs = (logsResult.success && logsResult.data) ? logsResult.data : [];
                
                safeLog.log(`âœ… æˆåŠŸé‡æ–°è¼‰å…¥ ${accessLogs.length} ç­†ä½¿ç”¨è¨˜éŒ„`);
                
                // æ›´æ–°çµ±è¨ˆè³‡è¨Š
                if (statsDiv) {
                    statsDiv.textContent = `ç¸½å…± ${accessLogs.length} ç­†ä½¿ç”¨è¨˜éŒ„`;
                }
                
                // æ›´æ–°è¨˜éŒ„åˆ—è¡¨
                if (logsContainer) {
                    if (accessLogs.length > 0) {
                        let logsHTML = '<div style="max-height: 400px; overflow-y: auto;">';
                        accessLogs.reverse().forEach((log, index) => {
                            let accessTime;
                            try {
                                accessTime = log.accessTime ? new Date(log.accessTime).toLocaleString('zh-TW') : 'æœªçŸ¥æ™‚é–“';
                            } catch (e) {
                                accessTime = log.accessTime || 'æœªçŸ¥æ™‚é–“';
                            }
                            
                            const phone = log.phone || '';
                            const lineId = log.lineId || '';
                            const hasContactInfo = phone || lineId || log.contactValue;
                            const logIndex = accessLogs.length - index - 1;
                            
                            logsHTML += `
                                <div style="background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #667eea;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                        <strong style="color: #333;">è¨˜éŒ„ #${accessLogs.length - index}</strong>
                                        <span style="font-size: 12px; color: #666;">${accessTime}</span>
                                    </div>
                                    <div style="font-size: 14px; color: #666;">
                                        <strong>æœå‹™é …ç›®ï¼š</strong>${log.serviceItem || 'æœªçŸ¥'}<br>
                                        <strong>å¼•è–¦äººï¼š</strong>${log.referrerCode || 'æœªçŸ¥'}<br>
                                        <strong>æŸ¥çœ‹é¡å‹ï¼š</strong>${
                                            log.accessType === 'phone' ? 'é›»è©±' : 
                                            log.accessType === 'lineid' ? 'LINE ID' : 
                                            log.accessType === 'contact' ? 'è¯çµ¡è³‡è¨Š' : 
                                            'è¯çµ¡è³‡è¨Š'
                                        }<br>
                                        ${log.memberCode ? `<strong>æˆå“¡ç·¨è™Ÿï¼š</strong>${log.memberCode}${log.memberName ? ` (${log.memberName})` : ''}<br>` : ''}
                                        <strong>ç€è¦½å™¨ï¼š</strong>${log.userAgent ? log.userAgent.substring(0, 50) + '...' : 'æœªçŸ¥'}
                                    </div>
                                    ${hasContactInfo ? `
                                        <div style="margin-top: 10px; text-align: center;">
                                            <button onclick="unlockContactFromLog(${logIndex})" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.3s ease;">
                                                ğŸ”“ è§£é–æŸ¥çœ‹è¯çµ¡è³‡è¨Š
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        logsHTML += '</div>';
                        logsContainer.outerHTML = logsHTML;
                    } else {
                        logsContainer.outerHTML = '<div style="text-align: center; color: #666; padding: 40px;">æš«ç„¡ä½¿ç”¨è¨˜éŒ„</div>';
                    }
                }
                
            } catch (error) {
                console.error('é‡æ–°è¼‰å…¥ä½¿ç”¨è¨˜éŒ„å¤±æ•—:', error);
                if (statsDiv) {
                    statsDiv.textContent = 'âŒ è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
                    statsDiv.className = 'error-message';
                    statsDiv.setAttribute('role', 'alert');
                }
            } finally {
                refreshBtn.textContent = originalText;
                refreshBtn.setAttribute('aria-busy', 'false');
                refreshBtn.disabled = false;
            }
        }
        
        // å¾è¨˜éŒ„è§£é–è¯çµ¡è³‡è¨Š
        async function unlockContactFromLog(logIndex) {
            try {
                const accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
                const reversedLogs = [...accessLogs].reverse();
                const log = reversedLogs[logIndex];
                
                if (!log) {
                    alert('æ‰¾ä¸åˆ°è©²ç­†è¨˜éŒ„');
                    return;
                }
                
                // ç²å–è¨˜éŒ„ä¸­çš„è¯çµ¡è³‡è¨Š
                let phone = log.phone || '';
                let lineId = log.lineId || '';
                const serviceItem = log.serviceItem || '';
                const referrerCode = log.referrerCode || '';
                
                // å¦‚æœæ²’æœ‰ç›´æ¥ä¿å­˜ phone/lineIdï¼Œå˜—è©¦å¾ contactValue è§£æ
                if (!phone && !lineId && log.contactValue) {
                    const contactValue = log.contactValue;
                    // è§£ææ ¼å¼ï¼šé›»è©±ï¼šxxx | LINE IDï¼šyyy æˆ– é›»è©±ï¼šxxx LINE IDï¼šyyy
                    const phoneMatch = contactValue.match(/é›»è©±[ï¼š:]\s*([^|]+?)(?:\s*\||$)/);
                    const lineIdMatch = contactValue.match(/LINE\s*ID[ï¼š:]\s*([^|]+?)(?:\s*\||$)/);
                    if (phoneMatch) phone = phoneMatch[1].trim();
                    if (lineIdMatch) lineId = lineIdMatch[1].trim();
                    
                    // å¦‚æœé‚„æ˜¯æ²’æœ‰è§£æåˆ°ï¼Œå˜—è©¦ç°¡å–®çš„å­—ä¸²åŒ¹é…ï¼ˆé©ç”¨æ–¼åªæœ‰é›»è©±æˆ–åªæœ‰ LINE ID çš„æƒ…æ³ï¼‰
                    if (!phone && !lineId) {
                        // å¦‚æœ contactValue çœ‹èµ·ä¾†åƒæ˜¯é›»è©±è™Ÿç¢¼
                        if (/^[\d\-()+\s]+$/.test(contactValue.trim())) {
                            phone = contactValue.trim();
                        } else {
                            // å¦å‰‡ç•¶ä½œ LINE ID
                            lineId = contactValue.trim();
                        }
                    }
                }
                
                if (!phone && !lineId) {
                    alert('è©²è¨˜éŒ„ä¸­æ²’æœ‰è¯çµ¡è³‡è¨Š');
                    return;
                }
                
                // é—œé–‰ä½¿ç”¨è¨˜éŒ„å½ˆçª—
                closeAccessLogs();
                
                // é‡æ–°è§¸ç™¼å®Œæ•´çš„æŸ¥çœ‹è¯çµ¡è³‡è¨Šæµç¨‹ï¼ˆåŒ…å«éš±ç§ä¿è­·ç¢ºèªï¼‰
                // æˆå“¡ç·¨è™Ÿè¼¸å…¥æ¡†ä¿æŒæ¸…ç©ºï¼Œæ–¹ä¾¿ä¸åŒçš„äººå¡«å¯«è‡ªå·±çš„ç·¨è™Ÿ
                if (phone && lineId) {
                    // å¦‚æœæœ‰é›»è©±å’Œ LINE IDï¼Œä½¿ç”¨å®Œæ•´çš„æŸ¥çœ‹åŠŸèƒ½
                    showAllContactDetails(phone, lineId, serviceItem, referrerCode);
                } else if (phone) {
                    // åªæœ‰é›»è©± - é¡¯ç¤ºéš±ç§ä¿è­·ç¢ºèªå½ˆçª—
                    showContactDetails('phone', phone, serviceItem, referrerCode);
                } else if (lineId) {
                    // åªæœ‰ LINE ID - é¡¯ç¤ºéš±ç§ä¿è­·ç¢ºèªå½ˆçª—
                    showContactDetails('lineid', lineId, serviceItem, referrerCode);
                }
                
            } catch (error) {
                console.error('è§£é–è¯çµ¡è³‡è¨Šå¤±æ•—:', error);
                alert('è§£é–å¤±æ•—ï¼š' + error.message);
            }
        }
        
        // å¿«é€Ÿè§£é–è¯çµ¡è³‡è¨Šï¼ˆç”¨æ–¼åªæœ‰é›»è©±æˆ–åªæœ‰ LINE ID çš„æƒ…æ³ï¼‰
        async function quickUnlockContact(type, value, serviceItem, referrerCode, memberCode) {
            try {
                // å¦‚æœæ˜¯é›»è©±è™Ÿç¢¼ï¼Œå…ˆæ ¼å¼åŒ–
                const formattedValue = type === 'phone' ? formatPhoneNumber(value) : value;
                
                // è¨˜éŒ„ä½¿ç”¨è³‡è¨Š
                const userInfo = {
                    accessTime: new Date().toISOString(),
                    accessType: type,
                    contactValue: formattedValue,
                    phone: type === 'phone' ? formattedValue : '',
                    lineId: type === 'lineid' ? formattedValue : '',
                    serviceItem: serviceItem,
                    referrerCode: referrerCode,
                    memberCode: memberCode,
                    userAgent: navigator.userAgent,
                    timestamp: Date.now()
                };
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
                let accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
                accessLogs.push(userInfo);
                localStorage.setItem('contactAccessLogs', JSON.stringify(accessLogs));
                
                // æäº¤åˆ° Google Sheets
                await handleAccessLogSubmission(userInfo);
                
                // é¡¯ç¤ºè¯çµ¡è³‡è¨Š
                const typeText = type === 'phone' ? 'é›»è©±' : 'LINE ID';
                alert(`${typeText}ï¼š${value}\n\nâœ… ä½¿ç”¨è¨˜éŒ„å·²è¨˜éŒ„\n\nâš ï¸ è«‹è¨˜å¾—è‡³ BNI ç³»çµ± KEY å¼•è–¦å°è±¡ï¼`);
                
            } catch (error) {
                console.error('å¿«é€Ÿè§£é–å¤±æ•—:', error);
                alert('è§£é–å¤±æ•—ï¼š' + error.message);
            }
        }
        
        // åŒ¯å‡ºä½¿ç”¨è¨˜éŒ„
        function exportAccessLogs() {
            const accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
            
            // ç¢ºå®šæŸ¥çœ‹é¡å‹é¡¯ç¤ºæ–‡å­—
            const getAccessTypeText = (accessType) => {
                if (accessType === 'phone') return 'é›»è©±';
                if (accessType === 'lineid') return 'LINE ID';
                if (accessType === 'contact') return 'è¯çµ¡è³‡è¨Š';
                return 'è¯çµ¡è³‡è¨Š';
            };
            
            const csvContent = [
                'æ™‚é–“,æœå‹™é …ç›®,å¼•è–¦äºº,æˆå“¡ç·¨è™Ÿ,æŸ¥çœ‹é¡å‹,è¯çµ¡è³‡è¨Š,ç€è¦½å™¨è³‡è¨Š',
                ...accessLogs.map(log => 
                    `${new Date(log.accessTime).toLocaleString('zh-TW')},"${log.serviceItem}","${log.referrerCode}","${log.memberCode || ''}","${getAccessTypeText(log.accessType)}","${log.contactValue}","${log.userAgent || ''}"`
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è¯çµ¡è³‡è¨Šä½¿ç”¨è¨˜éŒ„_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // æ¸…é™¤ä½¿ç”¨è¨˜éŒ„
        function clearAccessLogs() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ä½¿ç”¨è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                localStorage.removeItem('contactAccessLogs');
                alert('ä½¿ç”¨è¨˜éŒ„å·²æ¸…é™¤');
                closeAccessLogs();
            }
        }
        
        // Google Sheets API æ•´åˆåŠŸèƒ½
        async function submitToGoogleSheets(data, sheetType) {
            try {
                // å„ªå…ˆä½¿ç”¨ Apps Script Web App
                if (SHEET_CONFIG.APPS_SCRIPT_URL && SHEET_CONFIG.APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL') {
                    return await submitToAppsScript(data, sheetType);
                }
                
                // å‚™ç”¨ï¼šä½¿ç”¨å‚³çµ± Google Sheets API
                const sheetId = getSheetId(sheetType);
                if (!sheetId || sheetId === 'YOUR_VENDOR_SHEET_ID') {
                    safeLog.warn('Google Sheets æœªè¨­å®šï¼Œè³‡æ–™åƒ…å„²å­˜åœ¨æœ¬åœ°');
                    return false;
                }
                
                // æ ¹æ“šè³‡æ–™é¡å‹é¸æ“‡å·¥ä½œè¡¨åç¨±
                const sheetName = sheetType === 'referral' ? 'å¼•è–¦ç™»è¨˜' : 'ä½¿ç”¨è¨˜éŒ„';
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}:append?valueInputOption=RAW&key=${SHEET_CONFIG.API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        values: [data]
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    safeLog.log(`${sheetType} è³‡æ–™å·²æˆåŠŸæäº¤åˆ° Google Sheets`);
                    return true;
                } else {
                    const errorText = await response.text();
                    console.error(`Google Sheets API éŒ¯èª¤è©³æƒ…:`, errorText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                }
            } catch (error) {
                console.error(`æäº¤åˆ° Google Sheets å¤±æ•—:`, error);
                return false;
            }
        }
        
        // ä½¿ç”¨ Apps Script Web App æäº¤è³‡æ–™
        async function submitToAppsScript(data, sheetType) {
            try {
                safeLog.log(`ğŸš€ é–‹å§‹æäº¤ ${sheetType} è³‡æ–™åˆ° Apps Script...`);
                safeLog.log('ğŸ“‹ åŸå§‹è³‡æ–™:', data);
                
                const actionMap = {
                    'referral': 'addReferral', 
                    'access_log': 'addAccessLog'
                };
                
                const action = actionMap[sheetType];
                if (!action) {
                    throw new Error(`æœªçŸ¥çš„è³‡æ–™é¡å‹: ${sheetType}`);
                }
                
                // æº–å‚™æäº¤è³‡æ–™
                let requestData;
                switch (sheetType) {
                    case 'referral':
                        requestData = {
                            action: 'addReferral',
                            referralData: {
                                serviceItem: data[1],      // è¢«å¼•è–¦æœå‹™é …ç›®
                                referrerCode: data[2],     // å¼•è–¦äººï¼ˆæœƒå“¡ç·¨è™Ÿï¼‰
                                companyName: data[3],      // è¢«å¼•è–¦å» å•†åç¨±
                                phone: data[4],            // å» å•†è¯çµ¡é›»è©±
                                lineId: data[5],           // å» å•†LINE ID
                                area: data[6],             // å» å•†æœå‹™å€åŸŸ
                                note: data[7]              // å¼•è–¦å‚™è¨»
                            }
                        };
                        break;
                    case 'access_log':
                        // åˆ¤æ–· accessTypeï¼ˆæ³¨æ„ï¼šç¾åœ¨æ¬„ä½ç´¢å¼•å·²èª¿æ•´ï¼‰
                        // æ¬„ä½é †åºï¼šæ™‚é–“ã€æœå‹™é …ç›®ã€å¼•è–¦äººã€æˆå“¡ç·¨è™Ÿã€æˆå“¡å§“åã€å» å•†åç¨±ã€æŸ¥çœ‹é¡å‹ã€è¯çµ¡è³‡è¨Šã€ç€è¦½å™¨è³‡è¨Š
                        let accessType = 'contact';
                        const accessTypeIndex = 6; // æŸ¥çœ‹é¡å‹åœ¨ç¬¬7æ¬„ï¼ˆç´¢å¼•6ï¼‰
                        if (data[accessTypeIndex] === 'é›»è©±') {
                            accessType = 'phone';
                        } else if (data[accessTypeIndex] === 'LINE ID') {
                            accessType = 'lineid';
                        } else if (data[accessTypeIndex] === 'è¯çµ¡è³‡è¨Š') {
                            accessType = 'contact';
                        }
                        
                        requestData = {
                            action: 'addAccessLog',
                            accessData: {
                                accessTime: data[0],
                                serviceItem: data[1],
                                referrerCode: data[2],
                                memberCode: data[3] || '',     // Dæ¬„ï¼šæˆå“¡ç·¨è™Ÿ
                                memberName: data[4] || '',     // Eæ¬„ï¼šæˆå“¡å§“å
                                companyName: data[5] || '',    // Fæ¬„ï¼šå» å•†åç¨±
                                accessType: accessType,
                                contactValue: data[7] || '',   // è¯çµ¡è³‡è¨Šï¼ˆæ¬„ä½ç´¢å¼•èª¿æ•´ï¼‰
                                userAgent: data[8] || ''       // ç€è¦½å™¨è³‡è¨Šï¼ˆæ¬„ä½ç´¢å¼•èª¿æ•´ï¼‰
                            }
                        };
                        break;
                }
                
                safeLog.log('ğŸ“¦ æº–å‚™æäº¤çš„è«‹æ±‚è³‡æ–™:', requestData);
                safeLog.log('ğŸ”— Apps Script URL:', SHEET_CONFIG.APPS_SCRIPT_URL);
                
                // æª¢æŸ¥ URL æ˜¯å¦æœ‰æ•ˆ
                if (!SHEET_CONFIG.APPS_SCRIPT_URL || SHEET_CONFIG.APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL') {
                    safeLog.warn('âš ï¸ Apps Script URL æœªé…ç½®ï¼Œå°‡ä½¿ç”¨æœ¬åœ°å„²å­˜');
                    return false;
                }
                
                // å˜—è©¦ä½¿ç”¨ fetch APIï¼ˆå…ˆå˜—è©¦ç°¡å–®è«‹æ±‚ï¼Œé¿å… CORS é æª¢ï¼‰
                try {
                    safeLog.log('ğŸ“¡ ç™¼é€ POST è«‹æ±‚åˆ° Apps Script...');
                    
                    // æ–¹æ³•1ï¼šå˜—è©¦ä½¿ç”¨ application/x-www-form-urlencodedï¼ˆç°¡å–®è«‹æ±‚ï¼Œä¸è§¸ç™¼é æª¢ï¼‰
                    try {
                        const formData = new URLSearchParams();
                        formData.append('data', JSON.stringify(requestData));
                        
                        const response = await fetch(SHEET_CONFIG.APPS_SCRIPT_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: formData.toString()
                        });
                        
                        safeLog.log('ğŸ“¨ å›æ‡‰ç‹€æ…‹:', response.status, response.statusText);
                        
                        if (response.ok) {
                            const result = await response.json();
                            safeLog.log(`âœ… ${sheetType} è³‡æ–™å·²æˆåŠŸæäº¤åˆ° Apps Script`);
                            return true;
                        } else {
                            const errorText = await response.text();
                            console.error(`âŒ Apps Script å›æ‡‰éŒ¯èª¤:`, errorText);
                            throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                        }
                    } catch (formFetchError) {
                        // å¦‚æœè¡¨å–®æ ¼å¼ä¹Ÿå¤±æ•—ï¼Œå˜—è©¦ JSONï¼ˆå¯èƒ½æœƒè§¸ç™¼ CORSï¼‰
                        safeLog.log('âš ï¸ application/x-www-form-urlencoded å¤±æ•—ï¼Œå˜—è©¦ JSON æ ¼å¼...');
                        const response = await fetch(SHEET_CONFIG.APPS_SCRIPT_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(requestData)
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            safeLog.log(`âœ… ${sheetType} è³‡æ–™å·²æˆåŠŸæäº¤åˆ° Apps Script`);
                            return true;
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    }
                } catch (fetchError) {
                    safeLog.warn('âš ï¸ Fetch API å¤±æ•—ï¼Œæ”¹ç”¨è¡¨å–®æäº¤æ–¹å¼:', fetchError.message);
                    console.error('Fetch éŒ¯èª¤è©³æƒ…:', fetchError);
                    return submitWithForm(requestData, sheetType);
                }
            } catch (error) {
                console.error(`âŒ æäº¤åˆ° Apps Script å¤±æ•—:`, error);
                console.error('éŒ¯èª¤å †ç–Š:', error.stack);
                return false;
            }
        }
        
        // ä½¿ç”¨è¡¨å–®æäº¤æ–¹å¼ï¼ˆé¿å…CORSå•é¡Œï¼‰
        function submitWithForm(requestData, sheetType) {
            try {
                safeLog.log(`ğŸ“ ä½¿ç”¨è¡¨å–®æäº¤ ${sheetType} è³‡æ–™...`);
                safeLog.log('ğŸ“¦ è¡¨å–®æäº¤çš„è³‡æ–™:', requestData);
                
                // æ–¹æ³•1ï¼šå˜—è©¦ä½¿ç”¨éš±è—iframe
                try {
                    safeLog.log('ğŸ”² å‰µå»ºéš±è— iframe...');
                    const iframe = document.createElement('iframe');
                    iframe.name = 'hiddenSubmitFrame_' + Date.now();
                    iframe.style.display = 'none';
                    iframe.style.width = '0';
                    iframe.style.height = '0';
                    iframe.style.border = 'none';
                    document.body.appendChild(iframe);
                    
                    safeLog.log('ğŸ“ å‰µå»ºè¡¨å–®...');
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = SHEET_CONFIG.APPS_SCRIPT_URL;
                    form.target = iframe.name;
                    form.style.display = 'none';
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'data';
                    input.value = JSON.stringify(requestData);
                    
                    form.appendChild(input);
                    document.body.appendChild(form);
                    
                    safeLog.log('ğŸš€ æäº¤è¡¨å–®åˆ°:', SHEET_CONFIG.APPS_SCRIPT_URL);
                    
                    // ç›£è½ iframe è¼‰å…¥å®Œæˆï¼ˆä½†å¯èƒ½å› ç‚ºCORSä¸æœƒè§¸ç™¼ï¼‰
                    iframe.onload = function() {
                        safeLog.log('âœ… iframe å·²è¼‰å…¥ï¼Œè¡¨å–®æäº¤å¯èƒ½æˆåŠŸ');
                        safeLog.log('iframe src:', iframe.src);
                    };
                    
                    // ç›£è½ iframe éŒ¯èª¤
                    iframe.onerror = function(error) {
                        safeLog.warn('âš ï¸ iframe è¼‰å…¥éŒ¯èª¤:', error);
                    };
                    
                    // æäº¤è¡¨å–®
                    form.submit();
                    
                    // æ¸…ç†DOMå…ƒç´ ï¼ˆå»¶é²æ¸…ç†ä»¥ç¢ºä¿æäº¤å®Œæˆï¼‰
                    setTimeout(() => {
                        try {
                            if (document.body.contains(form)) {
                                document.body.removeChild(form);
                            }
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        } catch (cleanupError) {
                            safeLog.warn('æ¸…ç†DOMå…ƒç´ æ™‚ç™¼ç”ŸéŒ¯èª¤:', cleanupError);
                        }
                    }, 2000);
                    
                    safeLog.log(`âœ… ${sheetType} è³‡æ–™å·²é€šéiframeè¡¨å–®æäº¤`);
                    safeLog.log('ğŸ“Š è«‹åœ¨ Google Sheets ä¸­æª¢æŸ¥è³‡æ–™æ˜¯å¦å·²æˆåŠŸå¯«å…¥');
                    return true;
                } catch (iframeError) {
                    safeLog.warn('âš ï¸ iframeæäº¤å¤±æ•—ï¼Œå˜—è©¦ç›´æ¥è¡¨å–®æäº¤:', iframeError);
                    
                    // æ–¹æ³•2ï¼šåœ¨éš±è— iframe ä¸­æäº¤ï¼ˆä¸æœƒè·³å‡ºï¼‰
                    const iframe = document.createElement('iframe');
                    iframe.name = 'hidden_' + Date.now();
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);
                    
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = SHEET_CONFIG.APPS_SCRIPT_URL;
                    form.target = iframe.name;
                    form.style.display = 'none';
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'data';
                    input.value = JSON.stringify(requestData);
                    
                    form.appendChild(input);
                    document.body.appendChild(form);
                    form.submit();
                    
                    // æ¸…ç†è¡¨å–®å’Œ iframe
                    setTimeout(() => {
                        try {
                            if (document.body.contains(form)) {
                                document.body.removeChild(form);
                            }
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        } catch (cleanupError) {
                            safeLog.warn('æ¸…ç†è¡¨å–®æ™‚ç™¼ç”ŸéŒ¯èª¤:', cleanupError);
                        }
                    }, 1000);
                    
                    safeLog.log(`âœ… ${sheetType} è³‡æ–™å·²é€šééš±è— iframe æäº¤ï¼ˆä¸æœƒè·³å‡ºï¼‰`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ è¡¨å–®æäº¤å¤±æ•—:`, error);
                return false;
            }
        }
        
        // ç²å–å·¥ä½œè¡¨ID
        function getSheetId(sheetType) {
            switch (sheetType) {
                case 'referral':
                    return SHEET_CONFIG.REFERRAL_SHEET_ID;
                case 'access_log':
                    return SHEET_CONFIG.ACCESS_LOG_SHEET_ID;
                default:
                    return null;
            }
        }
        
        
        // è™•ç†å¼•è–¦ç™»è¨˜æäº¤
        async function handleReferralRegistration(formData) {
            try {
                safeLog.log('ğŸ“ é–‹å§‹è™•ç†å¼•è–¦ç™»è¨˜ï¼Œè¡¨å–®è³‡æ–™:', formData);
                
                // è³‡æ–™é©—è­‰
                if (!validateReferralData(formData)) {
                    safeLog.error('âŒ è³‡æ–™é©—è­‰å¤±æ•—');
                    return false;
                }
                safeLog.log('âœ… è³‡æ–™é©—è­‰é€šé');
                
                // æº–å‚™æäº¤è³‡æ–™ - ä¿®æ­£æ¬„ä½å°æ‡‰
                // æ ¼å¼åŒ–é›»è©±è™Ÿç¢¼ï¼ˆä¸è¶³10ç¢¼å‰é¢è£œ0ï¼‰
                const formattedPhone = formatPhoneNumber(formData.companyPhone);
                
                const referralData = [
                    new Date().toISOString(),                    // å¼•è–¦æ—¥æœŸ
                    formData.referredService || '',              // è¢«å¼•è–¦æœå‹™é …ç›®
                    formData.referrerCode || '',                 // å¼•è–¦äººï¼ˆæœƒå“¡ç·¨è™Ÿï¼‰
                    formData.referredCompany || '',              // è¢«å¼•è–¦å» å•†åç¨±
                    `'${formattedPhone}`,                        // å» å•†è¯çµ¡é›»è©±ï¼ˆåŠ å–®å¼•è™Ÿç¢ºä¿ä»¥æ–‡å­—æ ¼å¼ä¿å­˜ï¼‰
                    formData.companyLineId || '',                // å» å•†LINE ID
                    formData.companyArea || '',                  // å» å•†æœå‹™å€åŸŸ
                    formData.referralNote || ''                  // å¼•è–¦å‚™è¨»
                ];
                
                safeLog.log('ğŸ“¤ æº–å‚™æäº¤çš„å¼•è–¦è³‡æ–™:', referralData);
                safeLog.log('ğŸ”— Apps Script URL:', SHEET_CONFIG.APPS_SCRIPT_URL);
                
                // æäº¤åˆ° Google Sheets
                const success = await submitToGoogleSheets(referralData, 'referral');
                
                if (success) {
                    safeLog.log('âœ… å¼•è–¦è³‡æ–™å·²æˆåŠŸæäº¤åˆ° Google Sheets');
                    return true;
                } else {
                    console.error('âŒ å¼•è–¦è³‡æ–™æäº¤å¤±æ•—');
                    return false;
                }
            } catch (error) {
                console.error('âŒ å¼•è–¦ç™»è¨˜è™•ç†å¤±æ•—:', error);
                console.error('éŒ¯èª¤è©³æƒ…:', error.stack);
                alert('å¼•è–¦ç™»è¨˜å¤±æ•—ï¼š' + error.message);
                return false;
            }
        }
        
        // è™•ç†ä½¿ç”¨è¨˜éŒ„æäº¤
        async function handleAccessLogSubmission(accessData) {
            try {
                safeLog.log('é–‹å§‹æäº¤ä½¿ç”¨è¨˜éŒ„:', accessData);
                
                // ç¢ºå®šæŸ¥çœ‹é¡å‹é¡¯ç¤ºæ–‡å­—
                let accessTypeText = 'è¯çµ¡è³‡è¨Š';
                if (accessData.accessType === 'phone') {
                    accessTypeText = 'é›»è©±';
                } else if (accessData.accessType === 'lineid') {
                    accessTypeText = 'LINE ID';
                } else if (accessData.accessType === 'contact') {
                    accessTypeText = 'è¯çµ¡è³‡è¨Š';
                }
                
                // æº–å‚™æäº¤è³‡æ–™ï¼ˆæ·»åŠ æˆå“¡ç·¨è™Ÿã€æˆå“¡å§“åå’Œå» å•†åç¨±æ¬„ä½ï¼‰
                // å» å•†åç¨±å„ªå…ˆä½¿ç”¨å‰ç«¯å‚³å…¥çš„ï¼Œå¦‚æœæ²’æœ‰å‰‡åœ¨ Apps Script ä¸­æŸ¥è©¢
                const logData = [
                    new Date(accessData.accessTime).toLocaleString('zh-TW'),
                    accessData.serviceItem || '',
                    accessData.referrerCode || '',
                    accessData.memberCode || '',      // Dæ¬„ï¼šæˆå“¡ç·¨è™Ÿ
                    accessData.memberName || '',      // Eæ¬„ï¼šæˆå“¡å§“åï¼ˆå¾å‰ç«¯å‚³å…¥ï¼‰
                    accessData.companyName || '',     // Fæ¬„ï¼šå» å•†åç¨±ï¼ˆå¾å‰ç«¯å‚³å…¥ï¼‰
                    accessTypeText,
                    accessData.contactValue || '',
                    accessData.userAgent || ''
                ];
                
                safeLog.log('æº–å‚™æäº¤çš„ä½¿ç”¨è¨˜éŒ„è³‡æ–™:', logData);
                
                // æäº¤åˆ° Google Sheets
                const success = await submitToGoogleSheets(logData, 'access_log');
                
                if (success) {
                    safeLog.log('âœ… ä½¿ç”¨è¨˜éŒ„å·²æˆåŠŸæäº¤åˆ° Google Sheets');
                } else {
                    console.error('âŒ ä½¿ç”¨è¨˜éŒ„æäº¤å¤±æ•—');
                }
                
                return success;
            } catch (error) {
                console.error('ä½¿ç”¨è¨˜éŒ„æäº¤å¤±æ•—:', error);
                return false;
            }
        }
        
        // ç™¼é€å¼•è–¦è³‡æ–™éƒµä»¶çµ¦å®¢æˆ¶
        async function sendReferralInfoEmailToCustomer(customerEmail, customerName, customerCode, referralData) {
            try {
                safeLog.log('ğŸ“§ é–‹å§‹ç™¼é€å¼•è–¦è³‡æ–™éƒµä»¶çµ¦å®¢æˆ¶');
                safeLog.log('å®¢æˆ¶ Email:', customerEmail);
                safeLog.log('å®¢æˆ¶å§“å:', customerName);
                safeLog.log('å¼•è–¦è³‡æ–™:', referralData);
                
                // æª¢æŸ¥ Apps Script URL æ˜¯å¦è¨­å®š
                if (!SHEET_CONFIG.APPS_SCRIPT_URL || SHEET_CONFIG.APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL') {
                    safeLog.warn('âš ï¸ Apps Script URL æœªè¨­å®šï¼Œç„¡æ³•ç™¼é€éƒµä»¶');
                    return false;
                }
                
                // æº–å‚™éƒµä»¶è³‡æ–™
                const emailData = {
                    action: 'sendReferralInfoToCustomer',
                    customerEmail: customerEmail,
                    customerName: customerName,
                    customerCode: customerCode,
                    referralData: referralData
                };
                
                // ä½¿ç”¨ application/x-www-form-urlencoded æ ¼å¼é¿å… CORS é æª¢
                const formData = new URLSearchParams();
                formData.append('data', JSON.stringify(emailData));
                
                // ç™¼é€è«‹æ±‚åˆ° Apps Script
                const response = await fetch(SHEET_CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData.toString()
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        safeLog.log('âœ… å¼•è–¦è³‡æ–™éƒµä»¶å·²æˆåŠŸç™¼é€çµ¦å®¢æˆ¶:', customerEmail);
                        return true;
                    } else {
                        safeLog.warn('âš ï¸ éƒµä»¶ç™¼é€å¤±æ•—:', result.message);
                        return false;
                    }
                } else {
                    console.error('âŒ éƒµä»¶ç™¼é€è«‹æ±‚å¤±æ•—:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('âŒ ç™¼é€éƒµä»¶æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                return false;
            }
        }
        
        
        // å¼•è–¦è³‡æ–™é©—è­‰
        function validateReferralData(data) {
            const requiredFields = ['referrerCode', 'referredCompany', 'companyPhone'];
            
            for (const field of requiredFields) {
                if (!data[field] || data[field].trim() === '') {
                    alert(`è«‹å¡«å¯« ${getFieldDisplayName(field)}`);
                    return false;
                }
            }
            
            // é›»è©±è™Ÿç¢¼æ ¼å¼é©—è­‰
            if (!isValidPhone(data.companyPhone)) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»è©±è™Ÿç¢¼');
                return false;
            }
            
            return true;
        }
        
        // æ¬„ä½é¡¯ç¤ºåç¨±
        function getFieldDisplayName(field) {
            const fieldNames = {
                'companyName': 'å…¬å¸åç¨±',
                'contactName': 'è¯çµ¡äººå§“å',
                'phone': 'è¯çµ¡é›»è©±',
                'email': 'é›»å­éƒµä»¶',
                'referrerCode': 'å¼•è–¦äººç·¨è™Ÿ',
                'serviceItem': 'æœå‹™é …ç›®',
                'referredCompany': 'è¢«å¼•è–¦å» å•†åç¨±',
                'companyPhone': 'å» å•†è¯çµ¡é›»è©±',
                'referredService': 'è¢«å¼•è–¦æœå‹™é …ç›®'
            };
            return fieldNames[field] || field;
        }
        
        // é›»è©±è™Ÿç¢¼é©—è­‰
        function isValidPhone(phone) {
            const phoneRegex = /^[0-9\-\+\(\)\s]{8,15}$/;
            return phoneRegex.test(phone);
        }
        
        // æ ¼å¼åŒ–é›»è©±è™Ÿç¢¼ï¼ˆä¸è¶³10ç¢¼å‰é¢è£œ0ï¼Œç¢ºä¿å‰å°0ä¸æ¶ˆå¤±ï¼‰
        function formatPhoneNumber(phone) {
            if (!phone) return '';
            
            // ç§»é™¤æ‰€æœ‰éæ•¸å­—å­—ç¬¦
            const digits = phone.replace(/\D/g, '');
            
            // å¦‚æœæ•¸å­—é•·åº¦ç‚º9ç¢¼ï¼Œå‰é¢è£œ0
            if (digits.length === 9) {
                return '0' + digits;
            }
            
            // å¦‚æœæ•¸å­—é•·åº¦ç‚º10ç¢¼ï¼Œç¢ºä¿ä»¥å­—ä¸²æ ¼å¼è¿”å›ï¼ˆä¿æŒå‰å°0ï¼‰
            if (digits.length === 10) {
                return digits; // å·²ç¶“æ˜¯10ä½æ•¸ï¼Œç›´æ¥è¿”å›
            }
            
            // å…¶ä»–æƒ…æ³è¿”å›åŸå§‹æ•¸å­—
            return digits;
        }
        
        // é›»å­éƒµä»¶é©—è­‰
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            if (!query) {
                clearHighlights();
                closeSearchResults();
                return;
            }
            
            // é¡¯ç¤ºæœç´¢åŠ è¼‰å‹•ç•«
            showSearchLoading();
            
            // ä½¿ç”¨é˜²æŠ–å„ªåŒ–æ€§èƒ½
            clearTimeout(handleSearch.timeout);
            handleSearch.timeout = setTimeout(() => {
                performSearch(query);
            }, 150);
        }
        
        function performSearch(query) {
            // æœå°‹æ‰€æœ‰æœå‹™é …ç›®ï¼ˆå¢å¼·ç‰ˆ - æ”¯æ´åŒç¾©è©æœç´¢ï¼‰
            const results = [];
            const categories = mindmapData["2025å¹´ è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒå¼•è–¦å¹³å°"];
            
            // ç²å–æ“´å±•çš„æœç´¢è©ï¼ˆåŒ…å«åŒç¾©è©ï¼‰
            const expandedTerms = getExpandedSearchTerms(query);
            
            for (const [categoryName, subCategories] of Object.entries(categories)) {
                for (const [subCategoryName, items] of Object.entries(subCategories)) {
                    items.forEach(item => {
                        const itemLower = item.toLowerCase();
                        let bestScore = 0;
                        let matchedTerm = '';
                        
                        // æª¢æŸ¥æ¯å€‹æ“´å±•æœç´¢è©
                        for (const term of expandedTerms) {
                            if (itemLower.includes(term)) {
                                let score = 0;
                                
                                if (itemLower === term) {
                                    score = 100; // å®Œå…¨åŒ¹é…
                                } else if (itemLower.startsWith(term)) {
                                    score = 80; // é–‹é ­åŒ¹é…
                                } else if (itemLower.includes(term)) {
                                    score = 60; // éƒ¨åˆ†åŒ¹é…
                                }
                                
                                // å¦‚æœåŸå§‹æŸ¥è©¢åŒ¹é…ï¼Œçµ¦äºˆé¡å¤–åŠ åˆ†
                                if (term === query && score > 0) {
                                    score += 10;
                                }
                                
                                if (score > bestScore) {
                                    bestScore = score;
                                    matchedTerm = term;
                                }
                            }
                        }
                        
                        // å¦‚æœæ‰¾åˆ°åŒ¹é…ï¼Œæ·»åŠ åˆ°çµæœä¸­
                        if (bestScore > 0) {
                            results.push({
                                category: categoryName,
                                subCategory: subCategoryName,
                                item: item,
                                score: bestScore,
                                matchedTerm: matchedTerm
                            });
                        }
                    });
                }
            }
            
            // æŒ‰åˆ†æ•¸æ’åº
            results.sort((a, b) => b.score - a.score);
            
            // é¡¯ç¤ºæœå°‹çµæœ
            if (results.length > 0) {
                addToSearchHistory(query);
                showSearchResults(results, query);
            } else {
                showNoResults(query);
            }
            
            // é‡ç½®é¸ä¸­ç´¢å¼•
            selectedResultIndex = -1;
        }
        
        // é¡¯ç¤ºæœç´¢åŠ è¼‰å‹•ç•«
        function showSearchLoading() {
            const oldResults = document.getElementById('searchResults');
            if (oldResults) oldResults.remove();
            
            const loadingContainer = document.createElement('div');
            loadingContainer.id = 'searchResults';
            loadingContainer.style.cssText = `
                position: fixed;
                top: 85px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 600px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 2000;
                padding: 30px;
                text-align: center;
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼å‰µå»ºè¼‰å…¥ä¸­å…§å®¹
            loadingContainer.textContent = ''; // æ¸…ç©º
            const spinner = safeCreateElement('div', '', {
                style: 'display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;',
                'aria-label': 'è¼‰å…¥ä¸­'
            });
            const loadingText = safeCreateElement('div', 'æœå°‹ä¸­...', {
                style: 'margin-top: 15px; color: #666; font-size: 14px;'
            });
            loadingContainer.appendChild(spinner);
            loadingContainer.appendChild(loadingText);
            
            document.body.appendChild(loadingContainer);
        }
        
        // é¡¯ç¤ºç„¡çµæœæç¤º
        function showNoResults(query) {
            const oldResults = document.getElementById('searchResults');
            if (oldResults) oldResults.remove();
            
            const noResultsContainer = document.createElement('div');
            noResultsContainer.id = 'searchResults';
            noResultsContainer.style.cssText = `
                position: fixed;
                top: 85px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 600px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 2000;
                padding: 30px;
                text-align: center;
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼å‰µå»ºç„¡çµæœå…§å®¹
            const noResultsHTML = `
                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ”</div>
                <div style="color: #666; font-size: 16px; margin-bottom: 10px;">æ‰¾ä¸åˆ°ã€Œ${query}ã€ç›¸é—œæœå‹™</div>
                <div style="color: #999; font-size: 13px;">è©¦è©¦å…¶ä»–é—œéµå­—ï¼Œæˆ–æŸ¥çœ‹ä¸‹æ–¹ç†±é–€æœç´¢</div>
            `;
            
            document.body.appendChild(noResultsContainer);
        }
        
        // é¡¯ç¤ºæœå°‹çµæœ
        function showSearchResults(results, query) {
            // ç§»é™¤èˆŠçš„çµæœ
            const oldResults = document.getElementById('searchResults');
            if (oldResults) {
                oldResults.remove();
            }
            
            // å‰µå»ºçµæœå®¹å™¨
            const resultsContainer = document.createElement('div');
            resultsContainer.id = 'searchResults';
            resultsContainer.style.cssText = `
                position: fixed;
                top: 85px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 600px;
                max-height: 400px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 2000;
                overflow-y: auto;
                padding: 20px;
            `;
            
            let resultsHTML = `
                <div style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e9ecef;">
                    <strong style="color: #667eea; font-size: 16px;">ğŸ” æœå°‹çµæœï¼šæ‰¾åˆ° ${results.length} é …æœå‹™</strong>
                </div>
            `;
            
            results.forEach((result, index) => {
                // ä½¿ç”¨ç·¨ç¢¼é¿å…ç‰¹æ®Šå­—ç¬¦å•é¡Œ
                const encodedItem = encodeURIComponent(result.item);
                const encodedCategory = encodeURIComponent(result.category);
                const encodedSubCategory = encodeURIComponent(result.subCategory);
                
                // é«˜äº®é—œéµå­—
                const highlightedItem = highlightKeyword(result.item, query);
                const highlightedCategory = highlightKeyword(result.category, query);
                const highlightedSubCategory = highlightKeyword(result.subCategory, query);
                
                resultsHTML += `
                    <div class="search-result-item" onclick="selectSearchResult('${encodedItem}', '${encodedCategory}', '${encodedSubCategory}')" 
                         style="padding: 12px; margin-bottom: 8px; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; border-left: 4px solid #667eea;"
                         onmouseenter="this.style.background='#e3e8ff'; this.style.transform='translateX(5px)'"
                         onmouseleave="this.style.background='#f8f9fa'; this.style.transform='translateX(0)'">
                        <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${highlightedItem}</div>
                        <div style="font-size: 12px; color: #666;">${highlightedCategory} > ${highlightedSubCategory}</div>
                    </div>
                `;
            });
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®æœç´¢çµæœ
            safeSetHTML(resultsContainer, resultsHTML);
            document.body.appendChild(resultsContainer);
        }
        
        // é—œé–‰æœå°‹çµæœ
        function closeSearchResults() {
            const results = document.getElementById('searchResults');
            if (results) {
                results.remove();
            }
        }
        
        // é¸æ“‡æœå°‹çµæœ
        function selectSearchResult(item, category, subCategory) {
            closeSearchResults();
            // è§£ç¢¼åƒæ•¸
            const decodedItem = decodeURIComponent(item);
            const decodedCategory = decodeURIComponent(category);
            const decodedSubCategory = decodeURIComponent(subCategory);
            // é¡¯ç¤ºè©²é …ç›®çš„è©³ç´°è³‡è¨Š
            showDetails(decodedItem, decodedCategory, decodedSubCategory);
        }

        function clearHighlights() {
            const highlights = document.querySelectorAll('.highlight');
            highlights.forEach(highlight => {
                highlight.outerHTML = highlight.textContent;
            });
        }
        
        // ä¸€éµæ”¶åˆæ‰€æœ‰å±•é–‹çš„åˆ†é¡
        function collapseAllCategories() {
            // ç§»é™¤æ‰€æœ‰å­åˆ†é¡å®¹å™¨
            const subContainers = document.querySelectorAll('.sub-categories');
            subContainers.forEach(container => {
                container.style.opacity = '0';
                container.style.transform = 'translateX(-50%) translateY(-10px)';
                setTimeout(() => {
                    container.remove();
                }, 300);
            });
            
            // é¡¯ç¤ºæˆåŠŸæç¤º
            showNotification('âœ… å·²æ”¶åˆæ‰€æœ‰å±•é–‹çš„åˆ†é¡', 'success');
        }
        
        // é¡¯ç¤ºé€šçŸ¥è¨Šæ¯
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${type === 'success' ? '#4caf50' : '#2196f3'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                animation: slideInRight 0.3s ease-out;
                font-size: 14px;
                font-weight: 500;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 2000);
        }

        // ===== å¢å¼·æœç´¢åŠŸèƒ½ =====
        
        // æœç´¢æ­·å²ç®¡ç†
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]');
        let selectedResultIndex = -1;
        
        // é—œéµè©åŒç¾©è©æ˜ å°„ï¼ˆè®“ä¸åŒç¨±å‘¼éƒ½èƒ½æœå°‹åˆ°ç›¸åŒæœå‹™ï¼‰
        const searchSynonyms = {
            "æˆ¿ä»²": ["ä»²ä»‹"],
            "ä»²ä»‹": ["æˆ¿ä»²", "ä½å®…ä»²ä»‹", "å•†æ¥­ä¸å‹•ç”¢"],
            "ä½å®…ä»²ä»‹": ["æˆ¿ä»²", "ä»²ä»‹"],
            "å•†è¾¦ä»²ä»‹": ["ä»²ä»‹", "å•†æ¥­ä¸å‹•ç”¢"],
            "å»ºç¯‰å¸«": ["å»ºç¯‰è¨­è¨ˆ"],
            "å»ºç¯‰è¨­è¨ˆ": ["å»ºç¯‰å¸«"],
            "å®¤å…§è¨­è¨ˆ": ["å®¤å…§è¦åŠƒ", "ç©ºé–“è¨­è¨ˆ"],
            "BIM": ["å»ºç¯‰è³‡è¨Šæ¨¡å‹", "BIMå»ºæ¨¡"],
            "ä»£æ›¸": ["åœ°æ”¿å£«"],
            "åœ°æ”¿å£«": ["ä»£æ›¸"],
            "ç‰©æ¥­": ["ç‰©æ¥­ç®¡ç†", "ç¤¾å€ç®¡ç†"],
            "ç‰©æ¥­ç®¡ç†": ["ç‰©æ¥­", "ç¤¾å€ç®¡ç†"],
            "ä¿å…¨": ["å®‰ç®¡", "å®‰å…¨ç¶­è­·"],
            "å®‰ç®¡": ["ä¿å…¨", "å®‰å…¨ç¶­è­·"],
            "æ¸…æ½”": ["æ¸…æ½”æœå‹™", "æ‰“æƒ"],
            "æ¸…æ½”æœå‹™": ["æ¸…æ½”", "æ‰“æƒ"],
            "é©—å±‹": ["é©—å±‹æœå‹™", "æˆ¿å±‹æª¢æ¸¬", "å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“"],
            "é©—å±‹æœå‹™": ["é©—å±‹", "æˆ¿å±‹æª¢æ¸¬", "å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“"],
            "æ°´é›»": ["æ°´é›»å·¥ç¨‹", "æ°´é›»å®‰è£"],
            "æ°´é›»å·¥ç¨‹": ["æ°´é›»", "æ°´é›»å®‰è£"],
            "æ©Ÿé›»": ["æ©Ÿé›»å·¥ç¨‹", "æ©Ÿé›»è¨­å‚™"],
            "æ©Ÿé›»å·¥ç¨‹": ["æ©Ÿé›»", "æ©Ÿé›»è¨­å‚™"],
            "æ¶ˆé˜²": ["æ¶ˆé˜²å·¥ç¨‹", "æ¶ˆé˜²è¨­å‚™"],
            "æ¶ˆé˜²å·¥ç¨‹": ["æ¶ˆé˜²", "æ¶ˆé˜²è¨­å‚™"],
            "å¼±é›»": ["å¼±é›»å·¥ç¨‹", "ç›£æ§ç³»çµ±"],
            "å¼±é›»å·¥ç¨‹": ["å¼±é›»", "ç›£æ§ç³»çµ±"],
            "è£ä¿®": ["è£ä¿®å·¥ç¨‹", "å®¤å…§è£ä¿®"],
            "è£ä¿®å·¥ç¨‹": ["è£ä¿®", "å®¤å…§è£ä¿®"],
            "æ³¥ä½œ": ["æ³¥ä½œå·¥ç¨‹", "æ³¥å·¥"],
            "æ³¥ä½œå·¥ç¨‹": ["æ³¥ä½œ", "æ³¥å·¥"],
            "éµå·¥": ["éµå·¥å·¥ç¨‹", "é‹¼æ§‹"],
            "éµå·¥å·¥ç¨‹": ["éµå·¥", "é‹¼æ§‹"],
            "æœ¨å·¥": ["æœ¨ä½œå·¥ç¨‹", "æœ¨å·¥è£æ½¢"],
            "æœ¨ä½œå·¥ç¨‹": ["æœ¨å·¥", "æœ¨å·¥è£æ½¢"],
            "çŸ³æ": ["çŸ³æå·¥ç¨‹", "çŸ³æå®‰è£"],
            "çŸ³æå·¥ç¨‹": ["çŸ³æ", "çŸ³æå®‰è£"],
            "ç»ç’ƒ": ["ç»ç’ƒå·¥ç¨‹", "ç»ç’ƒå®‰è£"],
            "ç»ç’ƒå·¥ç¨‹": ["ç»ç’ƒ", "ç»ç’ƒå®‰è£"],
            "ç£ç£š": ["ç£ç£šå·¥ç¨‹", "ç£ç£šé‹ªè¨­"],
            "ç£ç£šå·¥ç¨‹": ["ç£ç£š", "ç£ç£šé‹ªè¨­"],
            "é‹é–€çª—": ["é‹é–€çª—å·¥ç¨‹", "é‹çª—"],
            "é‹é–€çª—å·¥ç¨‹": ["é‹é–€çª—", "é‹çª—"],
            "æ²¹æ¼†": ["å¡—æ–™å·¥ç¨‹", "æ²¹æ¼†ç²‰åˆ·"],
            "å¡—æ–™å·¥ç¨‹": ["æ²¹æ¼†", "æ²¹æ¼†ç²‰åˆ·"],
            "è²¸æ¬¾": ["è²¸æ¬¾æœå‹™", "æˆ¿è²¸", "è³¼å±‹è²¸æ¬¾", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "è²¸æ¬¾æœå‹™": ["è²¸æ¬¾", "æˆ¿è²¸", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "æˆ¿è²¸": ["è²¸æ¬¾", "è²¸æ¬¾æœå‹™", "è³¼å±‹è²¸æ¬¾", "æˆ¿è²¸è½‰å¢è²¸", "æˆ¿è²¸ä»£å„Ÿ", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "èè³‡": ["å»ºç¯‰èè³‡", "é–‹ç™¼èè³‡"],
            "å»ºç¯‰èè³‡": ["èè³‡", "é–‹ç™¼èè³‡"],
            "è¡ŒéŠ·": ["å»ºæ¡ˆè¡ŒéŠ·", "æ•¸ä½è¡ŒéŠ·"],
            "å»ºæ¡ˆè¡ŒéŠ·": ["è¡ŒéŠ·", "æ•¸ä½è¡ŒéŠ·"],
            "ç§Ÿè³ƒ": ["ç§Ÿè³ƒæœå‹™", "ç§Ÿè³ƒç®¡ç†"],
            "ç§Ÿè³ƒæœå‹™": ["ç§Ÿè³ƒ", "ç§Ÿè³ƒç®¡ç†"],
            "ä¿®ç¹•": ["ä¿®ç¹•æœå‹™", "ç¶­ä¿®"],
            "ä¿®ç¹•æœå‹™": ["ä¿®ç¹•", "ç¶­ä¿®"],
            "çµ±åŒ…": ["çµ±åŒ…å·¥ç¨‹"],
            "çµ±åŒ…å·¥ç¨‹": ["çµ±åŒ…"],
            "æª¢æ¸¬": ["æª¢æ¸¬æœå‹™", "æˆ¿å±‹æª¢æ¸¬", "å°ˆæ¥­æœå‹™"],
            "æª¢æ¸¬æœå‹™": ["æª¢æ¸¬", "æˆ¿å±‹æª¢æ¸¬", "å°ˆæ¥­æœå‹™"],
            "ç’°å¢ƒ": ["ç’°å¢ƒæ²»ç†", "å°ˆæ¥­æœå‹™"],
            "ç’°å¢ƒæ²»ç†": ["ç’°å¢ƒ", "å°ˆæ¥­æœå‹™"],
            "é¡§å•": ["é¡§å•æœå‹™", "å°ˆæ¥­æœå‹™"],
            "é¡§å•æœå‹™": ["é¡§å•", "å°ˆæ¥­æœå‹™"],
            "å¸‚å ´": ["å¸‚å ´ç ”ç©¶", "å°ˆæ¥­æœå‹™"],
            "å¸‚å ´ç ”ç©¶": ["å¸‚å ´", "å°ˆæ¥­æœå‹™"],
            "ç ”ç©¶": ["å¸‚å ´ç ”ç©¶", "å°ˆæ¥­æœå‹™"],
            "å»ºæ": ["å»ºæä¾›æ‡‰"],
            "å»ºæä¾›æ‡‰": ["å»ºæ"],
            "è¨­å‚™": ["æ–½å·¥è¨­å‚™"],
            "æ–½å·¥è¨­å‚™": ["è¨­å‚™"],
            "é©—æ”¶": ["äº¤ä»˜æœå‹™", "é©—æ”¶æµç¨‹"],
            "äº¤ä»˜æœå‹™": ["é©—æ”¶", "é©—æ”¶æµç¨‹"],
            "ç‡Ÿé€ ": ["ç‡Ÿé€ ç®¡ç†", "ç‡Ÿé€ å•†"],
            "ç‡Ÿé€ ç®¡ç†": ["ç‡Ÿé€ ", "ç‡Ÿé€ å•†"],
            "æŠ•è³‡": ["ä¸å‹•ç”¢æŠ•è³‡", "æˆ¿ç”¢æŠ•è³‡"],
            "ä¸å‹•ç”¢æŠ•è³‡": ["æŠ•è³‡", "æˆ¿ç”¢æŠ•è³‡"],
            "ä¼°åƒ¹": ["é‘‘åƒ¹æœå‹™", "ä¸å‹•ç”¢ä¼°åƒ¹å¸«"],
            "é‘‘åƒ¹æœå‹™": ["ä¼°åƒ¹", "ä¸å‹•ç”¢ä¼°åƒ¹å¸«"],
            "å¾‹å¸«": ["æ³•å¾‹æœå‹™", "å°ˆæ¥­æœå‹™"],
            "æ³•å¾‹æœå‹™": ["å¾‹å¸«", "å°ˆæ¥­æœå‹™"],
            "å°ˆæ¥­æœå‹™": ["æ³•å¾‹æœå‹™", "æ³•è¦è«®è©¢", "é©—å±‹æœå‹™", "äººæ‰åŸ¹è¨“"],
            "æ³•è¦": ["æ³•è¦è«®è©¢", "å°ˆæ¥­æœå‹™"],
            "æ³•è¦è«®è©¢": ["æ³•è¦", "å°ˆæ¥­æœå‹™"],
            "äººæ‰": ["äººæ‰åŸ¹è¨“", "å°ˆæ¥­æœå‹™"],
            "äººæ‰åŸ¹è¨“": ["äººæ‰", "å°ˆæ¥­åŸ¹è¨“", "å°ˆæ¥­æœå‹™"],
            "åŸ¹è¨“": ["äººæ‰åŸ¹è¨“", "å°ˆæ¥­åŸ¹è¨“"],
            "æœƒè¨ˆå¸«": ["ç¨…å‹™è¦åŠƒ", "æœƒè¨ˆ"],
            "ç¨…å‹™è¦åŠƒ": ["æœƒè¨ˆå¸«", "æœƒè¨ˆ"],
            "SEO": ["SEOå„ªåŒ–", "æ•¸ä½è¡ŒéŠ·"],
            "SEOå„ªåŒ–": ["SEO", "æ•¸ä½è¡ŒéŠ·"],
            "å»£å‘Š": ["Googleå»£å‘Š", "Facebookå»£å‘Š", "æ•¸ä½è¡ŒéŠ·"],
            "Googleå»£å‘Š": ["å»£å‘Š", "æ•¸ä½è¡ŒéŠ·"],
            "Facebookå»£å‘Š": ["å»£å‘Š", "æ•¸ä½è¡ŒéŠ·"],
            "æ”å½±": ["å»ºæ¡ˆæ”å½±", "å…§å®¹è¡ŒéŠ·"],
            "å»ºæ¡ˆæ”å½±": ["æ”å½±", "å…§å®¹è¡ŒéŠ·"],
            "å½±ç‰‡": ["å»ºæ¡ˆå½±ç‰‡æ‹æ”", "å…§å®¹è¡ŒéŠ·"],
            "å»ºæ¡ˆå½±ç‰‡æ‹æ”": ["å½±ç‰‡", "å…§å®¹è¡ŒéŠ·"],
            "åˆ†æ": ["å¸‚å ´ç ”ç©¶", "ä¸å‹•ç”¢å¸‚å ´åˆ†æ"],
            "å¸‚å ´ç ”ç©¶": ["åˆ†æ", "ä¸å‹•ç”¢å¸‚å ´åˆ†æ"],
            "å¯¦åƒ¹": ["å¯¦åƒ¹ç™»éŒ„æŸ¥è©¢", "è³‡è¨Šå¹³å°"],
            "å¯¦åƒ¹ç™»éŒ„æŸ¥è©¢": ["å¯¦åƒ¹", "è³‡è¨Šå¹³å°"],
            "591": ["591ç§Ÿå±‹ç¶²", "è³‡è¨Šå¹³å°"],
            "591ç§Ÿå±‹ç¶²": ["591", "è³‡è¨Šå¹³å°"],
            "ç¶­è­·": ["æ©Ÿé›»ç¶­è­·", "ç‰©æ¥­ç®¡ç†"],
            "æ©Ÿé›»ç¶­è­·": ["ç¶­è­·", "ç‰©æ¥­ç®¡ç†"],
            "ä¿é¤Š": ["é›»æ¢¯ä¿é¤Š", "ç©ºèª¿ä¿é¤Š", "æ©Ÿé›»ç¶­è­·"],
            "é›»æ¢¯ä¿é¤Š": ["ä¿é¤Š", "æ©Ÿé›»ç¶­è­·"],
            "ç©ºèª¿ä¿é¤Š": ["ä¿é¤Š", "æ©Ÿé›»ç¶­è­·"],
            "ä¿é¤Š": ["é›»æ¢¯ä¿é¤Š", "ç©ºèª¿ä¿é¤Š", "æ©Ÿé›»ç¶­è­·"],
            "åœ’è—": ["åœ’è—ç¶­è­·", "åœ’è—è¨­è¨ˆ"],
            "åœ’è—ç¶­è­·": ["åœ’è—", "åœ’è—è¨­è¨ˆ"],
            "Airbnb": ["çŸ­ç§Ÿç‡Ÿé‹", "Airbnbä»£ç‡Ÿé‹"],
            "çŸ­ç§Ÿç‡Ÿé‹": ["Airbnb", "Airbnbä»£ç‡Ÿé‹"],
            "å¹³å°": ["ç‰©æ¥­ç®¡ç†ç³»çµ±", "ç§Ÿè³ƒç®¡ç†ç³»çµ±", "æ•¸ä½å¹³å°"],
            "ç‰©æ¥­ç®¡ç†ç³»çµ±": ["å¹³å°", "æ•¸ä½å¹³å°"],
            "ç§Ÿè³ƒç®¡ç†ç³»çµ±": ["å¹³å°", "æ•¸ä½å¹³å°"],
            "æ•¸ä½å¹³å°": ["å¹³å°", "ç‰©æ¥­ç®¡ç†ç³»çµ±"],
            "æ³•æ‹": ["ç‰¹æ®Šæ¸ é“", "æ³•æ‹"],
            "ç‰¹æ®Šæ¸ é“": ["æ³•æ‹", "ä»£éŠ·"],
            "ä»£éŠ·": ["ç‰¹æ®Šæ¸ é“", "å»ºæ¡ˆè¡ŒéŠ·"],
            "å±¥ç´„": ["å±¥ç´„ä¿è­‰", "äº¤æ˜“æœå‹™"],
            "å±¥ç´„ä¿è­‰": ["å±¥ç´„", "äº¤æ˜“æœå‹™"],
            "éæˆ¶": ["éæˆ¶æœå‹™", "äº¤æ˜“æœå‹™"],
            "éæˆ¶æœå‹™": ["éæˆ¶", "äº¤æ˜“æœå‹™"],
            "ç”¢æ¬Š": ["ç”¢æ¬Šèª¿æŸ¥", "äº¤æ˜“æœå‹™"],
            "ç”¢æ¬Šèª¿æŸ¥": ["ç”¢æ¬Š", "äº¤æ˜“æœå‹™"],
            "ä¿¡è¨—": ["åƒ¹é‡‘ä¿¡è¨—", "ä¸å‹•ç”¢æŠ•è³‡ä¿¡è¨—"],
            "åƒ¹é‡‘ä¿¡è¨—": ["ä¿¡è¨—", "äº¤æ˜“æœå‹™"],
            "ä¸å‹•ç”¢æŠ•è³‡ä¿¡è¨—": ["ä¿¡è¨—", "ä¸å‹•ç”¢æŠ•è³‡"],
            "å±éšª": ["å±éšªè£œå¼·", "ç‰¹æ®Šå·¥ç¨‹"],
            "å±éšªè£œå¼·": ["å±éšª", "ç‰¹æ®Šå·¥ç¨‹"],
            "æ™ºæ…§": ["æ™ºæ…§å·¥ç¨‹", "æ™ºæ…§å®¶é›»"],
            "æ™ºæ…§å·¥ç¨‹": ["æ™ºæ…§", "æ™ºæ…§å®¶é›»"],
            "IoT": ["IoTç‰©è¯ç¶²", "æ™ºæ…§å·¥ç¨‹"],
            "IoTç‰©è¯ç¶²": ["IoT", "æ™ºæ…§å·¥ç¨‹"],
            "ç‰©è¯ç¶²": ["IoTç‰©è¯ç¶²", "æ™ºæ…§å·¥ç¨‹"],
            "è‡ªå‹•åŒ–": ["è‡ªå‹•åŒ–æ§åˆ¶", "æ™ºæ…§å·¥ç¨‹"],
            "è‡ªå‹•åŒ–æ§åˆ¶": ["è‡ªå‹•åŒ–", "æ™ºæ…§å·¥ç¨‹"],
            "é–€é–": ["æ™ºæ…§é–€é–", "å¼±é›»å·¥ç¨‹"],
            "æ™ºæ…§é–€é–": ["é–€é–", "å¼±é›»å·¥ç¨‹"],
            "ç›£æ¸¬": ["å»ºç¯‰ç§‘æŠ€ç›£æ¸¬", "çµæ§‹å¥åº·ç›£æ¸¬", "ç’°å¢ƒç›£æ¸¬"],
            "å»ºç¯‰ç§‘æŠ€ç›£æ¸¬": ["ç›£æ¸¬", "æ™ºæ…§å·¥ç¨‹"],
            "çµæ§‹å¥åº·ç›£æ¸¬": ["ç›£æ¸¬", "æ™ºæ…§å·¥ç¨‹"],
            "ç’°å¢ƒç›£æ¸¬": ["ç›£æ¸¬", "æ™ºæ…§å·¥ç¨‹"],
            "èƒ½è€—": ["èƒ½è€—åˆ†æ", "æ™ºæ…§å·¥ç¨‹"],
            "èƒ½è€—åˆ†æ": ["èƒ½è€—", "æ™ºæ…§å·¥ç¨‹"],
            "ç¶­è­·": ["é æ¸¬æ€§ç¶­è­·", "æ™ºæ…§å·¥ç¨‹"],
            "é æ¸¬æ€§ç¶­è­·": ["ç¶­è­·", "æ™ºæ…§å·¥ç¨‹"],
            "é˜²æ°´": ["é˜²æ°´å·¥ç¨‹", "é˜²æ°´è£œæ¼"],
            "é˜²æ°´å·¥ç¨‹": ["é˜²æ°´", "ç‰¹æ®Šå·¥ç¨‹"],
            "é˜²æ°´è£œæ¼": ["é˜²æ°´", "ä¿®ç¹•æœå‹™"],
            "éš”ç†±": ["é˜²æ°´éš”ç†±", "ç‰¹æ®Šå·¥ç¨‹"],
            "é˜²æ°´éš”ç†±": ["éš”ç†±", "ç‰¹æ®Šå·¥ç¨‹"],
            "å¸·å¹•": ["å¸·å¹•ç‰†å·¥ç¨‹", "ç‰¹æ®Šå·¥ç¨‹"],
            "å¸·å¹•ç‰†å·¥ç¨‹": ["å¸·å¹•", "ç‰¹æ®Šå·¥ç¨‹"],
            "éš”é–“": ["éš”é–“å·¥ç¨‹", "è£ä¿®å·¥ç¨‹"],
            "éš”é–“å·¥ç¨‹": ["éš”é–“", "è£ä¿®å·¥ç¨‹"],
            "ç»ç’ƒéš”é–“": ["éš”é–“", "ç»ç’ƒå·¥ç¨‹"],
            "å¤©èŠ±æ¿": ["å¤©èŠ±æ¿å·¥ç¨‹", "è£ä¿®å·¥ç¨‹"],
            "å¤©èŠ±æ¿å·¥ç¨‹": ["å¤©èŠ±æ¿", "è£ä¿®å·¥ç¨‹"],
            "åœ°æ¿": ["åœ°æ¿å·¥ç¨‹", "å¯¦æœ¨åœ°æ¿"],
            "åœ°æ¿å·¥ç¨‹": ["åœ°æ¿", "è£ä¿®å·¥ç¨‹"],
            "å¯¦æœ¨åœ°æ¿": ["åœ°æ¿", "æœ¨ä½œå·¥ç¨‹"],
            "æ²¹æ¼†ç²‰åˆ·": ["æ²¹æ¼†", "å¡—æ–™å·¥ç¨‹"],
            "ç£ç£šé‹ªè¨­": ["ç£ç£š", "ç£ç£šå·¥ç¨‹"],
            "çŸ³æå®‰è£": ["çŸ³æ", "çŸ³æå·¥ç¨‹"],
            "ç»ç’ƒå®‰è£": ["ç»ç’ƒ", "ç»ç’ƒå·¥ç¨‹"],
            "é‹çª—": ["é‹çª—å®‰è£", "é‹é–€çª—å·¥ç¨‹"],
            "é‹çª—å®‰è£": ["é‹çª—", "é‹é–€çª—å·¥ç¨‹"],
            "æ°£å¯†çª—": ["é‹çª—", "é‹é–€çª—å·¥ç¨‹"],
            "éš”éŸ³çª—": ["é‹çª—", "é‹é–€çª—å·¥ç¨‹"],
            "é‹é–€": ["é‹é–€è£½ä½œ", "é‹é–€çª—å·¥ç¨‹"],
            "é‹é–€è£½ä½œ": ["é‹é–€", "é‹é–€çª—å·¥ç¨‹"],
            "ç´—çª—": ["ç´—çª—å®‰è£", "é‹é–€çª—å·¥ç¨‹"],
            "ç´—çª—å®‰è£": ["ç´—çª—", "é‹é–€çª—å·¥ç¨‹"],
            "é˜²æ°´å¡—æ–™": ["é˜²æ°´", "å¡—æ–™å·¥ç¨‹"],
            "éš”ç†±å¡—æ–™": ["éš”ç†±", "å¡—æ–™å·¥ç¨‹"],
            "ç’°ä¿å¡—æ–™": ["ç’°ä¿", "å¡—æ–™å·¥ç¨‹"],
            "è—è¡“å¡—æ–™": ["æ³¥ä½œ", "æ³¥ä½œå·¥ç¨‹"],
            "æ¸…æ°´æ¨¡": ["æ³¥ä½œ", "æ³¥ä½œå·¥ç¨‹"],
            "ä»¿å¤æ³¥ä½œ": ["æ³¥ä½œ", "æ³¥ä½œå·¥ç¨‹"],
            "å®¤å…§æ³¥ä½œ": ["æ³¥ä½œ", "æ³¥ä½œå·¥ç¨‹"],
            "å®¤å¤–æ³¥ä½œ": ["æ³¥ä½œ", "æ³¥ä½œå·¥ç¨‹"],
            "é‹¼æ§‹": ["é‹¼æ§‹å·¥ç¨‹", "éµå·¥å·¥ç¨‹"],
            "é‹¼æ§‹å·¥ç¨‹": ["é‹¼æ§‹", "éµå·¥å·¥ç¨‹"],
            "é‡‘å±¬åŠ å·¥": ["éµå·¥", "éµå·¥å·¥ç¨‹"],
            "ç„Šæ¥": ["ç„Šæ¥ä¿®è£œ", "éµå·¥å·¥ç¨‹"],
            "ç„Šæ¥ä¿®è£œ": ["ç„Šæ¥", "éµå·¥å·¥ç¨‹"],
            "çµæ§‹è£œå¼·": ["è£œå¼·", "éµå·¥å·¥ç¨‹"],
            "è£œå¼·": ["çµæ§‹è£œå¼·", "éµå·¥å·¥ç¨‹"],
            "æœ¨å·¥è£æ½¢": ["æœ¨å·¥", "æœ¨ä½œå·¥ç¨‹"],
            "æ«¥æ«ƒ": ["æ«¥æ«ƒè£½ä½œ", "æœ¨ä½œå·¥ç¨‹"],
            "æ«¥æ«ƒè£½ä½œ": ["æ«¥æ«ƒ", "æœ¨ä½œå·¥ç¨‹"],
            "è¨‚è£½æ«¥æ«ƒ": ["æ«¥æ«ƒ", "æœ¨ä½œå·¥ç¨‹"],
            "ç³»çµ±å®¶å…·": ["å®¶å…·", "æœ¨ä½œå·¥ç¨‹"],
            "è¨‚è£½å‚¢ä¿±": ["å‚¢ä¿±", "å®¤å…§è¨­è¨ˆ"],
            "å‚¢ä¿±è¨­è¨ˆ": ["å‚¢ä¿±", "å®¤å…§è¨­è¨ˆ"],
            "å‚¢ä¿±": ["è¨‚è£½å‚¢ä¿±", "å‚¢ä¿±è¨­è¨ˆ"],
            "è¨‚è£½": ["è¨‚è£½å‚¢ä¿±", "è¨‚è£½æ«¥æ«ƒ"],
            "è¨‚è£½å‚¢ä¿±": ["è¨‚è£½", "å®¤å…§è¨­è¨ˆ"],
            "è¨‚è£½æ«¥æ«ƒ": ["è¨‚è£½", "æœ¨ä½œå·¥ç¨‹"],
            "é¦¬è³½å…‹": ["ç£ç£š", "ç£ç£šå·¥ç¨‹"],
            "å¤§ç†çŸ³ç£š": ["ç£ç£š", "ç£ç£šå·¥ç¨‹"],
            "ä»¿å¤ç£š": ["ç£ç£š", "ç£ç£šå·¥ç¨‹"],
            "å¤§ç†çŸ³": ["çŸ³æ", "çŸ³æå·¥ç¨‹"],
            "èŠ±å´—å²©": ["çŸ³æ", "çŸ³æå·¥ç¨‹"],
            "äººé€ çŸ³": ["çŸ³æ", "çŸ³æå·¥ç¨‹"],
            "è† åˆç»ç’ƒ": ["ç»ç’ƒ", "ç»ç’ƒå·¥ç¨‹"],
            "å¼·åŒ–ç»ç’ƒ": ["ç»ç’ƒ", "ç»ç’ƒå·¥ç¨‹"],
            "çµ¦æ’æ°´": ["çµ¦æ’æ°´è¨­è¨ˆ", "æ°´é›»å·¥ç¨‹"],
            "çµ¦æ’æ°´è¨­è¨ˆ": ["çµ¦æ’æ°´", "æ°´é›»å·¥ç¨‹"],
            "ç“¦æ–¯": ["ç“¦æ–¯ç³»çµ±", "æ°´é›»å·¥ç¨‹"],
            "ç“¦æ–¯ç³»çµ±": ["ç“¦æ–¯", "æ°´é›»å·¥ç¨‹"],
            "ç†±æ°´å™¨": ["ç†±æ°´å™¨", "æ°´é›»å·¥ç¨‹"],
            "æ·¨æ°´": ["æ·¨æ°´ç³»çµ±", "æ°´é›»å·¥ç¨‹"],
            "æ·¨æ°´ç³»çµ±": ["æ·¨æ°´", "æ°´é›»å·¥ç¨‹"],
            "æ°´é›»å®‰è£": ["æ°´é›»", "æ°´é›»å·¥ç¨‹"],
            "é›»æ¢¯": ["é›»æ¢¯", "æ©Ÿé›»å·¥ç¨‹"],
            "ç©ºèª¿": ["ç©ºèª¿ç³»çµ±", "ç©ºèª¿å®‰è£ä¿é¤Š", "æ©Ÿé›»å·¥ç¨‹"],
            "ç©ºèª¿ç³»çµ±": ["ç©ºèª¿", "æ©Ÿé›»å·¥ç¨‹"],
            "ç©ºèª¿å®‰è£ä¿é¤Š": ["ç©ºèª¿", "æ©Ÿé›»å·¥ç¨‹"],
            "å†·æ°£": ["å†·æ°£å®‰è£ä¿é¤Š", "æ©Ÿé›»å·¥ç¨‹"],
            "å†·æ°£å®‰è£ä¿é¤Š": ["å†·æ°£", "æ©Ÿé›»å·¥ç¨‹"],
            "é€šé¢¨": ["é€šé¢¨ç³»çµ±", "æ©Ÿé›»å·¥ç¨‹"],
            "é€šé¢¨ç³»çµ±": ["é€šé¢¨", "æ©Ÿé›»å·¥ç¨‹"],
            "ç¯€èƒ½": ["ç¯€èƒ½è¨­å‚™", "æ©Ÿé›»å·¥ç¨‹"],
            "ç¯€èƒ½è¨­å‚™": ["ç¯€èƒ½", "æ©Ÿé›»å·¥ç¨‹"],
            "ç‘æ°´": ["è‡ªå‹•ç‘æ°´", "æ¶ˆé˜²å·¥ç¨‹"],
            "è‡ªå‹•ç‘æ°´": ["ç‘æ°´", "æ¶ˆé˜²å·¥ç¨‹"],
            "è­¦å ±": ["è­¦å ±ç³»çµ±", "æ¶ˆé˜²å·¥ç¨‹"],
            "è­¦å ±ç³»çµ±": ["è­¦å ±", "æ¶ˆé˜²å·¥ç¨‹"],
            "ç”³å ±": ["æ¶ˆé˜²ç”³å ±", "æ¶ˆé˜²å·¥ç¨‹"],
            "æ¶ˆé˜²ç”³å ±": ["ç”³å ±", "æ¶ˆé˜²å·¥ç¨‹"],
            "æ¶ˆé˜²è¨­å‚™": ["æ¶ˆé˜²", "æ¶ˆé˜²å·¥ç¨‹"],
            "ç›£æ§": ["ç›£æ§ç³»çµ±", "å¼±é›»å·¥ç¨‹"],
            "ç›£æ§ç³»çµ±": ["ç›£æ§", "å¼±é›»å·¥ç¨‹"],
            "é–€ç¦": ["é–€ç¦ç³»çµ±", "å¼±é›»å·¥ç¨‹"],
            "é–€ç¦ç³»çµ±": ["é–€ç¦", "å¼±é›»å·¥ç¨‹"],
            "é–€ç¦ç®¡ç†": ["é–€ç¦", "ç‰©æ¥­ç®¡ç†"],
            "ç¶²è·¯": ["ç¶²è·¯æ¶è¨­", "å¼±é›»å·¥ç¨‹"],
            "ç¶²è·¯æ¶è¨­": ["ç¶²è·¯", "å¼±é›»å·¥ç¨‹"],
            "æ™ºæ…§ç³»çµ±": ["æ™ºæ…§", "å¼±é›»å·¥ç¨‹"],
            "BIMå»ºæ¨¡": ["BIM", "BIMæœå‹™"],
            "å»ºç¯‰è³‡è¨Šæ¨¡å‹": ["BIM", "BIMæœå‹™"],
            "3D": ["3Då¯è¦–åŒ–", "BIMæœå‹™"],
            "3Då¯è¦–åŒ–": ["3D", "BIMæœå‹™"],
            "ç¢°æ’": ["ç¢°æ’æª¢æ¸¬", "BIMæœå‹™"],
            "ç¢°æ’æª¢æ¸¬": ["ç¢°æ’", "BIMæœå‹™"],
            "å”åŒ": ["å”åŒä½œæ¥­", "BIMæœå‹™"],
            "å”åŒä½œæ¥­": ["å”åŒ", "BIMæœå‹™"],
            "ç‡Ÿå»º": ["ç‡Ÿå»ºç®¡ç†", "å°ˆæ¡ˆç®¡ç†"],
            "ç‡Ÿå»ºç®¡ç†": ["ç‡Ÿå»º", "å°ˆæ¡ˆç®¡ç†"],
            "æ™‚ç¨‹": ["æ™‚ç¨‹æ§ç®¡", "å°ˆæ¡ˆç®¡ç†"],
            "æ™‚ç¨‹æ§ç®¡": ["æ™‚ç¨‹", "å°ˆæ¡ˆç®¡ç†"],
            "æˆæœ¬": ["æˆæœ¬æ§ç®¡", "å°ˆæ¡ˆç®¡ç†"],
            "æˆæœ¬æ§ç®¡": ["æˆæœ¬", "å°ˆæ¡ˆç®¡ç†"],
            "å“è³ª": ["å“è³ªç®¡ç†", "å°ˆæ¡ˆç®¡ç†"],
            "å“è³ªç®¡ç†": ["å“è³ª", "å°ˆæ¡ˆç®¡ç†"],
            "é¢¨éšª": ["é¢¨éšªç®¡ç†", "å°ˆæ¡ˆç®¡ç†"],
            "é¢¨éšªç®¡ç†": ["é¢¨éšª", "å°ˆæ¡ˆç®¡ç†"],
            "æª¢æ¸¬": ["æˆ¿å±‹æª¢æ¸¬", "æª¢æ¸¬æœå‹™", "å°ˆæ¥­æœå‹™"],
            "æˆ¿å±‹æª¢æ¸¬": ["æª¢æ¸¬", "æª¢æ¸¬æœå‹™", "å°ˆæ¥­æœå‹™"],
            "çµæ§‹æª¢æ¸¬": ["æª¢æ¸¬", "æª¢æ¸¬æœå‹™"],
            "æ¼æ°´": ["æ¼æ°´æª¢æ¸¬", "æª¢æ¸¬æœå‹™"],
            "æ¼æ°´æª¢æ¸¬": ["æ¼æ°´", "æª¢æ¸¬æœå‹™"],
            "ç©ºæ°£": ["ç©ºæ°£å“è³ªæª¢æ¸¬", "æª¢æ¸¬æœå‹™"],
            "ç©ºæ°£å“è³ªæª¢æ¸¬": ["ç©ºæ°£", "æª¢æ¸¬æœå‹™"],
            "ç‘•ç–µ": ["ç‘•ç–µæª¢æ¸¬", "é©—å±‹æœå‹™"],
            "ç‘•ç–µæª¢æ¸¬": ["ç‘•ç–µ", "é©—å±‹æœå‹™"],
            "è¼»å°„": ["è¼»å°„æª¢æ¸¬", "é©—å±‹æœå‹™"],
            "è¼»å°„æª¢æ¸¬": ["è¼»å°„", "é©—å±‹æœå‹™"],
            "ç”²é†›": ["ç”²é†›æª¢æ¸¬", "é©—å±‹æœå‹™"],
            "ç”²é†›æª¢æ¸¬": ["ç”²é†›", "é©—å±‹æœå‹™"],
            "å°ˆæ¥­é©—å±‹": ["é©—å±‹", "é©—å±‹æœå‹™"],
            "å•†æ¥­ä¸å‹•ç”¢": ["å•†è¾¦", "ä»²ä»‹æœå‹™"],
            "å•†è¾¦": ["å•†æ¥­ä¸å‹•ç”¢", "ä»²ä»‹æœå‹™"],
            "æµ·å¤–": ["æµ·å¤–ä¸å‹•ç”¢", "ä»²ä»‹æœå‹™"],
            "æµ·å¤–ä¸å‹•ç”¢": ["æµ·å¤–", "ä»²ä»‹æœå‹™"],
            "æˆ¿ç”¢æŠ•è³‡": ["æŠ•è³‡", "ä»²ä»‹æœå‹™"],
            "ç‰¹æ®Šç‰©ä»¶": ["ç‰¹æ®Šç‰©ä»¶", "äº¤æ˜“èˆ‡è³‡é‡‘"],
            "å·¥æ¥­å» æˆ¿": ["å» æˆ¿", "ç‰¹æ®Šç‰©ä»¶"],
            "å» æˆ¿": ["å·¥æ¥­å» æˆ¿", "ç‰¹æ®Šç‰©ä»¶"],
            "åœŸåœ°": ["åœŸåœ°è²·è³£", "ç‰¹æ®Šç‰©ä»¶"],
            "åœŸåœ°è²·è³£": ["åœŸåœ°", "ç‰¹æ®Šç‰©ä»¶"],
            "å€‰å„²": ["å€‰å„²ç”¨åœ°", "ç‰¹æ®Šç‰©ä»¶"],
            "å€‰å„²ç”¨åœ°": ["å€‰å„²", "ç‰¹æ®Šç‰©ä»¶"],
            "é å”®": ["é å”®å±‹", "ç‰¹æ®Šç‰©ä»¶"],
            "é å”®å±‹": ["é å”®", "ç‰¹æ®Šç‰©ä»¶"],
            "æˆå±‹": ["æˆå±‹", "ç‰¹æ®Šç‰©ä»¶"],
            "ä»£éŠ·": ["ä»£éŠ·", "ç‰¹æ®Šæ¸ é“"],
            "æ¨™å”®": ["æ¨™å”®", "ç‰¹æ®Šæ¸ é“"],
            "éƒ½æ›´": ["éƒ½æ›´æ•´åˆ", "ç‰¹æ®Šæ¸ é“"],
            "éƒ½æ›´æ•´åˆ": ["éƒ½æ›´", "ç‰¹æ®Šæ¸ é“"],
            "å±è€": ["å±è€æ•´åˆ", "ç‰¹æ®Šæ¸ é“"],
            "å±è€æ•´åˆ": ["å±è€", "ç‰¹æ®Šæ¸ é“"],
            "åœŸåœ°é–‹ç™¼": ["åœŸåœ°", "åœ°æ”¿æœå‹™"],
            "åœ°æ”¿æœå‹™": ["åœŸåœ°é–‹ç™¼", "äº¤æ˜“èˆ‡è³‡é‡‘"],
            "åœŸåœ°è³‡ç”¢å‚³æ‰¿": ["åœŸåœ°", "åœ°æ”¿æœå‹™"],
            "è²·æˆ¿": ["è²·æˆ¿é™ªè·‘æœå‹™", "è²·æˆ¿é™ªè·‘æ•™ç·´", "è²·æˆ¿èª²ç¨‹", "æˆ¿å±‹è²·è³£èˆ‡äº¤æ˜“"],
            "è²·æˆ¿é™ªè·‘æœå‹™": ["è²·æˆ¿", "è²·æˆ¿é™ªè·‘æ•™ç·´", "è²·æˆ¿èª²ç¨‹", "å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“", "åŸ¹è¨“èˆ‡é¡§å•"],
            "è²·æˆ¿é™ªè·‘æ•™ç·´": ["è²·æˆ¿", "è²·æˆ¿é™ªè·‘æœå‹™", "è²·æˆ¿èª²ç¨‹", "å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“", "åŸ¹è¨“èˆ‡é¡§å•"],
            "è²·æˆ¿èª²ç¨‹": ["è²·æˆ¿", "è²·æˆ¿é™ªè·‘æœå‹™", "è²·æˆ¿é™ªè·‘æ•™ç·´", "å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“", "åŸ¹è¨“èˆ‡é¡§å•"],
            "é™ªè·‘": ["è²·æˆ¿é™ªè·‘æœå‹™", "è²·æˆ¿é™ªè·‘æ•™ç·´", "åŸ¹è¨“èˆ‡é¡§å•"],
            "æ•™ç·´": ["è²·æˆ¿é™ªè·‘æ•™ç·´", "è²·æˆ¿é™ªè·‘æœå‹™", "åŸ¹è¨“èˆ‡é¡§å•"],
            "èª²ç¨‹": ["è²·æˆ¿èª²ç¨‹", "åŸ¹è¨“èˆ‡é¡§å•", "å°ˆæ¥­æœå‹™èˆ‡åŸ¹è¨“"],
            "éæˆ¶": ["éæˆ¶æœå‹™", "äº¤æ˜“æœå‹™"],
            "è³¼å±‹": ["è³¼å±‹è²¸æ¬¾", "è²¸æ¬¾æœå‹™"],
            "è³¼å±‹è²¸æ¬¾": ["è³¼å±‹", "è²¸æ¬¾æœå‹™"],
            "æˆå±‹è²¸æ¬¾": ["æˆå±‹", "è²¸æ¬¾æœå‹™"],
            "è½‰å¢è²¸": ["æˆ¿è²¸è½‰å¢è²¸", "è²¸æ¬¾æœå‹™"],
            "æˆ¿è²¸è½‰å¢è²¸": ["è½‰å¢è²¸", "è²¸æ¬¾æœå‹™"],
            "æˆä¿¡": ["éŠ€è¡Œæˆä¿¡", "è²¸æ¬¾æœå‹™"],
            "éŠ€è¡Œæˆä¿¡": ["æˆä¿¡", "è²¸æ¬¾æœå‹™"],
            "è¦åŠƒ": ["è²¸æ¬¾è¦åŠƒ", "è²¸æ¬¾æœå‹™"],
            "è²¸æ¬¾è¦åŠƒ": ["è¦åŠƒ", "è²¸æ¬¾æœå‹™"],
            "ç†è²¡å‹": ["ç†è²¡å‹æˆ¿è²¸", "è²¸æ¬¾æœå‹™"],
            "ç†è²¡å‹æˆ¿è²¸": ["ç†è²¡å‹", "è²¸æ¬¾æœå‹™"],
            "æ¸›å£“": ["æˆ¿è²¸æ¸›å£“é¡§å•", "è²¸æ¬¾æœå‹™"],
            "æˆ¿è²¸æ¸›å£“é¡§å•": ["æ¸›å£“", "è²¸æ¬¾æœå‹™"],
            "é–‹ç™¼": ["é–‹ç™¼èè³‡", "å»ºç¯‰èè³‡"],
            "é–‹ç™¼èè³‡": ["é–‹ç™¼", "å»ºç¯‰èè³‡"],
            "èˆˆå»º": ["èˆˆå»ºè³‡é‡‘", "å»ºç¯‰èè³‡"],
            "èˆˆå»ºè³‡é‡‘": ["èˆˆå»º", "å»ºç¯‰èè³‡"],
            "é€±è½‰": ["é€±è½‰é‡‘", "å»ºç¯‰èè³‡"],
            "é€±è½‰é‡‘": ["é€±è½‰", "å»ºç¯‰èè³‡"],
            "å·¥ç¨‹æ¬¾": ["å·¥ç¨‹æ¬¾èè³‡", "å»ºç¯‰èè³‡"],
            "å·¥ç¨‹æ¬¾èè³‡": ["å·¥ç¨‹æ¬¾", "å»ºç¯‰èè³‡"],
            "REITs": ["REITs", "ä¸å‹•ç”¢æŠ•è³‡"],
            "åŸºé‡‘": ["ä¸å‹•ç”¢åŸºé‡‘", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ä¸å‹•ç”¢åŸºé‡‘": ["åŸºé‡‘", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ç§å‹Ÿ": ["ç§å‹Ÿè‚¡æ¬Š", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ç§å‹Ÿè‚¡æ¬Š": ["ç§å‹Ÿ", "ä¸å‹•ç”¢æŠ•è³‡"],
            "å®¶æ—": ["å®¶æ—è¾¦å…¬å®¤", "ä¸å‹•ç”¢æŠ•è³‡"],
            "å®¶æ—è¾¦å…¬å®¤": ["å®¶æ—", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ä¿éšª": ["ä¿éšªè³‡é‡‘", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ä¿éšªè³‡é‡‘": ["ä¿éšª", "ä¸å‹•ç”¢æŠ•è³‡"],
            "è­‰åˆ¸åŒ–": ["è³‡ç”¢è­‰åˆ¸åŒ–", "ä¸å‹•ç”¢æŠ•è³‡"],
            "è³‡ç”¢è­‰åˆ¸åŒ–": ["è­‰åˆ¸åŒ–", "ä¸å‹•ç”¢æŠ•è³‡"],
            "å»ºå•†": ["å»ºå•†ä¿¡è¨—", "ä¸å‹•ç”¢æŠ•è³‡"],
            "å»ºå•†ä¿¡è¨—": ["å»ºå•†", "ä¸å‹•ç”¢æŠ•è³‡"],
            "æŠ•è³‡é¡§å•": ["ä¸å‹•ç”¢æŠ•è³‡é¡§å•", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ä¸å‹•ç”¢æŠ•è³‡é¡§å•": ["æŠ•è³‡é¡§å•", "ä¸å‹•ç”¢æŠ•è³‡"],
            "å·¥ç¨‹éšª": ["å·¥ç¨‹éšª", "é¢¨éšªä¿éšœ"],
            "è²¬ä»»éšª": ["è²¬ä»»éšª", "é¢¨éšªä¿éšœ"],
            "ç”¢éšª": ["ç”¢éšª", "é¢¨éšªä¿éšœ"],
            "å·¥ç¨‹å±¥ç´„ä¿è­‰": ["å±¥ç´„", "é¢¨éšªä¿éšœ"],
            "å»ºç¯‰å±¥ç´„ä¿è­‰": ["å±¥ç´„", "é¢¨éšªä¿éšœ"],
            "é ä»˜æ¬¾": ["é ä»˜æ¬¾ä¿è­‰", "é¢¨éšªä¿éšœ"],
            "é ä»˜æ¬¾ä¿è­‰": ["é ä»˜æ¬¾", "é¢¨éšªä¿éšœ"],
            "ä¸å‹•ç”¢ä¼°åƒ¹å¸«": ["ä¼°åƒ¹", "æ³•å¾‹æœå‹™"],
            "å…¬è­‰": ["å…¬è­‰äºº", "æ³•å¾‹æœå‹™"],
            "å…¬è­‰äºº": ["å…¬è­‰", "æ³•å¾‹æœå‹™"],
            "å¾ªç’°": ["å¾ªç’°ç¶“æ¿Ÿ", "ç’°å¢ƒè¨­è¨ˆ"],
            "å¾ªç’°ç¶“æ¿Ÿ": ["å¾ªç’°", "ç’°å¢ƒè¨­è¨ˆ"],
            "æ°¸çºŒ": ["æ°¸çºŒè¦åŠƒ", "ç’°å¢ƒè¨­è¨ˆ"],
            "æ°¸çºŒè¦åŠƒ": ["æ°¸çºŒ", "ç’°å¢ƒè¨­è¨ˆ"],
            "ç¶ å»ºç¯‰": ["ç¶ å»ºç¯‰è¨­è¨ˆ", "ç’°å¢ƒè¨­è¨ˆ"],
            "ç¶ å»ºç¯‰è¨­è¨ˆ": ["ç¶ å»ºç¯‰", "ç’°å¢ƒè¨­è¨ˆ"],
            "ç¯€èƒ½è¨­è¨ˆ": ["ç¯€èƒ½", "ç’°å¢ƒè¨­è¨ˆ"],
            "ç’°ä¿è¨­è¨ˆ": ["ç’°ä¿", "ç’°å¢ƒè¨­è¨ˆ"],
            "åŸºç¤": ["åŸºç¤è¨­è¨ˆ", "çµæ§‹è¨­è¨ˆ"],
            "åŸºç¤è¨­è¨ˆ": ["åŸºç¤", "çµæ§‹è¨­è¨ˆ"],
            "çµæ§‹è¨ˆç®—": ["çµæ§‹", "çµæ§‹è¨­è¨ˆ"],
            "æŠ—éœ‡": ["æŠ—éœ‡è¨­è¨ˆ", "çµæ§‹è¨­è¨ˆ"],
            "æŠ—éœ‡è¨­è¨ˆ": ["æŠ—éœ‡", "çµæ§‹è¨­è¨ˆ"],
            "è€éœ‡": ["è€éœ‡è£œå¼·è¨­è¨ˆ", "çµæ§‹è¨­è¨ˆ"],
            "è€éœ‡è£œå¼·è¨­è¨ˆ": ["è€éœ‡", "çµæ§‹è¨­è¨ˆ"],
            "è¼‰é‡": ["è¼‰é‡åˆ†æ", "çµæ§‹è¨­è¨ˆ"],
            "è¼‰é‡åˆ†æ": ["è¼‰é‡", "çµæ§‹è¨­è¨ˆ"],
            "éš”å¥—": ["åˆæ³•éš”å¥—è¨­è¨ˆ", "ç‰¹æ®Šè¦åŠƒ"],
            "åˆæ³•éš”å¥—è¨­è¨ˆ": ["éš”å¥—", "ç‰¹æ®Šè¦åŠƒ"],
            "æ¨¡çµ„åŒ–": ["æ¨¡çµ„åŒ–è¼•è£ä¿®", "ç‰¹æ®Šè¦åŠƒ"],
            "æ¨¡çµ„åŒ–è¼•è£ä¿®": ["æ¨¡çµ„åŒ–", "ç‰¹æ®Šè¦åŠƒ"],
            "æ—…å®¿": ["æ—…å®¿è³‡ç”¢æ´»åŒ–", "ç‰¹æ®Šè¦åŠƒ"],
            "æ—…å®¿è³‡ç”¢æ´»åŒ–": ["æ—…å®¿", "ç‰¹æ®Šè¦åŠƒ"],
            "æ©Ÿé›»é¡§å•": ["æ©Ÿé›»", "æ©Ÿé›»è¨­è¨ˆ"],
            "æ¶ˆé˜²é¡§å•": ["æ¶ˆé˜²", "æ©Ÿé›»è¨­è¨ˆ"],
            "å¼±é›»é¡§å•": ["å¼±é›»", "æ©Ÿé›»è¨­è¨ˆ"],
            "ç©ºèª¿è¨­è¨ˆ": ["ç©ºèª¿", "æ©Ÿé›»è¨­è¨ˆ"],
            "ç©ºé–“è¦åŠƒ": ["ç©ºé–“", "å®¤å…§è¨­è¨ˆ"],
            "ç‡ˆå…‰": ["ç‡ˆå…‰è¨­è¨ˆ", "å®¤å…§è¨­è¨ˆ"],
            "ç‡ˆå…‰è¨­è¨ˆ": ["ç‡ˆå…‰", "å®¤å…§è¨­è¨ˆ"],
            "è»Ÿè£": ["è»Ÿè£è¨­è¨ˆ", "å®¤å…§è¨­è¨ˆ"],
            "è»Ÿè£è¨­è¨ˆ": ["è»Ÿè£", "å®¤å…§è¨­è¨ˆ"],
            "å•†ç©º": ["å•†ç©ºå®¤å…§è¨­è¨ˆ", "å®¤å…§è¨­è¨ˆ"],
            "å•†ç©ºå®¤å…§è¨­è¨ˆ": ["å•†ç©º", "å®¤å…§è¨­è¨ˆ"],
            "é•·ç…§": ["é•·ç…§ç©ºé–“è¦åŠƒ", "å®¤å…§è¨­è¨ˆ"],
            "é•·ç…§ç©ºé–“è¦åŠƒ": ["é•·ç…§", "å®¤å…§è¨­è¨ˆ"],
            "éƒ½å¸‚è¨ˆç•«": ["éƒ½å¸‚è¨ˆç•«é¡§å•", "å»ºç¯‰è¨­è¨ˆ"],
            "éƒ½å¸‚è¨ˆç•«é¡§å•": ["éƒ½å¸‚è¨ˆç•«", "å»ºç¯‰è¨­è¨ˆ"],
            "æ™¯è§€": ["æ™¯è§€è¨­è¨ˆ", "å»ºç¯‰è¨­è¨ˆ"],
            "æ™¯è§€è¨­è¨ˆ": ["æ™¯è§€", "å»ºç¯‰è¨­è¨ˆ"],
            "é å”®å±‹ä»£éŠ·": ["é å”®", "å»ºæ¡ˆè¡ŒéŠ·"],
            "æˆå±‹ä»£éŠ·": ["æˆå±‹", "å»ºæ¡ˆè¡ŒéŠ·"],
            "å»ºæ¡ˆä»£éŠ·": ["å»ºæ¡ˆ", "å»ºæ¡ˆè¡ŒéŠ·"],
            "è±ªå®…": ["è±ªå®…ä»£éŠ·", "å»ºæ¡ˆè¡ŒéŠ·"],
            "è±ªå®…ä»£éŠ·": ["è±ªå®…", "å»ºæ¡ˆè¡ŒéŠ·"],
            "æµ·å¤–ä»£éŠ·": ["æµ·å¤–", "å»ºæ¡ˆè¡ŒéŠ·"],
            "ç¶²ç«™": ["ç¶²ç«™å»ºç½®", "æ•¸ä½è¡ŒéŠ·"],
            "ç¶²ç«™å»ºç½®": ["ç¶²ç«™", "æ•¸ä½è¡ŒéŠ·"],
            "Instagram": ["Instagramè¡ŒéŠ·", "æ•¸ä½è¡ŒéŠ·"],
            "Instagramè¡ŒéŠ·": ["Instagram", "æ•¸ä½è¡ŒéŠ·"],
            "YouTube": ["YouTubeè¡ŒéŠ·", "æ•¸ä½è¡ŒéŠ·"],
            "YouTubeè¡ŒéŠ·": ["YouTube", "æ•¸ä½è¡ŒéŠ·"],
            "LINE": ["LINEå®˜æ–¹å¸³è™Ÿ", "æ•¸ä½è¡ŒéŠ·"],
            "LINEå®˜æ–¹å¸³è™Ÿ": ["LINE", "æ•¸ä½è¡ŒéŠ·"],
            "ä»£æ“": ["æ•¸ä½å»£å‘Šä»£æ“", "æ•¸ä½è¡ŒéŠ·"],
            "æ•¸ä½å»£å‘Šä»£æ“": ["ä»£æ“", "æ•¸ä½è¡ŒéŠ·"],
            "æ–‡å®£": ["å»ºæ¡ˆæ–‡å®£", "å…§å®¹è¡ŒéŠ·"],
            "å»ºæ¡ˆæ–‡å®£": ["æ–‡å®£", "å…§å®¹è¡ŒéŠ·"],
            "æ–°èç¨¿": ["æ–°èç¨¿ä»£å¯«", "å…§å®¹è¡ŒéŠ·"],
            "æ–°èç¨¿ä»£å¯«": ["æ–°èç¨¿", "å…§å®¹è¡ŒéŠ·"],
            "ç›´æ’­": ["ç›´æ’­éŠ·å”®", "å…§å®¹è¡ŒéŠ·"],
            "ç›´æ’­éŠ·å”®": ["ç›´æ’­", "å…§å®¹è¡ŒéŠ·"],
            "çŸ­å½±éŸ³": ["çŸ­å½±éŸ³è£½ä½œ", "å…§å®¹è¡ŒéŠ·"],
            "çŸ­å½±éŸ³è£½ä½œ": ["çŸ­å½±éŸ³", "å…§å®¹è¡ŒéŠ·"],
            "å“ç‰Œ": ["å“ç‰Œä¼åŠƒ", "å‚³çµ±è¡ŒéŠ·"],
            "å“ç‰Œä¼åŠƒ": ["å“ç‰Œ", "å‚³çµ±è¡ŒéŠ·"],
            "ä¼åŠƒ": ["è¡ŒéŠ·ä¼åŠƒ", "å‚³çµ±è¡ŒéŠ·"],
            "è¡ŒéŠ·ä¼åŠƒ": ["ä¼åŠƒ", "å‚³çµ±è¡ŒéŠ·"],
            "åª’é«”": ["åª’é«”æŠ•æ”¾", "å‚³çµ±è¡ŒéŠ·"],
            "åª’é«”æŠ•æ”¾": ["åª’é«”", "å‚³çµ±è¡ŒéŠ·"],
            "æ´»å‹•": ["æ´»å‹•ä¼åŠƒ", "å‚³çµ±è¡ŒéŠ·"],
            "æ´»å‹•ä¼åŠƒ": ["æ´»å‹•", "å‚³çµ±è¡ŒéŠ·"],
            "æ‹›ç‰Œ": ["æ‹›ç‰Œè£½ä½œ", "å‚³çµ±è¡ŒéŠ·"],
            "æ‹›ç‰Œè£½ä½œ": ["æ‹›ç‰Œ", "å‚³çµ±è¡ŒéŠ·"],
            "æœƒå ´": ["æœƒå ´ä½ˆç½®", "å‚³çµ±è¡ŒéŠ·"],
            "æœƒå ´ä½ˆç½®": ["æœƒå ´", "å‚³çµ±è¡ŒéŠ·"],
            "å¯è¡Œæ€§": ["å¯è¡Œæ€§è©•ä¼°", "å¸‚å ´ç ”ç©¶"],
            "å¯è¡Œæ€§è©•ä¼°": ["å¯è¡Œæ€§", "å¸‚å ´ç ”ç©¶"],
            "æŠ•è³‡è©•ä¼°": ["æŠ•è³‡", "å¸‚å ´ç ”ç©¶"],
            "ç§Ÿé‡‘": ["ç§Ÿé‡‘è©•ä¼°", "å¸‚å ´ç ”ç©¶"],
            "ç§Ÿé‡‘è©•ä¼°": ["ç§Ÿé‡‘", "å¸‚å ´ç ”ç©¶"],
            "åƒ¹æ ¼": ["åƒ¹æ ¼åˆ†æ", "å¸‚å ´ç ”ç©¶"],
            "åƒ¹æ ¼åˆ†æ": ["åƒ¹æ ¼", "å¸‚å ´ç ”ç©¶"],
            "ä¸å‹•ç”¢å¸‚å ´åˆ†æ": ["å¸‚å ´", "å¸‚å ´ç ”ç©¶"],
            "æˆ¿ç”¢è³‡è¨Šç¶²": ["æˆ¿ç”¢", "è³‡è¨Šå¹³å°"],
            "ä¿¡ç¾©": ["ä¿¡ç¾©æˆ¿å±‹ç¶²", "è³‡è¨Šå¹³å°"],
            "ä¿¡ç¾©æˆ¿å±‹ç¶²": ["ä¿¡ç¾©", "è³‡è¨Šå¹³å°"],
            "æ°¸æ…¶": ["æ°¸æ…¶æˆ¿å±‹ç¶²", "è³‡è¨Šå¹³å°"],
            "æ°¸æ…¶æˆ¿å±‹ç¶²": ["æ°¸æ…¶", "è³‡è¨Šå¹³å°"],
            "ç¤¾å€": ["ç¤¾å€ç®¡ç†", "ç‰©æ¥­ç®¡ç†"],
            "ç¤¾å€ç®¡ç†": ["ç¤¾å€", "ç‰©æ¥­ç®¡ç†"],
            "å¤§æ¨“": ["å¤§æ¨“ç®¡ç†", "ç‰©æ¥­ç®¡ç†"],
            "å¤§æ¨“ç®¡ç†": ["å¤§æ¨“", "ç‰©æ¥­ç®¡ç†"],
            "è¨­æ–½": ["è¨­æ–½ç¶­è­·", "ç‰©æ¥­ç®¡ç†"],
            "è¨­æ–½ç¶­è­·": ["è¨­æ–½", "ç‰©æ¥­ç®¡ç†"],
            "ç‰©æ¥­é¡§å•": ["ç‰©æ¥­", "ç‰©æ¥­ç®¡ç†"],
            "å®‰å…¨ç¶­è­·": ["å®‰å…¨", "ç‰©æ¥­ç®¡ç†"],
            "å·¡é‚": ["å·¡é‚æœå‹™", "å®‰å…¨ç¶­è­·"],
            "å·¡é‚æœå‹™": ["å·¡é‚", "å®‰å…¨ç¶­è­·"],
            "é˜²ç›œ": ["é˜²ç›œç³»çµ±", "å®‰å…¨ç¶­è­·"],
            "é˜²ç›œç³»çµ±": ["é˜²ç›œ", "å®‰å…¨ç¶­è­·"],
            "æ¶ˆé˜²å®‰å…¨æª¢ä¿®": ["å®‰å…¨", "å®‰å…¨ç¶­è­·"],
            "å®šæœŸ": ["å®šæœŸæ¸…æ½”", "æ¸…æ½”æœå‹™"],
            "å®šæœŸæ¸…æ½”": ["å®šæœŸ", "æ¸…æ½”æœå‹™"],
            "æ·±åº¦": ["æ·±åº¦æ¸…æ½”", "æ¸…æ½”æœå‹™"],
            "æ·±åº¦æ¸…æ½”": ["æ·±åº¦", "æ¸…æ½”æœå‹™"],
            "å¤–ç‰†": ["å¤–ç‰†æ¸…æ´—", "æ¸…æ½”æœå‹™"],
            "å¤–ç‰†æ¸…æ´—": ["å¤–ç‰†", "æ¸…æ½”æœå‹™"],
            "é™¤èŸ²": ["é™¤èŸ²æ¶ˆæ¯’", "æ¸…æ½”æœå‹™"],
            "é™¤èŸ²æ¶ˆæ¯’": ["é™¤èŸ²", "æ¸…æ½”æœå‹™"],
            "ä¿é¤Š": ["é›»æ¢¯ä¿é¤Š", "æ©Ÿé›»ç¶­è­·"],
            "ç©ºèª¿ä¿é¤Š": ["ç©ºèª¿", "æ©Ÿé›»ç¶­è­·"],
            "ç›£æ§ç¶­è­·": ["ç›£æ§", "æ©Ÿé›»ç¶­è­·"],
            "åœ’è—è¨­è¨ˆ": ["åœ’è—", "åœ’è—ç¶­è­·"],
            "æ¤æ ½": ["æ¤æ ½é¤Šè­·", "åœ’è—ç¶­è­·"],
            "æ¤æ ½é¤Šè­·": ["æ¤æ ½", "åœ’è—ç¶­è­·"],
            "æ™¯è§€ç¶­è­·": ["æ™¯è§€", "åœ’è—ç¶­è­·"],
            "ç§Ÿå®¢": ["ç§Ÿå®¢æœå‹™", "ç§Ÿè³ƒæœå‹™"],
            "ç§Ÿå®¢æœå‹™": ["ç§Ÿå®¢", "ç§Ÿè³ƒæœå‹™"],
            "ç§Ÿç´„": ["ç§Ÿç´„ç®¡ç†", "ç§Ÿè³ƒæœå‹™"],
            "ç§Ÿç´„ç®¡ç†": ["ç§Ÿç´„", "ç§Ÿè³ƒæœå‹™"],
            "ä»£æ”¶": ["ç§Ÿé‡‘ä»£æ”¶", "ç§Ÿè³ƒæœå‹™"],
            "ç§Ÿé‡‘ä»£æ”¶": ["ä»£æ”¶", "ç§Ÿè³ƒæœå‹™"],
            "åŒ…ç§Ÿ": ["åŒ…ç§Ÿä»£ç®¡", "ç§Ÿè³ƒæœå‹™"],
            "åŒ…ç§Ÿä»£ç®¡": ["åŒ…ç§Ÿ", "ç§Ÿè³ƒæœå‹™"],
            "çŸ­æœŸ": ["çŸ­æœŸç§Ÿè³ƒ", "ç§Ÿè³ƒæœå‹™"],
            "çŸ­æœŸç§Ÿè³ƒ": ["çŸ­æœŸ", "ç§Ÿè³ƒæœå‹™"],
            "ç‰†é¢": ["ç‰†é¢ä¿®è£œ", "ä¿®ç¹•æœå‹™"],
            "ç‰†é¢ä¿®è£œ": ["ç‰†é¢", "ä¿®ç¹•æœå‹™"],
            "é–€çª—": ["é–€çª—ç¶­ä¿®", "ä¿®ç¹•æœå‹™"],
            "é–€çª—ç¶­ä¿®": ["é–€çª—", "ä¿®ç¹•æœå‹™"],
            "è¨ªå®¢": ["è¨ªå®¢ç®¡ç†ç³»çµ±", "æ•¸ä½å¹³å°"],
            "è¨ªå®¢ç®¡ç†ç³»çµ±": ["è¨ªå®¢", "æ•¸ä½å¹³å°"],
            "å ±ä¿®": ["ç¶­ä¿®å ±ä¿®ç³»çµ±", "æ•¸ä½å¹³å°"],
            "ç¶­ä¿®å ±ä¿®ç³»çµ±": ["å ±ä¿®", "æ•¸ä½å¹³å°"],
            "ç¤¾å€APP": ["APP", "æ•¸ä½å¹³å°"],
            "çŸ­æœŸç§Ÿè³ƒç®¡ç†": ["çŸ­æœŸ", "çŸ­ç§Ÿç‡Ÿé‹"],
            "é è¨‚": ["é è¨‚ç®¡ç†", "çŸ­ç§Ÿç‡Ÿé‹"],
            "é è¨‚ç®¡ç†": ["é è¨‚", "çŸ­ç§Ÿç‡Ÿé‹"],
            "æ¸…æ½”èª¿é…": ["æ¸…æ½”", "çŸ­ç§Ÿç‡Ÿé‹"],
            "å®¢æœ": ["å®¢æœæ”¯æ´", "çŸ­ç§Ÿç‡Ÿé‹"],
            "å®¢æœæ”¯æ´": ["å®¢æœ", "çŸ­ç§Ÿç‡Ÿé‹"],
            "Airbnbä»£ç‡Ÿé‹": ["Airbnb", "çŸ­ç§Ÿç‡Ÿé‹"],
            "åŠè»Š": ["åŠè»Š", "æ–½å·¥è¨­å‚™"],
            "æ³µè»Š": ["æ³µè»Š", "æ–½å·¥è¨­å‚™"],
            "é«˜ç©º": ["é«˜ç©ºä½œæ¥­", "æ–½å·¥è¨­å‚™"],
            "é«˜ç©ºä½œæ¥­": ["é«˜ç©º", "æ–½å·¥è¨­å‚™"],
            "æ¸¬é‡": ["æ¸¬é‡å„€å™¨", "æ–½å·¥è¨­å‚™"],
            "æ¸¬é‡å„€å™¨": ["æ¸¬é‡", "æ–½å·¥è¨­å‚™"],
            "åˆ‡å‰²": ["åˆ‡å‰²è¨­å‚™", "æ–½å·¥è¨­å‚™"],
            "åˆ‡å‰²è¨­å‚™": ["åˆ‡å‰²", "æ–½å·¥è¨­å‚™"],
            "ç„Šæ¥è¨­å‚™": ["ç„Šæ¥", "æ–½å·¥è¨­å‚™"],
            "ç²—æ¸…": ["ç²—æ¸…", "æ–½å·¥æ¸…æ½”"],
            "ç´°æ¸…": ["ç´°æ¸…", "æ–½å·¥æ¸…æ½”"],
            "å»¢æ£„ç‰©": ["å»¢æ£„ç‰©è™•ç†", "æ–½å·¥æ¸…æ½”"],
            "å»¢æ£„ç‰©è™•ç†": ["å»¢æ£„ç‰©", "æ–½å·¥æ¸…æ½”"],
            "ç¸½åŒ…": ["ç¸½åŒ…", "ç‡Ÿé€ ç®¡ç†"],
            "åˆ†åŒ…": ["åˆ†åŒ…ç®¡ç†", "ç‡Ÿé€ ç®¡ç†"],
            "åˆ†åŒ…ç®¡ç†": ["åˆ†åŒ…", "ç‡Ÿé€ ç®¡ç†"],
            "ç‡Ÿé€ å•†": ["ç‡Ÿé€ ", "ç‡Ÿé€ ç®¡ç†"],
            "ç‡Ÿå»ºæ•´åˆ": ["ç‡Ÿå»º", "ç‡Ÿé€ ç®¡ç†"],
            "é‹¼ç­‹": ["é‹¼ç­‹", "å»ºæä¾›æ‡‰"],
            "æ··å‡åœŸ": ["æ··å‡åœŸ", "å»ºæä¾›æ‡‰"],
            "æ¨¡æ¿": ["æ¨¡æ¿", "å»ºæä¾›æ‡‰"],
            "éš”ç†±ææ–™": ["éš”ç†±", "å»ºæä¾›æ‡‰"],
            "é˜²ç«": ["é˜²ç«å»ºæ", "å»ºæä¾›æ‡‰"],
            "é˜²ç«å»ºæ": ["é˜²ç«", "å»ºæä¾›æ‡‰"],
            "ç¶ å»ºæ": ["ç¶ ", "å»ºæä¾›æ‡‰"],
            "è¼•éš”é–“": ["éš”é–“", "å»ºæä¾›æ‡‰"],
            "ç…§æ˜": ["ç…§æ˜è¨­å‚™", "å»ºæä¾›æ‡‰"],
            "ç…§æ˜è¨­å‚™": ["ç…§æ˜", "å»ºæä¾›æ‡‰"],
            "ç³»çµ±æ«ƒ": ["æ«ƒ", "å»ºæä¾›æ‡‰"],
            "çª—ç°¾": ["çª—ç°¾çª—é£¾", "å»ºæä¾›æ‡‰"],
            "çª—ç°¾çª—é£¾": ["çª—ç°¾", "å»ºæä¾›æ‡‰"],
            "é©—æ”¶æµç¨‹": ["é©—æ”¶", "äº¤ä»˜æœå‹™"],
            "é»äº¤": ["é»äº¤æœå‹™", "äº¤ä»˜æœå‹™"],
            "é»äº¤æœå‹™": ["é»äº¤", "äº¤ä»˜æœå‹™"],
            "ä½¿ç”¨èªªæ˜": ["èªªæ˜", "äº¤ä»˜æœå‹™"],
            "å»ºç¯‰æ³•è¦": ["æ³•è¦", "æ³•è¦è«®è©¢"],
            "ç’°ä¿æ³•è¦": ["ç’°ä¿", "æ³•è¦è«®è©¢"],
            "ESG": ["ESGï¼ç¢³ç›¤æŸ¥é¡§å•", "æ³•è¦è«®è©¢"],
            "ESGï¼ç¢³ç›¤æŸ¥é¡§å•": ["ESG", "æ³•è¦è«®è©¢"],
            "ç¢³ç›¤æŸ¥": ["ESGï¼ç¢³ç›¤æŸ¥é¡§å•", "æ³•è¦è«®è©¢"],
            "æ¶ˆé˜²æ³•è¦": ["æ¶ˆé˜²", "æ³•è¦è«®è©¢"],
            "æ°´åœŸä¿æŒ": ["æ°´åœŸä¿æŒæ³•è¦", "æ³•è¦è«®è©¢"],
            "æ°´åœŸä¿æŒæ³•è¦": ["æ°´åœŸä¿æŒ", "æ³•è¦è«®è©¢"],
            "éºç”¢": ["éºç”¢è¦åŠƒ", "ç¨…å‹™è¦åŠƒ"],
            "éºç”¢è¦åŠƒ": ["éºç”¢", "ç¨…å‹™è¦åŠƒ"],
            "ä¿¡è¨—èˆ‡å—è¨—æ©Ÿæ§‹": ["ä¿¡è¨—", "ç¨…å‹™è¦åŠƒ"],
            "ç¯€ç¨…": ["ç¯€ç¨…è¦åŠƒ", "ç¨…å‹™è¦åŠƒ"],
            "ç¯€ç¨…è¦åŠƒ": ["ç¯€ç¨…", "ç¨…å‹™è¦åŠƒ"],
            "ä¸å‹•ç”¢ç¨…å‹™è¦åŠƒ": ["ç¨…å‹™", "ç¨…å‹™è¦åŠƒ"],
            "æˆ¿å±‹è²·è³£": ["æˆ¿å±‹è²·è³£èˆ‡äº¤æ˜“", "ä»²ä»‹æœå‹™", "äº¤æ˜“æœå‹™"],
            "æˆ¿å±‹è²·è³£èˆ‡äº¤æ˜“": ["æˆ¿å±‹è²·è³£", "ä»²ä»‹æœå‹™", "äº¤æ˜“æœå‹™"],
            "ç†è²¡": ["ç†è²¡è¦åŠƒ", "ç†è²¡é¡§å•", "æŠ•è³‡ç†è²¡", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "ç†è²¡è¦åŠƒ": ["ç†è²¡", "ç†è²¡é¡§å•", "æŠ•è³‡ç†è²¡", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘": ["ç†è²¡", "ç†è²¡è¦åŠƒ", "è²¸æ¬¾æœå‹™", "ç¨…å‹™è¦åŠƒ"],
            "æŠ•è³‡ç†è²¡": ["ç†è²¡", "ç†è²¡è¦åŠƒ", "ç†è²¡é¡§å•"],
            "æˆ¿è²¸": ["è³¼å±‹è²¸æ¬¾", "æˆ¿è²¸è½‰å¢è²¸", "æˆ¿è²¸ä»£å„Ÿ", "è²¸æ¬¾æœå‹™", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "æˆ¿è²¸ä»£å„Ÿ": ["æˆ¿è²¸", "è²¸æ¬¾æœå‹™"],
            "å¯Œé‚¦äººå£½": ["ä¿éšª", "ä¿éšªæœå‹™", "å£½éšª", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "åœ‹æ³°äººå£½": ["ä¿éšª", "ä¿éšªæœå‹™", "å£½éšª"],
            "æ–°å…‰äººå£½": ["ä¿éšª", "ä¿éšªæœå‹™", "å£½éšª"],
            "å—å±±äººå£½": ["ä¿éšª", "ä¿éšªæœå‹™", "å£½éšª"],
            "ä¿éšª": ["ä¿éšªæœå‹™", "å¯Œé‚¦äººå£½", "åœ‹æ³°äººå£½", "æ–°å…‰äººå£½", "å—å±±äººå£½", "å£½éšª", "ç”¢éšª"],
            "ä¿éšªæœå‹™": ["ä¿éšª", "å¯Œé‚¦äººå£½", "ç†è²¡è¦åŠƒèˆ‡è³‡é‡‘"],
            "å£½éšª": ["ä¿éšª", "ä¿éšªæœå‹™", "å¯Œé‚¦äººå£½"],
            "ç”¢éšª": ["ä¿éšª", "ä¿éšªæœå‹™", "ç”¢ç‰©ä¿éšª"],
            "ä»²ä»‹": ["ä»²ä»‹æœå‹™", "ä½å®…ä»²ä»‹", "å•†æ¥­ä¸å‹•ç”¢"],
            "ä»²ä»‹æœå‹™": ["ä»²ä»‹", "æˆ¿å±‹è²·è³£èˆ‡äº¤æ˜“"],
            "ä¸å‹•ç”¢ç¶“ç´€": ["ä»²ä»‹", "ä»²ä»‹æœå‹™"],
            "é»äº¤éæˆ¶": ["éæˆ¶", "äº¤æ˜“æœå‹™"],
            "ä¸­å¤å±‹": ["æˆå±‹", "ç‰¹æ®Šç‰©ä»¶"],
            "æ–°æˆå±‹": ["æˆå±‹", "ç‰¹æ®Šç‰©ä»¶"],
            "é‡åŠƒå€é–‹ç™¼": ["åœŸåœ°é–‹ç™¼", "ç‰¹æ®Šæ¸ é“"],
            "ä¸å‹•ç”¢ç™»è¨˜": ["åœ°æ”¿", "åœ°æ”¿æœå‹™"],
            "ä¿¡ç”¨è²¸æ¬¾": ["è²¸æ¬¾", "è²¸æ¬¾æœå‹™"],
            "ä¼æ¥­è²¸æ¬¾": ["è²¸æ¬¾", "è²¸æ¬¾æœå‹™"],
            "åœŸåœ°èè³‡": ["èè³‡", "å»ºç¯‰èè³‡"],
            "å»ºç¯‰èè³‡è¦åŠƒ": ["èè³‡", "å»ºç¯‰èè³‡"],
            "ä¸å‹•ç”¢è­‰åˆ¸åŒ–": ["æŠ•è³‡", "ä¸å‹•ç”¢æŠ•è³‡"],
            "ç«éšª": ["ä¿éšª", "é¢¨éšªä¿éšœ"],
            "åœ°éœ‡éšª": ["ä¿éšª", "é¢¨éšªä¿éšœ"],
            "è²¡ç”¢ç§»è½‰è¦åŠƒ": ["ç¨…å‹™", "ç¨…å‹™è¦åŠƒ"],
            "è£æ½¢è¨­è¨ˆ": ["è£æ½¢", "å®¤å…§è£æ½¢", "è¨­è¨ˆèˆ‡è¦åŠƒ"],
            "è£æ½¢": ["è£æ½¢è¨­è¨ˆ", "å®¤å…§è£æ½¢"],
            "å®¤å…§è£æ½¢": ["è£æ½¢", "è£æ½¢è¨­è¨ˆ"],
            "è»Ÿè£è¨­è¨ˆ": ["è»Ÿè£", "è»Ÿè£ä½ˆç½®", "è¨­è¨ˆèˆ‡è¦åŠƒ"],
            "è»Ÿè£": ["è»Ÿè£è¨­è¨ˆ", "è»Ÿè£ä½ˆç½®"],
            "è»Ÿè£ä½ˆç½®": ["è»Ÿè£", "è»Ÿè£è¨­è¨ˆ"],
            "å‚¢ä¿±": ["å‚¢ä¿±æ¡è³¼", "å‚¢ä¿±è¨­è¨ˆ", "è¨‚è£½å‚¢ä¿±", "å‚¢ä¿±é…ç½®"],
            "å‚¢ä¿±é…ç½®": ["å‚¢ä¿±", "è»Ÿè£è¨­è¨ˆ"],
            "çª—ç°¾è¨­è¨ˆ": ["çª—ç°¾", "è»Ÿè£è¨­è¨ˆ"],
            "ç‡ˆé£¾æ­é…": ["ç‡ˆé£¾", "è»Ÿè£è¨­è¨ˆ"],
            "è—è¡“æ“ºè¨­": ["æ“ºè¨­", "è»Ÿè£è¨­è¨ˆ"],
            "å¤©èŠ±æ¿è¨­è¨ˆ": ["å¤©èŠ±æ¿", "è£æ½¢è¨­è¨ˆ"],
            "ç‰†é¢è¨­è¨ˆ": ["ç‰†é¢", "è£æ½¢è¨­è¨ˆ"],
            "åœ°æ¿è¨­è¨ˆ": ["åœ°æ¿", "è£æ½¢è¨­è¨ˆ"],
            "è‰²å½©è¦åŠƒ": ["è‰²å½©", "è£æ½¢è¨­è¨ˆ"],
            "ç…§æ˜è¨­è¨ˆ": ["ç…§æ˜", "ç‡ˆå…‰è¨­è¨ˆ"],
            "ç‡ˆå…‰è¦åŠƒ": ["ç‡ˆå…‰", "ç‡ˆå…‰è¨­è¨ˆ"],
            "æ°›åœç‡Ÿé€ ": ["æ°›åœ", "ç‡ˆå…‰è¨­è¨ˆ"],
            "æ™ºèƒ½ç…§æ˜è¨­è¨ˆ": ["æ™ºèƒ½ç…§æ˜", "ç‡ˆå…‰è¨­è¨ˆ"],
            "å¤šåŠŸèƒ½å‚¢ä¿±": ["å‚¢ä¿±", "å‚¢ä¿±è¨­è¨ˆ"],
            "å±…å®¶æ”¶ç´è¨­è¨ˆ": ["æ”¶ç´", "å‚¢ä¿±è¨­è¨ˆ"],
            "ä¿®ç¹•": ["ä¿®ç¹•æœå‹™", "å·¥ç¨‹è¦åŠƒèˆ‡ä¿®ç¹•"],
            "ä¿®ç¹•æœå‹™": ["ä¿®ç¹•", "å·¥ç¨‹è¦åŠƒèˆ‡ä¿®ç¹•"],
            "æˆ¿å±‹ä¿®ç¹•": ["ä¿®ç¹•", "ä¿®ç¹•æœå‹™"],
            "è€å±‹ç¿»æ–°": ["ç¿»æ–°", "ä¿®ç¹•æœå‹™"],
            "æ¼æ°´ä¿®ç¹•": ["æ¼æ°´", "ä¿®ç¹•æœå‹™"],
            "ç‰†é¢ä¿®è£œ": ["ä¿®è£œ", "ä¿®ç¹•æœå‹™"],
            "å‚¢ä¿±æ¡è³¼": ["å‚¢ä¿±", "å‚¢ä¿±å‚¢é›»èˆ‡å»ºæ"],
            "å‚¢ä¿±è¨­è¨ˆ": ["å‚¢ä¿±", "å®¤å…§è¨­è¨ˆ", "è¨­è¨ˆèˆ‡è¦åŠƒ"],
            "è¨‚è£½å‚¢ä¿±": ["å‚¢ä¿±", "å®¤å…§è¨­è¨ˆ", "å‚¢ä¿±æ¡è³¼", "è¨­è¨ˆèˆ‡è¦åŠƒ"],
            "å®¶é›»": ["å®¶é›»æ¡è³¼", "å®¶é›»"],
            "å®¶é›»æ¡è³¼": ["å®¶é›»", "å‚¢ä¿±å‚¢é›»èˆ‡å»ºæ"],
            "å¯¢å…·": ["å¯¢å…·æ¡è³¼", "å¯¢å…·"],
            "å¯¢å…·æ¡è³¼": ["å¯¢å…·", "å‚¢ä¿±å‚¢é›»èˆ‡å»ºæ"],
            "å»ºæ": ["å»ºææ¡è³¼", "å»ºæä¾›æ‡‰", "åŸºç¤å»ºæ", "çµæ§‹å»ºæ"],
            "å»ºææ¡è³¼": ["å»ºæ", "å‚¢ä¿±å‚¢é›»èˆ‡å»ºæ"],
            "å»ºæä¾›æ‡‰": ["å»ºæ", "å·¥ç¨‹è¦åŠƒèˆ‡ä¿®ç¹•"],
            "åŸºç¤å»ºæ": ["å»ºæ", "å»ºæä¾›æ‡‰", "å»ºææ¡è³¼"],
            "çµæ§‹å»ºæ": ["å»ºæ", "å»ºæä¾›æ‡‰", "å»ºææ¡è³¼"],
            "è³¼è²·": ["å‚¢ä¿±æ¡è³¼", "å®¶é›»æ¡è³¼", "å¯¢å…·æ¡è³¼", "å»ºææ¡è³¼"],
            "æ¡è³¼": ["å‚¢ä¿±æ¡è³¼", "å®¶é›»æ¡è³¼", "å¯¢å…·æ¡è³¼", "å»ºææ¡è³¼"],
            "ç³»çµ±å®¶å…·": ["ç³»çµ±å‚¢ä¿±", "æœ¨ä½œå·¥ç¨‹", "å‚¢ä¿±æ¡è³¼"],
            "ç³»çµ±å‚¢ä¿±": ["ç³»çµ±å®¶å…·", "å‚¢ä¿±æ¡è³¼"],
            "æœ¨ä½œå»ºæ": ["æœ¨ä½œ", "æœ¨ä½œå·¥ç¨‹", "å»ºææ¡è³¼"]
        };
        
        // ç²å–åŒç¾©è©çš„æ“´å±•æœç´¢è©
        function getExpandedSearchTerms(query) {
            const terms = [query];
            if (searchSynonyms[query]) {
                terms.push(...searchSynonyms[query]);
            }
            return terms;
        }

        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        function initEnhancedSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchClearBtn = document.getElementById('searchClearBtn');
            
            // æ·»åŠ éµç›¤äº‹ä»¶ç›£è½
            searchInput.addEventListener('keydown', handleSearchKeydown);
            
            // æ·»åŠ ç„¦é»äº‹ä»¶
            searchInput.addEventListener('focus', showSearchSuggestions);
            
            // æ›´æ–°æ¸…é™¤æŒ‰éˆ•é¡¯ç¤º
            searchInput.addEventListener('input', function() {
                searchClearBtn.style.opacity = this.value ? '1' : '0';
            });
        }

        // è™•ç†æœç´¢éµç›¤äº‹ä»¶
        function handleSearchKeydown(e) {
            const results = document.getElementById('searchResults');
            if (!results) return;
            
            const resultItems = results.querySelectorAll('.search-result-item');
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedResultIndex = Math.min(selectedResultIndex + 1, resultItems.length - 1);
                    updateSelectedResult(resultItems);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    selectedResultIndex = Math.max(selectedResultIndex - 1, -1);
                    updateSelectedResult(resultItems);
                    break;
                case 'Enter':
                    e.preventDefault();
                    if (selectedResultIndex >= 0 && resultItems[selectedResultIndex]) {
                        resultItems[selectedResultIndex].click();
                    }
                    break;
                case 'Escape':
                    closeSearchResults();
                    document.getElementById('searchInput').blur();
                    break;
            }
        }

        // æ›´æ–°é¸ä¸­çš„æœç´¢çµæœ
        function updateSelectedResult(resultItems) {
            resultItems.forEach((item, index) => {
                if (index === selectedResultIndex) {
                    item.classList.add('highlight');
                    item.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                } else {
                    item.classList.remove('highlight');
                }
            });
        }

        // é¡¯ç¤ºæœç´¢å»ºè­°ï¼ˆæ­·å²è¨˜éŒ„å’Œç†±é–€æœç´¢ï¼‰
        function showSearchSuggestions() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query) return; // æœ‰è¼¸å…¥æ™‚ä¸é¡¯ç¤ºå»ºè­°
            
            closeSearchResults();
            
            // å‰µå»ºå»ºè­°å®¹å™¨
            const suggestionsContainer = document.createElement('div');
            suggestionsContainer.id = 'searchResults';
            suggestionsContainer.style.cssText = `
                position: fixed;
                top: 85px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 600px;
                max-height: 400px;
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 2000;
                overflow-y: auto;
                padding: 20px;
            `;
            
            let suggestionsHTML = '';
            
            // é¡¯ç¤ºæœç´¢æ­·å²
            if (searchHistory.length > 0) {
                suggestionsHTML += `
                    <div style="margin-bottom: 20px;">
                        <div style="margin-bottom: 10px; padding-bottom: 8px; border-bottom: 2px solid #e9ecef;">
                            <strong style="color: #667eea; font-size: 14px;">ğŸ• æœ€è¿‘æœç´¢</strong>
                        </div>
                        <div>
                            ${searchHistory.slice(0, 5).map(term => `
                                <div class="search-history-item" onclick="searchFromHistory('${term}')">
                                    <span class="search-history-icon">ğŸ•</span>
                                    <span>${term}</span>
                                    <span class="search-history-delete" onclick="removeFromHistory('${term}', event)">âœ•</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // é¡¯ç¤ºç†±é–€æœç´¢
            const popularSearches = getPopularSearches();
            if (popularSearches.length > 0) {
                suggestionsHTML += `
                    <div>
                        <div style="margin-bottom: 10px; padding-bottom: 8px; border-bottom: 2px solid #e9ecef;">
                            <strong style="color: #667eea; font-size: 14px;">ğŸ”¥ ç†±é–€æœç´¢</strong>
                        </div>
                        <div class="popular-tags">
                            ${popularSearches.map(term => `
                                <span class="popular-tag" onclick="searchFromHistory('${term}')">${term}</span>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®æœç´¢å»ºè­°ï¼ˆåŒ…å«ç”¨æˆ¶è¼¸å…¥ï¼‰
            safeSetHTML(suggestionsContainer, suggestionsHTML);
            document.body.appendChild(suggestionsContainer);
        }

        // å¾æ­·å²è¨˜éŒ„æœç´¢
        function searchFromHistory(term) {
            document.getElementById('searchInput').value = term;
            document.getElementById('searchInput').dispatchEvent(new Event('input'));
        }

        // ç§»é™¤æœç´¢æ­·å²
        function removeFromHistory(term, event) {
            event.stopPropagation();
            searchHistory = searchHistory.filter(t => t !== term);
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            showSearchSuggestions();
        }

        // ç²å–ç†±é–€æœç´¢
        function getPopularSearches() {
            return [
                'å®¤å…§è¨­è¨ˆ', 'æ°´é›»å·¥ç¨‹', 'æ²¹æ¼†', 'æœ¨å·¥', 
                'å†·æ°£', 'æ¸…æ½”', 'å¾‹å¸«', 'æœƒè¨ˆå¸«'
            ];
        }

        // æ·»åŠ åˆ°æœç´¢æ­·å²
        function addToSearchHistory(query) {
            // ç§»é™¤é‡è¤‡é …
            searchHistory = searchHistory.filter(t => t !== query);
            // æ·»åŠ åˆ°é–‹é ­
            searchHistory.unshift(query);
            // é™åˆ¶æ­·å²è¨˜éŒ„æ•¸é‡
            searchHistory = searchHistory.slice(0, 10);
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        }

        // æ¸…é™¤æœç´¢
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchInput').focus();
            clearHighlights();
            closeSearchResults();
            selectedResultIndex = -1;
        }

        // é«˜äº®é—œéµå­—
        function highlightKeyword(text, keyword) {
            if (!keyword) return text;
            
            const regex = new RegExp(`(${keyword})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // æ‹–æ‹½åŠŸèƒ½
        function startDrag(e) {
            if (e.target.closest('.branch-node, .sub-node, .center-node')) return;
            isDragging = true;
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;
            document.getElementById('mindmapContainer').classList.add('dragging');
        }

        function drag(e) {
            if (!isDragging) return;
            
            const deltaX = e.clientX - dragStart.x;
            const deltaY = e.clientY - dragStart.y;
            
            const container = document.getElementById('mindmapContainer');
            container.scrollLeft -= deltaX;
            container.scrollTop -= deltaY;
            
            dragStart.x = e.clientX;
            dragStart.y = e.clientY;
        }

        function endDrag() {
            isDragging = false;
            document.getElementById('mindmapContainer').classList.remove('dragging');
        }

        // æ»¾è¼ªæ»‘å‹•åŠŸèƒ½
        function handleZoom(e) {
            e.preventDefault();
            const container = document.getElementById('mindmapContainer');
            const scrollAmount = 50; // æ¯æ¬¡æ»¾å‹•çš„åƒç´ æ•¸
            
            if (e.deltaY > 0) {
                // å‘ä¸‹æ»¾å‹•
                container.scrollTop += scrollAmount;
            } else {
                // å‘ä¸Šæ»¾å‹•
                container.scrollTop -= scrollAmount;
            }
        }

        function zoomIn() {
            setZoom(currentZoom + 0.2);
        }

        function zoomOut() {
            setZoom(currentZoom - 0.2);
        }

        function setZoom(zoom) {
            currentZoom = Math.max(0.3, Math.min(2, zoom));
            const content = document.getElementById('mindmapContent');
            content.style.transform = `scale(${currentZoom})`;
            document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
        }

        // éµç›¤å¿«æ·éµ
        function handleKeydown(e) {
            if (e.target.tagName === 'INPUT') return;
            
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    if (isExpanded) collapseMindmap(); else expandMindmap();
                    break;
                case 'e':
                case 'E':
                    e.preventDefault();
                    expandAll();
                    break;
                case 'c':
                case 'C':
                    e.preventDefault();
                    collapseAll();
                    break;
                case 'r':
                case 'R':
                    e.preventDefault();
                    resetView();
                    break;
                case 'Escape':
                    closeDetails();
                    break;
            }
        }

        // æ§åˆ¶å‡½æ•¸
        function expandAll() {
            expandMindmap();
        }

        function collapseAll() {
            collapseMindmap();
        }

        function resetView() {
            collapseAll();
            setZoom(1);
            document.getElementById('mindmapContent').style.transform = 'scale(1)';
            setTimeout(() => {
                expandMindmap();
            }, 100);
        }

        function exportPNG() {
            const container = document.getElementById('mindmapContainer');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            
            html2canvas(container).then(canvas => {
                const link = document.createElement('a');
                link.download = 'è¯æ³°ä¸å‹•ç”¢å¿ƒæ™ºåœ–.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
        
        // æ¸¬è©¦å¼•è–¦è³‡æ–™ä¿å­˜åŠŸèƒ½
        function testReferralData() {
            safeLog.log('=== å¼•è–¦è³‡æ–™æ¸¬è©¦ ===');
            safeLog.log('ç•¶å‰å¼•è–¦è³‡æ–™åº«:', referralData);
            
            const savedData = localStorage.getItem('referralData');
            safeLog.log('æœ¬åœ°å­˜å„²çš„å¼•è–¦è³‡æ–™:', savedData ? JSON.parse(savedData) : 'ç„¡');
            
            // æ¸¬è©¦æ·»åŠ ä¸€å€‹å¼•è–¦è³‡æ–™
            const testReferral = {
                referrerCode: 'TEST001',
                companyName: 'æ¸¬è©¦å…¬å¸',
                phone: '0912-345-678',
                lineId: 'test_line',
                area: 'å°åŒ—å¸‚',
                note: 'æ¸¬è©¦å¼•è–¦',
                referralDate: new Date().toISOString()
            };
            
            const testService = 'æ¸¬è©¦æœå‹™';
            referralData[testService] = [testReferral];
            localStorage.setItem('referralData', JSON.stringify(referralData));
            
            safeLog.log('æ¸¬è©¦å¼•è–¦è³‡æ–™å·²æ·»åŠ :', testReferral);
            safeLog.log('æ›´æ–°å¾Œçš„å¼•è–¦è³‡æ–™åº«:', referralData);
        }
        
        // æ¸¬è©¦ç›´æ¥æ·»åŠ å¼•è–¦äººåŠŸèƒ½
        function testDirectAddReferral() {
            safeLog.log('=== æ¸¬è©¦ç›´æ¥æ·»åŠ å¼•è–¦äºº ===');
            
            // æ¨¡æ“¬é»æ“Šé …ç›®
            const testItem = 'æ³¥ä½œ';
            const testCategory = 'ğŸ”º ä¸Šæ¸¸ï½œä¾›æ‡‰ç«¯èˆ‡åŸææ–™';
            const testSubCategory = 'åŸºç¤å»ºæ';
            
            // è¨­ç½®currentDetails
            currentDetails = {
                item: testItem,
                category: testCategory,
                subCategory: testSubCategory
            };
            
            safeLog.log('è¨­ç½®currentDetails:', currentDetails);
            
            // æ¸¬è©¦addReferralå‡½æ•¸
            safeLog.log('æ¸¬è©¦addReferralå‡½æ•¸...');
            addReferral();
            
            safeLog.log('å¦‚æœçœ‹åˆ°å¼•è–¦ç™»è¨˜è¡¨å–®ï¼Œè¡¨ç¤ºåŠŸèƒ½æ­£å¸¸');
        }
        
        // æ¸¬è©¦Apps Scripté€£æ¥
        async function testAppsScriptConnection() {
            safeLog.log('=== æ¸¬è©¦ Apps Script é€£æ¥ ===');
            safeLog.log('Apps Script URL:', SHEET_CONFIG.APPS_SCRIPT_URL);
            
            try {
                // ä½¿ç”¨GETè«‹æ±‚æ¸¬è©¦é€£æ¥
                const response = await fetch(SHEET_CONFIG.APPS_SCRIPT_URL + '?test=1');
                const result = await response.json();
                
                if (response.ok) {
                    safeLog.log('âœ… Apps Script é€£æ¥æˆåŠŸ');
                    return true;
                } else {
                    safeLog.error('âŒ Apps Script é€£æ¥å¤±æ•—:', response.status);
                    return false;
                }
            } catch (error) {
                safeLog.error('âŒ Apps Script é€£æ¥éŒ¯èª¤:', error);
                safeLog.log('å˜—è©¦ä½¿ç”¨è¡¨å–®æäº¤æ–¹å¼...');
                return testWithFormSubmission();
            }
        }
        
        // ä½¿ç”¨è¡¨å–®æäº¤æ–¹å¼æ¸¬è©¦ï¼ˆé¿å…CORSå•é¡Œï¼Œä¸æœƒè·³å‡ºï¼‰
        function testWithFormSubmission() {
            safeLog.log('=== ä½¿ç”¨è¡¨å–®æäº¤æ–¹å¼æ¸¬è©¦ï¼ˆéš±è— iframeï¼‰ ===');
            
            // å‰µå»ºéš±è— iframe
            const iframe = document.createElement('iframe');
            iframe.name = 'test_' + Date.now();
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = SHEET_CONFIG.APPS_SCRIPT_URL;
            form.target = iframe.name;
            form.style.display = 'none';
            
            const testData = {
                action: 'test',
                timestamp: new Date().toISOString()
            };
            
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'data';
            input.value = JSON.stringify(testData);
            
            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
            
            // æ¸…ç†
            setTimeout(() => {
                try {
                    if (document.body.contains(form)) {
                        document.body.removeChild(form);
                    }
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                } catch (e) {
                    safeLog.warn('æ¸…ç†æ¸¬è©¦è¡¨å–®æ™‚ç™¼ç”ŸéŒ¯èª¤:', e);
                }
            }, 1000);
            
            safeLog.log('âœ… è¡¨å–®æäº¤æ¸¬è©¦å·²ç™¼é€ï¼ˆéš±è—æäº¤ï¼Œä¸æœƒè·³å‡ºï¼‰');
            return true;
        }
        
        // æ¸¬è©¦å¼•è–¦è³‡æ–™æäº¤
        async function testReferralSubmission() {
            safeLog.log('=== æ¸¬è©¦å¼•è–¦è³‡æ–™æäº¤ ===');
            
            const testData = [
                new Date().toISOString(),
                'æ¸¬è©¦æœå‹™',
                'TEST001',
                'æ¸¬è©¦å…¬å¸',
                '0912-345-678',
                'test_line',
                'å°åŒ—å¸‚',
                'æ¸¬è©¦å¼•è–¦'
            ];
            
            safeLog.log('æ¸¬è©¦è³‡æ–™:', testData);
            
            try {
                const success = await submitToAppsScript(testData, 'referral');
                if (success) {
                    safeLog.log('âœ… å¼•è–¦è³‡æ–™æäº¤æˆåŠŸ');
                    alert('âœ… å¼•è–¦è³‡æ–™æäº¤æˆåŠŸï¼è«‹æª¢æŸ¥Google Sheetsã€‚');
                } else {
                    safeLog.log('âŒ å¼•è–¦è³‡æ–™æäº¤å¤±æ•—');
                    alert('âŒ å¼•è–¦è³‡æ–™æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ConsoleéŒ¯èª¤è¨Šæ¯ã€‚');
                }
                return success;
            } catch (error) {
                safeLog.error('âŒ å¼•è–¦è³‡æ–™æäº¤éŒ¯èª¤:', error);
                alert('âŒ å¼•è–¦è³‡æ–™æäº¤éŒ¯èª¤: ' + error.message);
                return false;
            }
        }
        
        // é¡¯ç¤ºè³‡æ–™æŸ¥çœ‹åŠŸèƒ½
        function showDataView() {
            // ä½¿ç”¨å…¨å±€çš„ referralDataï¼ˆå¾ Google Sheets è¼‰å…¥çš„æœ€æ–°è³‡æ–™ï¼‰
            // å¦‚æœå…¨å±€è³‡æ–™ç‚ºç©ºï¼Œæ‰å˜—è©¦å¾ localStorage è®€å–
            const currentReferralData = (referralData && Object.keys(referralData).length > 0) 
                ? referralData 
                : JSON.parse(localStorage.getItem('referralData') || '{}');
            
            const accessLogs = JSON.parse(localStorage.getItem('contactAccessLogs') || '[]');
            
            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const totalReferrals = Object.values(currentReferralData).reduce((sum, refs) => {
                return sum + (Array.isArray(refs) ? refs.length : 1);
            }, 0);
            
            // å‰µå»ºè³‡æ–™æŸ¥çœ‹å®¹å™¨
            const dataContainer = document.createElement('div');
            dataContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
                backdrop-filter: blur(10px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                animation: fadeIn 0.3s ease-out;
            `;
            
            const dataDialog = document.createElement('div');
            dataDialog.style.cssText = `
                background: linear-gradient(145deg, #ffffff, #f8f9fa);
                padding: 0;
                border-radius: 20px;
                width: 95%;
                max-width: 900px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 25px 50px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.1);
                animation: slideUp 0.4s ease-out;
            `;
            
            let dataHTML = `
                <style>
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from { transform: translateY(50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    .data-header {
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 20px 30px;
                        border-radius: 20px 20px 0 0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .data-header h3 {
                        margin: 0;
                        font-size: 24px;
                        font-weight: 700;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    .close-btn {
                        background: rgba(255,255,255,0.2);
                        border: none;
                        color: white;
                        font-size: 28px;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.3s ease;
                    }
                    .close-btn:hover {
                        background: rgba(255,255,255,0.3);
                        transform: rotate(90deg);
                    }
                    .data-content {
                        padding: 30px;
                    }
                    .stats-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                        gap: 15px;
                        margin-bottom: 30px;
                    }
                    .stat-card {
                        background: linear-gradient(135deg, #f8f9ff, #ffffff);
                        border: 2px solid #e3e8ff;
                        border-radius: 15px;
                        padding: 15px;
                        text-align: center;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
                        transition: all 0.3s ease;
                    }
                    .stat-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
                    }
                    .stat-icon {
                        font-size: 32px;
                        margin-bottom: 8px;
                    }
                    .stat-number {
                        font-size: 28px;
                        font-weight: 700;
                        color: #667eea;
                        margin: 8px 0;
                    }
                    .stat-label {
                        font-size: 13px;
                        color: #666;
                        font-weight: 600;
                    }
                    .section-title {
                        font-size: 18px;
                        font-weight: 700;
                        color: #333;
                        margin: 25px 0 12px 0;
                        padding-bottom: 8px;
                        border-bottom: 3px solid #667eea;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    .referral-list {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                        gap: 12px;
                        margin-bottom: 20px;
                    }
                    @media (max-width: 768px) {
                        .stats-grid {
                            grid-template-columns: repeat(3, 1fr);
                            gap: 10px;
                        }
                        .stat-card {
                            padding: 12px;
                        }
                        .stat-icon {
                            font-size: 28px;
                            margin-bottom: 6px;
                        }
                        .stat-number {
                            font-size: 24px;
                            margin: 6px 0;
                        }
                        .stat-label {
                            font-size: 12px;
                        }
                        .referral-list {
                            grid-template-columns: repeat(2, 1fr);
                            gap: 10px;
                        }
                        .referral-item {
                            padding: 12px;
                        }
                        .referral-service {
                            font-size: 14px;
                        }
                        .referral-count {
                            font-size: 12px;
                        }
                        .section-title {
                            font-size: 16px;
                            margin: 20px 0 10px 0;
                        }
                        .data-content {
                            padding: 20px 15px;
                        }
                        .data-header {
                            padding: 15px 20px;
                        }
                        .data-header h3 {
                            font-size: 20px;
                        }
                    }
                    @media (max-width: 480px) {
                        .stats-grid {
                            grid-template-columns: repeat(3, 1fr);
                            gap: 8px;
                        }
                        .stat-card {
                            padding: 10px 8px;
                        }
                        .stat-icon {
                            font-size: 24px;
                            margin-bottom: 4px;
                        }
                        .stat-number {
                            font-size: 20px;
                            margin: 4px 0;
                        }
                        .stat-label {
                            font-size: 11px;
                        }
                        .referral-list {
                            grid-template-columns: repeat(2, 1fr);
                            gap: 8px;
                        }
                        .referral-item {
                            padding: 10px;
                        }
                        .referral-service {
                            font-size: 13px;
                        }
                        .referral-count {
                            font-size: 11px;
                        }
                        .log-item {
                            padding: 12px;
                        }
                        .log-service {
                            font-size: 14px;
                        }
                        .log-info {
                            font-size: 12px;
                        }
                        .log-time {
                            font-size: 11px;
                        }
                    }
                    .referral-item {
                        background: linear-gradient(135deg, #f8f9fa, #ffffff);
                        border-left: 4px solid #667eea;
                        border-radius: 10px;
                        padding: 15px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        transition: all 0.3s ease;
                    }
                    .referral-item:hover {
                        transform: translateX(5px);
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
                    }
                    .referral-service {
                        font-weight: 700;
                        color: #333;
                        font-size: 15px;
                        margin-bottom: 5px;
                    }
                    .referral-count {
                        color: #667eea;
                        font-weight: 600;
                        font-size: 13px;
                    }
                    .log-list {
                        max-height: 300px;
                        overflow-y: auto;
                    }
                    .log-item {
                        background: linear-gradient(135deg, #fff9e6, #ffffff);
                        border-left: 4px solid #ff9800;
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 12px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        transition: all 0.3s ease;
                    }
                    .log-item:hover {
                        transform: translateX(5px);
                        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.2);
                    }
                    .log-service {
                        font-weight: 700;
                        color: #333;
                        font-size: 15px;
                        margin-bottom: 5px;
                    }
                    .log-info {
                        color: #666;
                        font-size: 13px;
                        margin: 5px 0;
                    }
                    .log-time {
                        color: #999;
                        font-size: 12px;
                        margin-top: 8px;
                    }
                    .empty-state {
                        text-align: center;
                        padding: 40px;
                        color: #999;
                        font-size: 16px;
                    }
                    ::-webkit-scrollbar {
                        width: 8px;
                    }
                    ::-webkit-scrollbar-track {
                        background: #f1f1f1;
                        border-radius: 4px;
                    }
                    ::-webkit-scrollbar-thumb {
                        background: #667eea;
                        border-radius: 4px;
                    }
                    ::-webkit-scrollbar-thumb:hover {
                        background: #5a6fd8;
                    }
                </style>
                
                <div class="data-header">
                    <h3>ğŸ“Š è³‡æ–™æŸ¥çœ‹</h3>
                    <button class="close-btn" onclick="closeDataView()">Ã—</button>
                </div>
                
                <div class="data-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“‹</div>
                            <div class="stat-number">${Object.keys(currentReferralData).length}</div>
                            <div class="stat-label">æœå‹™é …ç›®</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘¥</div>
                            <div class="stat-number">${totalReferrals}</div>
                            <div class="stat-label">ç¸½å¼•è–¦äººæ•¸</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-number">${accessLogs.length}</div>
                            <div class="stat-label">ä½¿ç”¨è¨˜éŒ„æ•¸</div>
                        </div>
                    </div>
                    
                    ${Object.keys(currentReferralData).length > 0 ? `
                        <div class="section-title">ğŸ“‹ å¼•è–¦è³‡æ–™è©³æƒ…</div>
                        <div class="referral-list">
                            ${Object.keys(currentReferralData).map(service => {
                                const referrals = Array.isArray(currentReferralData[service]) 
                                    ? currentReferralData[service] 
                                    : (currentReferralData[service] ? [currentReferralData[service]] : []);
                                const count = referrals.length;
                                return `
                                    <div class="referral-item">
                                        <div class="referral-service">${service || 'æœªçŸ¥æœå‹™'}</div>
                                        <div class="referral-count">${count} ä½å¼•è–¦äºº</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“­</div>
                            <div>æš«ç„¡å¼•è–¦è³‡æ–™</div>
                        </div>
                    `}
                    
                    ${accessLogs.length > 0 ? `
                        <div class="section-title">ğŸ“ æœ€è¿‘ä½¿ç”¨è¨˜éŒ„</div>
                        <div class="log-list">
                            ${accessLogs.slice(-5).reverse().map(log => {
                                let time = 'æœªçŸ¥æ™‚é–“';
                                try {
                                    if (log.accessTime) {
                                        time = new Date(log.accessTime).toLocaleString('zh-TW');
                                    } else if (log.timestamp) {
                                        time = new Date(log.timestamp).toLocaleString('zh-TW');
                                    }
                                } catch (e) {
                                    time = log.accessTime || log.timestamp || 'æœªçŸ¥æ™‚é–“';
                                }
                                return `
                                    <div class="log-item">
                                        <div class="log-service">${log.serviceItem || 'æœªçŸ¥æœå‹™'}</div>
                                        <div class="log-info">å¼•è–¦äººï¼š${log.referrerCode || 'æœªçŸ¥'}</div>
                                        ${log.memberCode ? `<div class="log-info">æˆå“¡ç·¨è™Ÿï¼š${log.memberCode}${log.memberName ? ` (${log.memberName})` : ''}</div>` : ''}
                                        <div class="log-time">${time}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“­</div>
                            <div>æš«ç„¡ä½¿ç”¨è¨˜éŒ„</div>
                        </div>
                    `}
                </div>
            `;
            
            // ä½¿ç”¨å®‰å…¨æ–¹å¼è¨­ç½®è³‡æ–™å°è©±æ¡†ï¼ˆåŒ…å«ç”¨æˆ¶æ•¸æ“šï¼‰
            safeSetHTML(dataDialog, dataHTML);
            dataContainer.appendChild(dataDialog);
            document.body.appendChild(dataContainer);
        }
        
        // é—œé–‰è³‡æ–™æŸ¥çœ‹
        function closeDataView() {
            const dataContainer = document.querySelector('div[style*="z-index: 2000"]');
            if (dataContainer) {
                dataContainer.remove();
            }
        }
        
        // æ¸¬è©¦æœƒå“¡æœç´¢åŠŸèƒ½ï¼ˆå¯åœ¨æ§åˆ¶å°èª¿ç”¨ï¼‰
        window.testMemberSearch = async function(code) {
            safeLog.log('ğŸ§ª æ¸¬è©¦æœƒå“¡æœç´¢åŠŸèƒ½');
            safeLog.log('è¼¸å…¥ç·¨è™Ÿ:', code);
            
            // é‡æ–°è¼‰å…¥æœƒå“¡è³‡æ–™
            memberDataCache = null;
            memberDataCacheTime = null;
            
            const memberData = await loadMemberData();
            safeLog.log('ğŸ“Š æœƒå“¡è³‡æ–™æ•¸é‡:', Object.keys(memberData).length);
            
            // æ¸¬è©¦æœç´¢
            const result = await searchMemberName(code);
            safeLog.log('ğŸ¯ æœç´¢çµæœ:', result || 'æœªæ‰¾åˆ°');
            
            return { memberData, result };
        };
        
        // æŸ¥çœ‹ç•¶å‰æœƒå“¡è³‡æ–™ï¼ˆå¯åœ¨æ§åˆ¶å°èª¿ç”¨ï¼‰
        window.showMemberData = function() {
            try {
                if (memberDataCache) {
                    safeLog.log('ğŸ“Š ç•¶å‰æœƒå“¡è³‡æ–™ç·©å­˜:');
                    // å‰µå»ºä¸åŒ…å«å¯†ç¢¼çš„å‰¯æœ¬ç”¨æ–¼é¡¯ç¤º
                    const sanitizedData = {};
                    Object.keys(memberDataCache).forEach(code => {
                        const member = memberDataCache[code];
                        sanitizedData[code] = {
                            name: member.name,
                            professionalCategory: member.professionalCategory
                        };
                    });
                    if (IS_DEVELOPMENT) {
                        console.table(sanitizedData);
                    }
                } else {
                    safeLog.log('ğŸ“Š ç•¶å‰æœƒå“¡è³‡æ–™ç·©å­˜: ç„¡');
                }
                safeLog.log('ğŸ“Š ç·©å­˜æ™‚é–“:', memberDataCacheTime ? new Date(memberDataCacheTime).toLocaleString() : 'ç„¡');
                safeLog.log('ğŸ“Š æœƒå“¡è³‡æ–™æ•¸é‡:', memberDataCache ? Object.keys(memberDataCache).length : 0);
            } catch (error) {
                safeLog.error('æŸ¥çœ‹æœƒå“¡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
            
            return memberDataCache;
        };
    </script>
    
    <!-- å¼•å…¥html2canvasåº«ç”¨æ–¼åŒ¯å‡ºåŠŸèƒ½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- ç‰ˆæ¬Šè²æ˜ -->
    <div style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.9); padding: 8px; text-align: center; font-size: 11px; color: #666; z-index: 1000; border-top: 1px solid #e0e0e0;">
        Â© 2025 è¯åœ°ç”¢é‘½çŸ³åˆ†æœƒ ç‰ˆæ¬Šæ‰€æœ‰ | å¼•è–¦å¹³å°ç³»çµ±
    </div>
</body>
</html>